define("odsp-shared/utilities/resources/ResourceScope",["require","exports"],function(){var e=function(){function e(e){this._parent=e,this._handles={}}return e.prototype.consume=function(e){var t,r=e.id,i=this._getHandle(r);if(!i)throw new Error('Resource ID "'+r+'" ('+e.name+") is being consumed, but has not been exposed by a parent scope.");t=i.instance;var n=this._handles[r];return n||(this._handles[r]={scope:i.scope,instance:t}),t},e.prototype.expose=function(e,t){var r=e.id;return this._handles[r]={scope:this,instance:t},t},e.prototype.isExposed=function(e){var t=this._getHandle(e.id);return!!t&&!!t.instance},e.prototype.injected=function(e){var t=this,r=function(){for(var r=[],i=0;i<arguments.length;i++)r[i-0]=arguments[i];return this.resources=t,e.apply(this,r)};return r.prototype=e.prototype,r},e.prototype.dispose=function(){this._handles={}},e.prototype._getHandle=function(e){for(var t,r=this;!(t=r._handles[e])&&r._parent;)r=r._parent;return t},e}();return e}),define("odsp-next/resources/LoggingResourceKeys",["require","exports","odsp-shared/utilities/resources/ResourceKey"],function(e,t,r){var i=function(){function e(){}return e.beacon=r("beacon"),e.rumOneHelper=r("rumOneHelper"),e}();return i}),define("odsp-next/resources/SPOResourceKeys",["require","exports","odsp-shared/utilities/resources/ResourceKey"],function(e,t,r){var i;return function(e){"use strict";e.hostSettings=r("hostSettings"),e.context=r("context"),e.listContext=r("listContext"),e.listItems=r("listItems")}(i||(i={})),i}),define("odsp-next/dataSources/base/odb/ServerData",["require","exports"],function(){var e=function(){function e(e,t){this._request=e,this._url=t}return e.prototype.getValue=function(t){var r=void 0;switch(t){case e.DataValueKeys.SourceURL:r=this._url;break;case e.DataValueKeys.CorrelationId:r=this._request.getResponseHeader("SPRequestGuid");break;case e.DataValueKeys.Status:try{r=this._request.status}catch(i){}break;case e.DataValueKeys.AuthenticationRedirect:r=this._request.getResponseHeader("X-Forms_Based_Auth_Required");break;case e.DataValueKeys.ResponseText:r=this._request.responseText}return r},e.DataValueKeys={SourceURL:"SourceUrl",CorrelationId:"CorrelationId",Status:"Status",AuthenticationRedirect:"AuthenticationRedirect",ResponseText:"ResponseText"},e}();return e}),define("odsp-next/utilities/uri/Uri",["require","exports","odsp-utilities/object/ObjectUtil","odsp-shared/utilities/string/StringHelper"],function(e,t,r,i){var n=function(){function e(e,t){this._queryCaseInsensitive=!1,this._pathCaseInsensitive=!1,this._scheme="",this._user="",this._host="",this._port="",this._path="",this._pathSegments=[],this._pathEncoded="",this._query={},this._fragment="",Boolean(t)&&(this._queryCaseInsensitive=Boolean(t.queryCaseInsensitive),this._pathCaseInsensitive=Boolean(t.pathCaseInsensitive)),this._parseURI(e)}return e.concatenate=function(t,r){return e.ensureTrailingSlash(t)+e.ensureNoPrecedingSlash(r)},e.ensureNoPrecedingSlash=function(e){return"/"===e[0]?e.substr(1):e},e.ensureTrailingSlash=function(e){return"/"!==e[e.length-1]?e+"/":e},e.prototype.getScheme=function(){return this._scheme},e.prototype.setScheme=function(e){this._scheme=e},e.prototype.getAuthority=function(){return this._getAuthority(!1)},e.prototype.setAuthority=function(e){this._parseAuthority(e)},e.prototype.getUser=function(){return this._user},e.prototype.getHost=function(){return this._host},e.prototype.getPort=function(){return this._port},e.prototype.getPath=function(e){var t=this._path;return Boolean(e)&&null!==t&&t.lastIndexOf("/")===t.length-1&&(t=t.slice(0,-1)),t},e.prototype.setPath=function(e){e&&"/"!==e[0]&&(e="/"+e),this._parsePath(e)},e.prototype.getPathSegments=function(){return this._pathSegments},e.prototype.getLastPathSegment=function(){return 0===this._pathSegments.length?"":this._pathSegments[this._pathSegments.length-1]},e.prototype.getQuery=function(e){return this._serializeQuery(e)},e.prototype.setQuery=function(e){var t=this._deserializeQuery(e);this.setQueryFromObject(t)},e.prototype.getQueryAsObject=function(){return this._query},e.prototype.setQueryFromObject=function(e){this._query={};for(var t in e)e.hasOwnProperty(t)&&this.setQueryParameter(t,e[t])},e.prototype.getQueryParameter=function(e){var t=null,r=this._query;if(this._queryCaseInsensitive){e=e.toLowerCase();for(var i in r)this._query.hasOwnProperty(i)&&i.toLowerCase()===e&&(t=r[i])}else t=r[e];return t||null},e.prototype.setQueryParameter=function(e,t){var r=this._decodeQueryString(e),i=this._decodeQueryString(t);this._query[r]=i},e.prototype.removeQueryParameter=function(e){var t=this._decodeQueryString(e);delete this._query[t]},e.prototype.getFragment=function(){return this._fragment},e.prototype.setFragment=function(e){"#"===e[0]&&(e=e.substring(1)),this._fragment=this._decodeQueryString(e)},e.prototype.equals=function(e){return i.equalsCaseInsensitive(this._scheme,e.getScheme())&&this._user===e.getUser()&&i.equalsCaseInsensitive(this._host,e.getHost())&&this._port===e.getPort()&&this._fragment===e.getFragment()&&this._equalsCaseAppropriate(this.getPath(!0),e.getPath(!0),this._pathCaseInsensitive)&&this._equalsCaseAppropriate(this.getQuery(),e.getQuery(),this._queryCaseInsensitive)},e.prototype.equivalent=function(e){var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r.toLowerCase()]=e[r].toLowerCase());return t};return i.equalsCaseInsensitive(this._scheme,e.getScheme())&&i.equalsCaseInsensitive(this._user,e.getUser())&&i.equalsCaseInsensitive(this._host,e.getHost())&&i.equalsCaseInsensitive(this._port,e.getPort())&&i.equalsCaseInsensitive(this.getPath(!0),e.getPath(!0))&&r.deepCompare(t(this.getQueryAsObject()),t(e.getQueryAsObject()))&&i.equalsCaseInsensitive(this._fragment,e.getFragment())},e.prototype.toString=function(e){return this._getStringInternal(!0,e)},e.prototype.getDecodedStringForDisplay=function(){return this._getStringInternal(!1)},e.prototype.getStringWithoutQueryAndFragment=function(){return this._getStringWithoutQueryAndFragmentInternal(!0)},e.prototype._equalsCaseAppropriate=function(e,t,r){return r?i.equalsCaseInsensitive(e,t):e===t},e.prototype._getStringInternal=function(e,t){var r=this._getStringWithoutQueryAndFragmentInternal(e,t),i=this.getQuery(e);return i&&(r+="?"+i),this._fragment&&(r+="#"+(e?encodeURIComponent(this._fragment):this._fragment)),r},e.prototype._getStringWithoutQueryAndFragmentInternal=function(e,t){var r="";this._scheme&&(r+=(e?encodeURIComponent(this._scheme):this._scheme)+":");var i=this._getAuthority(e,t);return i&&(r+="//"+i),this._pathEncoded&&(r+=e?this._pathEncoded:this._path),r},e.prototype._deserializeQuery=function(e){var t={};0===e.indexOf("?")&&(e=e.substring(1));for(var r=e.split(/[;&]+/),i=0;i<r.length;i++){var n=r[i],o=n.split("=");if(o.length>0){var s=o[0];if(s.length>0){var a="";2===o.length&&(a=o[1]),t[s]=a}}}return t},e.prototype._serializeQuery=function(e){e=Boolean(e);var t="";for(var r in this._query)if(this._query.hasOwnProperty(r)){var i=r,n=this._query[r];e&&(i=encodeURIComponent(i),n=encodeURIComponent(n)),t+=null===n||""===n?i+"=&":i+"="+n+"&"}return""!==t&&(t=t.slice(0,-1)),t},e.prototype._parseURI=function(t){var r=t,n=r.indexOf("#");if(n>=0){var o=r.substring(n+1);this.setFragment(o),r=r.substring(0,n)}var s=i.findOneOf(r,e.DELIMITERS);if(!(s>=0))return void this.setPath(r);var a=r.indexOf(":");a>=0&&a===s&&(this.setScheme(r.substring(0,s)),r=r.substring(s+1));var u="",l=r.indexOf("//");if(l>=0&&0===l){r=r.substring(2);var c=i.findOneOf(r,e.AUTHORITY_TERMINATORS);if(c>=0?(u=r.substring(0,c),r=r.substring(c)):(u=r,r=null),this.setAuthority(u),!r)return void this.setPath("")}var d=r.indexOf("?");d>=0&&(this.setQuery(r.substring(d+1)),r=r.substring(0,d)),this.setPath(r)},e.prototype._parseAuthority=function(e){this._host=e;var t=e.lastIndexOf("@");t>=0&&(this._host=this._host.substring(t+1));var r=this._host.indexOf(":");if(!(0>t&&0>r)){var i=e;0>t?this._host=i:(this._user=i.substring(0,t),this._host=i.substring(t+1)),r>=0&&(this._port=this._host.substring(r+1),this._host=this._host.substring(0,r)),this._user=decodeURIComponent(this._user),this._host=decodeURIComponent(this._host)}},e.prototype._parsePath=function(e){this._path=decodeURIComponent(e),this._pathSegments=[],this._pathEncoded=e;for(var t=e.split("/"),r=0;r<t.length;++r){var i=decodeURIComponent(t[r]);this._pathSegments[r]=i}""===this._pathSegments[0]&&this._pathSegments.shift(),""===this._pathSegments[this._pathSegments.length-1]&&this._pathSegments.pop()},e.prototype._getAuthority=function(e,t){void 0===t&&(t={});var r,i,n,o=t&&t.doNotPercentEncodeHost,s="";return e?(r=encodeURIComponent(this._user).replace("%3A",":"),i=o?this._host:encodeURIComponent(this._host),n=encodeURIComponent(this._port)):(r=this._user,i=this._host,n=this._port),""!==r&&(s=r+"@"),""!==this._host&&(s+=i),""!==this._port&&(s+=":"+n),s},e.prototype._decodeQueryString=function(e){var t=e;try{t=decodeURIComponent(e.replace(/\+/g," "))}catch(r){}return t},e.DELIMITERS=";/?:@&=$,",e.AUTHORITY_TERMINATORS="/?",e}();return n}),define("odsp-next/utilities/logging/rumone/APICallPerformanceData",["require","exports"],function(){var e=function(){function e(e,t,r,i){this.url=e,this.duration=t,this.correlationId=r,this.status=i}return e}();return e}),define("odsp-next/utilities/logging/rumone/PageTransitionType",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.fullPageLoad=4]="fullPageLoad"}(e||(e={})),e}),define("odsp-next/utilities/logging/rumone/RUMOneSLAPI",["require","exports"],function(){var e=function(){function e(){this.ServerCorrelationId=null,this.ScenarioId=null,this.EUPL=void 0,this.ServerUrl=null,this.Browser=null,this.ClientIP=null,this.Flights=null,this.PageTransitionType=void 0,this.AppCache=void 0,this.FolderNav=void 0,this.InitiationTimeOffset=void 0,this.ServerRequestDuration=void 0,this.IISLatency=void 0,this.TTFB=void 0,this.TTLB=void 0,this.ParseTime=void 0,this.RenderTime=void 0,this.PreRender=void 0,this.PostRender=void 0,this.DataFetch=void 0,this.APICallCount=void 0,this.APICallDurationSum=void 0,this.Control1Id=null,this.Control1RenderTime=void 0,this.Control2Id=null,this.Control2RenderTime=void 0,this.Control3Id=null,this.Control3RenderTime=void 0,this.Control4Id=null,this.Control4RenderTime=void 0,this.SharePointRequestCountTotal=void 0,this.SharePointRequestCountASPX=void 0,this.SharePointRequestCountJS=void 0,this.SharePointRequestCountCSS=void 0,this.SharePointRequestCountIMG=void 0,this.SharePointRequestCountNoneCached=void 0,this.SharePointRequestBytes=void 0,this.SharePointRequestDownloadTime=void 0,this.CDNRequestCountTotal=void 0,this.CDNRequestCountASPX=void 0,this.CDNRequestCountJS=void 0,this.CDNRequestCountCSS=void 0,this.CDNRequestCountIMG=void 0,this.CDNRequestCountNoneCached=void 0,this.CDNRequestBytes=void 0,this.CDNRequestDownloadTime=void 0,this.ThirdPartyRequestCountTotal=void 0,this.ThirdPartyRequestCountASPX=void 0,this.ThirdPartyRequestCountJS=void 0,this.ThirdPartyRequestCountCSS=void 0,this.ThirdPartyRequestCountIMG=void 0,this.ThirdPartyRequestCountNoneCached=void 0,this.ThirdPartyRequestBytes=void 0,this.ThirdPartyRequestDownloadTime=void 0,this.FromEdge=void 0,this.W3cNavigationStart=void 0,this.W3cUnloadEventStart=void 0,this.W3cUnloadEventEnd=void 0,this.W3cFetchStart=void 0,this.W3cRedirectStart=void 0,this.W3cRedirectEnd=void 0,this.W3cDomainLookupStart=void 0,this.W3cDomainLookupEnd=void 0,this.W3cConnectStart=void 0,this.W3cSecureConnectStart=void 0,this.W3cConnectEnd=void 0,this.W3cRequestStart=void 0,this.W3cResponseStart=void 0,this.W3cResponseEnd=void 0,this.W3cDomLoading=void 0,this.W3cDomLoadEnd=void 0,this.W3cLoadEventStart=void 0,this.W3cLoadEventEnd=void 0,this.MDSDownloadStart=void 0,this.MDSParseDeltaStart=void 0,this.MDSParseDeltaEnd=void 0,this.MDSGCStart=void 0,this.MDSGCEnd=void 0,this.MDSCSSStart=void 0,this.MDSCSSEnd=void 0,this.MDSInnerHTMLStart=void 0,this.MDSScriptLoaderStart=void 0,this.MDSScriptLoaderEnd=void 0,this.MDSAnimationStart=void 0,this.MDSAnimationEnd=void 0,this.MDSParallelDownloadStart=void 0,this.MDSParallelDownloadEnd=void 0}return e}();return e}),define("odsp-next/utilities/logging/rumone/RUMOneErrorsSLAPI",["require","exports"],function(){var e=function(){function e(){this.Reason=null,this.Message=null}return e}();return e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/events/RUMOneDataUpload.event",["require","exports","odsp-utilities/logging/SingleEventBase","odsp-utilities/logging/Manager"],function(e,t,r,i){var n=function(e){function t(t){e.call(this,"RUMOneDataUpload,","RUMOneDataUpload",t)}return __extends(t,e),t.enabled=function(){return i.default.evaluateSamplingRampValue("RUMOneEventLogging")},t.logData=function(e,i){return r.SingleEventBase._logData(t,e,i)},t.prototype.isEnabled=function(){return i.default.evaluateSamplingRampValue("RUMOneEventLogging")},t.prototype.setSingleData=function(e){this.data.streamName=this.cleanString(e.streamName),this.data.dictionary=e.dictionary},t.fullName="RUMOneDataUpload,",t.shortName="RUMOneDataUpload",t.metadata={streamName:{type:"String",isMetric:!1},dictionary:{type:"Object",isMetric:!1}},t}(r.SingleEventBase);t.RUMOneDataUpload=n,n.prototype.metadata=n.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/utilities/logging/rumone/RUMOneLogger",["require","exports","../../features/Features","odsp-utilities/async/Async","./PageTransitionType","./RUMOneSLAPI","./RUMOneErrorsSLAPI","odsp-utilities/logging/events/RUMOneDataUpload.event"],function(e,t,r,i,n,o,s,a){var u;!function(e){e[e.Incomplete=1]="Incomplete",e[e.ReadyToUpload=2]="ReadyToUpload",e[e.Uploaded=3]="Uploaded",e[e.TimeOut=4]="TimeOut"}(u||(u={}));var l=function(){function e(e){this.async=new i(this),this.dataStartTime=Number((new Date).getTime()),this.performanceData=null,this.dataState=u.Incomplete,this.controls=[],this.apis=[],this.perfDataTimer=null,this.expectedControls=[],this.isW3cTimingCollected=!1,this.isW3cResourceTimingCollected=!1,this.tempData={},this.performanceData=null,this.loggingFunc=e,this.getPerformanceData(),this.setPerfDataTimer()}return e.isNullOrUndefined=function(e){return null===e||void 0===e},e.getRUMOneLogger=function(){if(!r.default.isFeatureEnabled(r.default.RUMOne))return null;if(!e.rumOneLogger)try{e.rumOneLogger=new e(function(e,t){a.RUMOneDataUpload.logData({streamName:e,dictionary:t})})}catch(t){e.rumOneLogger=null}return e.rumOneLogger},e.prototype.getPerformanceData=function(){return this.performanceData||(this.performanceData=new o,this.logMessageInConsole("RUMOne object initiated!")),this.performanceData},e.prototype.resetLogger=function(){this.dataStartTime=(new Date).getTime(),this.dataState=u.Incomplete,this.isW3cTimingCollected=!1,this.isW3cResourceTimingCollected=!1,this.expectedControls=[],this.controls=[],this.apis=[],this.tempData={},this.performanceData=null,this.getPerformanceData(),this.clearPerfDataTimer(),this.setPerfDataTimer(),this.logMessageInConsole("Reset performance Logger Done")},e.prototype.logPerformanceData=function(e,t){(e||this.performanceData||this.verifyPropertyMatchingSchema(e))&&(this.getPerformanceData(),this.performanceData[e]=t)},e.prototype.getPerformanceDataPropertyValue=function(e){return this.performanceData&&e&&this.verifyPropertyMatchingSchema(e)?this.performanceData[e]:null},e.prototype.verifyPropertyMatchingSchema=function(e){var t=this.getRUMOnePropertyNames(this.performanceData);return-1!==t.join().indexOf(e)},e.prototype.addExpectedControl=function(e){-1===this.expectedControls.indexOf(e)&&this.expectedControls.push(e)},e.prototype.writeServerCorrelationId=function(e){this.isCollected("ServerCorrelationId")||this.logPerformanceData("ServerCorrelationId",e)},e.prototype.writeServerUrl=function(e){if(!this.isCollected("ServerUrl")){var t=e||window.location.href;this.logPerformanceData("ServerUrl",t)}},e.prototype.writeServerSideLatency=function(e,t){this.isCollected("ServerRequestDuration")||(this.logPerformanceData("ServerRequestDuration",e),this.logPerformanceData("IISLatency",t))},e.prototype.writeControlPerformanceData=function(e){if(e){for(var t=!1,r=0;r<this.controls.length;r++)if(this.controls[r].controlId===e.controlId){t=!0;break}t||this.controls.push(e)}},e.prototype.writeAPICallPerformanceData=function(e){e&&this.apis.push(e)},e.prototype.readAPICallPerformanceData=function(){return this.apis},e.prototype.writeAppCache=function(e){this.isCollected("AppCache")||this.logPerformanceData("AppCache",e)},e.prototype.writePageTransitionType=function(t,r){this.isCollected("PageTransitionType")&&!r||e.isNullOrUndefined(t)||t!==n.fullPageLoad&&t!==n.none||this.logPerformanceData("PageTransitionType",t)},e.prototype.writeScenarioId=function(e,t){(!this.isCollected("ScenarioId")||t)&&this.logPerformanceData("ScenarioId",e)},e.prototype.collectW3CPerfTimings=function(){if(!this.isW3cTimingCollected){var e=["navigationStart","unloadEventStart","unloadEventEnd","fetchStart","redirectStart","redirectEnd","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domComplete","loadEventStart","loadEventEnd"],t=this.getWindowPerfTimingObject();if(t){for(var r=0;r<e.length;r++){var i=t[e[r]];i&&this.logPerformanceData(this.getW3cTimingName(e[r]),Number(i))}this.isW3cTimingCollected=!0}}},e.prototype.collectW3cResourceTimings=function(){if(!this.isW3cResourceTimingCollected&&window.performance&&window.performance.getEntriesByType){for(var e=performance.getEntriesByType("resource"),t=document.getElementsByTagName("iframe"),r=0;r<t.length;r++){var i=null;try{i=t[r].contentWindow.performance}catch(n){}i&&i.getEntriesByType&&e.concat(i.getEntriesByType("resource"))}var o={};o.SharePoint=function(e){return/\.sharepoint\.com|\.spoppe\.com/i.test(e.name)},o.CDN=function(e){return/(cdn(ppe)?|static(ppe)?)\.sharepointonline\.com|\.akamaihd\.net/i.test(e.name)},o.ThirdParty=function(e){return!o.SharePoint(e)&&!o.CDN(e)};var s={};s.ASPX=function(e){return/\.aspx/i.test(e.name)},s.JS=function(e){return/script/i.test(e.initiatorType)},s.CSS=function(e){return/link|css/i.test(e.initiatorType)},s.IMG=function(e){return/img/i.test(e.initiatorType)};for(var a=Object.keys(o),r=0;r<a.length;r++){var u=a[r],l=this.categorizeResourceRequests(e,{from:o[u],requestType:null});this.logPerformanceData(u+"RequestCountTotal",l.length.toString());for(var c=Object.keys(s),d=0;d<c.length;d++){var p=c[d];this.logPerformanceData(u+"RequestCount"+p,this.categorizeResourceRequests(l,{from:null,requestType:s[p]}).length.toString())}l.length>0&&this.logPerformanceData(u+"RequestDownloadTime",(l.reduce(function(e,t){return e+t.duration},0)/l.length).toString())}this.isW3cResourceTimingCollected=!0}},e.prototype.saveTempData=function(e,t){this.tempData[e]=t},e.prototype.readTempData=function(e){return this.tempData[e]},e.prototype.writeRenderTime=function(e){this.isCollected("RenderTime")||this.logPerformanceData("RenderTime",e)},e.prototype.writePreRenderTime=function(e){this.isCollected("PreRender")||this.logPerformanceData("PreRender",e)},e.prototype.writePostRenderTime=function(e){this.isCollected("PostRender")||this.logPerformanceData("PostRender",e)},e.prototype.writeDataFetchTime=function(e){this.isCollected("DataFetch")||this.logPerformanceData("DataFetch",e)},e.prototype.isRunning=function(){return!(this.dataState===u.Uploaded||this.dataState===u.TimeOut)},e.prototype.logMessageInConsole=function(e){var t=!1;try{if("sessionStorage"in window&&window.sessionStorage){var r=window.sessionStorage.enableRUMOneDebugging;t=r&&"true"===r.toLowerCase()}}catch(i){}t&&"undefined"!=typeof console&&console&&console.log(e)},e.prototype.logObjectForDebugging=function(e,t){var r=e+" : "+JSON.stringify(t);this.logMessageInConsole(r)},e.prototype.isCollected=function(t){return!e.isNullOrUndefined(this.getPerformanceDataPropertyValue(t))},e.prototype.getRUMOnePropertyNames=function(t){var r=[],i=0;if(!e.isNullOrUndefined(t))for(var n in t)t.hasOwnProperty(n)&&(r[i++]=n);return r},e.prototype.setPerfDataTimer=function(){this.perfDataTimer=this.async.setTimeout(this.loopForDataCompleteness,e.CHECK_INTERVAL)},e.prototype.clearPerfDataTimer=function(){e.isNullOrUndefined(this.perfDataTimer)||(this.async.clearTimeout(this.perfDataTimer),this.perfDataTimer=null)},e.prototype.categorizeResourceRequests=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i];t.from&&!t.from(n)||t.requestType&&!t.requestType(n)||r.push(n)}return r},e.prototype.loopForDataCompleteness=function(){if(this.clearPerfDataTimer(),this.logObjectForDebugging("RUMONE",this.performanceData),this.logObjectForDebugging("RUMOne DataState",String(this.getReadableDataState(this.dataState))),this.logObjectForDebugging("Control Performance Data",this.controls),this.logObjectForDebugging("API Performance Data",this.apis),this.isRunning()){for(var t=!0,r=[],i=0;i<e.KeyMetrics.length;i++){var n=this.getPerformanceDataPropertyValue(e.KeyMetrics[i]);e.isNullOrUndefined(n)&&(t=!1,r.push(e.KeyMetrics[i]))}if(this.dataState=t?u.ReadyToUpload:u.Incomplete,this.dataState===u.Incomplete)Number((new Date).getTime())-Number(this.dataStartTime)>e.ERROR_TIMEOUT?(this.dataState=u.TimeOut,this.setAPIDataToRUMOne(),this.writeServerUrl(null),this.uploadPerfData(),this.reportErrors("TimeOut","Did not get key perf metrics in "+String(e.ERROR_TIMEOUT)+" milliseconds. Missed metrics: "+r.join()+".")):(this.processControlPerfData(),this.readyToComputeEUPL()&&this.setEUPL());else{this.setAPIDataToRUMOne(),this.writeServerUrl(null);try{this.uploadPerfData()}catch(o){!function(e){"undefined"!=typeof console&&Boolean(console)&&console.error(e)}("PerformanceLogger error writing RUMOne data: "+String(o))}this.dataState=u.Uploaded}this.setPerfDataTimer()}},e.prototype.getReadableDataState=function(e){for(var t in u)if(e===Number(u[t]))return t;return"NaN"},e.prototype.writeControlDataToRUMOne=function(e){if(e){var t=e.controlId,r=e.renderTime;if(!this.isCollected("Control1Id"))return this.logPerformanceData("Control1Id",t),void this.logPerformanceData("Control1RenderTime",r);if(!this.isCollected("Control2Id"))return this.logPerformanceData("Control2Id",t),void this.logPerformanceData("Control2RenderTime",r);if(!this.isCollected("Control3Id"))return this.logPerformanceData("Control3Id",t),void this.logPerformanceData("Control3RenderTime",r);this.isCollected("Control4Id")||(this.logPerformanceData("Control4Id",t),this.logPerformanceData("Control4RenderTime",r))}},e.prototype.processControlPerfData=function(){for(var e=0;e<this.controls.length;e++){var t=this.controls[e],r=this;!Boolean(t.renderTime)&&t.renderTimeRequiredDataChecker(r,t)&&(t.renderTime=t.renderTimeCalculator(r,t),this.writeControlDataToRUMOne(t))}},e.prototype.readyToComputeEUPL=function(){for(var e=0,t=0;t<this.expectedControls.length;t++){var r=this.lookUpControls(this.expectedControls[t],this.controls);r&&Boolean(r.renderTime)&&e++}return this.expectedControls.length>0&&this.expectedControls.length===e},e.prototype.lookUpControls=function(e,t){if(t)for(var r=0;r<t.length;r++)if(e===t[r].controlId)return t[r];return null},e.prototype.setEUPL=function(){if(!this.isCollected("EUPL")){for(var e=0,t=0;t<this.controls.length;t++){var r=this.controls[t];Boolean(r.renderTime)&&e<r.renderTime&&(e=r.renderTime)}this.logPerformanceData("EUPL",e)}},e.prototype.setAPIDataToRUMOne=function(){for(var e=0,t=0,r=0;r<this.apis.length;r++){var i=this.apis[r];i&&(e++,t+=i.duration)}this.logPerformanceData("APICallCount",e),this.logPerformanceData("APICallDurationSum",t)},e.prototype.getW3cTimingName=function(e){return"secureConnectionStart"!==e?"W3c"+e.charAt(0).toUpperCase()+e.slice(1):"W3csecureConnectStart"},e.prototype.getWindowPerfTimingObject=function(){var t=window.self.performance;return e.isNullOrUndefined(t)||e.isNullOrUndefined(t.timing)?null:t.timing},e.prototype.uploadPerfData=function(){this.performanceData&&this.loggingFunc&&(this.dataState===u.ReadyToUpload||this.dataState===u.TimeOut)&&this.loggingFunc("RUMOne",this.getPerformanceData())},e.prototype.reportErrors=function(e,t){var r=new s;r.Reason=e,r.Message=t,this.loggingFunc&&this.loggingFunc("RUMOneErrors",r)},e.rumOneLogger=null,e.CHECK_INTERVAL=100,e.ERROR_TIMEOUT=3e4,e.KeyMetrics=["EUPL","ScenarioId"],e}();return l}),define("odsp-next/dataSources/base/odb/ServerConnection",["require","exports","./ServerData","odsp-utilities/encoding/UriEncoding","../../../utilities/uri/Uri","../../../utilities/logging/rumone/APICallPerformanceData","../../../utilities/logging/rumone/RUMOneLogger","../../item/odb/ListViewDataPrefetchHelper"],function(e,t,r,i,n,o,s,a){var u=function(){function e(t,r){this._currentRequest=null,this._needsRequestDigest=!0,this._requestCanaryForAuth=!1,this._webUrl=null,this._alwaysGetDigest=!1,this._needsRequestDigest=t!==!1,this._needsRequestDigest&&!e._requestDigest&&this._tryLoadDigestFromPage(),r&&(this._webUrl=r,this._alwaysGetDigest=!0)}return e._isXhrAborted=function(e){try{if(4===e.readyState&&("undefined"==typeof e.status||0===e.status))return!0;if(Boolean(e.isCancelled))return!0}catch(t){return!0}return!1},e.prototype.abort=function(){if(null!=this._currentRequest){var e=this._currentRequest;e.isCancelled=!0,this._currentRequest.abort(),this._currentRequest=null}},e.prototype.isRequestActive=function(){return Boolean(this._currentRequest)},e.prototype.getServerDataFromUrl=function(e,t,r,i,n,o,s,a,u){void 0===o&&(o="POST");var l=new XMLHttpRequest;if(l.open(o,e,!0),l.setRequestHeader("accept","application/json;odata=verbose"),Boolean(a)?l.setRequestHeader("Content-Type",a):n?l.setRequestHeader("Content-Type","application/json;odata=verbose"):l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),Boolean(s))for(var c in s)l.setRequestHeader(c,s[c]);this._currentRequest=l;var d=this,p=function(n){d._needsRequestDigest&&Boolean(n)&&l.setRequestHeader("x-requestdigest",n),l.onreadystatechange=function(){d._onReadyStateChange(l,e,t,r,u)},l.send(i)};this._needsRequestDigest?this._ensureRequestDigest(p,r):p(null)},e.prototype._ensureRequestDigest=function(t,r){var i=new Date;return!this._alwaysGetDigest&&e._requestDigest&&e._lastDigestLoaded&&i.getTime()-e._lastDigestLoaded.getTime()<1e3*e._requestDigestInterval?void t(e._requestDigest):void this._ensureRequestDigestWorker(t,r)},e.prototype._ensureRequestDigestWorker=function(t,i){var o=function(i){var n=i.getValue(r.DataValueKeys.ResponseText),o=JSON.parse(n);e._requestDigest=o.d.GetContextWebInformation.FormDigestValue,e._requestDigestInterval=o.d.GetContextWebInformation.FormDigestTimeoutSeconds-e.INTERVAL_ADJUST,e._lastDigestLoaded=new Date,t&&t(e._requestDigest)},s=function(e){t?t(null):i&&i(e)},a=new e(!1);t||(a._requestCanaryForAuth=!0),a.getServerDataFromUrl(n.concatenate(this._webUrl?this._webUrl:window._spPageContextInfo.webServerRelativeUrl,"/_api/contextinfo"),o,s,null,!0,"POST",null,null,Boolean(i))},e.prototype._onReadyStateChange=function(t,u,l,c,d){if(4===t.readyState)if(this._currentRequest=null,t.onreadystatechange=null,e._isXhrAborted(t))c();else{var p=new r(t,u),h=p.getValue(r.DataValueKeys.Status),m=(new Date).getTime(),f=s.getRUMOneLogger();if(Boolean(f)){var g=new o(u,Number(t.getResponseHeader("SPClientServiceRequestDuration")),t.getResponseHeader("SPRequestGuid"),h);window.sessionStorage.setItem(a.LISTVIEW_PREFETCH_REQUEST_SERVER_DURATION_KEY,t.getResponseHeader("SPClientServiceRequestDuration")),f.writeAPICallPerformanceData(g),f.saveTempData("appDataFetchEnd",m)}if(this._requestCanaryForAuth){if(this._requestCanaryForAuth=!1,403===h){try{c(p)}catch(y){}if(!d){var v=p.getValue(r.DataValueKeys.AuthenticationRedirect);if(Boolean(v)){var _=new n(v);_.setQueryParameter("ReturnUrl",i.encodeURIComponent(window.location.href)),window.location.href=_.toString()}}}else{try{c(p)}catch(y){}d||(v=window._spPageContextInfo.webServerRelativeUrl+"/_layouts/15/AccessDenied.aspx",Boolean(v)&&(_=new n(v),_.setQueryParameter("Source",i.encodeURIComponent(window.location.href)),_.setQueryParameter("Type","list"),_.setQueryParameter("correlation",r.DataValueKeys.CorrelationId),window.location.href=_.toString()))}return}if(200===h||201===h||204===h)return void l(p);if(403===h)return void(d?this._ensureRequestDigestWorker(null,function(){return c(p)}):this._ensureRequestDigestWorker(null));c(p)}},e.prototype._tryLoadDigestFromPage=function(){var t=null,r=document.getElementsByName("__REQUESTDIGEST");if(Boolean(r)&&1===r.length){t=r[0];var i=window._spPageContextInfo;null!==t&&"input"===t.tagName.toLowerCase()&&"hidden"===t.type.toLowerCase()&&null!==t.value&&t.value.length>0&&i&&i.updateFormDigestPageLoaded&&(e._requestDigest=t.value,e._lastDigestLoaded=i.updateFormDigestPageLoaded,e._requestDigestInterval=e.DEFAULT_DIGEST_INTERVAL-e.INTERVAL_ADJUST)}},e.DEFAULT_DIGEST_INTERVAL=1800,e.INTERVAL_ADJUST=10,e}();return u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/events/Qos.event",["require","exports","odsp-utilities/logging/PairedEventBase","./ResultTypeEnum","./ResultTypeEnum"],function(e,t,r,i,n){t.ResultTypeEnum=n.ResultTypeEnum;var o=function(e){function t(t,r){e.call(this,"Qos,","Qos",t,r)}return __extends(t,e),t.enabled=function(){return!0},t.instrumentPromise=function(e,i,n,o,s,a,u){return r.PairedEventBase._instrumentPromise(t,e,i,n,o,s,a,u)},t.prototype.setStartData=function(e){this.data.name=this.cleanString(e.name),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),"undefined"!=typeof e.resultType&&(this.data.resultType=e.resultType),"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.setEndData=function(e){"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),this.data.resultType=e.resultType,"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.end=function(e){return this._end(e)},t.prototype.verbose=function(e){return this._verbose(e)},t.prototype.setTimeout=function(e,t){return this._setTimeout(e,t)},t.fullName="Qos,",t.shortName="Qos",t.metadata={name:{type:"String",isKey:!0,isMetric:!1},resultCode:{type:"String",isMetric:!1},resultType:{type:"ResultTypeEnum",baseType:"Enum",typeRef:i.ResultTypeEnum,isMetric:!1},error:{type:"String",isMetric:!1},extraData:{type:"Object",isMetric:!1},extraMetrics:{type:"Object",isMetric:!1}},t}(r.PairedEventBase);t.Qos=o,o.prototype.metadata=o.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),define("odsp-next/dataSources/base/odb/DataSource",["require","exports","odsp-utilities/async/Promise","./ServerConnection","./ServerData","odsp-utilities/logging/events/Api.event","odsp-utilities/logging/events/Qos.event","../../../utilities/logging/rumone/RUMOneLogger"],function(e,t,r,i,n,o,s,a){var u=function(){function e(t){this._context=e.getContext(t)}return e.getContext=function(e){var t=e.webAbsoluteUrl;"/"===t[t.length-1]&&(t=t.substr(0,t.length-1));var r=e.webServerRelativeUrl;"/"===r[r.length-1]&&(r=r.substr(0,r.length-1));var i=r?t.split(r)[0]:t;return{cultureName:e.currentUICultureName,currentLanguage:Number(e.currentLanguage),env:e.env,isCustomList:e.isCustomList,layoutsUrl:e.layoutsUrl,siteClientTag:e.siteClientTag,userId:e.userId,userKey:e.systemUserKey,userLoginName:e.userLoginName,serverUrl:i,webServerRelativeUrl:e.webServerRelativeUrl,webTemplate:e.webTemplate,webUrl:t}
},e.prototype.done=function(){},e.prototype.getDataSourceName=function(){return"DataSource"},e.prototype.isRequestingListViewData=function(){return!1},e.prototype.getData=function(e,t,u,l,c,d,p,h,m,f){void 0===c&&(c="POST");var g=this,y=e();h="number"==typeof h&&h>=0?h:0;var v=0,_=new i(!g.isRequestingListViewData(y),f?this._context.webUrl:null),S=function(e,r){var i,o,a,f=Boolean(l)?l():null;i=function(r){var i=g.getDataSourceName()+"."+u,a=new s.Qos({name:i}),l=r.getValue(n.DataValueKeys.ResponseText),c=r.getValue(n.DataValueKeys.Status),d=r.getValue(n.DataValueKeys.CorrelationId),p=!1;try{var h=t(l);p=!0,a.end({resultType:s.ResultTypeEnum.Success,extraData:{CorrelationId:d,HttpStatus:c}}),_=null,e(h),g.done()}catch(m){p||a.end({resultType:s.ResultTypeEnum.Failure,error:m,extraData:{CorrelationId:d,HttpStatus:c}}),o(r)}},o=function(e){var t=g.getDataSourceName()+"."+u,i=new s.Qos({name:t});if(!e)return void i.end({resultType:s.ResultTypeEnum.ExpectedFailure,resultCode:"RequestAborted"});var o=e.getValue(n.DataValueKeys.Status),l=s.ResultTypeEnum.Failure,c=o;(403===o||404===o)&&(h=0,l=s.ResultTypeEnum.ExpectedFailure);var d=null;try{var p=e.getValue(n.DataValueKeys.ResponseText);d=p;var m=JSON.parse(p);m.error.status=o,d=m.error}catch(f){}i.end({resultType:l,error:d,resultCode:c,extraData:{CorrelationId:e.getValue(n.DataValueKeys.CorrelationId),HttpStatus:o}}),h>v?(++v,a()):r(d)},(a=function(){_.getServerDataFromUrl(y,i,o,f,!0,c,d,p,m)})()},T=function(){Boolean(_)&&_.abort()},b=(new Date).getTime(),C=a.getRUMOneLogger();return Boolean(C)&&(Boolean(C.readTempData("appDataFetchStart"))||C.saveTempData("appDataFetchStart",b),Boolean(C.readTempData("mainAPIUrl"))||C.saveTempData("mainAPIUrl",y)),o.Api.instrumentPromise({url:y,name:this.getDataSourceName()+"."+u+".Promise"},function(){return new r.default(S,T)},null,function(e){return e&&"Canceled"===e.name?{error:e,resultCode:"Canceled",resultType:s.ResultTypeEnum.ExpectedFailure}:e&&403===e.status?{error:e,resultCode:"AccessDenied",resultType:s.ResultTypeEnum.ExpectedFailure}:{error:e,resultType:s.ResultTypeEnum.Failure}})},e}();return u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/item/odb/ItemDataSource",["require","exports","odsp-utilities/async/Promise","../../../dataSources/base/odb/DataSource","../../../resources/DataSourceResourceKeys","odsp-utilities/logging/events/Api.event","odsp-utilities/logging/events/Qos.event","odsp-utilities/logging/events/Qos.event","./ListViewDataPrefetchHelper","odsp-utilities/async/Async","../../../utilities/logging/rumone/APICallPerformanceData","../../../utilities/logging/rumone/RUMOneLogger"],function(e,t,r,i,n,o,s,a,u,l,c,d){var p=function(e){function t(t,r){e.call(this,r),this._itemsStore=t,this._urlDataSource=this.resources.consume(n.url),this._listContext={},this._capabilities={supportsMoveCopy:!0,supportsMoveCopyOnShared:!1,supportsMoveCopyFilterParams:!0}}return __extends(t,e),t._getModifiedByFromObject=function(e){var t="";if(Boolean(e)&&Boolean(e.length)&&Boolean(e[e.length-1])){var r=e[e.length-1];t=r.title||r.Title}return t},t._getModifiedByFromString=function(e){if(!Boolean(e))return"";var t,r=e.lastIndexOf("\n");return t=r>-1?e.substr(r+1):e},t.prototype.getDataSourceName=function(){return"ItemDataSource"},t.prototype.isRequestingListViewData=function(e){return Boolean(e.match(new RegExp("web/.*/RenderListDataAsStream")))},t.prototype.getCapabilities=function(){return this._capabilities},t.prototype.getItem=function(e){var t=this,r=function(){return t.getData(function(){return t._getServerConnectionUrl(e.parentKey)},function(r){var i=null;return void 0!==r&&null!==r&&(i=JSON.parse(r)),t._processData(e.parentKey,e.queryType,i)},"GetData",function(){return t._getAdditionalPostData()},"POST",t._getAdditionalHeaders())};return this.tryGetPrefetchedListViewData(function(){return t._getServerConnectionUrl(e.parentKey)},function(r){var i=null;return void 0!==r&&null!==r&&(i=JSON.parse(r)),t._processData(e.parentKey,e.queryType,i)},"GetItemFromPrefetchedData",function(){return t._getAdditionalPostData()},r)},t.prototype.tryGetPrefetchedListViewData=function(e,t,i,n,p){var h=new s.Qos({name:"GetPrefetchedListViewData"}),m=this;if(!Boolean(window.sessionStorage))return h.end({resultType:a.ResultTypeEnum.Failure,resultCode:"SessionStorageFailure"}),p();var f=e();if(!m.isRequestingListViewData(f))return p();var g=window[u.LISTVIEW_PREFETCH_CREATE_HASH_CODE_KEY];if(!Boolean(g))return h.end({resultType:a.ResultTypeEnum.Failure,resultCode:"PrefetchNotStarted"}),p();var y=n(),v=g(f,y);if(null==window.sessionStorage.getItem(v))return h.end({resultType:a.ResultTypeEnum.Failure,resultCode:"UrlOrPayLoadNotMatch",extraData:{AdditionalPostData:null==y?"null":y}}),p();var _=function(e,r){var i,n,o,s;i=function(r){try{var i=t(r);e(i),m.done()}catch(o){n(r)}},s=function(){var t=p();t.then(e,r)},o=function(){var e,t=window.sessionStorage.getItem(v);e=function(e){if(t=window.sessionStorage.getItem(v),null!=t&&t.length>0&&null!=e&&200===e){h.end({resultType:a.ResultTypeEnum.Success}),i(t);var r=window.sessionStorage.getItem(u.LISTVIEW_PREFETCH_REQUEST_CORRELATIONID_KEY),n=window.sessionStorage.getItem(u.LISTVIEW_PREFETCH_REQUEST_SERVER_DURATION_KEY);if(r&&n){var o=d.getRUMOneLogger();if(Boolean(o)){o.saveTempData("mainAPIUrl",f);var l=new c(f,Number(n),r,e);o.writeAPICallPerformanceData(l)}}}else 403===e?(h.end({resultType:a.ResultTypeEnum.ExpectedFailure,resultCode:"PrefetchUnauthorized",extraData:{AdditionalPostData:null==y?"null":y,ResponseStatusCode:e}}),s()):(h.end({resultType:a.ResultTypeEnum.Failure,resultCode:"PrefetchFailed",extraData:{AdditionalPostData:null==y?"null":y,ResponseStatusCode:e}}),s())},null!=t&&(t.length>0?(i(t),h.end({resultType:a.ResultTypeEnum.Success})):window[u.LISTVIEW_PREFETCH_COMPLETED_CALLBACK_KEY]=e),window.sessionStorage.removeItem(v),window.sessionStorage.removeItem(u.LISTVIEW_PREFETCH_START_TIME_MARK_KEY),window.sessionStorage.removeItem(u.LISTVIEW_PREFETCH_COMPLETED_CALLBACK_KEY),window.sessionStorage.removeItem(u.LISTVIEW_PREFETCH_CREATE_HASH_CODE_KEY),window.sessionStorage.removeItem(u.LISTVIEW_PREFETCH_REQUEST_CORRELATIONID_KEY),window.sessionStorage.removeItem(u.LISTVIEW_PREFETCH_REQUEST_SERVER_DURATION_KEY)};var g=new l(this);g.setTimeout(o,0)};return o.Api.instrumentPromise({url:f,name:this.getDataSourceName()+"."+i},function(){return new r.default(_,null)},null,function(e){return e&&"Canceled"===e.name?{error:e,resultCode:"Canceled",resultType:a.ResultTypeEnum.ExpectedFailure}:{error:e,resultType:a.ResultTypeEnum.Failure}})},t.prototype.getSingleItem=function(){return null},t.prototype.getItemContents=function(){return null},t.prototype.getColumns=function(){return null},t.prototype.reportAbuse=function(){return null},t.prototype.getFilterData=function(){return null},t.prototype.createDocument=function(){return null},t.prototype.createCustomDocument=function(){return null},t.prototype.createShortcut=function(){return null},t.prototype.createFolder=function(){return null},t.prototype.deleteItems=function(){return null},t.prototype.renameItem=function(){return null},t.prototype.restoreItems=function(){return null},t.prototype.copyItemsAsync=function(){return null},t.prototype.restoreAll=function(){return null},t.prototype.copyItems=function(){return null},t.prototype.moveItems=function(){return null},t.prototype.removeFromRecent=function(){return r.default.wrap(!1)},t.prototype.requestReview=function(){return null},t.prototype.removeMountPoint=function(){return r.default.wrap(!1)},t.prototype.createMountPoint=function(){return null},t.prototype.saveSortOrder=function(){return null},t.prototype.getWorkProgress=function(){return null},t.prototype.cancelWork=function(){return null},t.prototype.getOpenInClientDetails=function(){return null},t.prototype.removeCoverPhotos=function(){return null},t.prototype.addCoverPhotos=function(){return null},t.prototype.changeFolderType=function(){return null},t.prototype.updateItemProperty=function(){return null},t.prototype.removeFromSharedList=function(){return null},t.prototype.getItemOcrTextContent=function(){return r.default.wrap("")},t.prototype.updateItemOcrInfo=function(){return null},t.prototype.processReferral=function(){return null},t.prototype.updateBundle=function(){return null},t.prototype.rotateItems=function(){return null},t.prototype.getDownloadUrl=function(e){return e.video?r.default.wrap(e.openUrl):null},t.prototype.updateViewCount=function(){return r.default.wrap(null)},t.prototype._getAdditionalPostData=function(){return null},t.prototype._getAdditionalHeaders=function(){return null},t.prototype._getServerConnectionUrl=function(){return null},t.prototype._processData=function(){return[]},t}(i);return p}),define("odsp-shared/base/Rotation",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.right=1]="right",e[e.flip=2]="flip",e[e.left=3]="left"}(e||(e={})),e}),define("odsp-next/models/item/OneDriveItem",["require","exports","../../dataSources/url/QueryType","odsp-shared/base/Rotation"],function(e,t,r,i){var n=function(){function e(e){this.isDropEnabled=!1,this.permissions={High:0,Low:0},this.key=e,this.revision=0,this.queryType=r.Files,this.displayType=r.Files,this.isPlaceholder=!0,this.rotation=i.none,this.properties={},this.statistics={views:0,viewsUnique:0,viewsRecent:0,viewsRecentUnique:0}}return e}();return n}),define("odsp-next/dataSources/url/OverlayType",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.oneUp=1]="oneUp"}(e||(e={})),e}),define("odsp-next/dataSources/url/ExternalAliasEnum",["require","exports"],function(){var e;return function(e){e[e.iosappstore=0]="iosappstore"}(e||(e={})),e}),define("odsp-next/models/itemPicker/ItemPickerSelectionMode",["require","exports"],function(e,t){var r;!function(e){e[e.single=0]="single",e[e.multiple=1]="multiple"}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("odsp-next/models/itemPicker/ItemPickerViewType",["require","exports"],function(e,t){var r;!function(e){e[e.all=0]="all",e[e.files=1]="files",e[e.folders=2]="folders"}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("odsp-next/models/itemPicker/ItemPickerLinkType",["require","exports"],function(e,t){var r;!function(e){e[e.webView=0]="webView",e[e.web=1]="web",e[e.download=2]="download"}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("odsp-next/models/itemPicker/ItemPickerAccessLevel",["require","exports"],function(e,t){var r;!function(e){e[e.readOnly=0]="readOnly",e[e.readWrite=1]="readWrite"}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/models/selection/BaseSelectionModel",["require","exports","knockout","odsp-shared/base/BaseModel"],function(e,t,r,i){function n(){"use strict";return!0}var o=100;!function(e){e[e.multiple=0]="multiple",e[e.single=1]="single"}(t.SelectionMode||(t.SelectionMode={}));var s=t.SelectionMode,a=function(e){function t(t){e.call(this,t),this.mode=t.mode||s.multiple,this.maximumSelectedCount=t.maximumSelectedCount,this._getItemKey=t.getItemKey,this._canSelectItem=t.canSelectItem||n,this._allSelectables={},this._items=[],this.selectedCount=r.observable(),this.selection=r.observableArray().extend({rateLimit:{timeout:o,method:"notifyWhenChangesStop"}}),this.isAllSelected=r.observable(!1).extend({rateLimit:{timeout:o,method:"notifyWhenChangesStop"}}),this.focusedItem=r.observable(),this.isActive=r.observable(!0),this.clear(!0)}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._allSelectables=null},t.prototype.clear=function(e){var t=this;this._isSelectedDefaultState=!1,this._keysExempt={},this._exemptCount=0,e&&(this._focusIndex=-1,this._anchorIndex=-1,this._anchorKey=null,this.focusedItem(null)),this.selection.removeAll(),this.isAllSelected(!1),r.ignoreDependencies(function(){t._updateAllSelectables(function(e){return{isSelected:t.isItemSelected(e)}})}),this._updateSelectedCount()},t.prototype.setItems=function(e,t){this._items=e,t&&this.clear(!0),this._onItemsChanged()},t.prototype.getItems=function(){return this._items},t.prototype.canSelectItem=function(e){return(!this.maximumSelectedCount||this.selectedCount()<this.maximumSelectedCount||this.isItemSelected(e))&&this._canSelectItem(e)},t.prototype.isItemSelected=function(e){var t=this._getItemKey(e),r=!!this._keysExempt[t];return this._canSelectItem(e)&&(this._isSelectedDefaultState&&!r||!this._isSelectedDefaultState&&r)},t.prototype.isIndexSelected=function(e){var t=this._items[e];return this.isItemSelected(t)},t.prototype.setItemSelected=function(e,t){var i=this,n=this._getItemKey(e);if(n&&n in this._keyToIndex&&t!==this.isItemSelected(e)){if(t&&!r.ignoreDependencies(function(){return i.canSelectItem(e)}))return;this.mode===s.single&&t&&this.clear(),this._keysExempt[n]?delete this._keysExempt[n]:this._keysExempt[n]=e,t?this.selection.push(e):this.selection.remove(e),this._updateSelectable(n,{isSelected:this.isItemSelected(e)}),this._exemptCount+=t?1:-1,this._updateIsAllSelected(),this._updateSelectedCount()}},t.prototype.setIndexSelected=function(e,t){this.setItemSelected(this._items[e],t)},t.prototype.toggleItemSelected=function(e){this.setItemSelected(e,!this.isItemSelected(e))},t.prototype.toggleIndexSelected=function(e){this.toggleItemSelected(this._items[e])},t.prototype.setItemFocus=function(e,t){var r=this.focusedItem.peek(),i=this._getItemKey(e),n=this._getItemKey(r),o=this._keyToIndex[i];e!==r&&(this._updateSelectable(n,{isFocused:!1}),o>=0?(this._focusIndex=o,this.focusedItem(e||null),n=this._getItemKey(e),this._updateSelectable(n,{isFocused:!0})):this.focusedItem(null)),t||(this._anchorIndex=o||-1,this._anchorKey=i)},t.prototype.setIndexFocus=function(e,t){this.setItemFocus(this._items[e],t)},t.prototype.invokeFocusedItem=function(e){var t=this.focusedItem.peek(),r=this._getItemKey(t),i=this._allSelectables[r];if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(o.onInvoke)return o.onInvoke(e)}return!0},t.prototype.setIsActive=function(e){this.isActive(e)},t.prototype.selectToItem=function(e){if(this.mode===s.single)this.setItemSelected(e,!0);else{var t=this._items,r=this._getItemKey(e);if(r){var i=this._keyToIndex[r],n=Math.min(t.length-1,Math.max(0,this._anchorIndex)),o=Math.max(i,n);if(t.length&&o>=0)for(var a=Math.min(i,n);o>=a;a++)this.setItemSelected(t[a],!0)}}},t.prototype.selectToIndex=function(e){this.selectToItem(this._items[e])},t.prototype.selectAll=function(){var e=this;this.maximumSelectedCount&&this.maximumSelectedCount<this._items.length||(this._isSelectedDefaultState=!0,this._keysExempt={},this._exemptCount=0,this.mode===s.multiple&&this.selection(this._items.slice(0)),this._updateIsAllSelected(),this._updateAllSelectables(function(t){return{isSelected:e.isItemSelected(t)}}),this._updateSelectedCount())},t.prototype.toggleSelectAll=function(){this.isAllSelected.peek()||this.maximumSelectedCount<this._items.length&&this.selectedCount.peek()?this.clear():this.selectAll()},t.prototype.registerSelectable=function(e,t){var r=this;this._allSelectables[e]||(this._allSelectables[e]=[]),this._allSelectables[e].push(t);var i=this._items[this._keyToIndex[e]];return this._updateSelectable(e,{isFocused:this.focusedItem.peek()===i,isSelected:this.isItemSelected(i)}),{dispose:function(){if(r._allSelectables&&r._allSelectables[e]){var i=r._allSelectables[e];if(1===i.length)delete r._allSelectables[e];else{var n=i.indexOf(t);n>=0&&i.splice(n,1)}}}}},t.prototype.getFocusIndex=function(){return this._focusIndex},t.prototype.getMissingIndicies=function(){for(var e=[],t=this._items,r=0;t&&r<t.length;r++){var i=t[r],n=this.isItemSelected(i);n&&!this._getItemKey(i)&&e.push(r)}return e},t.prototype._updateIsAllSelected=function(){this.isAllSelected(!!(this._items&&this._items.length>0&&(this._isSelectedDefaultState&&0===this._exemptCount||!this._isSelectedDefaultState&&this._exemptCount===this._items.length)))},t.prototype._updateSelectable=function(e,t){var r=this._allSelectables[e];if(r)for(var i=0;i<r.length;i++){var n=r[i];for(var o in t){var s=t[o];n[o]&&n[o](s)}}},t.prototype._updateAllSelectables=function(e){for(var t in this._allSelectables){var r=this._items[this._keyToIndex[t]],i=e(r);this._updateSelectable(t,i)}},t.prototype._onItemsChanged=function(){var e=this;this._keyToIndex={};var t=this._items,i=[],n=this._getItemKey(this.focusedItem.peek()),o=this._anchorKey;if(t){for(var s=function(t){return r.ignoreDependencies(function(){return e._getItemKey(t)})},a=0;t&&a<t.length;a++){var u=t[a],l=s(u);l&&(this._keyToIndex[l]=a,n&&n===l&&(this._focusIndex=a),o&&o===l&&(this._anchorIndex=a)),this.isItemSelected(u)&&i.push(u)}this._focusIndex=t.length?Math.min(t.length-1,this._focusIndex):-1,this.setIndexFocus(this._focusIndex,!0),this.selection(i),this._updateIsAllSelected(),this._updateSelectedCount()}},t.prototype._updateSelectedCount=function(){var e;e=this._isSelectedDefaultState?this._items.length-this._exemptCount:this._exemptCount,this.selectedCount(e)},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}),define("odsp-next/dataSources/itemPicker/ItemPickerConstants",["require","exports","../../models/itemPicker/ItemPickerSelectionMode","../../models/itemPicker/ItemPickerViewType","../../models/itemPicker/ItemPickerLinkType","../../models/itemPicker/ItemPickerAccessLevel","../../models/selection/BaseSelectionModel","../../models/item/ItemType"],function(e,t,r,i,n,o,s,a){t.MSA_CLIENT_ID_PARAM="msa_client_id",t.AAD_CLIENT_ID_PARAM="aad_client_id",t.RETURN_URL_PARAM="ru",t.VIEW_TYPE_PARAM="view_type",t.SELECTION_MODE_PARAM="selection_mode",t.LINK_TYPE_PARAM="link_type",t.ACCESS_LEVEL_PARAM="access",t.PROMPT_PARAM="prompt",t.PROMPT_SELECT_ACCUNT_VALUE="select_account",t.SELECTION_MODE_VALUES={"":r.default.single,multi:r.default.multiple,multiple:r.default.multiple,single:r.default.single},t.SELECTION_MODE_MAPPING=(u={},u[r.default.multiple]=s.SelectionMode.multiple,u[r.default.single]=s.SelectionMode.single,u),t.VIEW_TYPE_VALUES={"":i.default.all,file:i.default.files,folder:i.default.folders},t.VIEW_TYPE_MAPPINGS=(l={},l[i.default.all]=void 0,l[i.default.files]=function(e){var t=e&&e.peek&&e.peek();return!t||t.type!==a.Folder},l[i.default.folders]=function(e){var t=e&&e.peek&&e.peek();return!t||t.type===a.Folder},l),t.LINK_TYPE_VALUES={"":n.default.web,weblink:n.default.web,downloadlink:n.default.download,webviewlink:n.default.webView},t.ACCESS_LEVEL_VALUES={"":o.default.readOnly,read:o.default.readOnly,readwrite:o.default.readWrite},t.SELECTION_MAX_ITEMS=10;var u,l}),define("odsp-next/utilities/navigation/WindowStateManager",["require","exports"],function(e,t){t.VALUE_KEY="value";var r=function(){function e(){}return e.prototype.getState=function(e){var t=this._getNormalizedWindowName();return t[e]},e.prototype.setState=function(e,t){var r=this._getNormalizedWindowName();r[e]=t,window.name=JSON.stringify(r)},e.prototype.removeState=function(e){var t=this._getNormalizedWindowName(),r=t[e];return delete t[e],window.name=JSON.stringify(t),r},e.prototype._getNormalizedWindowName=function(){var e;try{e=JSON.parse(name)||{}}catch(r){e={}}return"object"!=typeof e&&(i={},i[t.VALUE_KEY]=e,e=i),e;var i},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("odsp-next/dataSources/url/odb/UrlDataSource",["require","exports","../QueryType","../PageType","../OverlayType","../../../utilities/navigation/NavigationHelper","../../../resources/UtilityResourceKeys","../../../resources/SPOResourceKeys","../ExternalAliasEnum","odsp-shared/utilities/string/StringHelper","../../../models/item/ItemType","../../../utilities/uri/Uri","knockout","./UrlQueryKeys","./UrlPageParamValues","../../itemPicker/ItemPickerConstants","../../../utilities/navigation/WindowStateManager"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m,f,g){var y=function(){function e(){this._navigation=this.resources.consume(s.navigation),this._context=this.resources.consume(a.context),this._updateViewParamsFromWindowName()}return e.getKeyParts=function(e){return o.deserializeQuery(e)},e.getQueryUrl=function(e,t){var r={};return e!==i.Files&&m.default.values[e]&&(r[h.default.pageParamKey]=m.default.values[e]),r[h.default.queryTypeParamKey]=t.toString(),"#"+o.serializeQuery(r)},e.prototype.getDefaultRootItemId=function(){return this._listContext||(this._listContext=this.resources.consume(a.listContext)),this._listContext&&this._listContext.listUrl||"root"},e.prototype.getQueryType=function(){return this._navigation.viewParams[h.default.queryTypeParamKey]?Number(this._navigation.viewParams[h.default.queryTypeParamKey]):r.Files},e.prototype.getPageType=function(){var e;if(!this._navigation.viewParams[h.default.pageParamKey])return i.Files;switch(this._navigation.viewParams[h.default.pageParamKey]){case m.default.values[i.FilePicker]:e=i.FilePicker;break;default:e=i.Files}return e},e.prototype.getOverlayType=function(){return n.none},e.prototype.isCurrentQuery=function(e){return this._navigation.viewParams[h.default.queryTypeParamKey]?e===r.Files?0===Object.keys(this._navigation.viewParams).length||this._navigation.viewParams[h.default.queryTypeParamKey].toString()===r.Files.toString():this._navigation.viewParams[h.default.queryTypeParamKey].toString()===e.toString():e===r.Files},e.prototype.getKey=function(e){return o.serializeQuery({id:e.id||e.FileRef||e.ServerRelativeUrl||this.getDefaultRootItemId()},null,!0)},e.prototype.getFocusItemKey=function(){var e=this._navigation.viewParams,t=null;return(e[h.default.parentIdParamKey]||e[h.default.parentQueryTypeParamKey])&&(t={},e[h.default.parentIdParamKey]&&(t[h.default.idParamKey]=e[h.default.idParamKey]),e[h.default.parentQueryTypeParamKey]&&(t[h.default.queryTypeParamKey]=e[h.default.queryTypeParamKey])),t&&o.serializeQuery(t,null,!0)||null},e.prototype.getCurrentItemKey=function(e){var t={},i=this.getQueryType();return e=e||this._navigation.viewParams,t[h.default.idParamKey]=i===r.Files?this.getDefaultRootItemId():h.default.queryTypeParamKey+i,p.utils.extend(t,e),(t[h.default.parentIdParamKey]||t[h.default.parentQueryTypeParamKey])&&(t[h.default.parentIdParamKey]&&(t[h.default.idParamKey]=t[h.default.parentIdParamKey]),t[h.default.parentQueryTypeParamKey]&&(t[h.default.queryTypeParamKey]=t[h.default.parentQueryTypeParamKey]),delete t[h.default.parentIdParamKey],delete t[h.default.parentQueryTypeParamKey]),this.getKey(t)},e.prototype.areKeysEqual=function(e,t){var r=o.deserializeQuery(e),i=o.deserializeQuery(t);return r[h.default.idParamKey]===i[h.default.idParamKey]},e.prototype.getQueryUrl=function(t,r){return e.getQueryUrl(t,r)},e.prototype.getAppsUrl=function(){return null},e.prototype.getSearchQueryUrl=function(){return null},e.prototype.getQueryParamValue=function(){return null},e.prototype.getOwnerId=function(){return""},e.prototype.getRootUrl=function(){return"/"},e.prototype.getSharedByUrl=function(){return""},e.prototype.getExternalUrl=function(t){var r=u[t];return e.EXTERNAL_URL_FORMAT+r},e.prototype.getAppSubfolder=function(){return"odb"},e.prototype.getUploadStorageUrl=function(){return""},e.prototype.getVideoPlayerUrl=function(){return""},e.prototype.getTaggingOptionsUrl=function(){return""},e.prototype.getAllPhotosForPlaceUrl=function(){return""},e.prototype.getSearchFilterQueryUrl=function(){return""},e.prototype.isSearchFilterApplied=function(){return!1},e.prototype.getItemHintRedirectViewParams=function(e){return e},e.prototype.getDefaultClickUrl=function(e,t){var r,i=o.deserializeQuery(e.key),n=p.utils.extend({},this._navigation.viewParams);if(p.utils.extend(n,i),delete n[h.default.parentIdParamKey],delete n[h.default.parentQueryTypeParamKey],this.getFocusItemKey()&&t&&t.preferCurrentView)r=this._getMediaUrl(e,n);else switch(e.type){case c.Media:r=this._getMediaUrl(e,n);break;case c.Folder:if(delete n[h.default.queryTypeParamKey],Boolean(e.openUrl)){var s=new d(e.openUrl);if(Boolean(s.getScheme())){r=e.openUrl;break}}r="#"+o.serializeQuery(n,null,!0);break;default:r=e.openUrl||e.key}return r},e.prototype.getPageModulePath=function(e){var t=i[e];return l.format("odsp-next/pages/{0}/odb/{1}",t[0].toLowerCase()+t.substr(1),t)},e.prototype.getTagUrl=function(){return""},e.prototype.getRecycleBinQueryUrl=function(){return l.format("{0}/{1}/AdminRecycleBin.aspx?mysite=1",this._context.webUrl,this._context.layoutsUrl)},e.prototype.getDateTimeControlIframeUrl=function(){return l.format("{0}/{1}/iframe.aspx",this._context.webServerRelativeUrl,this._context.layoutsUrl)},e.prototype.getRichTextEditorIframeUrl=function(e,t){return l.format("{0}/EditForm.aspx?OnlyIncludeOneField={1}&ID={2}&IsDlg=1",this._listContext.listUrl,e,t)},e.prototype.getOneDriveAppsUrl=function(){return"https://onedrive.com/download"},e.prototype.handleFatalErrorDuringViewLoad=function(){},e.prototype.getPhotoType=function(){return null},e.prototype.getItemUrl=function(t){var r=e.getKeyParts(t),i=r&&r.id;return i&&"/"===i.charAt(0)?this._context.serverUrl+i:i},e.prototype.getItemPickerUrl=function(){return"/"},e.prototype.getItemPickerBehavior=function(){var e={selectionMode:f.SELECTION_MODE_VALUES[(this._navigation.viewParams[h.default.pickerSelectionModeKey]||"").toLowerCase()],viewType:f.VIEW_TYPE_VALUES[(this._navigation.viewParams[h.default.pickerViewTypeKey]||"").toLowerCase()],linkType:f.LINK_TYPE_VALUES[(this._navigation.viewParams[h.default.pickerLinkTypeKey]||"").toLowerCase()],accessLevel:f.ACCESS_LEVEL_VALUES[(this._navigation.viewParams[h.default.pickerAccessLevelKey]||"").toLowerCase()],aadClientId:this._navigation.viewParams[h.default.pickerAADClientIdKey],msaClientId:this._navigation.viewParams[h.default.pickerMSAClientIdKey],returnUrl:this._navigation.viewParams[h.default.pickerReturnUrlKey]};return e},e.prototype.getVroomApiBaseUrl=function(){var e="";return"https://"+e+"-my.sharepoint.com/_api/v2.0"},e.prototype._getMediaUrl=function(e,t){var r=o.deserializeQuery(e.parent.key);return t[h.default.parentIdParamKey]=r[h.default.idParamKey],t[h.default.parentQueryTypeParamKey]=r[h.default.queryTypeParamKey],delete t[h.default.queryTypeParamKey],"#"+o.serializeQuery(t,null,!0)},e.prototype._updateViewParamsFromWindowName=function(){var e=new g.default,t=e.removeState(h.default.windowNameJsonKey);t&&this._navigation.updateViewParams(t,{ignoreHistory:!0,clearOtherParams:!1})},e.EXTERNAL_URL_FORMAT="/externalredirector?alias=",e}();return y}),define("odsp-next/dataSources/item/odb/GridPreviewHelpers",["require","exports","odsp-shared/utilities/string/StringHelper","./ODBDataSource.resx","../../../utilities/features/Features"],function(e,t,r,i,n){var o=function(){function e(){}return e.previewImageUrl=function(t,r,i){var n=t.SiteId||t.siteId||_spPageContextInfo.siteId,o=t.WebId||t.webId||_spPageContextInfo.webId,s=t.UniqueId||t.uniqueId,a=t.Url||t.url;return Boolean(s)&&Boolean(n)&&Boolean(o)?e.previewImageUrlFromProps(n,o,s,r,i):e.previewImageUrlFromUrl(a,r,i)},e.previewImageUrlFromProps=function(e,t,r,i,o){var s=[];if(Boolean(r)){var a=o?"":"&resolution=Width1024",u=i+"/"+_spPageContextInfo.layoutsUrl+"/getpreview.ashx?clientType=docLibGrid&guidFile="+r+"&guidSite="+e+"&guidWeb="+t+a;s.push(n.default.isFeatureEnabled(n.default.UseImageFrameInItemTilePhoto)?{url:u,width:0,height:0}:{url:u,width:Boolean(o)?200:0,height:Boolean(o)?200:0,fitToSize:!0})}return s},e.previewImageUrlFromUrl=function(e,t,r){var i=[];if(Boolean(e)){var o=r?"":"&resolution=Width1024",s=t+"/"+_spPageContextInfo.layoutsUrl+"/getpreview.ashx?clientType=docLibGrid&path="+e+o;i.push(n.default.isFeatureEnabled(n.default.UseImageFrameInItemTilePhoto)?{url:s,width:0,height:0}:{url:s,width:Boolean(r)?200:0,height:Boolean(r)?200:0,fitToSize:!0})}return i},e.getGridSubTitleTextFromModifiedBy=function(e){return Boolean(e)?r.format(i.strings.gridViewSubTitle,e):""},e}();return o}),define("odsp-next/actions/odb/PermissionMask",["require","exports"],function(){var e=function(){function e(){}return e.hasItemPermission=function(e,t){return(t.Low&e.permissions.Low)===t.Low&&(t.High&e.permissions.High)===t.High},e.Or=function(e,t){return{High:e.High|t.High,Low:e.Low|t.Low}},e.InsertListItems={High:0,Low:2},e.EditListItems={High:0,Low:4},e.DeleteListItems={High:0,Low:8},e.ApproveItems={High:0,Low:16},e.OpenItems={High:0,Low:32},e.ViewVersions={High:0,Low:64},e.DeleteVersions={High:0,Low:128},e.CancelCheckout={High:0,Low:256},e.ManageLists={High:0,Low:2048},e.ViewPages={High:0,Low:131072},e.ManageSubwebs={High:0,Low:8388608},e.ManagePermissions={High:0,Low:33554432},e.BrowseDirectories={High:0,Low:67108864},e.UseClientIntegration={High:16,Low:0},e.CreateAlerts={High:128,Low:0},e.EnumeratePermissions={High:1073741824,Low:0},e.LayoutsPage={High:0,Low:135168},e}();return e}),define("odsp-next/models/sharing/SharingRole",["require","exports"],function(){var e;return function(e){e[e.Owner=0]="Owner",e[e.View=1]="View",e[e.Edit=2]="Edit",e[e.Submitter=3]="Submitter",e[e.CoOwner=4]="CoOwner",e[e.None=5]="None",e[e.Custom=6]="Custom"}(e||(e={})),e}),define("odsp-next/utilities/locale/Locale",["require","exports"],function(){var e=function(){function e(){}return e.invalidate=function(){e.isRightToLeft="rtl"===document.documentElement.getAttribute("dir"),e.safeLeft=e.isRightToLeft?"right":"left",e.language=document.documentElement.getAttribute("lang")||document.documentElement.getAttribute("xml:lang")},e}();return e.invalidate(),e}),define("odsp-next/controls/list/interfaces/ColumnFieldType",["require","exports"],function(){var e;return function(e){e[e.Text=0]="Text",e[e.Hyperlink=1]="Hyperlink",e[e.Image=2]="Image",e[e.User=3]="User",e[e.DateTime=4]="DateTime",e[e.Number=5]="Number",e[e.Note=6]="Note",e[e.Computed=7]="Computed",e[e.Name=8]="Name",e[e.FileSize=9]="FileSize",e[e.Shared=10]="Shared",e[e.SharedWith=11]="SharedWith",e[e.FileIcon=12]="FileIcon",e[e.DotDotDot=13]="DotDotDot",e[e.Tag=14]="Tag",e[e.Lookup=15]="Lookup",e[e.Taxonomy=16]="Taxonomy"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/item/odb/SharedWithMeDataSource",["require","exports","knockout","./ItemDataSource","./ODBDataSource.resx","../../../utilities/uri/Uri","../../../models/item/OneDriveItem","../../../models/item/ItemType","../../../utilities/icons/IconSelector","../../../dataSources/url/odb/UrlDataSource","./GridPreviewHelpers","../../../actions/odb/PermissionMask","../../../models/sharing/SharingRole","../../../utilities/locale/Locale","../../../controls/list/interfaces/ColumnFieldType"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m){var f=function(e){function t(t,r){e.call(this,t,r),this._setDefaultSort()}return __extends(t,e),t.prototype._setDefaultSort=function(){this._listContext.sortField="Modified",this._listContext.isAscending="false"},t.prototype.getDataSourceName=function(){return"SharedWithMeSource"},t.prototype.getItem=function(t){return this._setContext(t),e.prototype.getItem.call(this,t)},t.prototype._setContext=function(e){e.sortField&&(this._listContext.sortField=e.sortField),"boolean"!=typeof e.isAscending||e.useDefaultAscending||(this._listContext.isAscending=e.isAscending.toString())},t.prototype._getServerConnectionUrl=function(){var e=this._getItemRequestUri();if(this._listContext.sortField){var t=this._listContext.sortField;"FileLeafRef"===t&&(t="Filename"),e.setQueryParameter("SortFieldName","'"+t+"'"),e.setQueryParameter("IsAscending",this._listContext.isAscending)
}return e.toString()},t.prototype._getItemRequestUri=function(){var e=new o(this._context.webUrl+"/_api/me/getsharedwithmedocs");return e.setQueryParameter("RowLimit","500"),e},t.prototype._getPageTitle=function(){return n.strings.SharedWithMe},t.prototype._processData=function(e,t,i){for(var s=i.d,a=s.results,u=l.getKeyParts(e),c=[],d=0,p=a.length;p>d;d++)c.push(a[d]);var h={id:u.id,Title:this._getPageTitle(),IsContainer:!0,folder:{childCount:c.length,startIndex:0,children:c},isRootFolder:!0},f=this._getShareWithMeItem(t,h,this._itemsStore,new o(this._context.webServerRelativeUrl)),g=[{internalName:"IsContainer",key:"type",name:"",index:0,isVisible:!0,isVisibleMobile:!0,isIcon:!0,isCollapsable:!1,isSorted:!1,isAscending:!1,width:50,filterable:!1,sortable:!1,fieldType:m.FileIcon,isFocused:r.observable(!1)},{internalName:"FileLeafRef",key:"name",name:n.strings.NameColumnName,index:1,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,isIcon:!1,width:250,sortable:!0,isSorted:"FileLeafRef"===this._listContext.sortField,isAscending:"true"===this._listContext.isAscending,filterable:!1,fieldType:m.Name,isFocused:r.observable(!1)},{internalName:"_calloutInvoker",key:"_calloutInvoker",name:"",index:2,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,isIcon:!1,width:18,sortable:!1,isSorted:!1,isAscending:!1,filterable:!1,fieldType:m.DotDotDot,isFocused:r.observable(!1)},{internalName:"Modified",key:"dateModified",name:n.strings.ModifiedColumnName,index:2,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,width:200,isSorted:"Modified"===this._listContext.sortField,isAscending:"true"===this._listContext.isAscending,sortable:!0,isIcon:!1,filterable:!1,fieldType:m.Text,isFocused:r.observable(!1)},{internalName:"ModifiedBy",key:"Editor",name:n.strings.ModifiedByColumnName,index:3,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,width:200,isSorted:"ModifiedBy"===this._listContext.sortField,isAscending:"true"===this._listContext.isAscending,sortable:!0,isIcon:!1,filterable:!1,fieldType:m.User,isFocused:r.observable(!1)}];return f.schema=g,f},t.prototype._getShareWithMeItem=function(e,t,r,n){if(!t)return null;var o=new s;o.id=t.FileRef,o.itemId=t.ListItemId,o.parentLink=t.ParentLink,o.key=this._urlDataSource.getKey(t),o.name=t.isRootFolder?t.Title:t.FileLeafRef||t.name,o.displayName=o.name,o.type=t.IsContainer?a.Folder:t.ProgId&&"OneNote"===t.ProgId.substring(0,7)?a.OneNote:a.File,o.dateModified=new Date(t.Modified).toLocaleDateString(h.language),o.queryType="undefined"!=typeof e?e:this._urlDataSource.getQueryType(),o.displayType=o.queryType,o.isPlaceholder=!1;var l,m=t.folder;if(m){if(l=[],m.children)for(var f=0;f<m.children.length;f++)l[f]=this._getShareWithMeItem(e,m.children[f],r,n).item,l[f].parentKey="id="+t.id;o.type=a.Folder,o.isRootFolder=!!t.isRootFolder}else o.location=t.ParentLink,t.IsContainer?o.openUrl=t.UrlPath:(o.openUrl=this._getUrl(t,n),o.thumbnails=c.previewImageUrl(t,this._context.webUrl,!0),o.previewIFrameUrl=t.ServerRedirectedEmbedUrl,o.sharingRole=p.Edit);o.extension=t.Extension||"",o.iconName=u.getIconNameFromItem(o);var g={};if(Boolean(t.Editors)&&(o.editorName=i._getModifiedByFromObject(t.Editors.results),o.defaultSubText=c.getGridSubTitleTextFromModifiedBy(o.editorName),t.Editors.results.length>0)){var y=t.Editors.results[t.Editors.results.length-1];g.title=y.Title,g.email="",g.id="",g.sip=y.SipAddress}return o.properties.Editor=[g],o.permissions=d.Or(d.OpenItems,d.ManagePermissions),r.setItem(o),{item:o,children:l,totalChildren:m?m.childCount:0}},t.prototype._getUrl=function(e,t){if(Boolean(e.LinkingUrl))return e.LinkingUrl;if(Boolean(e.UrlPath))return e.UrlPath;var r=new o(e.FileRef);return r.setScheme(t.getScheme()),r.setAuthority(t.getAuthority()),r.toString()},t}(i);return f});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/item/odb/DocsInCommonDataSource",["require","exports","./SharedWithMeDataSource","../../../utilities/uri/Uri","./ODBDataSource.resx"],function(e,t,r,i,n){var o=function(e){function t(t,r){e.call(this,t,r)}return __extends(t,e),t.prototype.getDataSourceName=function(){return"DocsInCommonSource"},t.prototype._getItemRequestUri=function(){var e=new i(this._context.webUrl+"/_api/me/getsharedwithpersondocs");return e.setQueryParameter("RowLimit","500"),e},t.prototype._getPageTitle=function(){return n.strings.DocsInCommon},t}(r);return o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/download/odb/DownloadDataSource",["require","exports","odsp-utilities/async/Promise","odsp-utilities/encoding/UriEncoding","../../../resources/SPOResourceKeys","../../../resources/UtilityResourceKeys","odsp-shared/base/BaseModel"],function(e,t,r,i,n,o,s){var a=function(e){function t(t){e.call(this,t),this._context=this.resources.consume(n.context),this._navigation=this.resources.consume(o.navigation)}return __extends(t,e),t.prototype.downloadItems=function(e){return this._navigation.navigateTo(this._getDownLoadUrl(e)),r.default.wrap(!0)},t.prototype._getDownLoadUrl=function(e){var t=[],r=i.escapeUrlForCallback(this._context.webUrl);return t.push(r),t.push("/"),t.push(this._context.layoutsUrl),t.push("/download.aspx?SourceUrl="),t.push(i.encodeURIComponent(e.items[0].id)),t.join("")},t}(s);return a});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/folderItemCount/odb/FolderItemCountDataSource",["require","exports","../../../dataSources/base/odb/DataSource","odsp-utilities/encoding/UriEncoding"],function(e,t,r,i){var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getDataSourceName=function(){return"FolderItemCountDataSource"},t.prototype.getFolderItemCountInfo=function(e){var t=this;return this.getData(function(){return t._getQueryUrl(e)},function(e){var t=JSON.parse(e);if(t&&t.d){var r=Number(t.d.ItemCount);return isNaN(r)&&(r=0),{itemCount:r}}return null},"GetFolderItemCountInfo")},t.prototype._getQueryUrl=function(e){var t=i.escapeUrlForCallback(this._context.webServerRelativeUrl),r=i.encodeRestUriStringToken(e.id);return[t,"/_api/Web/GetFolderByServerRelativeUrl(@folderUrl)/ItemCount?@folderUrl='",r,"'"].join("")},t}(r);return n}),define("odsp-next/providers/folderItemCount/FolderItemCountProvider",["require","exports","../../resources/DataSourceResourceKeys"],function(e,t,r){var i=function(){function e(){this._dataSource=this.resources.consume(r.folderItemCount)}return e.prototype.getFolderItemCountInfo=function(e){var t=this;return t._dataSource.getFolderItemCountInfo(e).then(function(e){return e})},e}();return i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/mobileAppPath/BaseIOSMobilePathDataSource",["require","exports","odsp-shared/utilities/string/StringHelper","odsp-shared/base/BaseModel"],function(e,t,r,i){var n=function(e){function t(){e.apply(this,arguments),this.FIRST_PARM_FORMAT="{0}?{1}"}return __extends(t,e),t.prototype.getPath=function(){return r.format(this.FIRST_PARM_FORMAT,t.APP_PATH_PRE_FIX,t.APP_PATH_POST_FIX)},t.prototype.getStorePath=function(){return"https://itunes.apple.com/us/app/onedrive/id477537958?mt=8"},t.APP_PATH_PRE_FIX="ms-onedrive://",t.APP_PATH_POST_FIX="from=web",t}(i);return n}),define("odsp-next/models/identity/IdentityType",["require","exports"],function(){var e;return function(e){e[e.anonymous=1]="anonymous",e[e.msa=2]="msa",e[e.aad=3]="aad"}(e||(e={})),e}),define("odsp-next/dataSources/identity/odb/IdentityDataSource",["require","exports","../../../models/identity/IdentityType"],function(e,t,r){var i=function(){function e(){}return e.prototype.getIdentity=function(){var e=r.aad,t="",i="",n=_spPageContextInfo.userLoginName;return{email:"",id:t,loginName:n,type:e,sessionState:i}},e.prototype.getClientId=function(){return null},e.prototype.getSignInUrl=function(){throw new Error("Not Implemented")},e.prototype.getSignOutUrl=function(){throw new Error("Not Implemented")},e.prototype.getSilentAuthUrl=function(){throw new Error("Not Implemented")},e.prototype.getCheckSessionUrl=function(){throw new Error("Not Implemented")},e}();return i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/providers/identity/IdentityProvider",["require","exports","odsp-shared/base/BaseModel","../../resources/DataSourceResourceKeys"],function(e,t,r,i){var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getIdentity=function(){var e=this.resources.consume(i.identity);return e.getIdentity()},t.prototype.getClientId=function(){var e=this.resources.consume(i.identity);return e.getClientId()},t.prototype.getSignInUrl=function(){var e=this.resources.consume(i.identity);return e.getSignInUrl()},t.prototype.getSignOutUrl=function(){var e=this.resources.consume(i.identity);return e.getSignOutUrl()},t.prototype.getSilentAuthUrl=function(e){var t=this.resources.consume(i.identity);return t.getSilentAuthUrl(e)},t.prototype.getCheckSessionUrl=function(){var e=this.resources.consume(i.identity);return e.getCheckSessionUrl()},t}(r);return n}),define("odsp-next/models/itemActivity/ItemActivityChangeType",["require","exports"],function(){var e;return function(e){e[e.invalid=0]="invalid",e[e.add=1]="add",e[e.edit=2]="edit",e[e.move=3]="move",e[e.remove=4]="remove",e[e.rename=5]="rename",e[e.renameOrMove=6]="renameOrMove",e[e.restore=7]="restore",e[e.share=8]="share",e[e.update=9]="update",e[e.none=10]="none"}(e||(e={})),e}),define("odsp-next/models/itemActivity/ItemActivityType",["require","exports"],function(){var e;return function(e){e[e.activity=0]="activity",e[e.aggregate=1]="aggregate"}(e||(e={})),e}),define("odsp-next/dataSources/itemActivity/odb/ChangeType",["require","exports"],function(){var e;return function(e){e[e.NoChange=0]="NoChange",e[e.Add=1]="Add",e[e.Update=2]="Update",e[e.Delete=3]="Delete",e[e.Rename=4]="Rename",e[e.MoveAway=5]="MoveAway",e[e.MoveInto=6]="MoveInto",e[e.Restore=7]="Restore",e[e.RoleAdd=8]="RoleAdd",e[e.RoleDelete=9]="RoleDelete",e[e.RoleUpdate=10]="RoleUpdate",e[e.AssignmentAdd=11]="AssignmentAdd",e[e.AssignmentDelete=12]="AssignmentDelete",e[e.MemberAdd=13]="MemberAdd",e[e.MemberDelete=14]="MemberDelete",e[e.SystemUpdate=15]="SystemUpdate",e[e.Navigation=16]="Navigation",e[e.ScopeAdd=17]="ScopeAdd",e[e.ScopeDelete=18]="ScopeDelete",e[e.ListContentTypeAdd=19]="ListContentTypeAdd",e[e.ListContentTypeDelete=20]="ListContentTypeDelete",e[e.Dirty=21]="Dirty"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/itemActivity/odb/ItemActivityDataSource",["require","exports","../../../dataSources/base/odb/DataSource","../../../models/itemActivity/ItemActivityChangeType","../../../models/itemActivity/ItemActivityType","./ChangeType","../../../models/item/ItemType","odsp-utilities/encoding/UriEncoding"],function(e,t,r,i,n,o,s,a){var u="/_layouts/15/userphoto.aspx?size=S&accountname=",l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getItemActivities=function(e,t,r){var i=this;return this.getData(function(){return i._getItemActivitiesUrl(e,r)},function(e){var n=JSON.parse(e);return i._transformData(n.d.results,t,r)},"GetChanges",function(){return i._constructPostBody(t)})},t.prototype.getDataSourceName=function(){return"ItemActivityDataSource"},t.prototype._getItemActivitiesUrl=function(e,t){var r=[],i=a.escapeUrlForCallback(this._context.webServerRelativeUrl),n=a.encodeRestUriStringToken(e.id);return r.push(i),r.push("/_api/Web/"),e.type===s.Folder&&!e.isRootFolder&&t?r.push("GetFolderByServerRelativeUrl(@v1)/GetListItemChanges"):e.isRootFolder?r.push("GetList(@v1)/RootFolder/GetListItemChanges"):(r.push("GetList(@v1)/Items("),r.push(e.properties.ID),r.push(")/GetChanges")),r.push("?@v1='"),r.push(n),r.push("'"),r.join("")},t.prototype._transformData=function(e,t,r){for(var o=new Array,s=0;s<e.length;s++){var a=new Array,l=this._mapActivityChangeType(e[s].ChangeType);if(l!==i.invalid){if(l===i.share){var c;e[s].SharedWithUsersHint&&(c=e[s].SharedWithUsersHint.results,a=this._createSharedWith(c))}var d={email:e[s].EditorEmailHint,name:e[s].Editor,image:u+e[s].EditorEmailHint,userId:"invalid"},p={changeToken:e[s].ChangeToken.StringValue,date:new Date(e[s].Time),editor:d,itemActivityChangeType:l,latestName:this._getFileName(e[s].ServerRelativeUrl),latestFolder:this._getFolderName(e[s].ServerRelativeUrl),sharedWith:a,type:n.activity};if(s===e.length-1){e.length<t.fetchLimit&&o.push(p);break}r||(p.previousName=this._getFileName(e[s+1].ServerRelativeUrl),p.previousFolder=this._getFolderName(e[s+1].ServerRelativeUrl)),l===i.rename&&(r?p.itemActivityChangeType=i.renameOrMove:p.previousFolder!==p.latestFolder&&(p.itemActivityChangeType=i.move)),o.push(p)}}return o},t.prototype._createSharedWith=function(e){var t=new Array;if(e){for(var r=0;r+1<e.length;r+=2){var i={email:e[r+1],name:e[r],image:u+e[r+1],userId:"invalid"};t.push(i)}return t}},t.prototype._getFileName=function(e){var t=e.split("/"),r=t.length-1,i=void 0;return r>=0&&(i=t[r]),i},t.prototype._getFolderName=function(e){var t=e.split("/"),r=t.length-1,i=void 0;if(r>=0){var n=this._context.webServerRelativeUrl,o=n.split("/"),s=0;0===e.indexOf(n)&&(s=o.length+1),t=t.slice(s,r),i=t.join("/")}return i},t.prototype._mapActivityChangeType=function(e){var t=0;switch(e){case o.Add:t=i.add;break;case o.Update:t=i.edit;break;case o.Delete:t=i.remove;break;case o.Rename:t=i.rename;break;case o.Restore:t=i.restore;break;case o.AssignmentAdd:t=i.share;break;case o.NoChange:t=i.none;break;default:t=i.invalid}return t},t.prototype._constructPostBody=function(e){var t=(e.fetchLimit+1).toString(),r={query:{Add:e.add,DeleteObject:e.deleteObject,FetchLimit:t,Group:e.group,Item:e.item,LatestFirst:e.latestFirst,Move:e.move,Rename:e.rename,Restore:e.restore,RoleAssignmentAdd:e.roleAssignmentAdd,RoleDefinitionAdd:e.roleDefinitionAdd,Update:e.update,User:e.user}};return JSON.stringify(r)},t}(r);return l}),define("odsp-next/providers/itemActivity/ItemActivityProvider",["require","exports","../../resources/DataSourceResourceKeys"],function(e,t,r){var i=function(){function e(){this._dataSource=this.resources.consume(r.itemActivity)}return e.prototype.getItemActivities=function(e,t,r){var i=this;return i._dataSource.getItemActivities(e,t,r).then(function(e){return e})},e}();return i}),define("odsp-utilities/models/store/DataStoreCachingType",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.session=1]="session",e[e.local=2]="local"}(e||(e={})),e}),define("odsp-utilities/models/store/BaseDataStore",["require","exports","./DataStoreCachingType"],function(e,t,r){var i=function(){function e(t,i){if(void 0===i&&(i=r.none),e.init(),this.dataStoreKey=t,this.defaultCachingType=i,i===r.none)this.dataStore={};else{var n=e._dataStore[this.dataStoreKey];void 0===n&&(e._dataStore[this.dataStoreKey]={}),this.dataStore=e._dataStore[this.dataStoreKey]}}return e.hasStorageType=function(t){switch(e.init(),t){case r.none:return!0;case r.session:return!!e._sessionStorage;case r.local:return!!e._localStorage}return!1},e.init=function(){if(!e._initialized){try{"localStorage"in window&&window.localStorage&&e.testStorage(window.localStorage)&&(e._localStorage=window.localStorage)}catch(t){}try{"sessionStorage"in window&&window.sessionStorage&&e.testStorage(window.sessionStorage)&&(e._sessionStorage=window.sessionStorage)}catch(r){}null==e._localStorage&&(e._localStorage=e._sessionStorage),e._initialized=!0}},e.testStorage=function(e){var t="BrowserStorageTest",r="1",i=!1;try{e.setItem(t,r),e.getItem(t)===r&&(i=!0),e.removeItem(t)}catch(n){}return i},e.prototype.setValue=function(e,t,r){e=this.normalizeKey(e),this.dataStore[e]=t;var i=this.getStorage(r);if(i)try{var n=[],o=JSON.stringify(t,function(e,t){if("object"==typeof t&&null!==t){if(-1!==n.indexOf(t))return;if("_"===e[0])return;n.push(t)}return t});n=null,i.setItem(this.dataStoreKey+e,o)}catch(s){}},e.prototype.getValue=function(e,t){e=this.normalizeKey(e);var r=this.dataStore[e],i=this.getStorage(t);if(void 0===r&&i){var n=i.getItem(this.dataStoreKey+e);if(n)try{r=JSON.parse(n),this.dataStore[e]=r}catch(o){r=void 0}}return r},e.prototype.remove=function(e,t){e=this.normalizeKey(e);var r=this.getStorage(t);r&&r.removeItem(this.dataStoreKey+e),delete this.dataStore[e]},e.prototype.getStorage=function(t){var i=t?t:this.defaultCachingType;switch(i){case r.none:return null;case r.session:return e._sessionStorage;case r.local:return e._localStorage}return null},e.prototype.normalizeKey=function(e){return e&&e.toLowerCase()||""},e._sessionStorage=null,e._localStorage=null,e._dataStore={},e._initialized=!1,e}();return i}),define("odsp-shared/utilities/object/EqualityComparers",["require","exports","knockout"],function(e,t,r){var i=function(){function e(){}return e.objectStrictEquality=function(e,t){return e===t},e.arrayStrictEquality=function(e,t){return 0===r.utils.compareArrays(e,t,{sparse:!0,dontLimitMoves:!0}).length},e}();return i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/models/store/ItemsStore",["require","exports","../item/OneDriveItem","odsp-utilities/models/store/BaseDataStore","knockout","../../utilities/navigation/NavigationHelper","odsp-shared/utilities/object/EqualityComparers"],function(e,t,r,i,n,o,s){var a="token=",u="result=",l="item=",c="photoToken=",d="photoResult=",p="photo=",h=function(e){function t(){e.call(this,"ItemsStore"),this._itemSetsKeys=[],window.odstore=this}return __extends(t,e),t.prototype.setItem=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._handleSetItem.apply(this,[e,l].concat(t))},t.prototype.getItem=function(e){return this.getValue(l+e)},t.prototype.setItemSet=function(e,t){var r=u+e;this.setValue(r,t),-1===this._itemSetsKeys.indexOf(r)&&this._itemSetsKeys.push(r)},t.prototype.getItemSetFromItemKey=function(e){for(var t,r=0;r<this._itemSetsKeys.length;r++){t=this.getValue(this._itemSetsKeys[r]);var i=t.context&&t.content.peek();if(i)for(var n=i.items,o=0;n&&o<n.length;o++)if(n[o]&&n[o].peek().parentKey===e)return t}},t.prototype.getItemSet=function(e){return this.getValue(u+e)},t.prototype.setPhoto=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._handleSetItem.apply(this,[e,p].concat(t))},t.prototype.getPhoto=function(e){return this.getValue(p+e.toLowerCase())},t.prototype.setPhotosSet=function(e,t){var r=d+e;this.setValue(r,t),-1===this._itemSetsKeys.indexOf(r)&&this._itemSetsKeys.push(r)},t.prototype.getPhotosSet=function(e){return this.getValue(d+e)},t.prototype.setNextPhotoToken=function(e,t){var r=this._makePhotoTokenKey(e);this.setValue(r,t)},t.prototype.getNextPhotoToken=function(e){return this.getValue(this._makePhotoTokenKey(e))},t.prototype.setNextRequestToken=function(e,t,r){var i=a+t;r?this.setValue(i,r):this.remove(i)},t.prototype.getNextRequestToken=function(e){return this.getValue(a+e)},t.prototype.invalidateItem=function(e){return this._handleItemInvalidation(e,this.getItem(e))},t.prototype.invalidateTagSet=function(e){var t=this.getValue(d+e);t&&(t.isExpired=!0,t.content.peek().groupings=null,t.content.peek().items=[],t.content.valueHasMutated())},t.prototype.emptyAllOtherSets=function(e){for(var t,r=0;r<this._itemSetsKeys.length;r++)t=this.getValue(this._itemSetsKeys[r]),!t.item||e&&0!==e.length&&-1!==e.indexOf(t.item.peek().key)||(t.content.peek().groupings=null,t.content.peek().items=[],t.content.valueHasMutated(),t.isExpired=!0)},t.prototype.emptyAllPhotosSets=function(){for(var e,t=0;t<this._itemSetsKeys.length;t++)e=this.getValue(this._itemSetsKeys[t]),e.item&&0===e.key.indexOf(d)&&(e.content.peek().groupings=null,e.content.peek().items=[],e.content.valueHasMutated())},t.prototype.invalidateLocation=function(e){for(var t,r,i=0,n=this._itemSetsKeys;i<n.length;i++){var s=n[i];if(t=this.getValue(s),r=t&&t.item&&t.item.peek().key){var a=o.deserializeQuery(r);a&&a.locationFilter&&a.locationFilter.indexOf(e)>=0&&(t.isExpired=!0)}}},t.prototype.invalidateTag=function(e){for(var t,r,i=0,n=this._itemSetsKeys;i<n.length;i++){var s=n[i];if(t=this.getValue(s),r=t&&t.item&&t.item.peek().key){var a=o.deserializeQuery(r);a&&a.tagFilter===e&&(t.isExpired=!0)}}},t.prototype.invalidateAllPhotos=function(){for(var e,t,r=0,i=this._itemSetsKeys;r<i.length;r++){var n=i[r];if(e=this.getValue(n),t=e&&e.item&&e.item.peek().key){var s=o.deserializeQuery(t);s&&"allmyphotos"===s.qt&&(e.isExpired=!0)}}},t.prototype._handleItemInvalidation=function(e,i){if(i){var o=new r(e);n.utils.extend(o,i.peek()),o.revision++,o[t.EXPIRED_ITEM_KEY]=!0,i(o);for(var s,a=0;a<this._itemSetsKeys.length;a++)s=this.getValue(this._itemSetsKeys[a]),s.item&&s.item.peek().key===e&&(this.setNextRequestToken(e,s.key,""),s.isExpired=!0)}this.emptyAllPhotosSets()},t.prototype._makePhotoTokenKey=function(e){return c+"&setKey="+e},t.prototype._handleSetItem=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=t+e.key,a=this.getValue(o);a?a(e):(a=n.observable(e),a.equalityComparer=s.objectStrictEquality,this.setValue(o,a));for(var u=0;u<r.length;u++){var l=r[u];l&&l!==e.key&&(o=t+l.toLowerCase(),a=this.getValue(t+l.toLowerCase()),a?a(e):(a=n.observable(e),a.equalityComparer=s.objectStrictEquality,this.setValue(o,n.observable(e))))}},t.EXPIRED_ITEM_KEY="isExpired",t}(i);return h}),define("odsp-next/models/suiteNav/SuiteNavLinkIds",["require","exports"],function(){var e=function(){function e(){}return e.CUSTOM_SETTINGS_1="WorkloadSettingsSubLinks1",e.CUSTOM_SETTINGS_2="WorkloadSettingsSubLinks2",e.CUSTOM_SETTINGS_3="WorkloadSettingsSubLinks3",e.FEEDBACK="ShellFeedback",e.DIAGNOSTICS="Diagnostics",e.O365_SETTINGS="ShellO365Settings",e.ADD_APP="SuiteMenu_zz5_MenuItemCreate",e.SITE_CONTENTS="SuiteMenu_zz6_MenuItem_ViewAllSiteContents",e.SITE_SETTINGS="SuiteMenu_zz7_MenuItem_Settings",e.USER_ACTIVITY="UserActivity",e.ABOUT_ME="ShellAboutMe",e.SETTINGS="ShellSettings",e.MY_SETTINGS="SuiteMenu_zz2_ID_PersonalInformation",e.SIGN_OUT="ShellSignout",e.HELP="HelpLink",e.COMMUNITY="ShellCommunity",e.PRIVACY="ShellPrivacy",e.LEGAL="ShellLegal",e.MAIL="ShellMail",e.CALENDAR="ShellCalendar",e.PEOPLE="ShellPeople",e.ONEDRIVE="ShellDocuments",e.WORD="ShellWordOnline",e.EXCEL="ShellExcelOnline",e.POWERPOINT="ShellPowerPointOnline",e.ONENOTE="ShellOneNoteOnline",e.SITES="ShellSites",e.YAMMER="ShellYammer",e.TASKS="ShellTasks",e.POWER_BI="ShellPowerBI",e.DELVE="ShellOfficeGraph",e.VIDEO="ShellVideo",e.ALCHEMY="ShellAlchemy",e.SMILE="ShellSendASmile",e}();return e}),define("odsp-next/dataSources/item/ColumnWidth",["require","exports"],function(){var e;return function(e){e[e.icon=16]="icon",e[e.iconMin=16]="iconMin",e[e.regularMin=90]="regularMin",e[e.regular=130]="regular",e[e.nameMin=150]="nameMin",e[e.nameODC=440]="nameODC",e[e.nameODB=250]="nameODB"}(e||(e={})),e}),define("odsp-next/bindings/beakAdorner/BeakAdorner.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".Beak-container{position:absolute}.Beak-arrow{background:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,.4);height:calc(16px);position:relative;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);width:calc(16px)}.od-theme--darkTransparent .Beak-arrow{background:rgba(0,0,0,.7)}")}),define("odsp-next/bindings/beakAdorner/BeakAdornerBinding",["require","exports","knockout","odsp-utilities/domUtils/DomUtils","../../utilities/locale/Locale","./BeakAdorner.css"],function(e,t,r,i,n){var o,s=function(){function e(){}return e.init=function(t,s){var a,u=r.utils.unwrapObservable(s())||{},l=u.anchorElement,c=u.isVisible||r.observable(!0);(l||(l=i.findAncestor(t,"beak-anchor")))&&r.computed(function(){r.utils.unwrapObservable(u.trigger),a&&r.removeNode(a);var s=i.calculateRect(t,!0),d=i.calculateRect(l,!0),p=e.size,h=p/2,m=e.determineBeakDirection(s,d),f=0;m===o.left||m===o.right?(f=d.getCenter().y-s.getTop(),f=e.clamp(f,p,s.height-p)):(f=n.isRightToLeft?s.getRight()-d.getCenter().x:d.getCenter().x-s.getLeft(),f=e.clamp(f,p,s.width-p));var g,y;switch(m){case o.left:y=-h,g=f-h;break;case o.right:y=s.width-h,g=f-h;break;case o.top:y=f-h,g=-h;break;case o.bottom:y=f-h,g=s.height-h}a=document.createElement("div"),a.className="Beak-container";var v=document.createElement("div");v.className="Beak-arrow",v.style.top=g+"px",n.isRightToLeft?v.style.right=y+"px":v.style.left=y+"px",a.appendChild(v),t.insertBefore(a,t.firstChild),r.computed(function(){a.style.display=c()?"":"none"},null,{disposeWhenNodeIsRemoved:a})},null,{disposeWhenNodeIsRemoved:t})},e.clamp=function(e,t,r){return Math.max(Math.min(e,r),t)},e.determineBeakDirection=function(e,t){var r=o.top,i=e.getCenter(),n=t.getCenter();return r=n.y>=e.getTop()&&n.y<e.getBottom()?n.x<i.x?o.left:o.right:n.y<i.y?o.top:o.bottom},e.after=["component"],e.size=8,e}();return function(e){e[e.left=0]="left",e[e.right=1]="right",e[e.top=2]="top",e[e.bottom=3]="bottom"}(o||(o={})),s}),define("odsp-shared/utilities/knockout/KnockoutOverrides",["require","exports","knockout"],function(e,t,r){"boolean"==typeof r.options.preferJQueryEvents?r.options.preferJQueryEvents=!1:"boolean"==typeof r.options.useOnlyNativeEvents&&(r.options.useOnlyNativeEvents=!0)}),define("odsp-shared/utilities/knockout/ResourceComponentLoader",["require","exports","../resources/ResourceScope","../../base/Disposable","knockout","./KnockoutOverrides"],function(e,t,r,i,n){var o=0,s=function(){function e(){}return e.loadViewModel=function(e,t,s){var a=this;s(function(s,u){var l=n.contextFor(u.element),c=s&&n.utils.unwrapObservable(s.resources)||a.getCurrentResourceScope(l)||null;s=n.utils.extend({},s||{});var d,p=s.resources=new r(c);return d=t.createViewModel instanceof Function?t.createViewModel(s,u):new(p.injected(t))(s),d[a.COMPONENT_ID_KEY]=o++,d[a.COMPONENT_BINDING_ELEMENT]=u.element,d[a.COMPONENT_CHILD_COMPONENTS_KEY]={},d[a.COMPONENT_SCOPE_KEY]=p,d[a.COMPONENT_NAME_KEY]=e,a.addToParentComponentContext(d,l),i.default.hook(d,function(){a.removeFromParentComponentContext(d,l),p.dispose()})})},e.getCurrentResourceScope=function(t){var r=null,i=null;if(t&&t.$data&&t.$data.resources)return t.$data.resources;for(;(!(i=t.$data)||"object"!=typeof i||!(r=i[e.COMPONENT_SCOPE_KEY]))&&t.$parentContext;)t=t.$parentContext;return r},e.findParentComponentContext=function(t,r){for(;r;){if(r.$data&&r.$data!==t&&r.$data[e.COMPONENT_NAME_KEY])return r;r=r.$parentContext}return null},e.addToParentComponentContext=function(e,t){var r=this.findParentComponentContext(e,t);if(r){var i=r.$data;e[this.COMPONENT_PARENT_COMPONENT_VIEWMODEL_KEY]=i;var n=i[this.COMPONENT_CHILD_COMPONENTS_KEY];n[e[this.COMPONENT_ID_KEY]]=e}},e.removeFromParentComponentContext=function(e){var t=e[this.COMPONENT_PARENT_COMPONENT_VIEWMODEL_KEY];if(t){var r=t[this.COMPONENT_CHILD_COMPONENTS_KEY];r&&r[e[this.COMPONENT_ID_KEY]]&&delete r[e[this.COMPONENT_ID_KEY]],e[this.COMPONENT_PARENT_COMPONENT_VIEWMODEL_KEY]=null,e[this.COMPONENT_CHILD_COMPONENTS_KEY]=null,e[this.COMPONENT_BINDING_ELEMENT]=null}},e.COMPONENT_SCOPE_KEY="__ResourceComponentLoader$resources",e.COMPONENT_NAME_KEY="__ResourceComponentLoader$componentName",e.COMPONENT_ID_KEY="__ResourceComponentLoader$componentId",e.COMPONENT_CHILD_COMPONENTS_KEY="__ResourceComponentLoader$childComponents",e.COMPONENT_PARENT_COMPONENT_VIEWMODEL_KEY="__ResourceComponentLoader$parentComponentViewModel",e.COMPONENT_BINDING_ELEMENT="__ResourceComponentLoader$componentBindingElement",e}();return n.components.loaders.unshift(s),s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/bindings/BaseBinding",["require","exports","odsp-shared/base/BaseModel","knockout","odsp-shared/utilities/knockout/ResourceComponentLoader","odsp-shared/utilities/resources/ResourceScope"],function(e,t,r,i,n,o){var s=function(e){function t(t,r){e.call(this,t,r),this.element=t.element,this.valueAccessor=t.valueAccessor,this.allBindingsAccessor=t.allBindingsAccessor,this.bindingContext=t.bindingContext,this.controlsDescendantBindings=!1}return __extends(t,e),t.init=function(e,t,r,s,a){var u=new o(n.getCurrentResourceScope(a)),l=new(u.injected(this))({element:e,allBindingsAccessor:r,valueAccessor:t,bindingContext:a});return i.utils.domNodeDisposal.addDisposeCallback(e,function(){return l.dispose()}),{controlsDescendantBindings:l.controlsDescendantBindings}},t.supportsVirtualElements=!1,t}(r);return s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/bindings/dismiss/DismissBinding",["require","exports","../BaseBinding","odsp-utilities/domUtils/DomUtils","knockout"],function(e,t,r,i,n){var o=27,s=1e3,a=function(e){function t(t){var r=this;e.call(this,t);var i=t.valueAccessor();this._isActive=n.observable(!0),this._options="object"==typeof i?i:{close:i},this._timeout="number"==typeof this._options.timeout?this._options.timeout:s,this._options.isAutomatic&&this.createComputed(this._dismiss).extend({rateLimit:{timeout:this._timeout,method:"notifyWhenChangesStop"}}),this.createComputed(function(){r._options.isOpen&&r._options.isOpen()&&r._isActive(!1)}),this.events.on(this.element,"touchstart, click, pointerdown, MSPointerDown, mouseenter, mousemove, touchmove, pointermove, MSPointerMove",this._wakeUp),this.events.on(this.element,"keydown",this._onKeyDown),this.events.on(this.element,"mouseout",this._sleep),this.events.on(document,"click",this._onClick,!0),this._options.dismissOnResize&&this.events.on(window,"resize",this._onResizeOrScroll,!0),this._options.dismissOnScroll&&this.events.on(window,"scroll",this._onResizeOrScroll,!0)}return __extends(t,e),t._isWithinElement=function(e,t){for(var r=t.target;r!==e&&i.getParent(r);)r=i.getParent(r);return r===e},t.prototype._dismiss=function(){var e=this._isActive();return this._options.isOpen&&!this._options.isOpen()||e||(this._options.isOpen&&this._options.isOpen(!1),!this._options.close||this._options.close.call(this.bindingContext.$data,this.bindingContext.$data)!==!1)?!0:!1},t.prototype._onClick=function(e){return t._isWithinElement(this.element,e)||(this._isActive(!1),this._dismiss()),!0},t.prototype._onKeyDown=function(e){if(e.keyCode===o){if(this._isActive(!1),this._dismiss()===!1)return e.stopPropagation(),!1}else this._isActive(!0);return!0},t.prototype._wakeUp=function(){return this._isActive(!0),!0},t.prototype._sleep=function(){return this._isActive(!1),!0},t.prototype._onResizeOrScroll=function(){return this._isActive(!1),this._dismiss(),!0},t}(r);return a}),define("odsp-next/bindings/measure/MeasureBinding",["require","exports","knockout","odsp-utilities/async/Async","odsp-utilities/domUtils/DomUtils"],function(e,t,r,i,n){var o=new i,s=function(){function e(){}return e.init=function(e,t){var i=t(),s=i&&i.measure||i;
r.computed(function(){if(s)if(r.utils.unwrapObservable(i.trigger),i.async)o.setImmediate(function(){var t=n.calculateSubtreeRect(e);s(t)});else{var t=n.calculateSubtreeRect(e);s(t)}},null,{disposeWhenNodeIsRemoved:e})},e.after=["component"],e}();return s}),define("odsp-next/bindings/element/ElementBinding",["require","exports"],function(){var e=function(){function e(){}return e.init=function(e,t){t()(e)},e}();return e}),define("odsp-next/bindings/raiseEventOnChange/RaiseEventOnChangeBinding",["require","exports","knockout","odsp-utilities/events/EventGroup"],function(e,t,r,i){var n=function(){function e(){}return e.init=function(e,t){var n=r.utils.unwrapObservable(t()),o=n.eventName||"dataChange",s=n.eventArgs,a=r.isObservable(n.data)?n.data:r.observable(),u=n.bubbleEvent||!1;a.subscribe(function(){i.raise(e,o,s,u)})},e}();return n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/bindings/longHover/LongHoverBinding",["require","exports","../BaseBinding"],function(e,t,r){var i=function(e){function t(t){e.call(this,t);var r=t.valueAccessor();this._callback=r.callback,this._delay=r.delay||400,this.events.on(this.element,"mouseenter",this._onMouseEnter),this.events.on(this.element,"mouseleave",this._onMouseLeave)}return __extends(t,e),t.prototype._clearTimer=function(){this._timerID&&(this.async.clearTimeout(this._timerID),this._timerID=void 0)},t.prototype._onMouseEnter=function(){this._clearTimer(),this._timerID=this.async.setTimeout(this._onHoverTimer,this._delay)},t.prototype._onMouseLeave=function(){this._clearTimer()},t.prototype._onHoverTimer=function(){this._timerID=void 0,this._callback&&this._callback()},t}(r);return i}),define("odsp-shared/utilities/logging/LoggingHelper",["require","exports"],function(){var e=function(){function e(){}return e.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.ClickName="Click",e}();return e}),define("odsp-next/bindings/teachingBubble/TeachingBubbleBinding",["require","exports","../../resources/ProviderResourceKeys"],function(e,t,r){var i=function(){function e(){}return e.init=function(e,t,i,n,o){var s=t();if(s){var a=o.$data,u=a.resources.consume(r.teachingBubble);u.addBubble(s,e)}},e}();return i}),define("odsp-next/controls/commands/CommandState",["require","exports"],function(e,t){var r;!function(e){e[e.initialized=0]="initialized",e[e.executed=1]="executed",e[e.failed=2]="failed"}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/controls/commands/CommandViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../bindings/beakAdorner/BeakAdornerBinding","../../bindings/dismiss/DismissBinding","../../bindings/measure/MeasureBinding","../../bindings/element/ElementBinding","../../bindings/raiseEventOnChange/RaiseEventOnChangeBinding","../../bindings/longHover/LongHoverBinding","../../utilities/icons/Icon","odsp-utilities/math/Point","../../utilities/locale/Locale","odsp-utilities/logging/events/Engagement.event","odsp-shared/utilities/logging/LoggingHelper","../../resources/UtilityResourceKeys","../../bindings/teachingBubble/TeachingBubbleBinding","./CommandState","odsp-shared/utilities/knockout/Projections"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m,f,g,y){var v=function(e){function t(t){var i=this;if(e.call(this,t),this.requiresChildren=!1,this.collapseSingleChildCommands=!0,this.isToggleable=!1,this.isSideCommand=!1,this.positionIconRight=!1,this.isFileUpload=!1,this.isFolderUpload=!1,this.hasLineBreakBefore=!1,this.hasLineBreakAfter=!1,this.hidesMenuChevron=!1,this.menuFocus=r.observable(!1),this.isLabelVisible=r.observable(!0),this.isOpen=r.observable(!1),this.isToggled=r.observable(!1),this.isActive=r.observable(!1),this.focused=r.observable(!1),this._defaultMenuOffset=new d(0,n.size/2+4),this.addBindingHandlers({dismiss:o,raiseEventOnChange:u,measure:s,longHover:l,element:a,teachingBubble:g}),this.collapsedText=r.observable(),this.newFeatureExperienceAnchor=r.observable(null),this.fileInputElement=r.observable(),this.teachingBubble=null,this.isPermanent=!1,t){if(r.utils.extend(this,t),t.textObservable?this.text=t.textObservable:t.text&&(this.text=r.observable(t.text)),t.subtext&&(this.subtext=r.observable(t.subtext)),t.iconObservable?this.icon=t.iconObservable:t.icon&&(this.icon=r.observable(t.icon)),this.iconBadge=r.isObservable(t.iconBadge)?t.iconBadge:r.observable(t.iconBadge),t.iconUrl&&(this.iconUrl=r.observable(t.iconUrl)),this.tooltip=t.tooltip||"",t.newFeatureAnchorName){var c=this.resources.consume(f.newFeatureExperienceEnabler);c&&c.anchorToName(t.newFeatureAnchorName,function(e){i.newFeatureExperienceAnchor(e)})}this.teachingBubble=t.teachingBubble,this._handleKeysWhenHidden=r.utils.unwrapObservable(t.isHidden),t.isDisabled&&(this.isDisabled=t.isDisabled)}this.text||(this.text=r.observable("")),this.subtext||(this.subtext=r.observable("")),this.bounds=r.observable(),this.measurementReady=function(e){i.onMeasurementReady(e)},this.url=r.observable(t.url||"#"),this.payload=this.payload||null;var p=this.children||r.observableArray();this.keys=t.keys||[],this.addDisposable(p.map({mappingWithDisposeCallback:function(e){return e.parentCommand=i,{mappedValue:e,dispose:function(){e.parentCommand=null}}}})),this.children=p,this.visibleChildren=this.addDisposable(p.filter(function(e){return e.isVisible()})),this.isToggled=this.createComputed(function(){return i.isOpen()?!0:i.action?i.action.isToggled():!1}),this.hasAnimation=r.isObservable(t.hasAnimation)?t.hasAnimation:r.observable(!1),this.isVisible=this.createComputed(function(){var e=!1;return e=r.utils.unwrapObservable(t.isHidden)?!1:i.requiresChildren?i.visibleChildren().length>0:i.action?i.isPermanent||i.action.isAvailable()||i.isToggleable&&i.action.isToggled():!0}),this.state=this.state||r.observable(y.default.initialized),this.isCurrentView=t&&t.isCurrentView?t.isCurrentView:null,this.isLastPivot=t&&t.isLastPivot||!1,this.isCollapsed=this.createComputed(function(){return i.collapseSingleChildCommands&&1===i.visibleChildren().length}),this.menuAlignment=t.menuAlignment||r.observable(0),this.menuOffset=t.menuOffset||r.observable(this._defaultMenuOffset),this.targetCommand=this.createComputed(function(){if(i.isCollapsed()){var e=i.visibleChildren()[0];return e}return i}),this.label=this.createComputed(function(){return i.isCollapsed()?i.targetCommand().collapsedText()||i.targetCommand().text():i.text()}),this.hasIconOnly=t.hasIconOnly||!1,this.positionIconRight=t.positionIconRight||!1,this.subscribe(this.isOpen,function(){i.isOpen()||i.children().forEach(function(e){e.children().length>0&&e.isOpen(!1)})});var h=this.addDisposable(this.visibleChildren.filter(function(e){return e.isOpen()})),m=this.createComputed(function(){return h().length>0});this.subscribe(m,function(e){e||i.async.setImmediate(function(){document.activeElement&&document.activeElement!==document.body||i.focused(!0)})}),this.createComputed(function(){i.isActive(!i.isOpen()&&i.focused()?!0:!1)}),this.isDisabled||(this.isDisabled=this.createPureComputed(function(){if(i.targetCommand()!==i)return i.targetCommand().isDisabled();var e=!((!i.requiresChildren||p().length)&&(i.requiresChildren||p().length||i.action&&(i.action.isAvailable()||i.isToggleable&&i.action.isToggled())||i.callback));return e})),this.layoutChanged=r.observable(),this.createComputed(function(){i.isLabelVisible(),i.text(),i.layoutChanged.notifySubscribers()}),this.tabindex=this.createPureComputed(function(){return i.focused()?0:-1}),t.engagementName&&(this.engagementName=t.engagementName)}return __extends(t,e),t.prototype.hasVisibleChildren=function(){return this.visibleChildren().length>0},t.prototype.onMeasurementReady=function(e){this.bounds(e)},t.prototype.onClick=function(e,t){var r,i=["CommandView",m.capitalizeFirstLetter(t.type)],n=!1;if((this._handleKeysWhenHidden||this.isVisible.peek())&&!this.isDisabled.peek()){e.engagementName&&(i=[e.engagementName,m.ClickName],r=i.join("."));var o=this.isCollapsed()?this.visibleChildren()[0]:this;if(o.payload&&o.isOpen()&&o.isOpen(!1),o.visibleChildren().length&&(o.icon||o.text)){o._closeSiblingCommands();var s=o.icon&&o.icon(),a=s?s.toString():o.text();e.engagementName||(i.splice(1,0,"Parent"+m.capitalizeFirstLetter(a)),r=i.join(".")),o.isOpen(o.parentCommand?!0:!o.isOpen()),o.isOpen.peek()&&o.focused(!0),o.callback&&o.callback(),n=!0}else if(o.action&&o.action.isAvailable.peek()){if(e.engagementName||(i.splice(1,0,m.capitalizeFirstLetter(o.action.name)),r=i.join(".")),o._closeParentCommands(),!e.isDisabled||!e.isDisabled()){if(o.fileInputElement.peek()&&o.action.isAvailable.peek()){var u=o.fileInputElement.peek();u.click()}else o.action.execute(t);"MoveCopy"===o.action.name&&e.isDisabled(!0)}n=!0}else o.callback&&(o.callback(),n=!0);r&&h.Engagement.logData({name:r,extraData:{action:m.capitalizeFirstLetter(t.type)}})}return n&&(t.preventDefault(),t.stopPropagation()),!n},t.prototype.onDismiss=function(){var e=this.visibleChildren();(this.payload||e&&e.length)&&this.isOpen(!1)},t.prototype.onInputChange=function(e,t){var r=this.targetCommand();return r&&r.action?r.action.onInputChange(t):void 0},t.prototype.openMenu=function(){var e=this.visibleChildren();return e&&e.length?(this.isOpen(!0),!0):!1},t.prototype.getIcon=function(e){var t=e;return this.icon&&this.icon()&&(t+=" "+this.icon().getClass()),t},t.prototype.getChevron=function(e){var t=e,r=p.isRightToLeft?c.chevronLeft:c.chevronRight;return t+=" "+r.getClass()},t.prototype._closeParentCommands=function(){for(var e=this.parentCommand;e;)e.isOpen(!1),e=e.parentCommand},t.prototype._closeSiblingCommands=function(){var e=this;this.parentCommand&&this.parentCommand.children().forEach(function(t){t!==e&&t.isOpen(!1)})},t}(i);return v});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-shared/utilities/logging/events/Action.event",["require","exports","odsp-utilities/logging/PairedEventBase","odsp-utilities/logging/Manager","../../../../odsp-utilities/logging/events/ResultTypeEnum","../../../../odsp-utilities/logging/events/ResultTypeEnum"],function(e,t,r,i,n,o){t.ResultTypeEnum=o.ResultTypeEnum;var s=function(e){function t(t,r){e.call(this,"Action,Qos,","Action",t,r)}return __extends(t,e),t.enabled=function(){return i.default.evaluateSamplingRampValue("ActionEventLogging")},t.instrumentPromise=function(e,i,n,o,s,a,u){return r.PairedEventBase._instrumentPromise(t,e,i,n,o,s,a,u)},t.prototype.isEnabled=function(){return i.default.evaluateSamplingRampValue("ActionEventLogging")},t.prototype.setStartData=function(e){this.data.pageType=this.cleanString(e.pageType),this.data.queryType=this.cleanString(e.queryType),"undefined"!=typeof e.logStartEnd&&(this.data.logStartEnd=e.logStartEnd),this.data.name=this.cleanString(e.name),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),"undefined"!=typeof e.resultType&&(this.data.resultType=e.resultType),"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.setEndData=function(e){"undefined"!=typeof e.logStartEnd&&(this.data.logStartEnd=e.logStartEnd),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),this.data.resultType=e.resultType,"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.end=function(e){return this._end(e)},t.prototype.verbose=function(e){return this._verbose(e)},t.prototype.setTimeout=function(e,t){return this._setTimeout(e,t)},t.fullName="Action,Qos,",t.shortName="Action",t.metadata={pageType:{type:"String",isMetric:!1},queryType:{type:"String",isMetric:!1},logStartEnd:{type:"Boolean",isMetric:!1},name:{type:"String",isKey:!0,isMetric:!1},resultCode:{type:"String",isMetric:!1},resultType:{type:"ResultTypeEnum",baseType:"Enum",typeRef:n.ResultTypeEnum,isMetric:!1},error:{type:"String",isMetric:!1},extraData:{type:"Object",isMetric:!1},extraMetrics:{type:"Object",isMetric:!1}},t}(r.PairedEventBase);t.Action=s,s.prototype.metadata=s.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/base/BaseAction",["require","exports","odsp-shared/utilities/logging/events/Action.event","odsp-shared/base/BaseModel","../resources/DataSourceResourceKeys","odsp-utilities/async/Promise","odsp-utilities/logging/ErrorHelper","../dataSources/url/PageType","../dataSources/url/QueryType","odsp-utilities/logging/events/Qos.event","odsp-utilities/browser/PlatformDetection","knockout","../models/dialog/DialogState"],function(e,t,r,i,n,o,s,a,u,l,c,d,p){var h=function(e){function t(t){e.call(this,t),this.name="BaseAction",this._urlDatasource=this.resources.consume(n.url),this.isQosLogged=!0,this.logStartEnd=!1,this.platformDetection=new c,this._executingInstanceCount=d.observable(0),this.isAvailable=this.createComputed(this.onIsAvailable,{deferEvaluation:!0,pure:!0}),this.isToggled=this.createComputed(this.onIsToggled,{deferEvaluation:!0,pure:!0}),this.isExecuting=this.createComputed(this._computeIsExecuting,{deferEvaluation:!0,pure:!0})}return __extends(t,e),t.prototype.execute=function(e){var t,r=this,i=this.isQosLogged?this.onCreateQosEvent(e):null;try{t=this.onExecute(e,i)}catch(n){s.log(n)}return t?(this._executingInstanceCount(this._executingInstanceCount.peek()+1),t.done(function(e){r._executingInstanceCount(r._executingInstanceCount.peek()-1),i&&i.end(e)},function(t){r._executingInstanceCount(r._executingInstanceCount.peek()-1),t&&t.message&&"Canceled"!==t.message&&s.log(t),i&&i.end(r.onCreateErrorEventArg(e,t,!1))})):i&&i.end(this.onCreateErrorEventArg(e,null,!0)),t},t.prototype.onCreateQosEvent=function(){return new r.Action({name:this.name,pageType:this._urlDatasource?a[this._urlDatasource.getPageType()]:"",queryType:this._urlDatasource?u[this._urlDatasource.getQueryType()]:"",logStartEnd:this.logStartEnd})},t.prototype.onCreateErrorEventArg=function(e,t,r){return!t||"Canceled"!==t.name&&t!==p.dismissed?{resultType:l.ResultTypeEnum.Failure,resultCode:r?"NoPromiseReturned":"PromiseFailed"}:{resultType:l.ResultTypeEnum.ExpectedFailure,resultCode:"Canceled"}},t.prototype.onExecute=function(){return o.default.wrap({resultType:l.ResultTypeEnum.Failure})},t.prototype.onIsAvailable=function(){return!0},t.prototype.onIsToggled=function(){return!1},t.prototype._computeIsExecuting=function(){return this._executingInstanceCount()>0},t}(i);return h});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/actions/FilterAction",["require","exports","../base/BaseAction","odsp-utilities/async/Promise","odsp-utilities/logging/events/Qos.event","../resources/UtilityResourceKeys","../utilities/navigation/NavigationHelper"],function(e,t,r,i,n,o,s){var a=function(t){function r(e){t.call(this,e),this.name="Filter",this.field=e.field,this.value=e.value,this.isFilterOn=e.isFilterOn}return __extends(r,t),r.prototype.onExecute=function(){var t=this.resources.consume(o.navigation),r=s.serializeQuery(t.viewParams),a=this;return e(["../utilities/list/ListFilterHelper"],function(e){r=e.addFilterInfo(r,a.field,a.value),t.updateViewParams(r,{clearOtherParams:!0})}),i.default.wrap({resultType:n.ResultTypeEnum.Success})},r.prototype.onIsAvailable=function(){return!0},r.prototype.onIsToggled=function(){return this.isFilterOn},r}(r);return a});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/actions/ClearFilterAction",["require","exports","../base/BaseAction","odsp-utilities/async/Promise","odsp-utilities/logging/events/Qos.event","../resources/UtilityResourceKeys","../utilities/navigation/NavigationHelper"],function(e,t,r,i,n,o,s){var a=function(t){function r(e){t.call(this,e),this.name="ClearFilter",this.field=e.field}return __extends(r,t),r.prototype.onExecute=function(){var t=this.resources.consume(o.navigation),r=s.serializeQuery(t.viewParams),a=this;return e(["../utilities/list/ListFilterHelper"],function(e){r=e.addFilterInfo(r,a.field,"",!0),t.updateViewParams(r,{clearOtherParams:!0})}),i.default.wrap({resultType:n.ResultTypeEnum.Success})},r.prototype.onIsAvailable=function(){return!0},r}(r);return a}),define("odsp-next/utilities/list/ListFilterHelper",["require","exports","odsp-utilities/encoding/UriEncoding","../../controls/commands/CommandViewModel","../../actions/FilterAction","../../actions/ClearFilterAction","../../utilities/icons/Icon","./ListUtilities.resx","odsp-shared/utilities/string/StringHelper","../../controls/list/interfaces/ColumnFieldType"],function(e,t,r,i,n,o,s,a,u,l){var c="TaxKeyword",d=function(){function e(){}return e.getFilterMenuItems=function(t,r,l,c,d){var p=[];l=l.split("<br>")[0];var h=document.createElement("DIV");h.innerHTML=l;var m=h.querySelector("#diidFilter"+d);if(null!=m){for(var f=m.childNodes.length,g=m.childNodes,y=Boolean(e.getFilterFieldByName(c,d)),v=1;f>v;v++){var _=e._getText(g[v]),S=g[v].value.toString(),T=y?e._isFieldValueInUrl(c,d,S):!1,b=new i({text:_,isToggleable:!0,action:new(t.injected(n))({field:d,value:S,isFilterOn:T})});p[v]=b}var C=u.format(a.strings.ClearFilterText,r.name),x=new i({text:C,icon:s.x,action:new(t.injected(o))({field:d})});p[0]=x}else p=e.getTaxonomyFilterMenuItems(t,r,l,c,d);return p},e.getTaxonomyFilterMenuItems=function(t,r,d,p,h){var m=[];if(r.fieldType===l.Taxonomy&&r.internalName!==c){var f=document.createElement("UL");f.innerHTML=d;for(var g=f.querySelector("#diidFilterCustomTable").firstChild,y=0;g;){var v=e._getText(g);if(v&&0!==v.length||(v="0"),g=g.nextSibling){var _=e._getText(g);if(g=g.nextSibling){{e._getText(g)}if(g=g.nextSibling,g&&(g=g.nextSibling)){g=g.nextSibling;var S=Boolean(e.getFilterFieldByName(p,h)),T=S?e._isFieldValueInUrl(p,h,v):!1,b=new i({text:_,isToggleable:!0,action:new(t.injected(n))({field:h,value:v,isFilterOn:T})});m[y++]=b}}}}if(m.length>0){var C=u.format(a.strings.ClearFilterText,r.name),x=new i({text:C,icon:s.x,action:new(t.injected(o))({field:h})});m.splice(0,0,x)}}return m},e.getFilterParams=function(t){var r,i,n="",o=0;do o++,r=e._getFilterFieldByIndex(t,o),i=e._getFilterValueByIndex(t,o),null!==r&&null!==i&&(n+="&"+r.toString()+"&"+i.toString());while(null!=r);return n},e.getFilterList=function(t){var r,i,n=[],o=0;do if(o++,r=e._getFilterFieldByIndex(t,o),i=e._getFilterValueByIndex(t,o),null!==r&&null!==i){var s=String(r[0].substr(r[0].indexOf("=")+1)),u=String(i[0].substr(i[0].indexOf("=")+1));n.push({field:decodeURIComponent(s),values:decodeURIComponent(u).split(";#").map(function(e){return e||a.strings.EmptyFilterValue})})}while(r);return n},e.clearFilterInfo=function(t,r){r=r||0;for(var i=e.getFilterList(t),n=r;n<i.length;n++){var o=i[n];t=e.addFilterInfo(t,o.field,null,!0)}return t},e.addFilterInfo=function(t,i,n,o){var s=e.getFilterFieldByName(t,i);if(Boolean(s)){var a=parseInt(s[1],10),u=e._getFilterValueByIndex(t,a),l=s[0]+u[0],c="";if(Boolean(o))l=new RegExp("(\\?|\\&)"+l);else{var d=String(u[0].substr(u[0].indexOf("=")+1)),p=[],h=!1,m=decodeURIComponent(d).split(";#");for(var f in m)m[f]!==n?p.push(m[f]):h=!0;if(h||p.push(n),p.length>0){var g="FilterField",y="&FilterValue";p.length>1&&(g="FilterFields",y="&FilterValues"),d=r.encodeURIComponent(p.join(";#")),c=g+s[1]+"="+i+y+s[1]+"="+d}}t=t.replace(l,c),t=e._restructureFilterUrl(t,a)}else{var v=0,_=[];do _=e._getFilterFieldByIndex(t,++v);while(null!==_);Boolean(o)||(""!==t&&(t+="&"),t+="FilterField"+String(v)+"="+i+"&FilterValue"+String(v)+"="+r.encodeURIComponent(n))}return t},e._getFilterFieldByIndex=function(e,t){var r=e.match(new RegExp("FilterField"+String(t)+"=[^&#]*"));return Boolean(r)||(r=e.match(new RegExp("FilterFields"+String(t)+"=[^&#]*"))),r},e._getFilterValueByIndex=function(e,t){var r=e.match(new RegExp("FilterValue"+String(t)+"=[^&#]*"));return Boolean(r)||(r=e.match(new RegExp("FilterValues"+String(t)+"=[^&#]*"))),r},e.getFilterFieldByName=function(e,t){var r=e.match(new RegExp("FilterField([0-9]+)="+t+"&"));return Boolean(r)||(r=e.match(new RegExp("FilterFields([0-9]+)="+t+"&"))),r},e.getFilterValueByName=function(e,t){var r=e.match(new RegExp("FilterField([0-9]+)="+t+"&FilterValue([0-9]+)=([^&]+)"));return Boolean(r)||(r=e.match(new RegExp("FilterFields([0-9]+)="+t+"&FilterValues([0-9]+)=([^&]+)"))),r?decodeURIComponent(r[r.length-1]):null},e._isFieldValueInUrl=function(t,r,i){var n=e.getFilterFieldByName(t,r);if(Boolean(n)){var o=parseInt(n[1],10),s=e._getFilterValueByIndex(t,o),a=String(s[0].substr(s[0].indexOf("=")+1)),u=decodeURIComponent(a).split(";#");for(var l in u)if(u[l]===i)return!0}return!1},e._getText=function(e){var t=null;return t=Boolean(e.innerText)?e.innerText.toString():Boolean(e.textContent)?e.textContent.toString():e.innerHTML.toString()},e._restructureFilterUrl=function(t,r){var i=r+1,n=t.match(new RegExp("FilterField"+String(i)+"=[^&]*")),o=!1;Boolean(n)||(n=t.match(new RegExp("FilterFields"+String(i)+"=[^&]*")),o=null!=n);for(var s=r;null!=n;s++){var a=o?"FilterFields"+String(s):"FilterField"+String(s),u=o?"FilterFields"+String(i):"FilterField"+String(i);t=t.replace(u,a),a=o?"FilterValues"+String(s):"FilterValue"+String(s),u=o?"FilterValues"+String(i):"FilterValue"+String(i),t=t.replace(u,a),i++,n=e._getFilterFieldByIndex(t,i)}return t},e}();return d}),define("odsp-next/dataSources/item/odb/ColumnsHelper",["require","exports","knockout","../ColumnWidth","../../../controls/list/interfaces/ColumnFieldType","../../../models/item/Item.resx","../../../models/item/ItemType","../../../utilities/list/SharingTypeHelper","../../../utilities/list/ListFilterHelper","odsp-shared/utilities/string/StringHelper","../../../resources/SPOResourceKeys"],function(e,t,r,i,n,o,s,a,u,l,c){var d=function(){function e(){}return e.getListSchema=function(t,o,s){var a={FSObjType:{key:"type",index:0,isVisibleMobile:!0,isCollapsable:!1,minWidth:i.iconMin,width:i.icon,type:n.FileIcon},DocIcon:{key:"type",index:0,isVisibleMobile:!0,isCollapsable:!1,minWidth:i.iconMin,width:i.icon,type:n.FileIcon},LinkFilename:{key:"name",index:1,isVisibleMobile:!0,isCollapsable:!1,minWidth:i.nameMin,width:i.nameODB,type:n.Name},LinkTitle:{key:"Title",index:1,isVisibleMobile:!0,isCollapsable:!1,minWidth:i.nameMin,width:i.nameODB,type:n.Name},_calloutInvoker:{key:"_calloutInvoker",isVisibleMobile:!1,isCollapsable:!0,index:2,minWidth:16,width:18,type:n.DotDotDot},Modified:{key:"dateModified",index:3,isVisibleMobile:!0,isCollapsable:!1,minWidth:i.regularMin,width:i.regular,type:n.DateTime}},u=4,l=["_ip_UnifiedCompliancePolicyUIAction","ItemChildCount","FolderChildCount"];if(Boolean(t)){var d=[],p=u,h=o.consume(c.hostSettings);h.removeCalloutInvoker||t.Field.push({DisplayName:"",Name:"_calloutInvoker",Sortable:"FALSE",Type:"Computed",role:"Computed"});for(var m=o.consume(c.listContext),f=0;f<t.Field.length;f++){var g=t.Field[f],y=g.Name;if(-1===r.utils.arrayIndexOf(l,y))if("TRUE"===g.GroupField&&s){var v={field:y,type:g.Type};s[y]=v}else{var _,S=Boolean(a[y]),T=S?a[y].key:null,b=e.getFieldFromListData(g,y,T,S,m);if(S){var C=a[y];b.minWidth=C.minWidth,b.width=C.width,b.fieldType=C.type,b.isCollapsable=C.isCollapsable,b.isVisibleMobile=C.isVisibleMobile,_=C.index,Boolean("type"===T)&&(b.name="")}else{_=p++;var x=e.getColumnFieldType(g.FieldType,g.Format,y);x===n.SharedWith&&(b.width=i.nameMin),b.fieldType=x,b.dispFormUrl=g.DispFormUrl}b.fieldType===n.Note&&(b.width=i.nameODB),d[_]=b}}return d}return null},e.getFieldFromListData=function(e,t,n,o,s){return{key:o?n:t,name:e.DisplayName,internalName:t,width:i.regular,isVisible:!0,isVisibleMobile:!0,isCollapsable:!0,isIcon:o?Boolean("type"===n):!1,sortable:!Boolean(e.Sortable)||Boolean("FALSE"!==e.Sortable),filterable:!("FALSE"===e.Filterable||"TRUE"===e.FilterDisable||"Note"===e["FieldType "]||"URL"===e["FieldType "]||"FileSizeDisplay"===t),isSorted:s.sortField===t,isAscending:"true"===s.isAscending,isFiltered:r.observable(Boolean(u.getFilterFieldByName(s.filterParams,t))),filterValues:r.observable(u.getFilterValueByName(s.filterParams,t)),isMenuOpen:r.observable(!1),minWidth:i.regularMin,isFocused:r.observable(!1),isRequired:Boolean(e.Required)}},e.getColumnFieldType=function(e,t,r){return"User"===e||"UserMulti"===e?n.User:"URL"===e?"Hyperlink"===t?n.Hyperlink:n.Image:"Computed"===e?"FileSizeDisplay"===r?n.FileSize:"SharedWith"===r?n.SharedWith:n.Computed:"Note"===e?n.Note:"Lookup"===e||"LookupMulti"===e?n.Lookup:"TaxonomyFieldType"===e||"TaxonomyFieldTypeMulti"===e?n.Taxonomy:n.Text},e.isFieldTypeHtmlRendering=function(e){return e===n.Computed||e===n.Note||e===n.FileSize?!0:!1},e.getNameFieldAriaLabelForItem=function(t){var r="";return r=t.name+","+e.getIconFieldAriaLabelForItem(t)},e.getIconFieldAriaLabelForItem=function(e){var t="",r=e.appMap,i=e.extension;if(e.type===s.Folder)t=a.useSharedFolderAriaLabel(e.sharingType)?o.strings.fileTypeSharedFolder:o.strings.fileTypeFolder;else{if(e.type!==s.Folder&&r){var n=r.toLowerCase();-1!==n.indexOf("ms-word")?t=o.strings.fileTypeDoc:-1!==n.indexOf("ms-excel")?t=o.strings.fileTypeXls:-1!==n.indexOf("ms-powerpoint")?t=o.strings.fileTypePpt:-1!==n.indexOf("onenote")&&(t=o.strings.fileTypeOneNotebook)}else e.type===s.Media&&e.photo?t=l.format(o.strings.fileTypeImage,i||"").trim():i&&(0===i.indexOf(".")&&(i=i.substring(1)),t=i+" "+o.strings.fileTypeNoExtension);e.tooltipText&&(t&&(t+=", "),t+=e.tooltipText)}return t},e}();return d}),define("odsp-next/dataSources/item/odb/ListDataUrlBuilder",["require","exports","odsp-utilities/encoding/UriEncoding"],function(e,t,r){var i=function(){function e(){this.isClientRendering=!1,this.isEcbInfo=!1,this.isXslView=!1,this.isFullListSearch=!1,this.shouldCascadeDeleteWarningMessage=!1,this.ignoreQString=!1}return e.prototype.buildUrl=function(){var e=[],t=r.escapeUrlForCallback(this.httpRoot);if(e.push(t),"/"!==t[t.length-1]&&e.push("/"),this.listUrl?(e.push("_api/web/GetList('"),e.push(this.listUrl)):(e.push("_api/web/lists/getById('"),e.push(this.listName)),this.requestToken)return e.push("')/RenderListDataAsStream"),e.push(this.requestToken),e.join("");e.push("')/RenderListDataAsStream?View="),e.push(this.view),this.overrideSelectCommand&&e.push("&HasOverrideSelectCommand=TRUE");var i=null;"undefined"!=typeof this.overrideFilterQstring&&(i=this.overrideFilterQstring.match(RegExp("OverrideScope=[^&]*"))),"undefined"!=typeof this.overrideScope&&null===i&&e.push("&OverrideScope="+this.overrideScope),"undefined"!=typeof this.overrideFilterQstring&&(e.push("&"),e.push(this.overrideFilterQstring)),"undefined"!=typeof this.searchTerm&&null!==this.searchTerm&&(e.push("&InplaceSearchQuery="),e.push(r.encodeURIComponent(this.searchTerm))),this.isFullListSearch&&e.push("&InplaceFullListSearch=true"),this.isClientRendering&&this.isEcbInfo&&e.push("&IsRibbon=TRUE"),this.rootFolder&&(e.push("&RootFolder="),e.push(r.encodeURIComponent(this.rootFolder))),this.cmd&&e.push("&Cmd="+this.cmd);var n=!1;if(this.pagingParams)for(var o in this.pagingParams)"List"!==o&&"View"!==o&&"ID"!==o&&("ShowInGrid"===o?(n=!0,e.push("&ShowInGrid="+(this.inGridMode?"True":"False"))):e.push("GroupString"===o&&"string"==typeof this.groupString?"&GroupString="+this.groupString:"&"+o+"="+this.pagingParams[o]));this.inGridMode&&!n&&e.push("&ShowInGrid=True"),this.webPartID&&e.push("&WebPartID="+this.webPartID),this.shouldCascadeDeleteWarningMessage&&e.push("&CascDelWarnMessage=1"),(this.groupString||""===this.groupString)&&(this.pagingParams.hasOwnProperty("IsGroupRender")||e.push("&IsGroupRender=TRUE"),e.push("&DrillDown=1"),this.pagingParams.hasOwnProperty("GroupString")||e.push("&GroupString="+this.groupString)),this.sortField&&e.push("&SortField="+this.sortField),this.sortDir&&e.push("&SortDir="+this.sortDir),this.filterParams&&e.push(this.filterParams),this.ignoreQString&&e.push("&IgnoreQString=TRUE");var s=e.join("");return s},e}();return i}),define("odsp-next/actions/DocumentType",["require","exports"],function(){var e;return function(e){e[e.Word=1]="Word",e[e.Excel=2]="Excel",e[e.PowerPoint=3]="PowerPoint",e[e.OneNote=4]="OneNote",e[e.ExcelSurvey=5]="ExcelSurvey",e[e.Text=6]="Text"}(e||(e={})),e}),define("odsp-next/dataSources/item/DeletionType",["require","exports"],function(){var e;return function(e){e[e.Recycle=2]="Recycle",e[e.PermanantDelete=3]="PermanantDelete"}(e||(e={})),e}),define("odsp-next/dataSources/upload/NameConflictBehavior",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.overwrite=1]="overwrite",e[e.rename=2]="rename"}(e||(e={})),e}),define("odsp-next/models/policyTip/PolicyTipType",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.notify=1]="notify",e[e.block=2]="block",e[e.notifyAndBlock=3]="notifyAndBlock"}(e||(e={})),e}),define("odsp-next/utilities/datetime/DateTime",["require","exports","./DateTime.resx","../locale/Locale","odsp-shared/utilities/string/StringHelper"],function(e,t,r,i,n){var o=function(){function e(){}return e.Iso8601DateTimeToJsDate=function(e){var t=!1;e.toUpperCase().indexOf("Z")===e.length-1&&(t=!0);var r=e.split(/[^0-9]/);if(!(r.length<6))return t?new Date(Date.UTC(Number(r[0]),Number(r[1])-1,Number(r[2]),Number(r[3]),Number(r[4]),Number(r[5]))):new Date(Number(r[0]),Number(r[1])-1,Number(r[2]),Number(r[3]),Number(r[4]),Number(r[5]))},e.GetRelativeDateTimeStringPast=function(t){var o=Date.now()-t.getTime();if(o<-5*e.ONE_MINUTE)return t.toLocaleDateString(i.language);if(o<e.ONE_MINUTE)return r.strings.RelativeDateTime_LessThanAMinute;if(o<e.TWO_MINUTES)return r.strings.RelativeDateTime_AboutAMinute;if(o<e.ONE_HOUR){var s=Math.floor(o/e.ONE_MINUTE);return n.getLocalizedCountValue(r.strings.RelativeDateTime_XMinutes,r.strings.RelativeDateTime_XMinutesIntervals,s).replace("{0}",String(s))}if(o<e.TWO_HOURS)return r.strings.RelativeDateTime_AboutAnHour;if(o<e.ONE_DAY){var a=Math.floor(o/e.ONE_HOUR);return n.getLocalizedCountValue(r.strings.RelativeDateTime_XHours,r.strings.RelativeDateTime_XHoursIntervals,a).replace("{0}",String(a))}if(o<e.TWO_DAYS)return r.strings.RelativeDateTime_YesterdayAndTime.replace("{0}",t.toLocaleTimeString(i.language));if(o<e.ONE_MONTH){var u=Math.floor(o/e.ONE_DAY);return n.getLocalizedCountValue(r.strings.RelativeDateTime_XDays,r.strings.RelativeDateTime_XDaysIntervals,u).replace("{0}",String(u))}return t.toLocaleDateString(i.language)},e.GetRelativeDateTimeStringPastWithHourMinute=function(t){var o=Date.now()-t.getTime(),s=t.toLocaleDateString(i.language),a=t.toLocaleTimeString(i.language,{hour:"numeric",minute:"2-digit"});return o<e.ONE_DAY?e.GetRelativeDateTimeStringPast(t):o<e.TWO_DAYS?n.format(r.strings.RelativeDateTime_YesterdayAndTime,a):n.format(r.strings.DateTime_DateAndTime,s,a)},e.IsThisWeek=function(t){var r=new Date,i=new Date(r.getTime()-r.getDay()*e.ONE_DAY),n=new Date(i.getTime()+e.ONE_WEEK-e.ONE_DAY),o=i.getTime()<=t.getTime()&&t.getTime()<=n.getTime();return o},e.IsLastWeek=function(t){var r=new Date,i=new Date(r.getTime()-r.getDay()*e.ONE_DAY-e.ONE_WEEK),n=new Date(i.getTime()+e.ONE_WEEK-e.ONE_DAY),o=i.getTime()<=t.getTime()&&t.getTime()<=n.getTime();
return o},e.GetRelativeDateTimeStringForLists=function(e){var t=null,i=null,o=e.split("|");if("0"===o[0])return e.substring(2);var s="1"===o[1],a=o[2],u=o.length>=4?o[3]:null,l=o.length>=5?o[4]:null;switch(a){case"1":t=s?r.strings.RelativeDateTime_AFewSecondsFuture:r.strings.RelativeDateTime_AFewSeconds;break;case"2":t=s?r.strings.RelativeDateTime_AboutAMinuteFuture:r.strings.RelativeDateTime_AboutAMinute;break;case"3":i=n.getLocalizedCountValue(s?r.strings.RelativeDateTime_XMinutesFuture:r.strings.RelativeDateTime_XMinutes,s?r.strings.RelativeDateTime_XMinutesFutureIntervals:r.strings.RelativeDateTime_XMinutesIntervals,Number(u));break;case"4":t=s?r.strings.RelativeDateTime_AboutAnHourFuture:r.strings.RelativeDateTime_AboutAnHour;break;case"5":null==u?t=s?r.strings.RelativeDateTime_Tomorrow:r.strings.RelativeDateTime_Yesterday:i=s?r.strings.RelativeDateTime_TomorrowAndTime:r.strings.RelativeDateTime_YesterdayAndTime;break;case"6":i=n.getLocalizedCountValue(s?r.strings.RelativeDateTime_XHoursFuture:r.strings.RelativeDateTime_XHours,s?r.strings.RelativeDateTime_XHoursFutureIntervals:r.strings.RelativeDateTime_XHoursIntervals,Number(u));break;case"7":null===l?t=u:i=r.strings.RelativeDateTime_DayAndTime;break;case"8":i=n.getLocalizedCountValue(s?r.strings.RelativeDateTime_XDaysFuture:r.strings.RelativeDateTime_XDays,s?r.strings.RelativeDateTime_XDaysFutureIntervals:r.strings.RelativeDateTime_XDaysIntervals,Number(u));break;case"9":t=r.strings.RelativeDateTime_Today}return null!==i&&(t=i.replace("{0}",u),null!==l&&(t=t.replace("{1}",l))),t},e.ConvertDateToISOString=function(t){var r=new Date(t),i=r.getTimezoneOffset()<0?!0:!1,n=r.getFullYear().toString(),o=e.padStringWithZeroes((r.getMonth()+1).toString(),2),s=e.padStringWithZeroes(r.getDate().toString(),2),a=e.padStringWithZeroes(r.getHours().toString(),2),u=e.padStringWithZeroes(r.getMinutes().toString(),2),l=e.padStringWithZeroes(r.getSeconds().toString(),2),c=e.padStringWithZeroes(i?Math.ceil(r.getTimezoneOffset()/60).toString().replace("-",""):Math.floor(r.getTimezoneOffset()/60).toString(),2),d=e.padStringWithZeroes((r.getTimezoneOffset()%60).toString().replace("-",""),2),p=n+o+s+"T"+a+u+l+(i?"+":"-")+c+d;return p},e.padStringWithZeroes=function(e,t){for(var r=e;r.length<t;)r="0"+r;return r},e.ONE_SECOND=1e3,e.ONE_MINUTE=60*e.ONE_SECOND,e.TWO_MINUTES=2*e.ONE_MINUTE,e.ONE_HOUR=60*e.ONE_MINUTE,e.TWO_HOURS=2*e.ONE_HOUR,e.ONE_DAY=24*e.ONE_HOUR,e.TWO_DAYS=2*e.ONE_DAY,e.ONE_WEEK=7*e.ONE_DAY,e.ONE_MONTH=32*e.ONE_DAY,e}();return o}),define("odsp-next/utilities/icons/SupportPreviewHelper",["require","exports"],function(){var e=function(){function e(){}return e.fileTypeSupportsPreview=function(t){return e.supportPreviewFileTypesMap[t]},e.supportPreviewFileTypesMap={".3gp":!0,".3g2":!0,".3gp2":!0,".asf":!0,".ai":!0,".avi":!0,".bmp":!0,".docm":!0,".docx":!0,".dotx":!0,".dotm":!0,".dv":!0,".emf":!0,".eps":!0,".gif":!0,".ismv":!0,".jpeg":!0,".jpg":!0,".m2v":!0,".m2ts":!0,".mov":!0,".mod":!0,".mp4":!0,".mpeg":!0,".mpg":!0,".mts":!0,".png":!0,".pdf":!0,".pptm":!0,".pptx":!0,".potm":!0,".potx":!0,".ppsm":!0,".ppsx":!0,".psd":!0,".svg":!0,".tif":!0,".tiff":!0,".ts":!0,".url":!0,".vob":!0,".wmf":!0,".wmv":!0,".xesc":!0,".xlsm":!0,".xlsx":!0},e}();return e}),define("odsp-next/utilities/suiteExtensions/SuiteExtensionsHelper",["require","exports","knockout","odsp-utilities/logging/ErrorHelper","odsp-utilities/logging/events/Engagement.event","../features/Features","../../models/item/OneDriveItem","odsp-utilities/logging/events/Qos.event","odsp-utilities/logging/events/Qos.event","odsp-utilities/events/EventGroup","../icons/Icon"],function(e,t,r,i,n,o,s,a,u,l,c){var d="genericfile",p=function(){function e(){this._events=new l(this)}return e.getInstance=function(){return e._instance},e.prototype.initializeSuiteExtensions=function(e){function t(t,r,n){var o=new a.Qos({name:"FileHandlerOneDrive.CallAzureDataPipe"});try{var s=new XMLHttpRequest,l=new Error;if(null===s)return i.log("XmlHttpRequest object is null","FileHandlerOneDrive.CallAzureDataPipe"),void o.end({resultType:u.ResultTypeEnum.Failure});s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var e=JSON.parse(s.responseText);i.verbose("Successfully fetched add-in data from Azure, will try to set local storage now","FileHandlerOneDrive.CallAzureDataPipe"),o.end({resultType:u.ResultTypeEnum.Success}),r(t,e.value)}else i.log("Correlation id is "+s.getResponseHeader("SPRequestGuid"),"FileHandlerOneDrive.CallAzureDataPipe"),503===s.status||500===s.status?(i.log("Failed to fetch add-in data, xmlhttp status is "+s.status.toString(),"FileHandlerOneDrive.CallAzureDataPipe"),l.message="Failed to fetch add-in data, xmlhttp status is "+s.status.toString()+", xmlhttp responsetext is "+s.responseText,o.end({resultCode:s.status.toString(),resultType:u.ResultTypeEnum.ExpectedFailure}),n(l)):(l.message="Failed to fetch add-in data, looks like an unknown failure, xmlhttp status is "+s.status.toString()+", xmlhttp responsetext is "+s.responseText,o.end({resultType:u.ResultTypeEnum.Failure}),n(l))};var c=e.webUrl+"/_api/apps/GetByType('"+t+"')";s.open("GET",c,!0),s.setRequestHeader("Accept","application/json;odata=nometadata"),i.verbose("Trying to fetch add-in data from Azure, webAbsoluteUrl is - "+e.webUrl+", fileHandlerEndPoint is - "+c,"FileHandlerOneDrive.CallAzureDataPipe");try{s.send("")}catch(d){i.log("Correlation id is "+s.getResponseHeader("SPRequestGuid"),"FileHandlerOneDrive.CallAzureDataPipe"),o.end({resultType:u.ResultTypeEnum.Failure}),n(d)}}catch(d){i.log("Unexpected exception "+d.toString(),"FileHandlerOneDrive.CallAzureDataPipe"),o.end({resultType:u.ResultTypeEnum.Failure})}}var r=this;if((o.default.isFeatureEnabled(o.default.ODBNextFileHandler)||o.default.isFeatureEnabled(o.default.ODBNextFileCreation))&&"undefined"!=typeof SuiteExtensions&&e){var s=new a.Qos({name:"FileHandlerOneDrive.Initialize"});try{this._webAbsoluteUrl=e.webUrl;var l=new SuiteExtensions.HostConfig(e.userId,t);l.host="OneDrive",l.set_logging(i,n.Engagement),l.cultureName=e.cultureName,l.resourceId=window.location.protocol+"//"+window.location.hostname,l.controlsScriptPath=e.webUrl+"/"+e.layoutsUrl+"/online/scripts/SuiteExtensionsControls.js",l.controlsScriptLoadCallback=function(){r._events.raise("dataReady")},o.default.isFeatureEnabled(o.default.FileExtensionDataPipe)&&l.addFlight(SuiteExtensions.AddInsFlights.AzureDataPipe),o.default.isFeatureEnabled(o.default.FileHandlerAddInPicker)&&l.addFlight(SuiteExtensions.AddInsFlights.FileHandlerAddInPicker),o.default.isFeatureEnabled(o.default.ODBNextFileCreation)&&l.addFlight(SuiteExtensions.AddInsFlights.FileHandlerFileCreation),SuiteExtensions.SuiteExtensionsDataStore.Initialize(l),s.end({resultType:u.ResultTypeEnum.Success})}catch(c){i.log("Unexpected exception "+c.toString(),"FileHandlerOneDrive.Initialize"),s.end({resultType:u.ResultTypeEnum.Failure})}}},e.prototype.updateItem=function(e,t){var r=this;if(!this._tryUpdateItem(e,t,!0)){var i=0;this._events.on(this,"dataReady",function(){i++,r._tryUpdateItem(e,t,!1),i>=2&&r._events.off(r,"dataReady")})}},e.prototype.updateCommand=function(e,t,r){var n=this,s=null,l=function(){if(o.default.isFeatureEnabled(o.default.ODBNextFileCreation)&&"undefined"!=typeof SuiteExtensionsControls&&"undefined"!=typeof SuiteExtensions&&e&&t&&r){var n=new a.Qos({name:"FileHandlerOneDrive.TryUpdateNewFileMenu"});try{s&&(e.children.removeAll(s),s=null);var l=SuiteExtensions.ControlFactory.CreateControl("",SuiteExtensions.ControlType.FileCreation);if(null!=l){var d=l.get_fileCreationEntries();if(d.length>0){var p=new a.Qos({name:"FileHandlerOneDrive.UpdateNewFileMenu"});s=[],p.end({resultType:u.ResultTypeEnum.Success})}for(var h=0;h<d.length&&d[h].displayName;h++)s.push(d[h].imageUrl?new t({text:d[h].displayName,iconUrl:d[h].imageUrl,action:new r({entryIndex:h,fileCreationMenu:l})}):new t({text:d[h].displayName,icon:c.document,action:new r({entryIndex:h,fileCreationMenu:l})}));return e.children.push.apply(e.children,s),n.end({resultType:u.ResultTypeEnum.Success}),!0}return n.end({resultType:u.ResultTypeEnum.Success}),!1}catch(m){i.log("Unexpected exception "+m.toString(),"FileHandlerOneDrive.TryUpdateNewFileMenu"),n.end({resultType:u.ResultTypeEnum.Failure})}}return!1};return l()||this._events.on(this,"dataReady",l),{dispose:function(){n._events.off(n,"dataReady",l),s&&(e.children.removeAll(s),s=null)}}},e.prototype._tryUpdateItem=function(e,t,n){if(o.default.isFeatureEnabled(o.default.ODBNextFileHandler)&&"undefined"!=typeof SuiteExtensionsControls&&"undefined"!=typeof SuiteExtensions&&e&&t){var l=new a.Qos({name:"FileHandlerOneDrive.TryUpdateItem"});try{var c=!1,d=this._getFileHandlerFileIcon(t);d&&(c=!0);var p=this._getFileHandlerPreviewRedirectUrl(t);p&&(c=!0);var h=this._getFileHandlerEditRedirectUrl(t);if(h&&(c=!0),c){var m=null;if(n?m=t:(m=new s(t.key),r.utils.extend(m,t)),d){var f=new a.Qos({name:"FileHandlerOneDrive.UpdateIcon"});m.iconUrl=d,f.end({resultType:u.ResultTypeEnum.Success})}if(p){var g=new a.Qos({name:"FileHandlerOneDrive.UpdatePreview"});m.previewIFrameUrl=p,g.end({resultType:u.ResultTypeEnum.Success})}if(h){var y=new a.Qos({name:"FileHandlerOneDrive.UpdateEdit"});m.openUrl=h,y.end({resultType:u.ResultTypeEnum.Success})}n||e.setItem(m)}return l.end({resultType:u.ResultTypeEnum.Success}),c}catch(v){i.log("Unexpected exception "+v.toString(),"FileHandlerOneDrive.TryUpdateItem"),l.end({resultType:u.ResultTypeEnum.Failure})}}return!1},e.prototype._getFileHandlerFileIcon=function(e){var t=new a.Qos({name:"FileHandlerOneDrive.GetIcon"});try{if(e&&e.extension&&e.iconName===d){var r=SuiteExtensions.ControlFactory.CreateControl(e.extension.replace(".",""),SuiteExtensions.ControlType.Icon);if(null!=r){var n=r.getFileIcon();return t.end({resultType:u.ResultTypeEnum.Success}),n}}return t.end({resultType:u.ResultTypeEnum.Success}),null}catch(o){i.log("Unexpected exception "+o.toString(),"FileHandlerOneDrive.GetIcon"),t.end({resultType:u.ResultTypeEnum.Failure})}},e.prototype._getFileHandlerPreviewRedirectUrl=function(e){var t=new a.Qos({name:"FileHandlerOneDrive.GetPreview"});try{if(e&&e.extension&&!e.previewIFrameUrl&&this._webAbsoluteUrl){var r=SuiteExtensions.ControlFactory.CreateControl(e.extension.replace(".",""),SuiteExtensions.ControlType.Preview);if(null!=r){r.set_itemUrl(e.id),r.set_httpRoot(this._webAbsoluteUrl);var n=r.getRedirectUrl();return t.end({resultType:u.ResultTypeEnum.Success}),n}}return t.end({resultType:u.ResultTypeEnum.Success}),null}catch(o){i.log("Unexpected exception "+o.toString(),"FileHandlerOneDrive.GetPreview"),t.end({resultType:u.ResultTypeEnum.Failure})}},e.prototype._getFileHandlerEditRedirectUrl=function(e){var t=new a.Qos({name:"FileHandlerOneDrive.GetEdit"});try{if(e&&e.extension&&e.id&&e.openUrl&&e.id===e.openUrl&&this._webAbsoluteUrl){var r=SuiteExtensions.ControlFactory.CreateControl(e.extension.replace(".",""),SuiteExtensions.ControlType.Edit);if(null!=r){r.set_itemUrl(e.id),r.set_httpRoot(this._webAbsoluteUrl);var n=r.getRedirectUrl();return t.end({resultType:u.ResultTypeEnum.Success}),n}}return t.end({resultType:u.ResultTypeEnum.Success}),null}catch(o){i.log("Unexpected exception "+o.toString(),"FileHandlerOneDrive.GetEdit"),t.end({resultType:u.ResultTypeEnum.Failure})}},e._instance=new e,e}();return p});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/item/odb/ShortcutLinkDataSource",["require","exports","odsp-next/dataSources/base/odb/DataSource","odsp-utilities/guid/Guid","odsp-utilities/async/Promise","odsp-next/utilities/uri/Uri","../../url/odb/UrlDataSource","odsp-utilities/encoding/UriEncoding"],function(e,t,r,i,n,o,s,a){var u=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.isSharePointUrl=function(e){var t=new o(e),r=t.getHost().toLowerCase();return r.indexOf("spoppe.com")>=0?!0:r.indexOf("sharepoint.com")>=0?!0:r.indexOf("sharepoint.cn")>=0?!0:!1},t.prototype.getDataSourceName=function(){return"ShortcutLinkDataSource"},t.prototype.createShortcut=function(e,t,r){var i=this,o=s.getKeyParts(e),a=o.id;return this.getData(function(){return i._getCreateShortcutUrl(a,t)},function(e){return e},"CreateShortcut",function(){return i._getCreateShortcutPostBody(r)}).then(null,function(e){return n.default.wrapError(e.message.value)})},t.prototype.getShortcutTargetData=function(e){var r=this;return this.getData(function(){return r._context.webServerRelativeUrl+"/_api/SP.Utilities.ShortcutLink.GetShortcutLink('"+e+"')"},function(e){try{var t=JSON.parse(e);return{url:t.d.url,siteId:"00000000-0000-0000-0000-000000000000"!==t.d.siteId?t.d.siteId:null,webId:"00000000-0000-0000-0000-000000000000"!==t.d.webId?t.d.webId:null,uniqueId:"00000000-0000-0000-0000-000000000000"!==t.d.uniqueId?t.d.uniqueId:null,isInternal:r._isInternal(t.d.url,t.d.uniqueId)}}catch(i){}return null},"GetShortcutTargetData").then(function(e){return e.uniqueId?n.default.wrap(e):t.isSharePointUrl(e.url)?r.getFileByUrl(e.url).then(function(t){return e.uniqueId=t.UniqueId,e}):n.default.wrap(e)})},t.prototype.getFileByUrl=function(e){var t=this,r=new o(e),i=new o(window.location.href);if(i.getHost()!==r.getHost())return n.default.wrap({});var s=this.getData(function(){return t._getWebRequestUrl(e)},function(e){var t=JSON.parse(e);return{url:t.d.GetContextWebInformation.LinkingUrl,webUrl:t.d.GetContextWebInformation.WebFullUrl}},"GetContextInfo");return s.then(function(r){return t.getData(function(){return t._getFileRequestUrl(e,r.webUrl)},function(e){var r=t._parseGetFileResponse(e);return r},"GetFileByUrl")})},t.prototype.isShortcutItem=function(e){return".url"===e.extension||".website"===e.extension||".lnk"===e.extension},t.prototype._getCreateShortcutUrl=function(e,t){return[a.escapeUrlForCallback(this._context.webUrl),"/_api/web/GetFolderByServerRelativeUrl('",e,"')/Files/add(url='",t,"',overwrite=false)"].join("")},t.prototype._getCreateShortcutPostBody=function(e){return"[InternetShortcut]\nURL="+e+"\n"},t.prototype._parseGetFileResponse=function(e){var t=JSON.parse(e);return{CheckInComment:t.d.CheckInComment,CheckOutType:t.d.CheckOutType,ContentTag:t.d.ContentTag,CustomizedPageStatus:t.d.CustomizedPageStatus,ETag:t.d.ETag,Exists:t.d.Exists,IrmEnabled:t.d.IrmEnabled,Length:t.d.Length,Level:t.d.Level,LinkingUrl:t.d.LinkingUrl,MajorVersion:t.d.MajorVersion,MinorVersion:t.d.MinorVersion,Name:t.d.Name,ServerRelativeUrl:t.d.ServerRelativeUrl,TimeCreated:t.d.TimeCreated,TimeLastModified:t.d.TimeLastModified,Title:t.d.Title,UIVersion:t.d.UIVersion,UIVersionLabel:t.d.UIVersionLabel,UniqueId:t.d.UniqueId}},t.prototype._isInternal=function(e,t){if(t!==i.default.Empty)return!0;var r=new o(e.toLowerCase()).getHost(),n=new o(this._context.serverUrl.toLowerCase()).getHost();if(r===n)return!0;var s=void 0,a=/(.+?)(-my)??(\..*)/i.exec(n);return s=void 0!==a[2]?a[1]+a[3]:a[1]+"-my"+a[3],r===s},t.prototype._getWebRequestUrl=function(e){var t=new o(e);t.setQuery(""),t.setFragment("");var r=t.getPathSegments(),i=r.indexOf("_layouts");i>=0&&(r.length=i,t.setPath(r.join("/")));var n=t.getLastPathSegment(),s=n.lastIndexOf(".");if(s>=0){var a=t.toString();a.replace(/\.([^\.]*)$/,"_"),t=new o(a)}return o.ensureTrailingSlash(t.toString())+"_api/contextinfo"},t.prototype._getFileRequestUrl=function(e,t){var r=new o(t+"/_api/web/GetFileByUrl(@v)");return r.setQueryParameter("@v","'"+e+"'"),r.toString()},t}(r);Object.defineProperty(t,"__esModule",{value:!0}),t.default=u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/item/odb/ListDataSource",["require","exports","knockout","./ColumnsHelper","./GridPreviewHelpers","./ItemDataSource","./ListDataUrlBuilder","./ODBDataSource.resx","../ItemDataSource.resx","../../../actions/DocumentType","../../../dataSources/item/DeletionType","../../../dataSources/upload/NameConflictBehavior","../../../dataSources/url/QueryType","../../../dataSources/url/odb/UrlDataSource","../../../dataSources/url/odb/UrlQueryKeys","../../../models/item/ItemType","../../../models/item/Item.resx","../../../models/item/OneDriveItem","../../../models/item/SharingType","../../../models/policyTip/PolicyTipType","../../../models/sharing/SharingRole","../../../resources/SPOResourceKeys","../../../resources/UtilityResourceKeys","odsp-utilities/async/Promise","../../../utilities/datetime/DateTime","odsp-utilities/encoding/UriEncoding","odsp-utilities/guid/Guid","../../../utilities/icons/IconSelector","../../../utilities/icons/SupportPreviewHelper","../../../utilities/list/ListFilterHelper","odsp-utilities/logging/events/Qos.event","odsp-utilities/logging/events/Qos.event","odsp-utilities/object/ObjectUtil","odsp-shared/utilities/string/StringHelper","./ListViewDataPrefetchHelper","../../../utilities/suiteExtensions/SuiteExtensionsHelper","../../../utilities/features/Features","./ShortcutLinkDataSource"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m,f,g,y,v,_,S,T,b,C,x,I,E,D,w,P,R,O,k,U,F,A,N,M){!function(e){e[e.fileNotFound=-2147024894]="fileNotFound",e[e.invalidView=-2147024809]="invalidView",e[e.listNotFound=-1]="listNotFound"}(t.ErrorType||(t.ErrorType={}));var L=t.ErrorType,B=u.strings,q=10,V=function(e){function t(t){e.call(this,t.itemsStore,t.hostSettings),this._navigation=this.resources.consume(b.navigation),this._shortcutLinkDataSource=new M.default(t.hostSettings);var r=t.viewId;if(r){var i=r.match(/\{(.*)\}/);r=i?i[1]:r}this._initListContext(r),this._listContext.renderFilesTitle=t.hostSettings.listShouldRenderFilesTitle,this._listContext.listId=t.listId,this._setListUrl(t.listRootFolderWebRelativeUrl,t.listRootFolderServerRelativeUrl,t.listFullUrl),this.resources.isExposed(T.listContext)||this.resources.expose(T.listContext,this._listContext)}return __extends(t,e),t.prototype.updateContext=function(e){var t=this._listContext.listUrl;this._setListUrl(null,null,e),t&&t!==this._listContext.listUrl&&this._initListContext()},t.prototype.getColumns=function(){return i.getListSchema(null,this.resources)},t.prototype.getItem=function(t){var r=this;return this._setContext(t),e.prototype.getItem.call(this,t).then(function(e){return e},function(e){var t=e.code?e.code.split(","):e.error.code.split(","),i=t.length>1?Number(t[0]):-1;return C.default.wrapError(r._getError(i))})},t.prototype.getSingleItem=function(e){var t=this;e.needSchema=!1;var r=k.deepCopy(this._listContext),i=new R.Qos({name:this.getDataSourceName()+".GetSingleItem"});return this.getItem(e).then(function(e){return i.end(e.children&&e.children[0]?{resultType:O.ResultTypeEnum.Success}:{resultType:O.ResultTypeEnum.Failure,resultCode:"ItemNotFound"}),t._listContext=r,C.default.wrap(e.children&&e.children[0])},function(e){return i.end({resultType:O.ResultTypeEnum.Failure,resultCode:"ServerError",extraData:{error:e}}),t._listContext=r,C.default.wrapError(e)})},t.prototype.getFilterData=function(e,t){var r=this;return this.getData(function(){return r._getFilterDataUrl(e,t)},function(e){return e},"GetFilterData")},t.prototype.createDocument=function(e,t,r){if("string"==typeof r){var i=this._checkFilename(r);if(null!==i)return i}var n=this;return this.getData(function(){return n._getCreateDocumentUrl(t,e,r)},function(e){if(void 0!==e&&null!==e){var r=JSON.parse(e);if(null!==r&&null!==r.d&&null!==r.d.CreateDocumentAndGetEditLink)return n._getRedirectToEditNewDocument(r.d.CreateDocumentAndGetEditLink,t);try{var i=new DOMParser,o=i.parseFromString(e,"text/xml"),s=o.getElementsByTagName("d:CreateDocumentAndGetEditLink")[0].textContent;return n._getRedirectToEditNewDocument(s,t)}catch(a){return""}}return e},"CreateDocument").then(null,function(e){return C.default.wrapError(e.message.value)})},t.prototype.createCustomDocument=function(e,t,r){if("string"==typeof r){var i=this._checkFilename(r);if(null!==i)return i}var n=this,o=h.getKeyParts(e),s=o.id;return s&&(s=s.replace(this._listContext.listUrl,""),"/"===s.substr(0,1)&&(s=s.substring(1))),this.getData(function(){return n._getCreateCustomDocumentUrl(t,s,r)},function(e){if(void 0!==e&&null!==e){var t=JSON.parse(e);if(null!==t&&null!==t.d&&null!==t.d.CreateDocumentWithDefaultName)return s?I.escapeUrlForCallback(n._listContext.listUrl)+"/"+s+"/"+t.d.CreateDocumentWithDefaultName:I.escapeUrlForCallback(n._listContext.listUrl)+"/"+t.d.CreateDocumentWithDefaultName;try{var r=new DOMParser,i=r.parseFromString(e,"text/xml"),o=i.getElementsByTagName("d:CreateDocumentWithDefaultName")[0].textContent;return I.escapeUrlForCallback(this._listContext.listUrl)+"/"+o}catch(a){return""}}return e},"CreateCustomDocument").then(null,function(e){return C.default.wrapError(e.message.value)})},t.prototype.createFolder=function(e){var t=this._checkFilename(e.folderName);if(null!==t)return t;var r=this;return this.getData(function(){return r._getCreateFolderUrl()},function(e){var t=null;if(void 0!==e&&null!==e&&(t=JSON.parse(e).d),t&&t.Exists){var i=new y;return i.type=f.Folder,i.id=t.ServerRelativeUrl,i.key=r._urlDataSource.getKey(t),i.name=t.Name,i.dateModified=x.GetRelativeDateTimeStringForLists(t.TimeLastModified),i.isDropEnabled=!0,i.permissions=t.PermMask,r._itemsStore.setItem(i),i}return null},"CreateFolder",function(){""===e.parent.key&&(e.parent.key="id="+r._listContext.folderPath);var t=h.getKeyParts(e.parent.key);return""===e.folderName&&(e.folderName="Folder"+Math.floor(100*Math.random())+1),JSON.stringify({url:t.id+"/"+e.folderName,overwrite:!1})}).then(null,function(e){return C.default.wrapError(e.message.value)})},t.prototype.deleteItems=function(e){var t=this;if(0===e.items.length)return C.default.wrap([]);null===e.deletionType&&(e.deletionType=c.Recycle);var r;if(1===e.items.length){var i=e.items[0],n=this.getData(function(){return t._getDeleteSingleItemUrl(i,e)},function(){return C.default.wrap([i.id])},"DeleteItemsSingle",function(){return""},"POST",e.deletionType===c.PermanantDelete?{"X-HTTP-Method":"DELETE"}:null);r=function(e,r){n.then(function(t){e(t)},function(e){r({data:t._processErrorResponse(e,i.id)})})}}else{var o=E.default.generate(),s="multipart/mixed; boundary=batch_"+o,a=this.getData(function(){return t._getBatchOperationUrl()},function(e){return C.default.wrap(e)},"DeleteItemsMultiple",function(){return t._getBatchDeleteContent(e,o)},"POST",null,s);r=function(r,i){a.then(function(n){var o=t._processBatchResponse(n,e.items);o.hasError?i({data:o}):r(e.items.map(function(e){return e.id}))},function(e){i(e)})}}return new C.default(r)},t.prototype.moveItems=function(e){if(0===e.items.length)return null;var t=this;if(1===e.items.length)return this.getData(function(){return t._getMoveSingleItemUrl(e.items[0],e)},function(e){return C.default.wrap(e)},"MoveItemsSingle").then(function(r){return t._getMoveCopySingleItemResponse(e.items[0],e.targetId,r)},function(r){return t._getMoveCopySingleItemResponse(e.items[0],e.targetId,r)});var r=E.default.generate(),i="multipart/mixed; boundary=batch_"+r;return this.getData(function(){return t._getBatchOperationUrl()},function(e){return C.default.wrap(e)},"moveItemsMultiple",function(){return t._getBatchMoveContent(e,r)},"POST",null,i).then(function(r){return t._getMoveCopyBatchItemsResponse(e.items,e.targetId,r)},function(r){return t._getMoveCopyBatchItemsResponse(e.items,e.targetId,r)})},t.prototype.copyItems=function(e){if(0===e.items.length)return null;var t=this;if(1===e.items.length)return this.getData(function(){return t._getCopySingleItemUrl(e.items[0],e)},function(e){return C.default.wrap(e)},"CopyItemsSingle").then(function(r){return t._getMoveCopySingleItemResponse(e.items[0],e.targetId,r)},function(r){return t._getMoveCopySingleItemResponse(e.items[0],e.targetId,r)});var r=E.default.generate(),i="multipart/mixed; boundary=batch_"+r;return this.getData(function(){return t._getBatchOperationUrl()},function(e){return C.default.wrap(e)},"copyItemsMultiple",function(){return t._getBatchCopyContent(e,r)},"POST",null,i).then(function(r){return t._getMoveCopyBatchItemsResponse(e.items,e.targetId,r)},function(r){return t._getMoveCopyBatchItemsResponse(e.items,e.targetId,r)})},t.prototype.renameItem=function(e){var t=this._checkFilename(e.newName);if(null!==t)return t;var r=this._getRenameItemUrl(e.item),i={},n={},o=e.newName.trim();return i.__metadata={type:this._getItemTypeForListUrl()},i.Title=o,i.FileLeafRef=o,n["X-HTTP-Method"]="MERGE",n["If-Match"]="*",this.getData(function(){return r},function(e){return C.default.wrap(e)},"RenameItem",function(){return JSON.stringify(i)},"POST",n).then(null,function(e){return C.default.wrapError(e.message.value)})},t.prototype.removeFromSharedList=function(e){var t=this,r=[];return e.items.forEach(function(e,t){r[t]=e.openUrl}),this.getData(function(){return U.format("{0}/_api/SP.Sharing.DocumentSharingManager.RemoveItemsFromSharedWithMeView",I.escapeUrlForCallback(t._context.webUrl))},function(e){var t=JSON.parse(e);if(t&&t.d&&t.d.RemoveItemsFromSharedWithMeView&&t.d.RemoveItemsFromSharedWithMeView.results){var r=[],i=t.d.RemoveItemsFromSharedWithMeView.results;return i.forEach(function(e){r.push(e.ErrorMessage)}),r}return[]},"RemoveFromSharedList",function(){return JSON.stringify({itemUrls:r})},"POST")},t.prototype.getDataSourceName=function(){return"ListItemDataSource"},t.prototype._getAdditionalPostData=function(){var e=!!this._listContext.needSchema||!!this._listContext.isGrouped,t=this._needsQuickLaunch(),r=F.getOverrideViewXml(this._listContext.groupBy);return F.getAdditionalPostData(e,this._getViewXml(),!1,t,r)},t.prototype._getAdditionalHeaders=function(){var e,t={};this._listContext.listUrl?e="listUrl="+this._listContext.listUrl:this._listContext.listId&&(e="list="+this._listContext.listId);var r=this._needsQuickLaunch();return t["X-SP-REQUESTRESOURCES"]=r?"NAVIGATIONSTRUCTURE,"+e:e,t},t.prototype._getServerConnectionUrl=function(e){var t=this._getServerConnectionUrlBuilder(e);return t.buildUrl()},t.prototype._processData=function(e,t,r){var n,o=r.ListData||r,s=o.Row,a=h.getKeyParts(e),u=a.id,l=this._listContext.listSchema,c=r.ListContenTypes,d={};r.ListSchema&&(l=this._listContext.listSchema=i.getListSchema(r.ListSchema,this.resources,d),this._listContext.listId=r.listName),this._listContext.listSchema&&(n=this._listContext.listSchema.filter(function(e){return e.isRequired&&Boolean(e.name)})),r.ListTitle&&(this._listContext.listTitle=r.ListTitle),r.ListTemplateType&&(this._listContext.listTemplateType=r.ListTemplateType),r.listUrlDir&&(this._listContext.listUrl=decodeURIComponent(r.listUrlDir)),r.Navigation&&(this._listContext.leftNavigationData={quickLaunchNodes:r.Navigation.Nodes});for(var p=[],g=0,y=s.length;y>g;g++)p.push(s[g]);var v=null;u&&u!==this._urlDataSource.getDefaultRootItemId()?0===u.indexOf(m.default.queryTypeParamKey)&&(v=this._getDisplayName()):(u=this._listContext.listUrl,v=this._getDisplayName());var _=u.split("/");null===v&&(v=_[_.length-1]);var S="",T=!!o.NextHref;T&&(S=o.NextHref,S=S.replace("&View=00000000-0000-0000-0000-000000000000",""));var b={},C="";for(g=0,y=_.length;y>g;g++)C+=_[g]+"/";b.id="/"===C[C.length-1]?C.substr(0,C.length-1):C;var x,I=this._itemsStore.getItem(this._urlDataSource.getKey(b));I&&I().id||(b={id:u,name:v,type:f.Folder,isRootFolder:u===this._listContext.listUrl}),b.folder={childCount:p.length,startIndex:0,children:p},b.nextRequestToken=T?S:"",b.PermMask=o.FolderPermissions;var E=null;if(this._listContext.groupBy?E=[this._listContext.groupBy]:r.ListSchema&&r.ListSchema.group1&&(E=[],E.push(r.ListSchema.group1),r.ListSchema.group2&&E.push(r.ListSchema.group2)),this._listContext.isGrouped=Boolean(E),x=this._getItemResult(t,_,b,this._itemsStore,I&&I().id?I().parent:null,I&&I().id?I():null,E,null,n),Boolean(x.groupings)){var D=x.groupings[0].itemGroups,w=D[D.length-1];this._listContext.lastGroup={field:w.field,value:w.name,type:d[w.field].type}}return x.schema=l,x.contentTypes=c,Boolean(r.CanShareLinkForNewDocument)&&(x.item.properties.commandsSupported={canShareLinkForNewDocument:"1"}),x},t.prototype._getDisplayName=function(){return"700"===this._listContext.listTemplateType||this._listContext.renderFilesTitle?a.strings.Files:this._listContext.listTitle},t.prototype._getFolderPath=function(e){var t=h.getKeyParts(e),r=t&&t.id;return r=""===r||r===this._urlDataSource.getDefaultRootItemId()?null:r},t.prototype._setContext=function(e){var t="";if(e.filters)for(var r in e.filters)t+="&"+r+"="+I.encodeURIComponent(e.filters[r]);e.sortField&&(this._listContext.sortField=e.sortField),"boolean"==typeof e.isAscending&&(this._listContext.isAscending=e.isAscending.toString()),this._listContext.requestToken=e.requestToken,this._listContext.filterParams=t,this._listContext.needSchema=!!e.needSchema,this._listContext.pageSize=e.pageSize,this._listContext.singleItemId=e.singleItemId,this._listContext.folderPath=this._getFolderPath(e.parentKey),this._listContext.viewId=e.viewId||this._listContext.viewId,this._listContext.groupBy=e.groupBy},t.prototype._getViewXml=function(){var e=this._fetchNextGroup(),t=e;return this._listContext.viewId&&!t?"":F.getViewXml(this._listContext.sortField||"LinkFileName",this._listContext.singleItemId,this._listContext.isAscending,this._listContext.pageSize,e,this._listContext.lastGroup)},t.prototype._initListContext=function(e){this._listContext.folderPath=null,e?(this._listContext.sortField=null,this._listContext.isAscending=null):(this._listContext.sortField="LinkFilename",this._listContext.isAscending="true"),this._listContext.filterParams=null,this._listContext.listSchema=null,this._listContext.requestToken=null,this._listContext.needSchema=!1,this._listContext.pageSize=30,this._listContext.listTitle=null,this._listContext.listId=null,this._listContext.viewId=e||null},t.prototype._setListUrl=function(e,t,r){e||t||!r?e?this._listContext.listUrl=this._context.webServerRelativeUrl+"/"+e:t&&(this._listContext.listUrl=t):(r=decodeURIComponent(r),this._listContext.listUrl=r.split(this._context.serverUrl)[1])},t.prototype._getServerConnectionUrlBuilder=function(){var e=new s;return e.listName=this._listContext.listId,e.listUrl=this._listContext.listUrl,e.httpRoot=this._context.webUrl,e.isClientRendering=!0,e.ctxId="0",e.isXslView=!0,e.overrideSelectCommand=!1,e.view=this._listContext.viewId,e.rootFolder=this._listContext.folderPath,e.filterParams=this._listContext.filterParams,this._listContext.sortField&&(e.sortField=this._listContext.sortField,e.sortDir="true"===this._listContext.isAscending?"Asc":"Desc"),e.requestToken=this._fetchNextGroup()?null:this._listContext.requestToken,e},t.prototype._getFilterDataUrl=function(e,t){var r=[I.escapeUrlForCallback(this._context.webUrl),"/_api/web/GetList('",I.escapeUrlForCallback(this._listContext.listUrl),"')/RenderListFilterData?","FieldInternalName=",I.encodeURIComponent(e)];this._listContext.folderPath&&(r.push("&RootFolder="),r.push(I.encodeURIComponent(this._listContext.folderPath)));var i=P.getFilterParams(t);return r.push(i),r.join("")},t.prototype._getCreateDocumentUrl=function(e,t,r){if(null!==e&&e>0&&5>=e){e!==l.OneNote||r?e===l.ExcelSurvey&&(r+=".xlsx"):r="Notebook"+Math.floor(100*Math.random())+1,r||(r="");var i=h.getKeyParts(t),n=i.id;return n&&(n=n.replace(this._listContext.listUrl,""),"/"===n.charAt(0)&&(n=n.substring(1))),[I.escapeUrlForCallback(this._context.webUrl),"/","_api/web/GetList(@listUrl)/CreateDocumentAndGetEditLink(fileName=@fileName,folderPath=@folderPath,documentTemplateType=",e,")?@listUrl='",I.encodeRestUriStringToken(this._listContext.listUrl),"'&@fileName='",I.encodeRestUriStringToken(r),"'&@folderPath='",I.encodeRestUriStringToken(n),"'"].join("")}throw new Error("document type is not valid, here are the valid type: 1 - Word, 2 - Excel, 3 - PowerPoint, 4 - OneNote, 5 - Excel Survey")},t.prototype._getCreateCustomDocumentUrl=function(e,t){if(!e)throw new Error("document extension is not valid");
return[I.escapeUrlForCallback(this._context.webUrl),"/_api/web/GetList(@listUrl)/CreateDocumentWithDefaultName(folderPath=@folderPath,extension=@extension)?@listUrl='",I.escapeUrlForCallback(this._listContext.listUrl),"'&@folderPath='",t,"'&@extension='",e,"'"].join("")},t.prototype._getCreateFolderUrl=function(){return I.escapeUrlForCallback(this._context.webUrl)+"/_api/web/folders/AddWithOverwrite"},t.prototype._getDeleteSingleItemUrl=function(e,t){var r=[I.escapeUrlForCallback(this._context.webUrl),"/"],i=e.properties?e.properties.UniqueId:null,n="";return e.type===f.Folder||"1"===e.properties.FSObjType?i?(r.push("_api/web/getfolderbyid(@url)"),n=i):(r.push("_api/web/GetFolderByServerRelativeUrl(@url)"),n=I.encodeRestUriStringToken(e.id)):(r.push("_api/web/GetFileByServerRelativeUrl(@url)"),n=I.encodeRestUriStringToken(e.id)),t.deletionType===c.Recycle&&r.push("/recycle"),r.push("?@url='"),r.push(n),r.push("'"),r.join("")},t.prototype._getMoveSingleItemUrl=function(e,t){var r=[I.escapeUrlForCallback(this._context.webUrl),"/"];return r.push(e.type===f.Folder||"1"===e.properties.FSObjType?"_api/SP.MoveCopyUtil.MoveFolder(srcUrl=@v1,destUrl=@v2":"_api/SP.MoveCopyUtil.MoveFile(srcUrl=@v1,destUrl=@v2"),r.push(t.nameConflict&&t.nameConflict===d.overwrite?",overwrite=true)":")"),r.push("?@v1='"),r.push(I.encodeRestUriStringToken(this._context.serverUrl+e.id)),r.push("'&@v2='"),r.push(I.encodeRestUriStringToken(this._context.serverUrl+t.targetId)),r.push("/"+I.encodeRestUriStringToken(e.name)+"'"),r.join("")},t.prototype._getCopySingleItemUrl=function(e,t){var r=[I.escapeUrlForCallback(this._context.webUrl),"/"];return r.push(e.type===f.Folder||"1"===e.properties.FSObjType?"_api/SP.MoveCopyUtil.CopyFolder(srcUrl=@v1,destUrl=@v2":"_api/SP.MoveCopyUtil.CopyFile(srcUrl=@v1,destUrl=@v2"),r.push(t.nameConflict&&t.nameConflict===d.overwrite?",overwrite=true)":")"),r.push("?@v1='"),r.push(I.encodeRestUriStringToken(this._context.serverUrl+e.id)),r.push("'&@v2='"),r.push(I.encodeRestUriStringToken(this._context.serverUrl+t.targetId)),r.push("/"+I.encodeRestUriStringToken(e.name)+"'"),r.join("")},t.prototype._getRenameItemUrl=function(e){return[I.escapeUrlForCallback(this._context.webUrl),"/_api/web/GetList('",I.escapeUrlForCallback(this._listContext.listUrl),"')/Items(",e.properties.ID,")"].join("")},t.prototype._getItemTypeForListUrl=function(){var e=this._listContext.listUrl;this._context.webServerRelativeUrl&&(e=this._listContext.listUrl.split(this._context.webServerRelativeUrl)[1]),e=e.substring(1);for(var t=[],r=0;r<e.length;r++){var i=e.charAt(r),n=e.charCodeAt(r),o=n>47&&58>n||n>64&&91>n||n>96&&123>n;if(!o){var s=String("0000"+n.toString(16)).slice(-4);i="_x"+s+"_"}t.push(i)}return"SP.Data."+t.join("")+"Item"},t.prototype._getBatchOperationUrl=function(){return I.escapeUrlForCallback(this._context.webUrl)+"/_api/$batch"},t.prototype._getBatchContent=function(e,t,r,i){for(var n=E.default.generate(),o=[],s=0;s<t.length;s++){var a=t[s];o.push("--changeset_"+n),o.push("Content-Type: application/http"),o.push("Content-Transfer-Encoding: binary"),o.push(""),o.push(r+" "+a+" HTTP/1.1"),o.push(i),o.push("")}o.push("--changeset_"+n+"--");var u=o.join("\r\n");return o=[],o.push("--batch_"+e),o.push('Content-Type: multipart/mixed; boundary="changeset_'+n+'"'),o.push("Content-Length: "+u.length),o.push("Content-Transfer-Encoding: binary"),o.push(""),o.push(u),o.push(""),o.push("--batch_"+e+"--"),o.join("\r\n")},t.prototype._getBatchDeleteContent=function(e,r){for(var i=e.items,n=[],o=e.deletionType===c.PermanantDelete?"DELETE":"POST",s=e.deletionType===c.PermanantDelete?"If-Match: *":t._DefaultBatchRequstPostData,a=0;a<i.length;a++){var u=i[a],l=this._getDeleteSingleItemUrl(u,e);n.push(l)}return this._getBatchContent(r,n,o,s)},t.prototype._getBatchMoveContent=function(e,r){for(var i=e.items,n=[],o="POST",s=t._DefaultBatchRequstPostData,a=0;a<i.length;a++){var u=i[a],l=this._getMoveSingleItemUrl(u,e);n.push(l)}return this._getBatchContent(r,n,o,s)},t.prototype._getBatchCopyContent=function(e,r){for(var i=e.items,n=[],o="POST",s=t._DefaultBatchRequstPostData,a=0;a<i.length;a++){var u=i[a],l=this._getCopySingleItemUrl(u,e);n.push(l)}return this._getBatchContent(r,n,o,s)},t.prototype._ensureAncestorsExist=function(e,t,r){for(var i="",n=null,o=this._listContext.listUrl.split("/").length,s=0,a=t.length-1;a>s;s++)if(i+=t[s]+"/",s>o-(t.length>o?2:0)){var u={id:"/"===i[i.length-1]?i.substr(0,i.length-1):i,name:null===n?this._getDisplayName():t[s],type:f.Folder,folder:{childCount:0,startIndex:0,children:[]}},l=this._itemsStore.getItem(this._urlDataSource.getKey(u));if(l)l().parent=n,n=l();else{var c=this._getItemResult(e,null,u,this._itemsStore,n);this._itemsStore.setItem(c.item),n=c.item}}r.parent=n},t.prototype._getRedirectToEditNewDocument=function(e,t){var r="",i="action=edit";return null!==e&&""!==e&&(r=t===l.ExcelSurvey?e.replace(i,"action=formedit"):e.replace(i,"action=editnew")),r},t.prototype._getItemResult=function(e,t,s,u,l,c,d,h,T){var b=this;if(!s)return null;var C=!1;if(!c){C=!0,c=new y;var I=s.File_x0020_Type;c.id=s.id||s.FileRef,c.extension=I?"."+I:"",c.key=this._urlDataSource.getKey(s),c.name=s.FileLeafRef||s.name,c.policyTip=Number(s._ip_UnifiedCompliancePolicyUIAction)||_.none,"1"===this._navigation.viewParams[m.default.pseudoPolicyTipKey]&&(c.policyTip=Number(s.ID)%3);var E=s["File_x0020_Type.mapapp"],R=s["HTML_x0020_File_x0020_Type.File_x0020_Type.mapall"];if(c.type="1"===s.FSObjType?f.Folder:f.File,c.type===f.Folder&&(E&&"onenote"===E.substring(0,7)||R&&-1!==R.indexOf("onenote"))&&(c.type=f.OneNote),D.getItemTypeFromExtension(I)===f.Media){c.type=f.Media;var O=D.getIconNameFromExtension(I);"photo"===O?c.photo={width:0,height:0}:"video"===O&&(c.isVideo=!0,c.video={fourCC:"H264",width:null,height:null})}if(c.dateModifiedValue=s.Modified,c.dateModified=Boolean(s["Modified.FriendlyDisplay"])?x.GetRelativeDateTimeStringForLists(s["Modified.FriendlyDisplay"]):s.Modified,c.permissions={High:this._getPermMaskHigh(s.PermMask),Low:this._getPermMaskLow(s.PermMask)},h&&d&&d.length>0){c.groups={};for(var k=0;k<d.length;k++){var F=d[k],N=0===k?F+".COUNT.group":F+".COUNT.group2";if(F){if("1"===s[F+".newgroup"]){var M=this._getGroupName(s,F),L={groupingType:"SPListGroup",groupingId:M,name:M,field:F,count:Number(s[N]),state:r.observable({isCollapsed:!1})};h[k]||(h[k]=[]),h[k].push(L)}if(h[k].length>0){var B=h[k][h[k].length-1];c.groups[F]=B.groupingId}}}}if(T&&T.length>0&&c){c.hasMissingMetadata=!1;for(var V in T){var K=T[V];if(!s[K.name]){c.hasMissingMetadata=!0;break}}}}var H,j,W=s.folder,G=[];if(W){if(c.type=f.Folder,H=[],W.children){for(var z=0,Q=W.children,Y=Q.length,J=0,X=0;Y>X;X++)j=this._getItemResult(e,null,Q[X],u,c,null,d,G,T),j&&(H[X]=j.item,q>J&&j.item.type===f.Media&&z++,J++);Y>0&&(z>=q||z>=Y)&&(c.displayType=p.Photos)}}else{var $=s["serverurl.progid"];if(c.openUrl=$?$.substring(1):s.FileRef,c.appMap=s["File_x0020_Type.mapapp"]||s["HTML_x0020_File_x0020_Type.File_x0020_Type.mapall"],c.size=Number(s.File_x0020_Size),c.type!==f.Folder){if(w.fileTypeSupportsPreview(c.extension))if(this._shortcutLinkDataSource.isShortcutItem(c)){var Z=this._shortcutLinkDataSource.getShortcutTargetData(s.FileRef);Z.then(function(e){c.thumbnails=n.previewImageUrl(e,b._context.webUrl,!0)})}else c.thumbnails=n.previewImageUrl(s,this._context.webUrl,!0)}else c.childCount=Number(s.ItemChildCount)+Number(s.FolderChildCount);c.type===f.Media?w.fileTypeSupportsPreview(c.extension)&&(c.fullThumbnail=n.previewImageUrl(s,this._context.webUrl,!1)[0]):Boolean(c.thumbnails)&&c.thumbnails.length>0&&(c.fullThumbnail=c.thumbnails[0]),c.previewIFrameUrl=s.ServerRedirectedEmbedUrl}if(C){c.type===f.Folder&&(c.isDropEnabled=!0),t&&this._ensureAncestorsExist(e,t,c),c.isRootFolder=s.isRootFolder;for(var et in s)s.hasOwnProperty(et)&&(c.properties[et]=s[et]);var tt=c.name;c.extension&&(tt=c.name.substring(0,c.name.toLowerCase().lastIndexOf(c.extension.toLowerCase()))),c.sharingRole=S.Owner,c.sharingType=Number(c.properties.PrincipalCount)>0?v.Shared:void 0===c.properties.PrincipalCount?v.Unknown:v.Private,c.properties.FileName=tt,c.iconName=D.getIconNameFromItem(c),c.defaultSubText=n.getGridSubTitleTextFromModifiedBy(o._getModifiedByFromObject(c.properties.Editor)),c.displayName=c.name,c.isPlaceholder=!1,c.queryType="undefined"!=typeof e?e:this._urlDataSource.getQueryType(),Boolean(c.displayType)||(c.displayType=c.queryType),c.isDraggable=c.queryType===p.Files&&!c.isMountPoint,c.properties.nameFieldAriaLabel=i.getNameFieldAriaLabelForItem(c),c.properties.iconFieldAriaLabel=i.getIconFieldAriaLabelForItem(c),c.properties.modifiedFieldAriaLabel=a.strings.ModifiedColumnName+", "+c.dateModified,c.properties.calloutInvokerIconAriaLabel=a.strings.calloutInvokerIconAriaLabel,c.properties.modifiedByFieldAriaLabel=a.strings.ModifiedByColumnName+", "+o._getModifiedByFromObject(c.properties.Editor),c.policyTip&&(c.policyTip>=_.block?c.tooltipText=g.strings.policyTipBlockText:c.policyTip===_.notify&&(c.tooltipText=g.strings.policyTipNotifyText));var rt=c.properties.CheckoutUser;rt&&rt[0]&&rt[0].title&&(c.properties.checkedOutToText=U.format(g.strings.checkedOutTo,rt[0].title),c.tooltipText?c.tooltipText+=" "+c.properties.checkedOutToText:c.tooltipText=c.properties.checkedOutToText)}!c.parent&&l&&(c.parent=l,c.parentKey=l.key),C&&(A.getInstance().updateItem(u,c),u.setItem(c));var it=null;if(G&&G.length>0){var nt=0;if(this._listContext.filterParams){var ot=Boolean(P.getFilterFieldByName(this._listContext.filterParams,d[0]));if(ot){var st=Boolean(P.getFilterFieldByName(this._listContext.filterParams,d[1]));nt=st?-1:1}}-1!==nt&&G[nt]&&G[nt].length>0&&(it=[{itemGroups:G[nt],isAllCollapsed:r.observable(!1)}])}return{item:c,children:H,groupings:it,totalChildren:W?W.childCount:0,nextRequestToken:s.nextRequestToken}},t.prototype._getGroupName=function(e,t){var r=decodeURIComponent(e[t+".urlencoded"]),i=r.split(";#"),n=i.length-1;do r=i[n],n--;while(""===r&&n>=0);return r},t.prototype._getPermMaskHigh=function(e){if(Boolean(e)){var t=e.length;return 10>=t?0:parseInt(e.substring(2,t-8),16)}return 2147483647},t.prototype._getPermMaskLow=function(e){if(Boolean(e)){var t=e.length;return 10>=t?parseInt(e,16):parseInt(e.substring(t-8,t),16)}return 2147483647},t.prototype._checkFilename=function(e){var t=/"#%\*:<>\?\/\\\|/,r=null;return"string"==typeof e?(e=e.trim(),0===e.length?r=a.strings.emptyNameError:"~"===e[0]||"."===e[0]?r=U.format(a.strings.invalidNameStartError,e[0]):t.test(e)&&(r=U.format(a.strings.invalidNameError,e))):r=a.strings.emptyNameError,null!==r?C.default.wrapError(r):null},t.prototype._getMoveCopySingleItemResponse=function(e,t,r){var i={id:e.id,newId:t+"/"+e.name};if(r=r.error?r.error:r,r&&r.code){var n=r.code?r.code.split(","):r.error.code.split(","),o=Number(n[0]),s=r.message.value;i.error={code:o,message:s}}return{items:[i]}},t.prototype._getMoveCopyBatchItemsResponse=function(e,t,r){var i=this._processBatchResponse(r,e,t);return{items:i.items}},t.prototype._processErrorResponse=function(e,t){var r={id:t};if(e=e.error?e.error:e,e&&e.code){var i=e.code?e.code.split(","):e.error.code.split(","),n=Number(i[0]),o=e.message.value;r.error={code:n,message:o}}return{items:[r]}},t.prototype._processBatchResponse=function(e,t,r){var i,n,o,s,a=[],u=!1;if(e.split("\n").length>0&&(i=e.split("\n")[0]),i){e=e.replace(i.trim()+"--",""),n=e.split(i);for(var l=1;l<n.length;l++)if(o=n[l].split("\n\r"),o.length>2){try{s=JSON.parse(o[2])}catch(c){s=o[2]}var d={id:t[l-1].id,newId:r?r+"/"+t[l-1].name:null};if(s=s.error?s.error:s,s&&s.code){var p=s.code?s.code.split(","):s.error.code.split(","),h=Number(p[0]),m=s.message.value;d.error={code:h,message:m},u=!0}a.push(d)}}return{items:a,hasError:u}},t.prototype._getError=function(e){var t={errorCode:e,errorDetailedText:"",actionText:B.DefaultActionText,actionUrl:"/",errorTitle:""};switch(e){case L.fileNotFound:t.errorTitle=B.ItemNotFoundTitle,t.errorDetailedText=B.ItemNotFoundSubText;break;case L.invalidView:t.errorTitle=B.InvalidViewTitle,t.errorDetailedText=B.InvalidViewSubText;break;case L.listNotFound:t.errorTitle=B.InvalidListTitle,t.errorDetailedText=B.InvalidListSubText;break;default:t.errorTitle=B.DefaultTitle,t.errorDetailedText=B.DefaultSubText}return t},t.prototype._fetchNextGroup=function(){return this._listContext.isGrouped&&Boolean(this._listContext.requestToken)},t.prototype._needsQuickLaunch=function(){return!this._listContext.leftNavigationData&&"1"===this._context.webTemplate&&N.default.isFeatureEnabled(N.default.RenderListDataAsStreamLeftNavOpt)},t._DefaultBatchRequstPostData="Content-Type: application/json;odata=verbose",t}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=V}),define("odsp-next/models/operation/OperationBatch",["require","exports"],function(){var e=function(){function e(){this.id=++e._lastBatchId}return e._lastBatchId=0,e}();return e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/models/operation/OperationAction",["require","exports","odsp-shared/base/BaseModel","odsp-utilities/async/Promise","knockout"],function(e,t,r,i,n){function o(){"use strict";return i.default.wrap()}var s=function(e){function t(t){e.call(this,t),this.key=t.key,this.count=t.count||n.observable(1),this.isAvailable=t.isAvailable||n.observable(!0),this._onExecute=t.onExecute||o,this._operation=t.operation}return __extends(t,e),t.prototype.execute=function(){return this._onExecute.apply(this._operation)},t}(r);return s}),define("odsp-next/models/operation/OperationVisibility",["require","exports"],function(){var e;return function(e){e[e.Default=0]="Default",e[e.HidePeek=1]="HidePeek",e[e.HideAll=2]="HideAll"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/models/operation/Operation",["require","exports","knockout","./OperationState","./OperationBatch","./OperationType","./OperationAction","odsp-shared/base/BaseModel","./OperationVisibility"],function(e,t,r,i,n,o,s,a,u){var l=function(e){function t(t){var s=this;e.call(this,t),this.name=t.name,this.iconName=t.iconName,this.state=r.observable(i.created),this.error=r.observable(),this.count=r.observable(1);var a={minimum:0,maximum:0,current:0};t.progress&&r.utils.extend(a,t.progress),this.progress={minimum:r.observable(a.minimum),maximum:r.observable(a.maximum),current:r.observable(a.current)},this.type=r.observable(t.type||o.multiple),this.batch=t.batch||new n,this._initializeActions(t.actions),this.payloads=r.observable(t.payloads||{}),this.visibility=t.visibility||u.Default,t.computedEvaluators&&t.computedEvaluators.forEach(function(e){s.createComputed(e.bind(s,s))})}return __extends(t,e),t.prototype._initializeActions=function(e){e=e||{};var t={};for(var i in e){var n=e[i],o=this.addDisposable(new s({key:i,operation:this,isAvailable:n.isAvailable,onExecute:n.execute}));t[i]=o}this.actions=r.observable(t)},t}(a);return l}),define("odsp-shared/utilities/knockout/Aggregators",["require","exports","knockout"],function(e,t,r){var i=function(){function e(){}return e.includeInSum=function(e,t){var r,i=function(e){t(t.peek()+e)},n=e.subscribe(function(){r=e.peek()},null,"beforeChange"),o=e.subscribe(function(){i(e.peek()-r)});return i(e.peek()),{dispose:function(){n.dispose(),o.dispose(),i(-e.peek())}}},e.includeInHistogram=function(e,t){var r,i=function(e,r){var i=t.peek();void 0!==e&&i[e]--,void 0!==r&&(i[r]=(i[r]||0)+1),t.valueHasMutated()},n=e.subscribe(function(){r=e.peek()},null,"beforeChange"),o=e.subscribe(function(){i(r,e.peek())});return i(void 0,e.peek()),{dispose:function(){n.dispose(),o.dispose(),i(e.peek(),void 0)}}},e.setFirst=function(e,t){var i=e.peek(),n=e.subscribe(function(){i=e.peek()},null,"beforeChange"),o=r.computed(function(){!t()&&e()&&t(e())}),s=e.subscribe(function(e){!e&&i&&t.peek()===i&&t(void 0)});return{dispose:function(){o.dispose(),s.dispose(),n.dispose()}}},e}();return i}),define("odsp-shared/utilities/knockout/GroupProjection",["require","exports","../../base/Disposable","knockout","./Projections"],function(e,t,r,i){var n=function(){function e(e,t){var n=this;this._source=e,this._getKey=t,this._groupsByKeyId={},this.groups=i.observableArray(),this._initializeGroups(),r.default.hook(this.groups,function(){n._mapping.dispose()})}return e.group=function(t,r){var i=new e(t,r);return i.groups},e.prototype._initializeGroups=function(){var e=this;this._mapping=this._source.map({mappingWithDisposeCallback:function(t){var r=e._getKey(t),n=JSON.stringify(r),o=e._groupsByKeyId[n];return o?o.values.push(t):(o={key:r,values:i.observableArray([t])},e._groupsByKeyId[n]=o,e.groups.push(o)),{mappedValue:n,dispose:function(){o.values.peek().length>1?o.values.remove(t):(delete e._groupsByKeyId[n],e.groups.remove(o))}}}})},e}();return n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/models/operation/GroupOperation",["require","exports","./OperationType","./OperationState","./OperationAction","odsp-utilities/async/Promise","odsp-shared/base/BaseModel","odsp-shared/utilities/knockout/Aggregators","odsp-shared/utilities/knockout/GroupProjection","./OperationVisibility","knockout","odsp-shared/utilities/knockout/Projections"],function(e,t,r,i,n,o,s,a,u,l,c){var d=function(e){function t(t){e.call(this,t),this.operations=t.operations,this.name="",this.iconName="",this.progress={minimum:c.observable(0),maximum:c.observable(0),current:c.observable(0)},this.batch=t.batch,this.error=c.observable(),this.count=c.observable(0),this._initializeType(),this.payloads=this.createComputed(this._computePayloads),this.actions=c.observable({}),this.states=c.observable({created:0,started:0,completed:0,failed:0,canceled:0,expired:0}),this._initializeOperations(),this.state=this.createComputed(this._computeState),this.createComputed(this._computeVisibility)}return __extends(t,e),t.prototype._initializeType=function(){var e=this.addDisposable(u.group(this.operations,function(e){return e.type()}));this.type=this.createComputed(function(){return 1===e().length&&e()[0].key||r.multiple})},t.prototype._computePayloads=function(){var e=this.operations()[0];return e&&e.payloads()||{}},t.prototype._initializeOperations=function(){var e=this;this.addDisposable(this.operations.map({mappingWithDisposeCallback:function(t){var r=c.pureComputed(function(){return i[t.state()]}),n=a.includeInSum(t.progress.minimum,e.progress.minimum),o=a.includeInSum(t.progress.maximum,e.progress.maximum),s=a.includeInSum(t.progress.current,e.progress.current),u=a.includeInHistogram(r,e.states),l=a.setFirst(t.error,e.error),d=a.includeInSum(t.count,e.count),p=c.computed(function(){var r=!1;for(var i in t.actions())i in e.actions.peek()||(e.actions.peek()[i]=e._initializeAction(i),r=!0);r&&e.actions.valueHasMutated()});return{mappedValue:{},dispose:function(){r.dispose(),n.dispose(),o.dispose(),s.dispose(),u.dispose(),p.dispose(),l.dispose(),d.dispose()}}}}))},t.prototype._computeState=function(){var e,t=this.states();return e=t.started||t.created&&(t.failed||t.completed||t.canceled)?i.started:t.created?i.created:t.failed?i.failed:t.completed?i.completed:t.canceled?i.canceled:i.expired},t.prototype._computeVisibility=function(){var e=this.operations().reduce(function(e,t){return t.visibility<e?t.visibility:e},l.HideAll);this.visibility=e},t.prototype._initializeAction=function(e){var t=this.addDisposable(this.operations.filter(function(t){var r=t.actions()[e];return r&&r.isAvailable()}));return this.addDisposable(new n({count:this.createComputed(function(){return t().length}),key:e,operation:this,isAvailable:this.createComputed(function(){return!!t().length}),onExecute:function(){return o.default.all(t().slice().map(function(t){var r=t.actions.peek()[e];return r&&r.execute()||o.default.wrap()}))}}))},t}(s);return d});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/providers/operation/OperationProvider",["require","exports","odsp-shared/base/BaseModel","../../models/operation/Operation","../../models/operation/OperationState","../../models/operation/OperationBatch","../../models/operation/GroupOperation","odsp-shared/utilities/knockout/GroupProjection","../../models/operation/OperationVisibility","knockout","odsp-shared/utilities/knockout/Projections"],function(e,t,r,i,n,o,s,a,u,l){var c=function(e){function t(t){var r=this;e.call(this,t);var i=new o;this.operations=l.observableArray(),this.groups=this.addDisposable(a.group(this.operations,function(e){return e.batch}).map({mappingWithDisposeCallback:function(e){var t=new(r.resources.injected(s))({batch:e.key,operations:e.values,visibility:u.Default});return{mappedValue:t,dispose:function(){t.dispose()}}}})),this.overall=new(this.managed(s))({batch:i,operations:this.groups,visibility:u.Default})}return __extends(t,e),t.prototype.register=function(e){var t=new i(e);return t.visibility!==u.HideAll&&this.operations.push(t),t},t.prototype.cleanup=function(e){void 0===e&&(e=!1);var t=[];this.groups.peek().forEach(function(r){var i=r.state.peek();if(i===n.completed||!e&&(i===n.expired||i===n.canceled||i===n.failed))for(var o,s=r.operations.peek(),a=0;a<s.length;a++){o=!0;var u=s[a];if(i===n.failed&&u.actions)for(var l=u.actions.peek(),c=Object.keys(l),d=0;d<c.length;d++)if(l[c[d]].isAvailable.peek()){o=!1;break}o&&t.push(s[a])}}),this.operations.removeAll(t),t.forEach(function(e){e.dispose()})},t}(r);return c}),define("odsp-shared/utilities/object/SchemaMapper",["require","exports"],function(){var e=function(){function e(e,t){this._map=e,this._callback=t}return e.prototype.forwardTransform=function(e){return this._transform(e,!0)},e.prototype.reverseTransform=function(e){return this._transform(e,!1)},e.prototype._getInputProperty=function(e,t){var r=e;this._callback&&this._callback(r,e);for(var i=t.split("."),n=0;n<i.length;n++)r=r[i[n]];return r},e.prototype._transformSingle=function(e,t){for(var r={},i=t?"from":"to",n=t?"to":"from",o=0;o<this._map.length;o++){var s=this._map[o][i],a=this._map[o][n];r[a]=this._getInputProperty(e,s)}return r},e.prototype._transform=function(e,t){if("undefined"!=typeof e&&e.constructor===Array){for(var r=[],i=0;i<e.length;i++)r.push(this._transformSingle(e[i],t));return r}return this._transformSingle(e,t)},e}();return e}),define("odsp-next/models/peoplePicker/EntityType",["require","exports"],function(){var e;return function(e){e[e.regularUser=0]="regularUser",e[e.externalUser=1]="externalUser",e[e.group=2]="group",e[e.application=3]="application"}(e||(e={})),e}),define("odsp-next/dataSources/peoplePicker/IPresenceType",["require","exports"],function(){var e;return function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.Busy=2]="Busy",e[e.DoNotDisturb=3]="DoNotDisturb",e[e.BeRightBack=4]="BeRightBack",e[e.Away=5]="Away",e[e.Offline=6]="Offline",e[e.Hidden=7]="Hidden"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/peoplePicker/odb/PeoplePickerDataSource",["require","exports","odsp-shared/utilities/object/SchemaMapper","../../../dataSources/base/odb/DataSource","../../../models/peoplePicker/EntityType","../IPresenceType"],function(e,t,r,i,n,o){var s=function(e){function t(t){e.call(this,t),this._hostSettings=t,this._capabilities={supportsMruCaching:!0}}return __extends(t,e),t.prototype.getDataSourceName=function(){return"PeoplePickerDataSource"},t.prototype.getCapabilities=function(){return this._capabilities},t.prototype.search=function(e,t){var r=this;return this.getData(function(){return r._context.webServerRelativeUrl+"/_api/SP.UI.ApplicationPages.ClientPeoplePickerWebServiceInterface.ClientPeoplePickerSearchUser"},function(e){var t=JSON.parse(e),i=JSON.parse(t.d.ClientPeoplePickerSearchUser);return r._transformData(i)},"Search",function(){return r._constructPostBody(e,t)})},t.prototype.resolve=function(e,t){var r=this;return this.getData(function(){return r._context.webServerRelativeUrl+"/_api/SP.UI.ApplicationPages.ClientPeoplePickerWebServiceInterface.ClientPeoplePickerResolveUser"},function(e){var t=JSON.parse(e),i=JSON.parse(t.d.ClientPeoplePickerResolveUser),n=[];return n[0]=i,i.IsResolved||(n[0].DisplayText=i.Key),n=r._transformData(n),n[0]},"Resolve",function(){return r._constructPostBody(e,t)})},t.prototype.subscribePresence=function(e,t){var r=this;try{if(this.ensureSkypePresence(),!O365Shell_Shim.SkypeIntegration.isAvailable())return null;Boolean(this._hostSettings)&&e===this._hostSettings&&(e=null);var i=function(e){try{switch(e){case 0:t(o.Unknown);break;case 1:t(o.Online);break;case 2:t(o.Busy);break;case 3:t(o.DoNotDisturb);break;case 4:t(o.BeRightBack);break;case 5:t(o.Away);break;case 6:t(o.Offline);break;case 8:t(o.Hidden);break;default:t(o.Unknown)}}catch(r){}};this._skypeIntegration.TrackPresence(e,i);var n={dispose:function(){try{r._skypeIntegration.UntrackPresence(e,i)}catch(t){}}};return n}catch(s){}return null},t.prototype.getPersonaDetails=function(e){var t=this;return this.getData(function(){return t._context.webServerRelativeUrl+"/_api/sp.publishing.personmagazine.GetPersonMagazineUserProfileDataForUser?accountName='"+e+"'"},function(i){var n=[{from:"DisplayName",to:"name"},{from:"Email",to:"email"},{from:"AccountName",to:"userId"},{from:"Office",to:"office"},{from:"PictureUrl",to:"image"},{from:"Title",to:"job"},{from:"DepartmentName",to:"department"},{from:"Phone",to:"phone"},{from:"Lync",to:"sip"}],o=new r(n),s=JSON.parse(i),a={personDetails:o.forwardTransform(s.d.GetPersonMagazineUserProfileDataForUser.Primary),managerChain:o.forwardTransform(s.d.GetPersonMagazineUserProfileDataForUser.ManagerChain.results),directReports:o.forwardTransform(s.d.GetPersonMagazineUserProfileDataForUser.DirectReports.results)};return a.personDetails.profilePage=t._context.webServerRelativeUrl+"/_layouts/15/me.aspx?p="+encodeURIComponent(e)+"&v=profile",a},"GetPersonaDetails")},t.prototype._transformData=function(e){for(var t=[{from:"DisplayText",to:"name"},{from:"EntityData.Email",to:"email"},{from:"Key",to:"userId"},{from:"EntityData.Title",to:"job"},{from:"EntityData.Department",to:"department"},{from:"EntityData.MobilePhone",to:"phone"},{from:"ProviderDisplayName",to:"providerName"},{from:"EntityType",to:"entityType"},{from:"IsResolved",to:"isResolved"},{from:"MultipleMatches",to:"multipleMatches"}],i=new r(t),o=i.forwardTransform(e),s=0;s<o.length;s++){o[s].multipleMatches.length>0&&(o[s].multipleMatches=this._transformData(o[s].multipleMatches)),o[s].isResolved&&(o[s].image=null!==o[s].email?"/_layouts/15/userphoto.aspx?size=S&accountname="+o[s].email:null);var a=e[s].EntityData.PrincipalType;switch(Boolean(a)||(a=e[s].EntityType),a){case"UNVALIDATED_EMAIL_ADDRESS":case"GUEST_USER":o[s].entityType=n.externalUser;break;case"SecGroup":case"SharePointGroup":o[s].entityType=n.group;break;default:o[s].entityType=n.regularUser}o[s].rawData=e[s]}return o},t.prototype._constructPostBody=function(e,t){var r={queryParams:{QueryString:e,MaximumEntitySuggestions:t.maximumEntitySuggestions,AllowEmailAddresses:t.allowEmailAddresses,AllowOnlyEmailAddresses:t.allowOnlyEmailAddresses,PrincipalType:t.principalType,PrincipalSource:t.principalSource}};return JSON.stringify(r)},t.prototype.ensureSkypePresence=function(){var e=this;try{if(!Boolean(this._skypeIntegration)){var t=new O365Shell_Shim.SkypeIntegration;t.OnApiReady(function(){e._skypeIntegration=t})}}catch(r){}},t}(i);return s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/models/store/PeopleStore",["require","exports","odsp-utilities/models/store/BaseDataStore","odsp-utilities/models/store/DataStoreCachingType"],function(e,t,r,i){var n=function(e){function t(){e.call(this,t._Key,t._DataStoreCachingType),this._MaxItems=200,this._Version=2,this._buffer=this.getValue(t._StorageKey),this._buffer&&this._buffer.version===this._Version||this.initializeBuffer(),this._data={};for(var r=0;r<this._buffer.dataArray.length;r++)this._data[this._buffer.dataArray[r].email]=this._buffer.dataArray[r]}return __extends(t,e),t.clear=function(){var e=new r(t._Key,t._DataStoreCachingType);e.remove(t._StorageKey)},t.prototype.setItem=function(e){if(!this._data[e.email]){if(this._buffer.dataArray.length===this._MaxItems){this._buffer.index++,this._buffer.index>=this._MaxItems&&(this._buffer.index=0);var r=this._buffer.dataArray[this._buffer.index];delete this._data[r.email],this._buffer.dataArray[this._buffer.index]=e}else this._buffer.dataArray.push(e),this._buffer.index++;this._data[e.email]=e,this.setValue(t._StorageKey,this._buffer)}},t.prototype.getItems=function(e){for(var t=[],r=0;r<this._buffer.dataArray.length;r++){var i=(this._buffer.index-r+this._MaxItems)%this._MaxItems;(this._buffer.dataArray[i].email&&this._buffer.dataArray[i].email.toLowerCase().indexOf(e.toLowerCase())>=0||this._buffer.dataArray[i].name&&this._buffer.dataArray[i].name.toLowerCase().indexOf(e.toLowerCase())>=0)&&t.push(this._buffer.dataArray[i])}return t},t.prototype.containsItem=function(e){return Boolean(this._data[e.email])},t.prototype.initializeBuffer=function(){this._buffer={},this._buffer.dataArray=[],this._buffer.index=-1,this._buffer.version=this._Version},t._Key="ClientPeoplePicker",t._StorageKey="MRU",t._DataStoreCachingType=i.local,t}(r);return n}),define("odsp-next/providers/peoplePicker/PeoplePickerProvider",["require","exports","odsp-utilities/async/Promise","../../resources/DataSourceResourceKeys","../../models/store/PeopleStore"],function(e,t,r,i,n){var o=function(){function e(){this._dataSource=this.resources.consume(i.people),this._ppCapabilities=this._dataSource.getCapabilities(),this._ppCapabilities.supportsMruCaching?(this._mruCache=new n,this.MaxCacheSuggestions=5):this.MaxCacheSuggestions=0}return e.prototype.search=function(e,t){var i,n=this,o={cached:null,promise:null};if(this._ppCapabilities.supportsMruCaching){var s=this.searchMruCache(e);s.length>0&&(o.cached=s)}return o.promise=new r.default(function(r,o){i=n._dataSource.search(e,t).then(function(e){if(n._ppCapabilities.supportsMruCaching){for(var t=0;t<e.length;t++)for(var i=0;i<s.length;i++)if(e[t].email===s[i].email){delete e[t];break}r(e.filter(Boolean))}else r(e)},function(e){o(e)})},function(){i&&i.cancel()}),o},e.prototype.resolve=function(e,t){var r=this;return r._dataSource.resolve(e,t).then(function(e){return r._ppCapabilities.supportsMruCaching&&e.isResolved&&r._mruCache.setItem(e),e})},e.prototype.getPersonaDetails=function(e){var t=this;return t._dataSource.getPersonaDetails(e).then(function(e){return e})},e.prototype.subscribePresence=function(e,t){var r=this;return r._dataSource.subscribePresence(e,t)},e.prototype.addToMruCache=function(e){this._mruCache&&this._mruCache.setItem(e)},e.prototype.searchMruCache=function(e){var t=[];return this._mruCache&&(t=this._mruCache.getItems(e),t.length>this.MaxCacheSuggestions&&(t=t.splice(0,this.MaxCacheSuggestions))),t},e}();return o}),define("odsp-next/models/policyTip/PolicyTipUserAction",["require","exports"],function(){var e;return function(e){e[e.override=0]="override",e[e.reportFalsePositive=1]="reportFalsePositive"}(e||(e={})),e}),define("odsp-next/models/policyTip/PolicyTipUserActionResult",["require","exports"],function(){var e;
return function(e){e[e.none=0]="none",e[e.falsePositiveReported=1]="falsePositiveReported",e[e.overridden=2]="overridden",e[e.falsePositiveReportedAndOverridden=3]="falsePositiveReportedAndOverridden"}(e||(e={})),e}),define("odsp-next/models/policyTip/RuleOverrideOptions",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.allow=1]="allow",e[e.allowWithJustification=2]="allowWithJustification"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/policyTip/odb/PolicyTipDataSource",["require","exports","../../../dataSources/base/odb/DataSource","../../../dataSources/url/odb/UrlQueryKeys","../../../models/policyTip/PolicyTipUserAction","../../../models/policyTip/PolicyTipUserActionResult","../../../models/policyTip/RuleOverrideOptions","../../../resources/SPOResourceKeys","../../../resources/UtilityResourceKeys","odsp-utilities/async/Promise","odsp-utilities/encoding/UriEncoding","odsp-shared/utilities/string/StringHelper"],function(e,t,r,i,n,o,s,a,u,l,c,d){var p=function(e){function t(t){e.call(this,t),this._navigation=this.resources.consume(u.navigation)}return __extends(t,e),t.prototype.getExternalSharingStatus=function(){if("1"===this._navigation.viewParams[i.default.pseudoPolicyTipKey])return l.default.wrap({isExternalSharingTipEnabled:!0,externalSharingTipsLearnMoreUrl:"http://bing.com"});var e=this;return this.getData(function(){return e._context.webServerRelativeUrl+"/_api/Web/DataLeakagePreventionStatusInfo"},function(e){var t=JSON.parse(e);return t&&t.d&&t.d.ExternalSharingTipsEnabled&&t.d.ExternalSharingTipsLearnMoreUrl?{isExternalSharingTipEnabled:t.d.ExternalSharingTipsEnabled,externalSharingTipsLearnMoreUrl:t.d.ExternalSharingTipsLearnMoreUrl}:null},"GetExternalSharingStatus")},t.prototype.getPolicyTip=function(e){var t=this;return this._listContext||(this._listContext=this.resources.consume(a.listContext)),"1"===this._navigation.viewParams[i.default.pseudoPolicyTipKey]?l.default.wrap({issueDescriptions:["Item might contain the following sensitive information: Credit card number, driver's license number","Item might be shared with people outside your organization","Item might have stuff you don't want in it"],overrideOption:s.allowWithJustification,lastScanned:new Date,policyInfoUrl:"http://bing.com",explanationText:"This item contains information that violates Contoso company policy. Access to this item is restricted for everyone except its creator, last modifier, and site owner."}):this.getData(function(){return d.format("{0}/_api/web/GetList('{1}')/items({2})/getdlppolicytip",c.escapeUrlForCallback(t._context.webUrl),c.escapeUrlForCallback(t._listContext.listUrl),e.properties.ID)},function(e){var t=JSON.parse(e);if(!t||!t.d||null===t.d.GetDlpPolicyTip)return null;var r={};return t=t.d,t.MatchedConditionDescriptions&&t.MatchedConditionDescriptions.results&&(r.issueDescriptions=t.MatchedConditionDescriptions.results),r.overrideOption=t.OverrideOptions?Number(t.OverrideOptions):s.none,r.lastScanned=new Date(t.LastProcessedTime),r.lastScanned.getTime&&isNaN(r.lastScanned.getTime())&&delete r.lastScanned,r.policyInfoUrl=t.ComplianceUrl,r.explanationText=t.GeneralText&&t.AppliedActionsText?t.GeneralText+" "+t.AppliedActionsText:t.GeneralText||t.AppliedActionsText||"",r},"GetPolicyTip")},t.prototype.updatePolicy=function(e){var t=this;if(this._listContext||(this._listContext=this.resources.consume(a.listContext)),"1"===this._navigation.viewParams[i.default.pseudoPolicyTipKey]){var r;return r=e.action===n.override?o.overridden:e.action===n.reportFalsePositive?o.falsePositiveReportedAndOverridden:o.none,l.default.wrap(r)}return this.getData(function(){return d.format("{0}/_api/web/GetList('{1}')/items({2})/overridepolicytip",c.escapeUrlForCallback(t._context.webUrl),c.escapeUrlForCallback(t._listContext.listUrl),e.item.properties.ID)},function(e){var t=JSON.parse(e);return t&&t.d&&"number"==typeof t.d.OverridePolicyTip?t.d.OverridePolicyTip:null},"UpdatePolicyTip",function(){return JSON.stringify({userAction:e.action,justification:e.justification})},"POST")},t.prototype.getDataSourceName=function(){return"PolicyTipDataSource"},t}(r);return p});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/item/odb/RecentDataSource",["require","exports","knockout","./ItemDataSource","./ODBDataSource.resx","../../../models/item/OneDriveItem","../../../models/item/ItemType","../../../dataSources/url/odb/UrlDataSource","../../../dataSources/url/QueryType","../../../utilities/icons/IconSelector","./GridPreviewHelpers","../../../actions/odb/PermissionMask","../../../models/sharing/SharingRole","../../../utilities/locale/Locale","../../../controls/list/interfaces/ColumnFieldType"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m){var f=function(e){function t(t,r){e.call(this,t,r)}return __extends(t,e),t.prototype.getDataSourceName=function(){return"RecentDataSource"},t.prototype._getServerConnectionUrl=function(){return this._context.webUrl+"/_api/search/query?querytext='*'&querytemplate='(AuthorOwsUser:{User.AccountName} OR EditorOwsUser:{User.AccountName}) AND ContentType:Document AND IsDocument:1 AND -Title:OneNote_DeletedPages AND -Title:OneNote_RecycleBin NOT(FileExtension:mht OR FileExtension:aspx OR FileExtension:html OR FileExtension:htm)'&rowlimit=50&bypassresulttypes=false&selectproperties='Title,Path,Filename,FileExtension,Created,Author,LastModifiedTime,ModifiedBy,LinkingUrl,SiteTitle,ParentLink,DocumentPreviewMetadata,ListID,ListItemID,SPSiteURL,SiteID,WebId,UniqueID,SPWebUrl'&sortlist='LastModifiedTime:descending'&enablesorting=true"},t.prototype._processData=function(e,t,i){var o=i.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results,s=a.getKeyParts(e),l=o,c={id:s.id,Title:n.strings.Recent,IsContainer:!0,displayType:u.Recent,folder:{childCount:l.length,startIndex:0,children:l},isRootFolder:!0},d=this._getRecentItem(t,c,this._itemsStore),p=[{internalName:"IsContainer",key:"type",name:"",index:0,isVisible:!0,isVisibleMobile:!0,isIcon:!0,isCollapsable:!1,isSorted:!1,isAscending:!1,width:50,filterable:!1,sortable:!1,fieldType:m.FileIcon,isFocused:r.observable(!1)},{internalName:"FileLeafRef",key:"name",name:n.strings.NameColumnName,index:1,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,isIcon:!1,width:250,sortable:!1,isSorted:!1,isAscending:!1,filterable:!1,fieldType:m.Name,isFocused:r.observable(!1)},{internalName:"_calloutInvoker",key:"_calloutInvoker",name:"",index:2,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,isIcon:!1,width:18,sortable:!1,isSorted:!1,isAscending:!1,filterable:!1,fieldType:m.DotDotDot,isFocused:r.observable(!1)},{internalName:"Modified",key:"dateModified",name:n.strings.ModifiedColumnName,index:2,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,width:200,isSorted:!0,isAscending:!1,sortable:!1,isIcon:!1,filterable:!1,fieldType:m.Text,isFocused:r.observable(!1)},{internalName:"ModifiedBy",key:"editorName",name:n.strings.ModifiedByColumnName,index:3,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,width:200,isSorted:!1,isAscending:!1,sortable:!1,isIcon:!1,filterable:!1,fieldType:m.User,isFocused:r.observable(!1)}];return d.schema=p,d},t.prototype._getRecentItem=function(e,t,r){if(!t)return null;var n=new o;n.id=this._getPropertyFromItem(t,"ListItemID")||t.Id,n.key=this._getPropertyFromItem(t,"Path")||this._urlDataSource.getKey(t),n.name=this._getPropertyFromItem(t,"Filename"),n.itemId=n.id,n.parentLink=this._getPropertyFromItem(t,"ParentLink"),n.displayName=this._getPropertyFromItem(t,"Title"),n.isPlaceholder=!1,n.type=s.File,n.dateModified=new Date(this._getPropertyFromItem(t,"LastModifiedTime")).toLocaleDateString(h.language),n.queryType="undefined"!=typeof e?e:this._urlDataSource.getQueryType();var a,u=t.folder;if(u){if(a=[],u.childCount=u.childCount,u.children)for(var m=0;m<u.children.length;m++)a[m]=this._getRecentItem(e,u.children[m],this._itemsStore).item;n.type=s.Folder,n.isRootFolder=!!t.isRootFolder}else{n.openUrl=this._getPropertyFromItem(t,"LinkingUrl")||this._getPropertyFromItem(t,"Path"),n.editorName=i._getModifiedByFromString(this._getPropertyFromItem(t,"ModifiedBy")),n.defaultSubText=c.getGridSubTitleTextFromModifiedBy(n.editorName);var f=this._getPropertyFromItem(t,"FileExtension");n.extension=f,l.getItemTypeFromExtension(f)===s.Media&&(n.type=s.Media,"photo"===l.getIconNameFromExtension(f)&&(n.photo={width:0,height:0}));var g=this._getPropertyFromItem(t,"SiteID"),y=this._getPropertyFromItem(t,"WebId"),v=this._getPropertyFromItem(t,"UniqueID");n.type!==s.Folder&&(n.thumbnails=c.previewImageUrlFromProps(g,y,v,this._context.webUrl,!0)),n.type===s.Media?n.fullThumbnail=c.previewImageUrlFromProps(g,y,v,this._context.webUrl,!1)[0]:Boolean(n.thumbnails)&&n.thumbnails.length>0&&(n.fullThumbnail=n.thumbnails[0]),n.sharingRole=p.Edit}n.iconName=l.getIconNameFromItem(n),n.permissions=d.Or(d.OpenItems,d.ManagePermissions);var _={};_.title=n.editorName,_.email="",_.id="",_.sip="";var S=this._getPropertyFromItem(t,"EditorOWSUSER");if(S){var T=S.split("|");T.length>1&&(S=T[0].trim(),S&&(_.sip=S))}return n.properties.editorName=[_],r.setItem(n),{item:n,children:a,totalChildren:u?u.childCount:0}},t.prototype._getPropertyFromItem=function(e,t){if(Boolean(e)&&Boolean(e.Cells))for(var r=e.Cells.results,i=r.length,n=0;i>n;n++)if(r[n].Key===t)return r[n].Value;return null},t}(i);return f});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/search/odb/SearchCenterDataSource",["require","exports","odsp-utilities/async/Promise","../../../dataSources/base/odb/DataSource"],function(e,t,r,i){var n=function(e){function t(t){e.call(this,t),this._urlCached=!1,this._searchCenterUrl=null}return __extends(t,e),t.prototype.getDataSourceName=function(){return"SearchCenterDataSource"},t.prototype.getSearchCenterUrl=function(){var e=this,t=!1;return new r.default(function(r,i){e._urlCached?r(e._searchCenterUrl):e.getData(function(){return e._context.webUrl+"/_api/search/searchCenterUrl"},function(e){var t=null;if(e){var r=JSON.parse(e);t=r.d.searchcenterurl}return t},"GetSearchCenterUrl").done(function(i){t||(e._searchCenterUrl=i,e._urlCached=!0,r(e._searchCenterUrl))},function(e){i(e)})},function(){t=!0})},t}(i);return n}),define("odsp-next/models/search/SearchData",["require","exports"],function(){var e=function(){function e(e,t,r){this.query=e,this.containers=t||[],this.upscopeAvailable=r||!1}return e}();return e}),define("odsp-next/dataSources/search/odb/SearchPromises",["require","exports"],function(){var e=function(){function e(){this._activePromises={}}return e.prototype.registerPromise=function(e,t,r,i){this._activePromises[t],this._activePromises[t]={query:e,id:t,completeCallback:r,errorCallback:i,results:[]}},e.prototype.unregisterPromise=function(e){delete this._activePromises[e]},e.prototype.setPromiseData=function(e,t){this._activePromises[e]=t},e.prototype.getPromiseData=function(e){return this._activePromises[e]},e.prototype.getAllPromiseKeys=function(){return Object.keys(this._activePromises)},e}();return e}),define("odsp-next/models/search/SearchResultType",["require","exports"],function(){var e;return function(e){e[e.Default=0]="Default",e[e.Photo=1]="Photo",e[e.Tag=2]="Tag",e[e.History=3]="History",e[e.Location=4]="Location",e[e.Expanded=5]="Expanded",e[e.UpscopeSearch=6]="UpscopeSearch"}(e||(e={})),e}),define("odsp-next/models/search/SearchResult",["require","exports","./SearchResultType"],function(e,t,r){var i=function(){function e(e,t,i){this.title=e,this.url=t,this.iconUrl=i,this.type=r.Expanded}return e}();return i}),define("odsp-next/dataSources/search/odb/SearchDataSource",["require","exports","odsp-utilities/async/Promise","odsp-utilities/logging/ErrorHelper","../../../utilities/datetime/DateTime","../../../utilities/uri/Uri","./SearchCenterDataSource","../../../models/search/SearchData","./SearchPromises","../../../models/search/SearchResult"],function(e,t,r,i,n,o,s,a,u,l){var c=function(){function t(e,t){this._capabilities={supportsResultsWheeling:"undefined"==typeof t?!0:t,minimumQueryLength:2,maxQueryRate:100,showNoResults:!0,showOnlyResults:!1,supportsSearchFiltering:!1},this._searchCenterDataSource=new s(e)}return t.prototype.getCapabilities=function(){return this._capabilities},t.prototype.getItems=function(t){var i=this,n=!1,o=null;return new r.default(function(o,s){new r.default(function(t){e(["odm"],function(){e(["oil.core","oil.p.myprops","sharedwithme","mydocuments","oil.p.export"],function(e,r,n,o,s){if(!i._initialized){i._oilCore=e;var a={requiresRawData:!0};i._pluginService=new e.PluginService(a);var l=new r.MyPropertiesPlugin;l.initialize(i._pluginService);var c=new n;c.initialize(i._pluginService);var d=new o;d._pluginDependency=!1,d.initialize(i._pluginService);var p=new s.ExportPlugin(["mydocuments"],i._dataDispatcher(),i._errorDispatcher());p.initialize(i._pluginService),i._searchPromises=new u,i._initialized=!0}t({oilCore:i._oilCore,pluginService:i._pluginService})})})}).then(function(e){if(!n){var r=new e.oilCore.Query({term:t});i._searchPromises.registerPromise(t,r.getId(),o,s);var a=e.pluginService;a.setQuery(r)}},function(){n=!0})},function(){n=!0,i._searchPromises.unregisterPromise(o)})},t.prototype.upscopeSearch=function(e){e&&this._searchCenterDataSource.getSearchCenterUrl().done(function(t){t?window.open(t+"/results.aspx?k="+e):i.log({message:"Cannot upscope search. Caller must use the upscopeAvailable property of the returned ISearchData to determine if calling upscopeSearch is acceptable."})})},t.prototype.searchResultClicked=function(){},t.prototype._dataDispatcher=function(){var e=this;return function(t){var r=t.queryId,i=function(t){var i=t.length,s=e._searchPromises.getPromiseData(r);if(s){for(var a=0;i>a;a++){var u=t[a],c=new o(u.clickurl);u.fileextension&&"one"===u.fileextension.toLowerCase()&&c.setQueryParameter("wdsearch",s.query);var d=new l(u.title,c.toString(),u.image);d.summary=u.summary,d.showSummary=u.summary.indexOf("<i>")>-1,d.lastModifiedDate=n.Iso8601DateTimeToJsDate(u.lastediteddatetime),d.lastModifiedBy=u.rawEditor,d.parentUrl=u.parentlink,u.folderbreadcrumb&&u.folderbreadcrumb.length>0&&(d.parentFolder=u.folderbreadcrumb[u.folderbreadcrumb.length-1]),s.results.push(d)}e._searchPromises.setPromiseData(r,s)}else;},s={mydocuments:i};if(t.processNewData(s),t.complete){var a=e._searchPromises.getPromiseData(r);a&&e._searchCenterDataSource.getSearchCenterUrl().done(function(t){var i=e._transferResults(a,t);e._searchPromises.unregisterPromise(r),a.completeCallback(i)},a.errorCallback)}}},t.prototype._errorDispatcher=function(){var e=this;return function(t){console.log("Search error.");var r,i=e._searchPromises.getAllPromiseKeys();for(var n in i){var o=i[n];r=e._searchPromises.getPromiseData(o),r&&(e._searchPromises.unregisterPromise(o),r.errorCallback&&(r.errorCallback(t.originalError.message),console.log("Search error details: "+t.originalError.message)))}}},t.prototype._transferResults=function(e,t){var r;return e&&(r=new a(e.query,[{results:e.results}],!!e.query&&!!t)),r},t}();return c}),define("odsp-next/providers/search/SearchProvider",["require","exports","../../resources/DataSourceResourceKeys"],function(e,t,r){var i=function(){function e(){this._searchDataSource=this.resources.consume(r.search)}return e.prototype.getCapabilities=function(){return this._searchDataSource.getCapabilities()},e.prototype.getItems=function(e,t){return this._searchDataSource.getItems(e,t)},e.prototype.upscopeSearch=function(e){this._searchDataSource.upscopeSearch(e)},e.prototype.searchResultClicked=function(e){this._searchDataSource.searchResultClicked(e)},e}();return i}),define("odsp-next/dataSources/settings/odb/SettingsDataSource",["require","exports"],function(){var e=function(){function e(){this.mediaBaseUrl="odsp-media"}return e}();return e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/shareByLink/odb/ShareByLinkDataSource",["require","exports","../../../dataSources/base/odb/DataSource"],function(e,t,r){var i=function(e){function t(t){e.call(this,t),this._connectionUrl="",this._connectionUrl=this._context.webServerRelativeUrl+"/_api/Site/ShareByLinkEnabled"}return __extends(t,e),t.prototype.getDataSourceName=function(){return"ShareByLinkDataSource"},t.prototype.getShareByLinkInfo=function(){var e=this;return this.getData(function(){return e._connectionUrl},function(e){var t=JSON.parse(e);return Boolean(t)&&Boolean(t.d)?{isExternalSharingTipEnabled:Boolean(t.d.ShareByLinkEnabled)}:null},"GetShareByLinkInfo")},t}(r);return i}),define("odsp-next/providers/shareByLink/ShareByLinkProvider",["require","exports","../../resources/DataSourceResourceKeys"],function(e,t,r){var i=function(){function e(){this._dataSource=this.resources.consume(r.shareByLink)}return e.prototype.getShareByLinkInfo=function(){var e=this;return e._dataSource.getShareByLinkInfo().then(function(e){return e})},e}();return i}),define("odsp-next/models/sharing/SharingLinkType",["require","exports"],function(){var e;return function(e){e[e.Network=1]="Network",e[e.Embed=3]="Embed",e[e.App=4]="App",e[e.View=5]="View",e[e.Edit=6]="Edit",e[e.Form=7]="Form",e[e.Direct=8]="Direct",e[e.Organization=9]="Organization"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/sharing/odb/SharingDataSource",["require","exports","odsp-utilities/async/Promise","odsp-shared/utilities/object/SchemaMapper","odsp-utilities/encoding/UriEncoding","../../../dataSources/base/odb/DataSource","../../../models/sharing/SharingRole","../../../models/sharing/SharingLinkType","../../../utilities/features/Features","../../../utilities/uri/Uri","../../../utilities/datetime/DateTime"],function(e,t,r,i,n,o,s,a,u,l,c){var d=function(e){function t(t){e.call(this,t),this._createAnonymousLinkMethodName="CreateAnonymousLink",this._createAnonymousLinkWithExpirationMethodName="CreateAnonymousLinkWithExpiration",this._disableAnonymousLinkMethodName="DeleteAnonymousLinkForObject",this._createOrganizationLinkMethodName="CreateOrganizationSharingLink",this._disableOrganizationLinkMethodName="DestroyOrganizationSharingLink",this._shareUrl=this._context.webServerRelativeUrl+"/_api/SP.Web.ShareObject",this._unshareUrl=this._context.webServerRelativeUrl+"/_api/SP.Web.UnshareObject",this._managePermissionsUrl=this._context.webServerRelativeUrl+"/_api/SP.Sharing.DocumentSharingManager.UpdateDocumentSharingInfo",this._getSharingSettingsUrl=this._context.webServerRelativeUrl+"/_api/SP.Web.GetObjectSharingSettings?$expand=ObjectSharingInformation,SharePointSettings,SharePointSettings/PickerProperties,ObjectSharingInformation/SharedWithUsersCollection",this._getPermissionsUrl=this._context.webServerRelativeUrl+"/_api/SP.ObjectSharingInformation.GetObjectSharingInformationByUrl?$expand=SharedWithUsersCollection",this._createAnonymousLinkUrl=this._context.webServerRelativeUrl+"/_api/SP.Web."+this._createAnonymousLinkMethodName,this._createAnonymousLinkWithExpirationUrl=this._context.webServerRelativeUrl+"/_api/SP.Web."+this._createAnonymousLinkWithExpirationMethodName,this._disableAnonymousLinkUrl=this._context.webServerRelativeUrl+"/_api/SP.Web."+this._disableAnonymousLinkMethodName,this._createOrganizationLinkUrl=this._context.webServerRelativeUrl+"/_api/SP.Web."+this._createOrganizationLinkMethodName,this._disableOrganizationLinkUrl=this._context.webServerRelativeUrl+"/_api/SP.Web."+this._disableOrganizationLinkMethodName,this._placeholderImage="/_layouts/15/userphoto.aspx?size=S"}return __extends(t,e),t._isCompanyWideSharingLinksFeatureEnabled=function(){return u.default.isFeatureEnabled(u.default.CompanyWideSharingLinks)&&u.default.isFeatureEnabled(u.default.ODBNextCompanyWideSharingLinks)},t._isAnonymousLinkExpirationFeatureEnabled=function(){return u.default.isFeatureEnabled(u.default.AnonymousLinkExpiration)},t._convertPrincipalType=function(e){if(!e)return 0;var t=0,r=e.split(",");for(var i in r)"User"===r[i]&&(t|=1),"DL"===r[i]&&(t|=2),"SecGroup"===r[i]&&(t|=4),"SPGroup"===r[i]&&(t|=8);return t},t._parsePeople=function(e,r){for(var n=[{from:"DisplayName",to:"name"},{from:"Email",to:"email"},{from:"User",to:"userId"}],o=new i(n),s=[],a=0;a<e.length;a++){var u={};u.item=r,u.role=t._parseSharingRole(e[a].CurrentRole),u.statusCode=Number(!e[a].Status),u.errorMessage=e[a].Message?e[a].Message:null,s[a]=o.forwardTransform(e[a]),s[a].sharingInfo=u}return s},t._parseSharingRole=function(e){switch(e){case 0:return s.None;case 1:return s.View;case 2:return s.Edit;default:return s.View}},t._getExpirationFromLink=function(e){if(Boolean(e)&&e.indexOf("expiration=")>-1){var t=new l(e),r=t.getQueryParameter("expiration")+" UTC",i=Date.parse(r.replace(/\+/g," "));if(Boolean(i))return new Date(i).toString()}return null},t._initSharingLinkFromServerData=function(e){if(!Boolean(e))return null;var r={};switch(r.url=e.Url,r.isActive=e.IsActive,e.LinkKind){case 0:r.role=s.None;break;case 1:r.url=encodeURI(e.Url),r.type=a.Direct,r.role=s.None,r.displayPriority=0,r.tag="Direct",r.supportsExpiration=!1;break;case 2:r.type=a.Organization,r.role=s.View,r.displayPriority=1,r.tag="OrganizationView",r.supportsExpiration=!1;break;case 3:r.type=a.Organization,r.role=s.Edit,r.displayPriority=2,r.tag="OrganizationEdit",r.supportsExpiration=!1;break;case 4:r.type=a.View,r.role=s.View,r.displayPriority=3,r.tag="AnonymousView",r.supportsExpiration=t._isAnonymousLinkExpirationFeatureEnabled();break;case 5:r.type=a.Edit,r.role=s.Edit,r.displayPriority=4,r.tag="AnonymousEdit",r.supportsExpiration=t._isAnonymousLinkExpirationFeatureEnabled();break;default:r.role=s.None}return r.expiration=r.supportsExpiration?t._getExpirationFromLink(r.url):null,r},t._pickSharingLinkByPriority=function(e){if(null==e||e.length<1)return null;var t=e.reduce(function(e,t){return"undefined"==typeof t.displayPriority||"undefined"==typeof t.isActive||t.displayPriority>e.displayPriority&&t.isActive?t:e});return t},t.prototype.getSharingData=function(e){var i,o,u,l,c=this,d=function(e){return c.getData(function(){return c._getSharingSettingsUrl},function(i){var o=JSON.parse(i),d=o.d,p={};p.itemId=d.ItemId,p.itemName=d.ItemName,p.canManagePermissions=d.ObjectSharingInformation.CanManagePermissions,p.canManageLinks=d.CanCurrentUserManageReadWriteLink||d.CanCurrentUserManageOrganizationReadWriteLink,p.canSendEmail=d.CanSendEmail,p.canSendLink=d.CanSendLink,p.pickerProperties={},p.itemUrl=c._getRelativeFileUrl(e),p.showAdvanced=p.canManagePermissions,p.supportsSharingPropagation=d.SupportsAclPropagation,p.anonymousLinksEnabled=d.CanCurrentUserRetrieveReadonlyLink,p.organizationLinksEnabled=d.CanCurrentUserRetrieveOrganizationReadonlyLink,p.networkLinksEnabled=!1,p.showAdditionalExternalWarning=d.ShowExternalSharingWarning,p.sharedWithMany=d.ObjectSharingInformation.IsSharedWithSecurityGroup||d.ObjectSharingInformation.IsSharedWithMany,d.ObjectSharingInformation&&d.ObjectSharingInformation.SharedWithUsersCollection&&d.ObjectSharingInformation.SharedWithUsersCollection.results&&(p.sharedWith=c._processPeople(d.ObjectSharingInformation.SharedWithUsersCollection.results,e,d.CanManagePermissions));var h=[d.WebUrl];h.push("/_layouts/15/user.aspx"),h.push("?List="+n.encodeURIComponent(d.ListId)),d.ListId&&h.push("&obj=",n.encodeURIComponent(d.ListId),",",n.encodeURIComponent(d.ItemId),",LISTITEM"),p.advancedUrl=h.join(""),d.SharePointSettings&&d.SharePointSettings.PickerProperties&&(p.pickerProperties=d.SharePointSettings.PickerProperties,p.pickerProperties.PrincipalAccountType=t._convertPrincipalType(d.SharePointSettings.PickerProperties.PrincipalAccountType));var m=[];if(d.SimplifiedRoles&&d.SimplifiedRoles.results)for(var f=0;f<d.SimplifiedRoles.results.length;f++){var g={};g.name=d.SimplifiedRoles.results[f].Key,g.value=d.SimplifiedRoles.results[f].Value,m.push(g)}p.sharingRoles=m,l=null;var y=[];if(d.ObjectSharingInformation)if(t._isCompanyWideSharingLinksFeatureEnabled()&&d.ObjectSharingInformation.SharingLinks)u=function(){return d.ObjectSharingInformation.SharingLinks.results.forEach(function(e){y.push(t._initSharingLinkFromServerData(e))}),y=y.filter(function(e){return p.canManageLinks||Boolean(e.url)&&e.isActive?e.role===s.View&&e.type===a.View&&!d.CanCurrentUserRetrieveReadonlyLink||e.role===s.Edit&&e.type===a.Edit&&!d.CanCurrentUserRetrieveReadWriteLink?!1:!0:!1}),r.default.wrap(y)}();else{if(d.ObjectSharingInformation.AnonymousViewLink){var v={};v.type=a.View,v.role=s.View,v.url=d.ObjectSharingInformation.AnonymousViewLink,y.push(v)}if(d.ObjectSharingInformation.AnonymousEditLink){var _={};_.type=a.Edit,_.role=s.Edit,_.url=d.ObjectSharingInformation.AnonymousEditLink,y.push(_)}}return null==l&&(l=y),p},"GetSharingSettings",function(){var t={objectUrl:c._getRelativeFileUrl(e),useSimplifiedRoles:!0};return JSON.stringify(t)},"POST",null,null,null,!0)},p=function(e){return c.getData(function(){return c._getPermissionsUrl},function(t){var r=JSON.parse(t),i=r.d,n=[],o=[];i.SharedWithUsersCollection&&i.SharedWithUsersCollection.results&&(o=i.SharedWithUsersCollection.results),n=c._processPeople(o,e,i.CanManagePermissions);var s={item:e,people:n,hasPendingAccessRequests:i.HasPendingAccessRequests,pendingAccessRequestsLink:i.PendingAccessRequestsLink,canUnshare:i.CanBeUnshared};return[s]},"GetItemPermissions",function(){var t={objectUrl:c._getRelativeFileUrl(e),excludeCurrentUser:!1,excludeSiteAdmin:!1,excludeSecurityGroups:!1,retrieveAnonymousLinks:!0,retrieveUserInfoDetails:!0,checkForAccessRequests:!0,retrievePermissionLevels:!0};return JSON.stringify(t)},"POST",null,null,null,!0)};return{getSettings:function(){return i||(i=d(e)),i},getPermissions:function(t){return(!o||t)&&(o=p(e)),o},getBestSharingLink:function(){return this.getLinks().then(function(e){return e&&e.length>0?r.default.wrap(t._pickSharingLinkByPriority(e)):null},function(){return null})},getLinks:function(){return u?u:this.getSettings().then(function(){return u=r.default.wrap(l)})},setLink:function(e){if(null!=e&&null!=l){var t=l.filter(function(t){return null!=t&&t.role===e.role&&t.type===e.type});if(0===t.length)l.push(e);else{var i=t[0];i.url=e.url,i.expiration=e.expiration,i.isActive=e.isActive,u=r.default.wrap(l)}}}}},t.prototype.share=function(e,r){var i=this;return this.getData(function(){return i._shareUrl},function(e){var i=JSON.parse(e),n=i.d,o=[];n.UniquelyPermissionedUsers&&n.UniquelyPermissionedUsers.results&&(o=n.UniquelyPermissionedUsers.results);var s={};return s.statusCode=n.StatusCode,s.errorMessage=n.ErrorMessage,s.people=t._parsePeople(o,r.item),s},"Share",function(){for(var t=[],n=0;n<e.length;n++){var o={Key:e[n].userId};t.push(o)}var s={url:i._getRelativeFileUrl(r.item),peoplePickerInput:JSON.stringify(t),roleValue:r.roleValue,sendEmail:r.sendEmail,emailBody:r.message,includeAnonymousLinkInEmail:!r.requireSignIn,propagateAcl:r.propagateSharing};return JSON.stringify(s)})},t.prototype.unshare=function(e){var t=this;return this.getData(function(){return t._unshareUrl},function(e){var t=JSON.parse(e),r=t.d,i={};return i.statusCode=r.StatusCode,i.errorMessage=r.ErrorMessage,i},"StopSharing",function(){var r={url:t._getRelativeFileUrl(e)};return JSON.stringify(r)})},t.prototype.updatePermissions=function(e,r,i){var n=this;return this.getData(function(){return n._managePermissionsUrl},function(e){var i=JSON.parse(e),n=i.d,o=[];n.UpdateDocumentSharingInfo&&n.UpdateDocumentSharingInfo.results&&(o=n.UpdateDocumentSharingInfo.results);var s={};return s.statusCode=0,s.errorMessage=null,s.people=t._parsePeople(o,r),s},"ManagePermissions",function(){for(var t=[],o=0;o<e.length;o++){var a={UserId:e[o].userId,Role:i===s.Edit?2:i===s.None?0:1};t.push(a)}var u={resourceAddress:n._getRelativeFileUrl(r),userRoleAssignments:t,validateExistingPermissions:!1,additiveMode:!1,sendServerManagedNotification:!1,customMessage:null,includeAnonymousLinksInNotification:!1,propagateAcl:!1};return JSON.stringify(u)})},t.prototype.manageSharingLinks=function(e){var r=this,i=this._createAnonymousLinkUrl,n="CreateAnonymousSharingLink",o=this._createAnonymousLinkMethodName;return e.expiration&&t._isCompanyWideSharingLinksFeatureEnabled()&&t._isAnonymousLinkExpirationFeatureEnabled()&&(i=this._createAnonymousLinkWithExpirationUrl,n="CreateAnonymousSharingLinkWithExpiration",o=this._createAnonymousLinkWithExpirationMethodName),e.create||(i=this._disableAnonymousLinkUrl,n="DisableAnonymousSharingLink",o=this._disableAnonymousLinkMethodName),t._isCompanyWideSharingLinksFeatureEnabled()&&e.type===a.Organization&&(i=e.create?this._createOrganizationLinkUrl:this._disableOrganizationLinkUrl,n=e.create?"CreateOrganizationSharingLink":"DisableOrganizationSharingLink",o=e.create?this._createOrganizationLinkMethodName:this._disableOrganizationLinkMethodName),this.getData(function(){return i},function(i){var n=JSON.parse(i),s=n.d,a=[],u={};if(u.url=s[o]||"",u.type=e.type,u.role=e.role,u.expiration=t._getExpirationFromLink(u.url),u.isActive=Boolean(u.url),t._isCompanyWideSharingLinksFeatureEnabled()){var l=r.getSharingData(e.item);l.setLink(u)}return s[o]&&a.push(u),a},n,function(){var t={url:r._getRelativeFileUrl(e.item),isEditLink:e.role===s.Edit?!0:!1};return e.expiration&&(t.expirationString=c.ConvertDateToISOString(e.expiration)),JSON.stringify(t)})},t.prototype.getDataSourceName=function(){return"SharingDataSource"},t.prototype._getRelativeFileUrl=function(e){var t=e.openUrl;return 0===t.indexOf("/")&&(t=this._context.webUrl+t.substring(this._context.webServerRelativeUrl.length)),t},t.prototype._processPeople=function(e,t,r){for(var n=[],o=[{from:"LoginName",to:"userId"},{from:"Name",to:"name"},{from:"Email",to:"email"},{from:"JobTitle",to:"job"},{from:"Department",to:"department"},{from:"Picture",to:"image"},{from:"SipAddress",to:"sip"}],a=new i(o),u=0;u<e.length;u++){var l=a.forwardTransform(e[u]);0===l.image.length&&(l.image=this._placeholderImage);var c={};e[u].IsSiteAdmin?c.role=s.Owner:void 0!==e[u].CustomRoleNames&&""!==e[u].CustomRoleNames?(c.role=s.Custom,c.customRole=e[u].CustomRoleNames):e[u].HasEditPermission?c.role=s.Edit:e[u].HasViewPermission&&(c.role=s.View),c.item=t,c.isChangeable=r,l.sharingInfo=c,n.push(l)}return n},t}(o);return d});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/providers/item/ShortcutProvider",["require","exports","odsp-shared/base/BaseModel","../../resources/ProviderResourceKeys","../../resources/SPOResourceKeys","../../dataSources/item/odb/ShortcutLinkDataSource"],function(e,t,r,i,n,o){var s=function(e){function t(t){e.call(this,t),this._shortcutDataSource=new o.default(this.resources.consume(n.hostSettings))}return __extends(t,e),t.prototype.createShortcut=function(e,t,r){var n=this.resources.consume(i.item);return this._shortcutDataSource.createShortcut(e,t,r).then(function(t){return n.invalidateItem(e),t})},t.prototype.getShortcutTargetData=function(e){return this._shortcutDataSource.getShortcutTargetData(e)},t.prototype.getFileByUrl=function(e){return this._shortcutDataSource.getFileByUrl(e)},t}(r);return s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e
}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/suiteNav/odb/SuiteNavDataSource",["require","exports","./ODBSuiteNav.resx","../../../models/suiteNav/SuiteNavLinkIds","../../base/odb/DataSource","odsp-utilities/encoding/UriEncoding","odsp-shared/utilities/string/StringHelper"],function(e,t,r,i,n,o,s){var a=function(e){function t(t,r){e.call(this,t),this._showMySiteSettings=r.showMySiteSettings,this._workloadId=r.workloadId,this._helpNamespace=r.helpNamespace,this._helpId=r.helpId,this._capabilities={supportsCaching:!0,supportsRealSuiteNav:!0,showO365Text:!0}}return __extends(t,e),t.prototype.getDataSourceName=function(){return"SuiteNavDataSource"},t.prototype.getCapabilities=function(){return this._capabilities},t.prototype.getUserIdentifier=function(){return this._context.userKey},t.prototype.getCacheToken=function(){var e=this._context.siteClientTag;return"string"==typeof e?e.substring(0,e.indexOf("$$")):""},t.prototype.getSettingsLinks=function(){if(this._showMySiteSettings){var e=r.strings,t=this._context.webUrl;return[{Id:i.ADD_APP,Text:e.AddAnApp,Url:t+"/_layouts/15/addanapp.aspx"},{Id:i.SITE_CONTENTS,Text:e.SiteContents,Url:t+"/_layouts/15/viewlsts.aspx"},null,{Id:i.SITE_SETTINGS,Text:e.SiteSettings,Url:t+"/_layouts/15/settings.aspx"}]}return[]},t.prototype.loadData=function(e){if(!e&&this._dataPromise)return this._dataPromise;var t=this,r="/"===this._context.webServerRelativeUrl?"":this._context.webServerRelativeUrl;return this._dataPromise=t.getData(function(){return s.format("{0}/_layouts/15/online/handlers/SpoSuiteLinks.ashx?Locale={1}&v=2&msajax=1&cv=2",o.escapeUrlForCallback(r),o.escapeUrlForCallback(t._context.cultureName))},function(e){var r=JSON.parse(e);return t._model={data:t._fixData(r.NavBarData),requireConfig:{paths:{shellcore:r.JsUrl.replace(/\.js$/,"")},shim:{shellcore:{exports:"O365"}}},cssUrl:r.CssUrl,userIdentifier:t.getUserIdentifier(),cacheToken:t.getCacheToken()},t._model},"LoadData",null,"POST",null,null,1),this._dataPromise.done(null,function(){this._context.env&&(t._dataPromise=null)}),this._dataPromise},t.prototype._fixData=function(e){return e.CurrentMainLinkElementID=this._workloadId,e.CurrentWorkloadSettingsSubLinks=this.getSettingsLinks(),e.FeedbackLink=null,e.HelpLink.Url=this._helpNamespace&&this._helpId?s.format("http://o15.officeredir.microsoft.com/r/rlidOfficeWebHelp?p1={0}&clid={1}&ver=16&HelpId={2}",this._helpNamespace,String(this._context.currentLanguage),this._helpId):"http://support.microsoft.com",e},t}(n);t.SuiteNavDataSource=a}),define("odsp-next/providers/suiteNav/FlexPaneWrapper",["require","exports","odsp-utilities/logging/ErrorHelper"],function(e,t,r){var i=function(){function e(){}return e.prototype.OnFlexPaneVisibilityChanged=function(e){try{return O365Shell.FlexPane.OnFlexPaneVisibilityChanged(e)}catch(t){r.log(t,"FlexPaneWrapper","OnFlexPaneVisibilityChanged")}},e.prototype.OpenFlexPaneForProvider=function(e){try{O365Shell.FlexPane.OpenFlexPaneForProvider(e)}catch(t){r.log(t,"FlexPaneWrapper","OpenFlexPaneForProvider")}},e}();return i}),define("odsp-next/providers/suiteNav/NavigationWrapper",["require","exports"],function(){var e=function(){function e(){}return e.prototype.OnLinkClick=function(e){return O365Shell.Navigation.OnLinkClick(e)},e.prototype.OnHamburgerButtonClick=function(e){return O365Shell.Navigation.OnHamburgerButtonClick(e)},e}();return e}),define("odsp-next/providers/suiteNav/O365ShellWrapper",["require","exports","./FlexPaneWrapper","./NavigationWrapper","odsp-utilities/async/Signal"],function(e,t,r,i,n){var o=function(){function e(){this.FlexPane=new r,this.Navigation=new i,this._PostRenderSignal=new n}return e.prototype.SetData=function(e){O365Shell.SetData(e)},e.prototype.Render=function(e,t){var r=this;O365Shell.Render(e,function(){return r._SignalAction(t)})},e.prototype.RenderAsync=function(e,t,r){var i=this;O365Shell.RenderAsync(e,function(){return i._SignalAction(t)},function(){return i._SignalAction(r)})},e.prototype.OnDataChanged=function(e){return O365Shell.OnDataChanged(e)},e.prototype.OnSuiteAPILoaded=function(e){return O365Shell.OnSuiteAPILoaded(e)},e.prototype.LoadShellPlus=function(){O365Shell.LoadShellPlus()},e.prototype.Exists=function(){return"undefined"!=typeof O365Shell},e.prototype.HasMember=function(e){return this.Exists()&&Boolean(O365Shell[e])},e.prototype.OnHasMember=function(e,t){var r=this;this.HasMember(e)?t():this._PostRenderSignal.getPromise().done(function(){return r.OnHasMember(e,t)})},e.prototype._SignalAction=function(e){e();var t=this._PostRenderSignal;this._PostRenderSignal=new n,t.complete()},e}();return o}),define("odsp-next/utilities/navigation/NavigationType",["require","exports"],function(){var e;return function(e){e[e.navigateNext=0]="navigateNext",e[e.reload=1]="reload",e[e.backForward=2]="backForward",e[e.undefined=255]="undefined"}(e||(e={})),e}),define("odsp-next/utilities/require/RequireConfigInjector",["require","exports"],function(){var e=function(){function e(){}return e.addConfig=function(e){requirejs.config(e)},e.addPaths=function(e){requirejs.config({paths:e})},e.addShims=function(e){requirejs.config({shim:e})},e}();return e}),define("odsp-next/providers/suiteNav/SuiteNavProvider",["require","exports","../../models/suiteNav/SuiteNavLinkIds","./O365ShellWrapper","odsp-utilities/models/store/BaseDataStore","odsp-utilities/models/store/DataStoreCachingType","../../resources/DataSourceResourceKeys","odsp-utilities/async/Promise","odsp-utilities/domUtils/DomUtils","odsp-utilities/logging/events/Engagement.event","odsp-utilities/logging/events/Qos.event","../../utilities/navigation/NavigationHelper","../../utilities/navigation/NavigationType","../../utilities/require/RequireConfigInjector"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h){var m=function(){function t(){this._dataSource=this.resources.consume(s.suiteNav),this._capabilities=this._dataSource.getCapabilities(),this._cssLoaded=!1,this._hasReloadedForPageRefresh=!1}return t.clearCache=function(){t._cache.remove(t.DATA_KEY),t._cache.remove(t.DATE_KEY),t._cache.remove(t.VERSION_KEY)},t._isProvisioning=function(e){if(!(e&&e.data&&e.data.WorkloadLinks&&e.data.WorkloadLinks.length))return!1;for(var t=e.data.WorkloadLinks,r=0;r<t.length;r++){var i=t[r];if(i&&!i.Url)return!0}return!1},t._updateCache=function(e){t._cache.setValue(t.DATA_KEY,e),t._cache.setValue(t.DATE_KEY,new Date),t._cache.setValue(t.VERSION_KEY,t.CACHE_VERSION),t._cache.setValue(t.SESSION_KEY,!0,o.session)},t.prototype.getCapabilities=function(){return this._capabilities},t.prototype.loadData=function(e){return this._loadModel(e).then(function(e){return a.default.wrap(e.data)})},t.prototype.getO365Shell=function(r){if(!this._capabilities.supportsRealSuiteNav)throw new Error("getO365Shell is only supported if supportsRealSuiteNav capability is true.");if(this._shellPromise)return this._shellPromise;var n=this,o=null,s=c.ResultTypeEnum.ExpectedFailure;return this._shellPromise=c.Qos.instrumentPromise({name:"SuiteNavProvider.GetO365Shell"},function(){return n._loadModel().then(function(s){return h.addConfig(s.requireConfig),r||n._cssLoaded||(u.loadStylesheet(s.cssUrl),n._cssLoaded=!0),new a.default(function(r,s){e(["shellcore"],function(){var e=new i;e.Exists()?r(e):(o="O365ShellNotDefined",s("O365Shell not defined after require() succeeded"))},function(e){n._capabilities.supportsCaching&&t.clearCache(),requirejs.undef("shellcore"),delete n._modelPromise,delete n._shellPromise,o="RequireError",s(e)})})})},null,function(e){return a.default.isCanceled(e)&&(s=c.ResultTypeEnum.ExpectedFailure,o="Canceled"),{resultType:s,resultCode:o||"Other",error:e}}),this._shellPromise},t.prototype.getMailUrl=function(){var e=this;return new a.default(function(t,i){e._loadModel().then(function(e){if(e&&e.data&&e.data.WorkloadLinks)for(var i=e.data.WorkloadLinks,n=0;n<i.length;++n)i[n]&&i[n].Id===r.MAIL&&t(i[n].Url);t(null)},i)})},t.prototype._loadModel=function(e){if(!e&&this._modelPromise)return this._modelPromise;this._hasReloadedForPageRefresh||d.getNavigationType()!==p.reload||(this._hasReloadedForPageRefresh=!0,e=!0);var r=this,i=r._capabilities.supportsCaching,n=null,o=c.ResultTypeEnum.Failure;return this._modelPromise=c.Qos.instrumentPromise({name:"SuiteNavProvider.LoadData"},function(){return new a.default(function(s,u){var d=null;!e&&i&&r._isCacheValid()&&(d=t._cache.getValue(t.DATA_KEY)),d&&d.data?(l.Engagement.logData({name:"SuiteNavProvider.DataFromCache"}),r._dataSource.getSettingsLinks&&(d.data.CurrentWorkloadSettingsSubLinks=r._dataSource.getSettingsLinks()),i&&r._isCacheOutdated()&&(l.Engagement.logData({name:"SuiteNavProvider.RefreshCache"}),r._dataSource.loadData().done(t._updateCache)),s(d)):(e&&l.Engagement.logData({name:"SuiteNavProvider.ForceUpdateData"}),l.Engagement.logData({name:"SuiteNavProvider.DataFromServer"}),r._dataSource.loadData().done(function(e){e?e.data?(i&&!t._isProvisioning(e)&&t._updateCache(e),s(e)):(n="NoModelData",u("Model with no data returned")):(n="NoModel",u("No model returned"))},function(e){a.default.isCanceled(u)?(n="Canceled",o=c.ResultTypeEnum.ExpectedFailure):n="ServerLoadFailure",u(e)}))})},null,function(e){return a.default.isCanceled(e)&&(o=c.ResultTypeEnum.ExpectedFailure,n="Canceled"),{resultType:o,resultCode:n||"Other",error:e}}),this._modelPromise},t.prototype._isCacheValid=function(){var e=t._cache.getValue(t.DATA_KEY),r=t._cache.getValue(t.VERSION_KEY),i=this._capabilities.supportsRealSuiteNav;return e&&e.data&&(!i||e.requireConfig&&e.cssUrl)&&r===t.CACHE_VERSION&&e.userIdentifier===this._dataSource.getUserIdentifier()&&e.cacheToken===this._dataSource.getCacheToken()},t.prototype._isCacheOutdated=function(){var e=Date.parse(t._cache.getValue(t.DATE_KEY)),r=new Date,i=t._cache.getValue(t.SESSION_KEY,o.session);return isNaN(e)||r.getTime()-e>864e5||n.hasStorageType(o.session)&&!i},t.CACHE_PREFIX="odSuiteNav",t.DATA_KEY="Data",t.DATE_KEY="CacheDate",t.VERSION_KEY="CacheVersion",t.SESSION_KEY="CachedThisSession",t.CACHE_VERSION=3,t._cache=new n(t.CACHE_PREFIX,o.local),t}();return m});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/dataSources/versionControl/odb/VersionControlDataSource",["require","exports","odsp-utilities/async/Promise","../../../dataSources/base/odb/DataSource","odsp-utilities/encoding/UriEncoding"],function(e,t,r,i,n){var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.checkOutItem=function(e){var t=this._getCheckOutItemUrl(e.item.id);return this.getData(function(){return t},function(e){return r.default.wrap(e)},"CheckOutItem")},t.prototype.undoCheckOutItem=function(e){var t=this._getUndoCheckOutItemUrl(e.item.id);return this.getData(function(){return t},function(e){return r.default.wrap(e)},"UndoCheckOutItem")},t.prototype.checkInItem=function(e){var t=this._getCheckInItemUrl(e);return this.getData(function(){return t},function(e){return r.default.wrap(e)},"CheckInItem")},t.prototype.getVersionHistoryUrl=function(e){var t=[],r=n.escapeUrlForCallback(this._context.webUrl),i=n.escapeUrlForCallback(this._context.layoutsUrl);return t.push(r),t.push("/"),t.push(i),t.push("/Versions.aspx?FileName="),t.push(n.encodeURIComponent(e)),t.push("&IsDlg=1"),t.join("")},t.prototype.getDataSourceName=function(){return"VersionControlDataSource"},t.prototype._getCheckOutItemUrl=function(e){var t=[];return t.push(n.escapeUrlForCallback(this._context.webUrl)),t.push("/_api/web/GetFileByServerRelativeUrl('"),t.push(e),t.push("')/CheckOut()"),t.join("")},t.prototype._getUndoCheckOutItemUrl=function(e){var t=[];return t.push(n.escapeUrlForCallback(this._context.webUrl)),t.push("/_api/web/GetFileByServerRelativeUrl('"),t.push(e),t.push("')/UndoCheckOut()"),t.join("")},t.prototype._getCheckInItemUrl=function(e){var t=[];return t.push(n.escapeUrlForCallback(this._context.webUrl)),t.push("/_api/web/GetFileByServerRelativeUrl('"),t.push(e.item.id),t.push("')/CheckIn(comment='"),t.push(e.comments),t.push("', checkintype=0)"),t.join("")},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/utilities/beforeUnload/BeforeUnload",["require","exports","odsp-shared/base/BaseModel","odsp-utilities/logging/ErrorHelper"],function(e,t,r,i){var n=function(e){function t(t){var r=this;e.call(this,t),this._handlers=[],this._originalBeforeUnload=window.onbeforeunload,window.onbeforeunload=window.__onbeforeunload=function(e){return r._handleBeforeUnload(e)}}return __extends(t,e),t.prototype.registerHashNavDialogCallback=function(e){this._hashNavDialogCallback=e},t.prototype.allowHashNav=function(e,t){var r=this,n=void 0;if(!this._isDialogOpen&&!this._allowNavs){for(var o=0;o<this._handlers.length;o++)try{if(n=this._handlers[o](!1))break}catch(s){i.log(s)}n&&(this._isDialogOpen=!0,this._hashNavDialogCallback(n).then(function(){r._isDialogOpen=!1,r._allowNavs=!0,r._blockNavsAgainId||(r._blockNavsAgainId=r.async.setImmediate(function(){r._allowNavs=!1,r._blockNavsAgainId=null})),e&&e()},function(){r._isDialogOpen=!1,t&&t()}))}return!n&&!this._isDialogOpen},t.prototype.registerHandler=function(e){this._handlers.push(e)},t.prototype.unRegisterHandler=function(e){for(var t=0;t<this._handlers.length;t++)if(this._handlers[t]===e){this._handlers.splice(t,1);break}},t.prototype.dispose=function(){window.onbeforeunload=this._originalBeforeUnload?this._originalBeforeUnload:null},t.prototype._handleBeforeUnload=function(e){var t=void 0;if(!this._allowNavs){for(var r=0;r<this._handlers.length;r++)try{if(t=this._handlers[r](!0))break}catch(n){i.log(n)}if(!t&&this._originalBeforeUnload)try{t=this._originalBeforeUnload(e)}catch(n){i.log(n)}}return t?t:void 0},t}(r);return n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/events/Nav.event",["require","exports","odsp-utilities/logging/SingleEventBase"],function(e,t,r){var i=function(e){function t(t){e.call(this,"Nav,","Nav",t)}return __extends(t,e),t.enabled=function(){return!0},t.logData=function(e,i){return r.SingleEventBase._logData(t,e,i)},t.prototype.setSingleData=function(e){this.data.viewParams=e.viewParams,"undefined"!=typeof e.url&&(this.data.url=this.cleanString(e.url))},t.fullName="Nav,",t.shortName="Nav",t.metadata={viewParams:{type:"Object",isMetric:!1},url:{type:"String",isMetric:!1}},t}(r.SingleEventBase);t.Nav=i,i.prototype.metadata=i.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/utilities/navigation/Navigation",["require","exports","knockout","odsp-shared/base/BaseModel","../beforeUnload/BeforeUnload","odsp-utilities/logging/events/Nav.event","./NavigationHelper","odsp-utilities/object/ObjectUtil"],function(e,t,r,i,n,o,s,a){var u=window.history,l=window.applicationCache,c=u&&!!u.pushState&&(!l||l.status===l.UNCACHED),d=function(e){function t(t){e.call(this,t),this._viewParamsString="",this._dontBlockNextNav=!1;var r=t&&t.disableHashConversion||!1;this._performHashConversion=!r,this.viewParams={},this.beforeUnload=new(this.managed(n)),this.events.declare("change"),this.events.on(window,"hashchange",this._updateUrlState),this.events.on(window,"popstate",this._updateUrlState),this._updateUrlState(null)}return __extends(t,e),t.prototype.navigateTo=function(e){var t=this;if(this.beforeUnload.allowHashNav(function(){return t.navigateTo(e)},null)){var r="string"==typeof e?{url:e}:e,i=r.url;if("#"===i[0]){var n=i.substr(1);r.ignoreHistory?this._replaceState(n):this._pushState(n)}else{var o;if(r&&r.frameId&&"_self"!==r.frameId)try{o=window.open(i,r.frameId)}catch(s){}if(!o)try{window.location.href=i}catch(s){}}}},t.prototype.updateViewParams=function(e,t){t||(t={});var i,n="string"==typeof e?s.deserializeQuery(e):e;i=t.clearOtherParams?{}:a.deepCopy(this.viewParams),r.utils.extend(i,n),t.ignoreHistory?this._replaceState(i):this._pushState(i)},t.prototype.reload=function(){window.location.reload()},t.prototype._updateUrlState=function(e){var t=this,r="",i=!1,n=window.document.location,a=!1;return this._dontBlockNextNav||this.beforeUnload.allowHashNav(function(){return t._updateUrlState(e)},function(){return t._resetBeforeNavBlock()})?(this._dontBlockNextNav=!1,n.href.indexOf("#")>-1?(r=n.hash.substr(1),a=!0):n.search.length&&(r=n.search.substr(1)),r!==this._viewParamsString&&(this._viewParamsString=r||"",this.viewParams=s.deserializeQuery(this._viewParamsString),i=!0),a&&this._performHashConversion&&c&&this._replaceState(r),i&&(o.Nav.logData({url:n.href,viewParams:this.viewParams}),this.events.raise("change")),this._prevHash=n.hash):(i=!1,e&&e.preventDefault()),i},t.prototype._resetBeforeNavBlock=function(){this._dontBlockNextNav=!0,c?history.forward(1):document.location.hash=this._prevHash},t.prototype._pushState=function(e){var t="string"==typeof e?e:s.serializeQuery(e);c?history.pushState({},null,"?"+t):document.location.hash=t,this._updateUrlState(null)},t.prototype._replaceState=function(e){var t="string"==typeof e?e:s.serializeQuery(e);c?history.replaceState({},null,document.location.pathname+(t.length>0?"?"+t:"")):document.location.hash=t,this._updateUrlState(null)},t}(i);return d}),define("odsp-next/controls/infoPane/sections/BaseInfoPaneSectionsMap",["require","exports"],function(){var e=function(){function e(){}return e}();return e}),define("odsp-next/utilities/logging/rumone/ControlPerformanceData",["require","exports"],function(){var e=function(){function e(e,t,r,i,n){this.controlId=e,this.startTime=t,this.endTime=r,this.renderTimeCalculator=i,this.renderTimeRequiredDataChecker=n}return e}();return e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-shared/utilities/logging/events/ListViewStartRender.event",["require","exports","odsp-utilities/logging/SingleEventBase","odsp-utilities/logging/Manager"],function(e,t,r,i){var n=function(e){function t(t){e.call(this,"ListViewStartRender,","ListViewStartRender",t)}return __extends(t,e),t.enabled=function(){return i.default.evaluateSamplingRampValue("ListViewRenderLogging")},t.logData=function(e){return r.SingleEventBase._logData(t,null,e)},t.prototype.isEnabled=function(){return i.default.evaluateSamplingRampValue("ListViewRenderLogging")},t.prototype.setSingleData=function(){},t.fullName="ListViewStartRender,",t.shortName="ListViewStartRender",t.metadata={},t}(r.SingleEventBase);t.ListViewStartRender=n,n.prototype.metadata=n.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-shared/utilities/logging/events/ListViewRendered.event",["require","exports","odsp-utilities/logging/SingleEventBase","odsp-utilities/logging/Manager"],function(e,t,r,i){var n=function(e){function t(t){e.call(this,"ListViewRendered,","ListViewRendered",t)}return __extends(t,e),t.enabled=function(){return i.default.evaluateSamplingRampValue("ListViewRenderLogging")},t.logData=function(e){return r.SingleEventBase._logData(t,null,e)},t.prototype.isEnabled=function(){return i.default.evaluateSamplingRampValue("ListViewRenderLogging")},t.prototype.setSingleData=function(){},t.fullName="ListViewRendered,",t.shortName="ListViewRendered",t.metadata={},t}(r.SingleEventBase);t.ListViewRendered=n,n.prototype.metadata=n.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/utilities/logging/odb/RUMOneHelper",["require","exports","odsp-utilities/logging/Manager","../rumone/PageTransitionType","../rumone/ControlPerformanceData","odsp-shared/utilities/logging/events/ListViewStartRender.event","odsp-shared/utilities/logging/events/ListViewRendered.event","../../../resources/DataSourceResourceKeys","../../../dataSources/url/PageType","../../../dataSources/url/QueryType","../rumone/RUMOneLogger"],function(e,t,r,i,n,o,s,a,u,l,c){var d=function(){function e(){var e=this;this.logListViewStart=function(e){if(o.ListViewStartRender.isTypeOf(e)){var t=c.getRUMOneLogger();Boolean(t)&&(t.resetLogger(),t.saveTempData("ListViewUpdateStartTime",e.startTime))}},this.logListViewEnd=function(t){if(s.ListViewRendered.isTypeOf(t)){var r=e;r.logRUMOneForListView(t.startTime,c)}},r.Manager.addLogHandler(this.logListViewStart),r.Manager.addLogHandler(this.logListViewEnd)}return e.prototype.logRUMOneForListView=function(e,t){var r=t.getRUMOneLogger();if(Boolean(r)&&r.isRunning()){r.addExpectedControl("ODBNextListView");var o=this.resources.consume(a.url),s=u[o.getPageType()]+"-"+(l[o.getQueryType()]||"Default");r.writeScenarioId("ODBNext."+s),r.writePageTransitionType(i.none),r.collectW3CPerfTimings();var c=window.applicationCache;r.writeAppCache(c&&c.status!==c.UNCACHED);var d=r.readAPICallPerformanceData();if(Boolean(d)&&d.length>0){for(var p=d[0],h=0;h<d.length;h++)if(d[h].url===r.readTempData("mainAPIUrl")){p=d[h];break}Boolean(p)&&(r.writeServerUrl(p.url),r.writeServerSideLatency(p.duration,0),r.writeServerCorrelationId(p.correlationId))}var m=r.readTempData("ListViewUpdateStartTime"),f=r.readTempData("appDataFetchStart"),g=r.readTempData("appDataFetchEnd"),y=r.getPerformanceDataPropertyValue("PageTransitionType");y!==i.fullPageLoad&&(Boolean(m)&&Boolean(f)&&r.writePreRenderTime(f-m),Boolean(g)&&r.writePostRenderTime(e-g),Boolean(g)&&Boolean(f)?r.writeDataFetchTime(g-f):Boolean(g)||Boolean(f)||r.writeDataFetchTime(0),Boolean(m)&&Boolean(g)&&Boolean(f)?r.writeRenderTime(e-g+f-m):!Boolean(m)||Boolean(g)||Boolean(f)||r.writeRenderTime(e-m));var v=this,_=new n("ODBNextListView",m,e,v.computeListViewRenderTime,v.checkListViewRenderTimeRequiredDataAvailable);r.writeControlPerformanceData(_)}},e.prototype.checkListViewRenderTimeRequiredDataAvailable=function(e,t){if(Boolean(e)&&Boolean(t)){var r=e.getPerformanceDataPropertyValue("PageTransitionType");if(r===i.fullPageLoad){var n=e.getPerformanceDataPropertyValue("W3cNavigationStart");return Boolean(n)&&Boolean(t.endTime)}if(r===i.none)return Boolean(t.startTime)&&Boolean(t.endTime)}return!1},e.prototype.computeListViewRenderTime=function(e,t){if(Boolean(e)&&Boolean(t)){var r=e.getPerformanceDataPropertyValue("PageTransitionType");if(r===i.fullPageLoad){var n=e.getPerformanceDataPropertyValue("W3cNavigationStart");return t.endTime-n}if(r===i.none)return t.endTime-t.startTime}return 0},e}();return d});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/events/Beacon.event",["require","exports","odsp-utilities/logging/PairedEventBase"],function(e,t,r){var i=function(e){function t(t,r){e.call(this,"Beacon,","Beacon",t,r)}return __extends(t,e),t.enabled=function(){return!0},t.prototype.setStartData=function(e){"undefined"!=typeof e.status&&(this.data.status=this.cleanString(e.status)),"undefined"!=typeof e.success&&(this.data.success=e.success),this.data.retryCount=e.retryCount,this.data.totalRetries=e.totalRetries},t.prototype.setEndData=function(e){"undefined"!=typeof e.status&&(this.data.status=this.cleanString(e.status)),this.data.success=e.success},t.prototype.end=function(e){return this._end(e)},t.prototype.verbose=function(e){return this._verbose(e)},t.prototype.setTimeout=function(e,t){return this._setTimeout(e,t)},t.fullName="Beacon,",t.shortName="Beacon",t.metadata={status:{type:"String",isMetric:!1},success:{type:"Boolean",isMetric:!1},retryCount:{type:"Number",isMetric:!0},totalRetries:{type:"Number",isMetric:!0}},t}(r.PairedEventBase);t.Beacon=i,i.prototype.metadata=i.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/events/UnhandledError.event",["require","exports","odsp-utilities/logging/SingleEventBase"],function(e,t,r){var i=function(e){function t(t){e.call(this,"UnhandledError,","UnhandledError",t)}return __extends(t,e),t.enabled=function(){return!0},t.logData=function(e,i){return r.SingleEventBase._logData(t,e,i)},t.prototype.isCritical=function(){return!0},t.prototype.setSingleData=function(e){this.data.message=this.cleanString(e.message),this.data.stack=this.cleanString(e.stack),this.data.builtStack=this.cleanString(e.builtStack),this.data.line=e.line,this.data.col=e.col,this.data.url=this.cleanString(e.url)},t.fullName="UnhandledError,",t.shortName="UnhandledError",t.metadata={message:{type:"String",isMetric:!1},stack:{type:"String",isMetric:!1},builtStack:{type:"String",isMetric:!1},line:{type:"Number",isMetric:!0},col:{type:"Number",isMetric:!0},url:{type:"String",isMetric:!1},unMinStack:{type:"Object",isMetric:!1}},t}(r.SingleEventBase);t.UnhandledError=i,i.prototype.metadata=i.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),define("odsp-utilities/logging/odb/DebugPriorityLevel",["require","exports"],function(){var e;return function(e){e[e.Low=0]="Low",e[e.Normal=1]="Normal"}(e||(e={})),e}),define("odsp-utilities/logging/odb/LogProcessor",["require","exports","../events/Qos.event","../events/PLT.event","../events/Beacon.event","../events/UnhandledError.event","../events/RequireJSError.event","../events/CaughtError.event","../events/QosError.event","../events/Verbose.event","../events/Engagement.event","../EventBase","../events/RUMOneDataUpload.event","./DebugPriorityLevel"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h){var m;return function(t){"use strict";function m(e){if(null==e.ignoredEventsHandler||!e.ignoredEventsHandler(e.event)){var t=c.Engagement.isTypeOf(e.event)?_(e.event):r.Qos.isTypeOf(e.event)?S(e.event,e.qoSEventNameHandler||null,e.qoSEventExtraDataHandler||null):i.PLT.isTypeOf(e.event)?b(e.event):o.UnhandledError.isTypeOf(e.event)?C(e.event):s.RequireJSError.isTypeOf(e.event)?x(e.event):a.CaughtError.isTypeOf(e.event)?I(e.event):l.Verbose.isTypeOf(e.event)?E(e.event):n.Beacon.isTypeOf(e.event)?T(e.event):p.RUMOneDataUpload.isTypeOf(e.event)?v(e.event):null;t||(t=[{userEngagementData:{EngagementName:"UnknownEvent",Duration:0,LogType:0,Properties:JSON.stringify({name:e.event.eventName}),ClientTime:e.event.eventType===d.ClonedEventType.End?e.event.endTime:e.event.startTime,Source:D}}]);for(var u=0,h=t.length;h>u;u++){var m=t[u];m.debugData&&(m.debugData.Tag=g(m.debugData.Tag,e.eventNamePrefix).replace(O,""),e.logFunc(w,m.debugData)),m.userEngagementData&&(m.userEngagementData.EngagementName=g(m.userEngagementData.EngagementName,e.eventNamePrefix).replace(O,""),e.logFunc(P,m.userEngagementData)),m.rumOneData&&e.logFunc(m.rumOneData.streamName,m.rumOneData.dictionary)}}}function f(e){var t=e;return t=t.replace("{",""),t=t.replace(/\"/gi,""),t=t.replace("}","")}function g(e,t){return t?t+"."+e:e}function y(e){return e===r.ResultTypeEnum.Success?".Success":e===r.ResultTypeEnum.Failure?".Failure":e===r.ResultTypeEnum.ExpectedFailure?".ExpectedFailure":""}function v(e){if(!e.data)return[{userEngagementData:{EngagementName:"RUMOne.no_EventData",Duration:0,LogType:0,ClientTime:e.startTime,Source:D}}];var t=e.data;return[{rumOneData:{streamName:t.streamName,dictionary:t.dictionary}}]}function _(e){var t={},r="no_EngagementName",i="";if(e.data){var n=e.data;n.name&&(r=n.name),i=n.extraData?JSON.stringify(n.extraData):""}return t.userEngagementData={EngagementName:r,Properties:i,Duration:0,LogType:0,ClientTime:e.startTime,Source:D},[t]}function S(e,t,r){var i={},n="no_QosName",o=e.data?e.data:null;o&&(o.name&&(n=o.name),null!=t&&(n=t(e,n)),o.extraData=o.extraData||{},null!=r&&r(e,o),o.extraData.appver=k);var s;return s=e.eventType===d.ClonedEventType.End&&e.startTime&&e.endTime?e.endTime-e.startTime:0,i.userEngagementData={EngagementName:n,Properties:o&&o.extraData?JSON.stringify(o.extraData):"",Duration:s,LogType:0,ClientTime:e.eventType===d.ClonedEventType.End?e.endTime:e.startTime,Source:R},[i]}function T(e){var t,r={};return t=e.eventType===d.ClonedEventType.End&&e.startTime&&e.endTime?e.endTime-e.startTime:0,r.userEngagementData={EngagementName:"Beacon",Properties:e.data?JSON.stringify(e.data):"no_EventData",Duration:t,LogType:0,ClientTime:e.eventType===d.ClonedEventType.End?e.endTime:e.startTime,Source:R},[r]}function b(e){if(!e.data)return[{userEngagementData:{EngagementName:"PLT.no_EventData",Duration:0,LogType:0,ClientTime:e.startTime,Source:D}}];for(var t=[],r=e.data,i="PLT."+r.name.replace(" ",""),n=JSON.stringify(r).split(","),o=0,s=0;s<n.length;s++){var a=f(n[s]),u=a.split(":");f(u[1])!==r.name&&(o="true"===u[1]?1:"false"===u[1]||"null"===u[1]?0:parseInt(u[1],10),t.push({userEngagementData:{EngagementName:i+"."+u[0],Properties:"appCacheHit"===u[0]?JSON.stringify(e.data):"",Duration:o,LogType:0,ClientTime:e.startTime,Source:D}}))}return t}function C(e){return[{userEngagementData:{EngagementName:"UnhandledError",Duration:0,LogType:0,ClientTime:e.startTime,Source:D},debugData:{Tag:"UnhandledError",Level:h.Normal,Message:e.data?JSON.stringify(e.data):"no_EventData",Misc:"",ClientTime:e.startTime}}]}function x(e){var t,r,i={},n="RequireJSError";if(e.data){t={};for(var o in e.data)"message"!==o?t[o]=e.data[o]:r=e.data[o]}return i.userEngagementData={EngagementName:n,Duration:0,LogType:0,ClientTime:e.startTime,Source:D},i.debugData={Tag:n,Level:h.Normal,Message:r?r:"no_ErrorMessage",Misc:t?JSON.stringify(t):"no_ErrorData",ClientTime:e.startTime},[i]}function I(e){var t={},r="CaughtError";if(u.QosError.isTypeOf(e))if(e.data){var i=e.data;r=i.name,i.resultCode&&(r+="."+i.resultCode),r+=y(i.resultType)}else r="QosErrorEvent.no_EventData";else t.userEngagementData={EngagementName:r,Duration:0,LogType:0,ClientTime:e.startTime,Source:D};var n=e.data?e.data:null;return t.debugData={Tag:r,Level:h.Normal,Message:n&&n.message?n.message:"",Misc:n&&n.stack?JSON.stringify(n.stack):"",ClientTime:e.startTime},[t]}function E(e){var t={},r="Verbose";if(e.data){var i=e.data;i.name&&(r=i.name+".Verbose")}else r+=".no_EventData";return t.debugData={Tag:r,Level:h.Low,Message:i.message,Misc:"",ClientTime:e.startTime},[t]}t.STORE_KEY="SPCacheLogger",t.STORE_SIZE_KEY="Size";var D="ClientV2Engagement",w="ReliabilityLog",P="UserEngagement",R="ClientV2Reliability",O=/[^a-z0-9\.\_\-\+]+/gi,k="",U=/[^\/]*\/?$/.exec(e.toUrl(""));U&&U.length&&(k=U[0].replace("/","")),t.processAndLogEvent=m}(m||(m={})),m}),define("odsp-utilities/logging/odb/BeaconCache",["require","exports","../../models/store/BaseDataStore","../../models/store/DataStoreCachingType","../Manager","./LogProcessor"],function(e,t,r,i,n,o){var s;return function(e){"use strict";function t(t,r,i,n){if(e.instance)throw new Error("The beaconCache has already been added to the logging manager with event name prefix "+t+".");e.instance=new a(t,r,i,n)}var s=new r(o.STORE_KEY,i.session);e.eventNamePrefix="",e.instance=null,e.ignoredEventsHandler=null,e.qoSEventNameHandler=null,e.qoSEventExtraDataHandler=null;var a=function(){function t(t,r,i,o){var s=this;e.eventNamePrefix=t,e.ignoredEventsHandler=r,e.qoSEventNameHandler=i,e.qoSEventExtraDataHandler=o;
for(var a=n.Manager.addLogHandler(function(e){s.addEvent(e)}),u=0;u<a.length;u++)this.addEvent(a[u])}return t.prototype.addEvent=function(t){t.enabled&&o.processAndLogEvent({event:t,logFunc:function(e,t){var r=s.getValue(o.STORE_SIZE_KEY);r||(r=0),s.setValue(r.toString(),{name:e,props:t}),s.setValue(o.STORE_SIZE_KEY,++r)},eventNamePrefix:e.eventNamePrefix,qoSEventNameHandler:e.qoSEventNameHandler,ignoredEventsHandler:e.ignoredEventsHandler})},t}();e.addToLoggingManager=t}(s||(s={})),s}),define("odsp-utilities/logging/EventBatchCache",["require","exports","../async/Async","./events/Beacon.event","../logging/ErrorHelper"],function(e,t,r,i,n){var o=function(){function e(e,t,i,n,o){this._events=[],this._flushCount=0,this._async=new r(this),this._maxSize=e,this._newEventHandler=i,this._flushHandler=n,this._maxFlushTimes=t,this._useSlidingWindow=o}return e.prototype.addEvent=function(e){if(this._events.push(e),this._newEventHandler)try{this._newEventHandler(e)}catch(t){n.log(t)}i.Beacon.isTypeOf(e)||(this._events.length>=this._maxSize?this.flush():this._setFlushTimeout(!1))},e.prototype.flush=function(){this._setFlushTimeout(!0)},e.prototype._handleFlush=function(){this._clearFlushTimeout(),this._events.length&&(this._flushHandler(this._events),this._events=[])},e.prototype._clearFlushTimeout=function(){this._flushTimeoutId&&(this._async.clearTimeout(this._flushTimeoutId),this._flushTimeoutId=null),this._immediateflushTimeoutId&&(this._async.clearTimeout(this._immediateflushTimeoutId),this._immediateflushTimeoutId=null)},e.prototype._setFlushTimeout=function(e){var t=this;this._immediateflushTimeoutId||(this._useSlidingWindow?(this._clearFlushTimeout(),e?this._immediateflushTimeoutId=this._async.setTimeout(function(){t._handleFlush()},0):this._flushTimeoutId=this._async.setTimeout(function(){t._handleFlush()},this._getFlushTime())):e?this._immediateflushTimeoutId||(this._immediateflushTimeoutId=this._async.setTimeout(function(){t._handleFlush()},0)):this._flushTimeoutId||(this._flushTimeoutId=this._async.setTimeout(function(){t._handleFlush()},this._getFlushTime())))},e.prototype._getFlushTime=function(){if(this._flushCount<this._maxFlushTimes.length){var e=this._flushCount;return this._flushCount++,this._maxFlushTimes[e]}return this._maxFlushTimes[this._maxFlushTimes.length-1]},e}();return o}),define("odsp-utilities/xhr/XHR",["require","exports","../async/Async","../logging/ErrorHelper"],function(e,t,r,i){var n=function(){function e(t){this._async=new r(this),this._url=t.url,this._requestTimeoutInMS=t.requestTimeoutInMS||e.DEFAULT_TIMEOUT_MS,this._json=t.json,this._headers=t.headers||{},this._method=t.method,this._withCredentials=t.withCredentials||!1}return e.prototype.abort=function(t){var r=this._abortRequest();r&&!t&&this._callFailureCallback(this._request,e.ABORT_STATUS,!1)},e.prototype.start=function(t,r){var n=this;try{this._successCallback=t,this._failureCallback=r,this._request=new XMLHttpRequest,this._async.setTimeout(function(){n._completed||n._timeoutCallback()},this._requestTimeoutInMS),this._request.onreadystatechange=function(){if(!n._completed){var e=4;try{e=n._request.DONE||4}catch(t){}n._request.readyState===e&&n._requestEndCallback()}},this._method||(this._method=this._json?"POST":"GET"),this._request.open(this._method,this._url,!0),"withCredentials"in this._request&&(this._request.withCredentials=this._withCredentials);for(var o in this._headers)this._request.setRequestHeader(o,this._headers[o]);this._request.send(this._json)}catch(s){i.log(s),this._abortRequest(),this._callFailureCallback(this._request,e.EXCEPTION_STATUS,!1)}},e.prototype._abortRequest=function(){var e=!1;if(!this._completed){this._completed=!0,this._async.dispose();try{this._request&&this._request.abort()}catch(t){}e=!0}return e},e.prototype._timeoutCallback=function(){this._completed||(this._abortRequest(),this._callFailureCallback(this._request,e.TIMEOUT_STATUS,!0))},e.prototype._callSuccessCallback=function(e,t){try{this._successCallback&&this._successCallback(e,t)}catch(r){i.log(r)}},e.prototype._callFailureCallback=function(e,t,r){try{this._failureCallback&&this._failureCallback(e,t,r)}catch(n){i.log(n)}},e.prototype._requestEndCallback=function(){if(!this._completed){this._completed=!0;var t=e.EXCEPTION_STATUS;try{this._async.dispose();try{t=this._request.status}catch(r){}}catch(r){t=e.EXCEPTION_STATUS,i.log(r)}400>t&&t>0?this._callSuccessCallback(this._request,t):this._callFailureCallback(this._request,t,!1)}},e.EXCEPTION_STATUS=-1,e.TIMEOUT_STATUS=-2,e.ABORT_STATUS=-3,e.DEFAULT_TIMEOUT_MS=3e4,e}();return n}),define("odsp-utilities/logging/BeaconBase",["require","exports","../logging/Manager","./EventBatchCache","../xhr/XHR","./events/Beacon.event"],function(e,t,r,i,n,o){var s=function(){function e(t,r,n,o,s,a,u,l){var c=this;this._lastSendBeacon=0,this._endPointUrl=t,this._maxCriticalFlushInterval=s,this._totalRetries=void 0===a?e.DEFAULT_TOTAL_RETRIES:a,this._totalRetriesStartValue=this._totalRetries,this._resetTotalRetriesAfter=void 0===u?e.DEFAULT_RESET_TOTAL_RETRIES_AFTER:u,this._ignorePreviousEvents=void 0===l?!1:l,this._eventBatchCache=new i(r,n,function(e){c._onNewEvent&&c._onNewEvent(e)},function(e){c._createBeaconRequest(e)},o),this.init()}return e.prototype.sendBeacon=function(e,t,r){this._sendBeacon(e,t,r,0)},e.prototype._sendBeacon=function(e,t,i,s){var a=this;0===s&&(this._lastSendBeacon=r.Manager.getTime());var u=new n({url:this._endPointUrl,json:e,headers:t,requestTimeoutInMS:i}),l=new o.Beacon({retryCount:s,totalRetries:this._totalRetries});u.start(function(e,t){l.end({status:t+"",success:!0}),++a._successfulLogRequests>=a._resetTotalRetriesAfter&&(a._successfulLogRequests=a._resetTotalRetriesAfter,a._totalRetries=a._totalRetriesStartValue)},function(r,o){a._successfulLogRequests=0,l.end({status:o+"",success:!1}),o===n.TIMEOUT_STATUS&&a._totalRetries>0&&(a._totalRetries--,a._sendBeacon(e,t,i,s+1))})},e.prototype.init=function(){var e=this,t=r.Manager.addLogHandler(function(t){e.addEvent(t)});if(!this._ignorePreviousEvents)for(var i=0;i<t.length;i++)this.addEvent(t[i])},e.prototype.addEvent=function(e){e.enabled&&(this._eventBatchCache.addEvent(e),e.critical&&(!this._lastSendBeacon||r.Manager.getTime()-this._lastSendBeacon>this._maxCriticalFlushInterval)&&this._eventBatchCache.flush())},e.DEFAULT_TOTAL_RETRIES=3,e.DEFAULT_RESET_TOTAL_RETRIES_AFTER=3,e}();return s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/odb/Beacon",["require","exports","../ErrorHelper","../BeaconBase","./BeaconCache","../../models/store/BaseDataStore","../../models/store/DataStoreCachingType","./LogProcessor"],function(e,t,r,i,n,o,s,a){var u;return function(e){"use strict";function t(e,t,r){var i=null;n.instance&&(i=n.eventNamePrefix,e=n.ignoredEventsHandler,t=n.qoSEventNameHandler,r=n.qoSEventExtraDataHandler),i||(i="NoBeaconCache"),u(i,e,t,r)}function u(e,t,r,i){if(ct)throw new Error("The beacon has already been added to the logging manager with event name prefix "+at+".");ct=new gt(e,t,r,i)}function l(){ot||(J=new Q,et=new Array(0),tt=new Array(0),c(E,1),ot=!0)}function c(e,t){if(!Boolean(et[e])){var r=new z(e,t),i=$;J.wsaStreams[i]=r,$++,Z+=A,et[e]=i}}function d(e,t){try{var i=new W(t);if(g())return;it=!0,h(K,e);var n=J.wsaStreams[et[e]];if(Boolean(n)){if(!(k>rt))throw"Beacon: MAX_ROWS_IN_STREAM exceeded for stream ID "+String(e);n.Rows[rt++]=i,Z+=p(i),h(H,rt)}}catch(o){r.log(o)}}function p(e){for(var t=U,r=0;r<e.Vals.length;r++){var i=String(e.Vals[r]);t+=2*i.length}return t+=6*(e.Vals.length-1)}function h(e,t){if(!(1>e||e>L||0>t||t>M)){var r=null,i=tt[e];if(Boolean(i)&&(r=J.wsaDatapoints[i]),null==r){var n=new G(e,t),o=X;J.wsaDatapoints[o]=n,tt[e]=o,X++}else r.Val=t}}function m(){if(null==J)return"";try{if(it){Boolean(nt)?h(j,q):(h(j,B),nt=!0),J.EndTime=T();var e=null;try{e=JSON.stringify(J)}catch(t){r.log(t)}return f(),e}}catch(t){return r.log(t),""}}function f(){et=new Array(0),tt=new Array(0),X=0,$=0,rt=0,Z=0,X=0;var e=J.CorrelationId;J=new Q,J.CorrelationId=e,c(E,1),it=!1}function g(){var e=X*F+Z;return e>=O?(ct.beacon(),e=X*F+Z,e>=O):!1}function y(e){l(),Boolean(J)&&(J.CorrelationId=null!==e&&void 0!==e?e:st)}function v(e,t){if(l(),Boolean(e)&&Boolean(t)){var r=new Array(R+1);r[w]=D,r[P]=e;var i=R;for(var n in t){var o=t[n];void 0!==o&&null!==o&&(o instanceof Date&&(o=o.getTime()),r[i++]=n,r[i++]=o)}d(E,r)}}function _(){return l(),m()}function S(){var e=new Date,t=e.getTime();return 0===Y&&(Y=t),1+t-Y&2147483647}function T(){var e=new Date,t=e.getTime();return t+=N,t=1e4*t}var b=1e4,C=5e3,x=100,I=5e3,E=1234,D="V1",w=0,P=1,R=2,O=65536,k=1e3,U=4,F=12,A=12,N=116444736e5,M=4294967295,L=2147483647,B=0,q=1,V=16,K=8048,H=7993,j=60,W=function(){function e(e){this.Tic=0,this.Vals=null;var t=this;t.Tic=S();var r=e.length;t.Vals=new Array(r);for(var i=0;r>i;i++)t.Vals[i]=e[i]}return e}(),G=function(){function e(e,t){var r=this;r.Id=e,r.Val=t,r.Tic=S()}return e}(),z=function(){function e(e,t){var r=this;r.Id=e,r.Width=t,r.Rows=new Array(0)}return e}(),Q=function(){function e(){this.StartTime=null,this.EndTime=null,this.Flags=0,this.wsaDatapoints=null,this.wsaStreams=null;var e=this;e.StartTime=T(),e.EndTime=null,e.CorrelationId=null,e.Flags=V,e.wsaDatapoints=new Array(0),e.wsaStreams=new Array(0)}return e}(),Y=0,J=null,X=0,$=0,Z=0,et=null,tt=null,rt=0,it=!1,nt=!1,ot=!1,st="00000000-0000-0000-0000-000000000000",at="",ut=new o(a.STORE_KEY,s.session),lt=ut.getValue(a.STORE_SIZE_KEY),ct=null,dt=null,pt=null,ht=null;lt||(lt=0);for(var mt=0;lt>mt;mt++){var ft=ut.getValue(mt.toString());ft&&ft.name&&ft.props&&v(ft.name,ft.props)}var gt=function(e){function t(t,r,n,o){var s=this;e.call(this,"/_layouts/15/WsaUpload.ashx",x,[C],!0,I,i.DEFAULT_TOTAL_RETRIES,i.DEFAULT_RESET_TOTAL_RETRIES_AFTER,!0),this._createBeaconRequest=function(e){var t=window._spPageContextInfo;y(void 0!==t&&null!==t?t.CorrelationId:st);for(var r=0;r<e.length;r++){var i=e[r];a.processAndLogEvent({event:i,logFunc:function(e,t){v(e,t)},eventNamePrefix:at,qoSEventNameHandler:pt,ignoredEventsHandler:dt})}s.beacon()},this._onNewEvent=function(){},dt=r,pt=n,ht=o,at=t}return __extends(t,e),t.prototype.beacon=function(){var e=_();if(null!=e&&e.length>0){var t={};t["Content-Type"]="application/json",this.sendBeacon(e,t,b)}lt=0,ut.setValue(a.STORE_SIZE_KEY,lt)},t}(i);e.addToLoggingManagerForBeaconCache=t,e.addToLoggingManager=u}(u||(u={})),u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/controls/video/item/logging/Video.event",["require","exports","odsp-utilities/logging/PairedEventBase","../../../../../odsp-utilities/logging/events/ResultTypeEnum","../../../../../odsp-utilities/logging/events/ResultTypeEnum"],function(e,t,r,i,n){t.ResultTypeEnum=n.ResultTypeEnum;var o=function(e){function t(t,r){e.call(this,"Video,Qos,","Video",t,r)}return __extends(t,e),t.enabled=function(){return!0},t.prototype.setStartData=function(e){this.data.playbackType=this.cleanString(e.playbackType),this.data.name=this.cleanString(e.name),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),"undefined"!=typeof e.resultType&&(this.data.resultType=e.resultType),"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.setEndData=function(e){"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),this.data.resultType=e.resultType,"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.end=function(e){return this._end(e)},t.prototype.verbose=function(e){return this._verbose(e)},t.prototype.setTimeout=function(e,t){return this._setTimeout(e,t)},t.fullName="Video,Qos,",t.shortName="Video",t.metadata={playbackType:{type:"String",isMetric:!1},name:{type:"String",isKey:!0,isMetric:!1},resultCode:{type:"String",isMetric:!1},resultType:{type:"ResultTypeEnum",baseType:"Enum",typeRef:i.ResultTypeEnum,isMetric:!1},error:{type:"String",isMetric:!1},extraData:{type:"Object",isMetric:!1},extraMetrics:{type:"Object",isMetric:!1}},t}(r.PairedEventBase);t.Video=o,o.prototype.metadata=o.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/controls/video/item/logging/VideoPlayback.event",["require","exports","odsp-utilities/logging/SingleEventBase","odsp-utilities/logging/Manager","../../../../../odsp-utilities/logging/events/ResultTypeEnum","../../../../../odsp-utilities/logging/events/ResultTypeEnum"],function(e,t,r,i,n,o){t.ResultTypeEnum=o.ResultTypeEnum;var s=function(e){function t(t){e.call(this,"VideoPlayback,","VideoPlayback",t)}return __extends(t,e),t.enabled=function(){return i.default.evaluateSamplingRampValue("VideoPlaybackLogging")},t.logData=function(e,i){return r.SingleEventBase._logData(t,e,i)},t.prototype.isEnabled=function(){return i.default.evaluateSamplingRampValue("VideoPlaybackLogging")},t.prototype.setSingleData=function(e){this.data.playbackType=this.cleanString(e.playbackType),this.data.resultType=e.resultType},t.fullName="VideoPlayback,",t.shortName="VideoPlayback",t.metadata={playbackType:{type:"String",isMetric:!1},resultType:{type:"ResultTypeEnum",baseType:"Enum",typeRef:n.ResultTypeEnum,isMetric:!1}},t}(r.SingleEventBase);t.VideoPlayback=s,s.prototype.metadata=s.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-shared/utilities/logging/events/UploadOperation.event",["require","exports","odsp-utilities/logging/PairedEventBase","../../../../odsp-utilities/logging/events/ResultTypeEnum","../../../../odsp-utilities/logging/events/ResultTypeEnum"],function(e,t,r,i,n){t.ResultTypeEnum=n.ResultTypeEnum;var o=function(e){function t(t,r){e.call(this,"UploadOperation,Qos,","UploadOperation",t,r)}return __extends(t,e),t.enabled=function(){return!0},t.prototype.setStartData=function(e){"undefined"!=typeof e.dragAndDrop&&(this.data.dragAndDrop=e.dragAndDrop),"undefined"!=typeof e.size&&(this.data.size=e.size),"undefined"!=typeof e.count&&(this.data.count=e.count),"undefined"!=typeof e.failCount&&(this.data.failCount=e.failCount),"undefined"!=typeof e.abortCount&&(this.data.abortCount=e.abortCount),"undefined"!=typeof e.successCount&&(this.data.successCount=e.successCount),"undefined"!=typeof e.extension&&(this.data.extension=this.cleanString(e.extension)),"undefined"!=typeof e.uploadType&&(this.data.uploadType=this.cleanString(e.uploadType)),this.data.name=this.cleanString(e.name),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),"undefined"!=typeof e.resultType&&(this.data.resultType=e.resultType),"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.setEndData=function(e){this.data.dragAndDrop=e.dragAndDrop,this.data.size=e.size,this.data.count=e.count,this.data.failCount=e.failCount,this.data.abortCount=e.abortCount,this.data.successCount=e.successCount,"undefined"!=typeof e.extension&&(this.data.extension=this.cleanString(e.extension)),this.data.uploadType=this.cleanString(e.uploadType),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),this.data.resultType=e.resultType,"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.end=function(e){return this._end(e)},t.prototype.verbose=function(e){return this._verbose(e)},t.prototype.setTimeout=function(e,t){return this._setTimeout(e,t)},t.fullName="UploadOperation,Qos,",t.shortName="UploadOperation",t.metadata={dragAndDrop:{type:"Boolean",isMetric:!1},size:{type:"Number",isMetric:!0},count:{type:"Number",isMetric:!0},failCount:{type:"Number",isMetric:!0},abortCount:{type:"Number",isMetric:!0},successCount:{type:"Number",isMetric:!0},extension:{type:"String",isMetric:!1},uploadType:{type:"String",isMetric:!1},name:{type:"String",isKey:!0,isMetric:!1},resultCode:{type:"String",isMetric:!1},resultType:{type:"ResultTypeEnum",baseType:"Enum",typeRef:i.ResultTypeEnum,isMetric:!1},error:{type:"String",isMetric:!1},extraData:{type:"Object",isMetric:!1},extraMetrics:{type:"Object",isMetric:!1}},t}(r.PairedEventBase);t.UploadOperation=o,o.prototype.metadata=o.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-shared/utilities/logging/events/Upload.event",["require","exports","odsp-utilities/logging/PairedEventBase","../../../../odsp-utilities/logging/events/ResultTypeEnum","../../../../odsp-utilities/logging/events/ResultTypeEnum"],function(e,t,r,i,n){t.ResultTypeEnum=n.ResultTypeEnum;var o=function(e){function t(t,r){e.call(this,"Upload,Qos,","Upload",t,r)}return __extends(t,e),t.enabled=function(){return!0},t.prototype.setStartData=function(e){this.data.dragAndDrop=e.dragAndDrop,this.data.size=e.size,this.data.extension=this.cleanString(e.extension),this.data.folderUpload=e.folderUpload,this.data.groupFolder=e.groupFolder,this.data.name=this.cleanString(e.name),"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),"undefined"!=typeof e.resultType&&(this.data.resultType=e.resultType),"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.setEndData=function(e){"undefined"!=typeof e.resultCode&&(this.data.resultCode=this.cleanString(e.resultCode)),this.data.resultType=e.resultType,"undefined"!=typeof e.error&&(this.data.error=this.cleanString(e.error)),"undefined"!=typeof e.extraData&&(this.data.extraData=e.extraData),"undefined"!=typeof e.extraMetrics&&(this.data.extraMetrics=e.extraMetrics)},t.prototype.end=function(e){return this._end(e)},t.prototype.verbose=function(e){return this._verbose(e)},t.prototype.setTimeout=function(e,t){return this._setTimeout(e,t)},t.fullName="Upload,Qos,",t.shortName="Upload",t.metadata={dragAndDrop:{type:"Boolean",isMetric:!1},size:{type:"Number",isMetric:!0},extension:{type:"String",isMetric:!1},folderUpload:{type:"Boolean",isMetric:!1},groupFolder:{type:"Boolean",isMetric:!1},name:{type:"String",isKey:!0,isMetric:!1},resultCode:{type:"String",isMetric:!1},resultType:{type:"ResultTypeEnum",baseType:"Enum",typeRef:i.ResultTypeEnum,isMetric:!1},error:{type:"String",isMetric:!1},extraData:{type:"Object",isMetric:!1},extraMetrics:{type:"Object",isMetric:!1}},t}(r.PairedEventBase);t.Upload=o,o.prototype.metadata=o.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),define("odsp-next/utilities/logging/odb/BeaconHelper",["require","exports","odsp-utilities/logging/odb/BeaconCache","odsp-utilities/logging/odb/Beacon","odsp-utilities/logging/events/Nav.event","odsp-utilities/logging/events/PLTHttpRequest.event","odsp-utilities/logging/events/Qos.event","odsp-utilities/logging/EventBase","../../../controls/video/item/logging/Video.event","../../../controls/video/item/logging/VideoPlayback.event","odsp-shared/utilities/logging/events/UploadOperation.event","odsp-shared/utilities/logging/events/Upload.event","odsp-shared/utilities/logging/events/Action.event"],function(e,t,r,i,n,o,s,a,u,l,c,d,p){function h(e){"use strict";return e===s.ResultTypeEnum.Success?".Success":e===s.ResultTypeEnum.Failure?".Failure":e===s.ResultTypeEnum.ExpectedFailure?".ExpectedFailure":""}function m(e,t){"use strict";t.extraData||(t.extraData={}),"undefined"!=typeof e.dragAndDrop&&(t.extraData.upload_DragAndDrop=e.dragAndDrop),"undefined"!=typeof e.extension&&(t.extraData.upload_Extension=e.extension),"undefined"!=typeof e.groupFolder&&(t.extraData.upload_GroupFolder=e.groupFolder),"undefined"!=typeof e.size&&(t.extraData.upload_Size=e.size)}function f(e,t){"use strict";t.extraData||(t.extraData={}),"undefined"!=typeof e.pageType&&(t.extraData.action_PageType=e.pageType),"undefined"!=typeof e.queryType&&(t.extraData.action_QueryType=e.queryType)}function g(e,t){"use strict";t.extraData||(t.extraData={}),"undefined"!=typeof e.playbackType&&(t.extraData.video_playbackType=e.playbackType)}function y(e,t){"use strict";t.extraData||(t.extraData={}),"undefined"!=typeof e.abortCount&&(t.extraData.uploadOperation_AbortCount=e.abortCount),"undefined"!=typeof e.count&&(t.extraData.uploadOperation_Count=e.count),"undefined"!=typeof e.dragAndDrop&&(t.extraData.uploadOperation_DragAndDrop=e.dragAndDrop),"undefined"!=typeof e.extension&&(t.extraData.uploadOperation_Extension=e.extension),"undefined"!=typeof e.failCount&&(t.extraData.uploadOperation_FailCount=e.failCount),"undefined"!=typeof e.size&&(t.extraData.uploadOperation_Size=e.size),"undefined"!=typeof e.successCount&&(t.extraData.uploadOperation_SuccessCount=e.successCount),"undefined"!=typeof e.uploadType&&(t.extraData.uploadOperation_UploadType=e.uploadType)}function v(){"use strict";i.addToLoggingManagerForBeaconCache(T,b,C)}function _(e){"use strict";i.addToLoggingManager(e,T,b,C)}function S(e){"use strict";r.addToLoggingManager(e,T,b,C)}var T=function(e){return n.Nav.isTypeOf(e)||o.PLTHttpRequest.isTypeOf(e)||l.default.isTypeOf(e)},b=function(e,t){var r=t;return c.UploadOperation.isTypeOf(e)?r="Upload":d.Upload.isTypeOf(e)?r="SingleUpload":p.Action.isTypeOf(e)?r="Action."+r:u.Video.isTypeOf(e)&&(r="Video."+r),e.data&&(e.eventType===a.ClonedEventType.Start?r+=".Start":e.eventType===a.ClonedEventType.End?(e.data.resultCode&&(r+="."+e.data.resultCode),r+=h(e.data.resultType)):r+=".no_EventType"),r},C=function(e,t){c.UploadOperation.isTypeOf(e)?y(e.data,t):d.Upload.isTypeOf(e)?m(e.data,t):p.Action.isTypeOf(e)?f(e.data,t):u.Video.isTypeOf(e)&&g(e.data,t)};t.addToLoggingManagerForBeaconCache=v,t.addToLoggingManager=_,t.beaconCacheAddToLoggingManager=S}),define("odsp-next/utilities/newFeatureExperience/UserType",["require","exports"],function(){var e;return function(e){e[e.existingLongTimeUser=0]="existingLongTimeUser",e[e.existingUser=1]="existingUser",e[e.newUser=2]="newUser"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/utilities/newFeatureExperience/UserInformation",["require","exports","./UserType","odsp-utilities/models/store/BaseDataStore","odsp-utilities/models/store/DataStoreCachingType"],function(e,t,r,i,n){var o=function(e){function t(){e.call(this,"NewFeatureExperienceUser",n.local),this.containsUserData()?(this.lastSeenVersion=this.getValue("lastSeenVersion"),this.userType=this.getValue("userType"),this.versionChangeDate=new Date(this.getValue("versionChangeDate")),this.firstVisit=!1):(this.lastSeenVersion=-1,this.userType=r.newUser,this.versionChangeDate=null,this.firstVisit=t.isLocalStorageSupported())}return __extends(t,e),t.isLocalStorageSupported=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},t.prototype.save=function(){this.setValue("lastSeenVersion",this.lastSeenVersion),this.setValue("userType",this.userType),this.setValue("versionChangeDate",this.versionChangeDate)},t.prototype.containsUserData=function(){return void 0!==this.getValue("lastSeenVersion")&&void 0!==this.getValue("userType")&&void 0!==this.getValue("versionChangeDate")},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/utilities/newFeatureExperience/NewFeatureExperienceEnabler",["require","exports","odsp-utilities/guid/Guid","odsp-utilities/async/Signal","odsp-utilities/async/Promise","odsp-shared/base/BaseModel","../../resources/ProviderResourceKeys","../../resources/DataSourceResourceKeys","odsp-utilities/async/RequireHelper","odsp-utilities/logging/events/Qos.event","odsp-utilities/logging/events/Engagement.event","odsp-utilities/logging/events/Qos.event","./UserInformation","./UserType","../../utilities/features/Features"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m){var f=function(t){function o(e){t.call(this,e),this._map={},this._needsRefreshData=!0,this.version=1}return __extends(o,t),o.prototype.anchorToName=function(e,t){var i=this._map[e];i&&null==i.referenceString?(i.referenceString=r.default.generate(),i.callback=t,i.signal.complete()):i?(i.callback(null),i.referenceString=r.default.generate(),i.callback=t,i.isAnchored=!1,i.signal&&i.signal.complete()):(i={referenceString:r.default.generate(),signal:null,callback:t,isAnchored:!1},this._map[e]=i)},o.prototype.getReferenceStrings=function(e,t){var r={};this.recursiveGetReferences(r,e,0,t)},o.prototype.initializeNewFeatureExperience=function(){var e=this,t=new l.Qos({name:"NewFeatureExperience.Initialize"});t.setTimeout(5e3,{resultType:d.ResultTypeEnum.Failure,resultCode:"Timeout"});var r=this.resources.consume(s.suiteNav);return r?void r.getO365Shell().done(function(r){r.OnHasMember("FlexPane",function(){e.async.setTimeout(function(){var i=new p,n=!1;if(-1===i.lastSeenVersion&&0!==O365Shell_Shim.NFD.GetWorkloadLastAccessedDate()){var o=new Date(O365Shell_Shim.NFD.GetWorkloadLastAccessedDate()),s=(new Date).getTime()-o.getTime();7884e6>s&&(i.userType=h.existingLongTimeUser,n=!0)}if(i.userType===h.newUser&&null!=i.versionChangeDate){var a=(new Date).getTime()-i.versionChangeDate.getTime();a>12096e5&&(i.userType=h.existingUser,n=!0)}return i.lastSeenVersion!==e.version&&(i.lastSeenVersion=e.version,i.versionChangeDate=new Date,n=!0),m.default.isFeatureEnabled(m.default.NewFeatureExperienceForNewUsers)||i.userType===h.existingLongTimeUser?(i.userType!==h.existingLongTimeUser&&c.Engagement.logData({name:"NewFeatureExperience.NewUsersEnabled"}),n&&i.save(),r.FlexPane.OnFlexPaneVisibilityChanged(function(t){e._needsRefreshData&&(e._needsRefreshData=!1,t===!0?(c.Engagement.logData({name:"NewFeatureExperience.Visible"}),e.loadNewFeatureData(i.userType)):c.Engagement.logData({name:"NewFeatureExperience.Hidden"}),e.async.setTimeout(function(){e._needsRefreshData=!0},50))}),void(i.firstVisit?(c.Engagement.logData({name:"NewFeatureExperience.AutoShow"}),r.FlexPane.OpenFlexPaneForProvider("NFD"),t.end({resultType:d.ResultTypeEnum.Success,extraData:{behavior:"ImmediateLoadAndShow"}})):t.end({resultType:d.ResultTypeEnum.Success,extraData:{behavior:"LazyLoad"}}))):(c.Engagement.logData({name:"NewFeatureExperience.NewUsersDisabled"}),void t.end({resultType:d.ResultTypeEnum.Success,extraData:{behavior:"NewUsersDisabled"}}))},500)})}):void t.end({resultType:d.ResultTypeEnum.Failure,resultCode:"SuiteNavProviderNotFound"})},o.prototype.loadNewFeatureData=function(t){var r=this,i=this.resources.consume(s.suiteNav);i.getO365Shell().done(function(i){u.promise(e,"./NewFeatureExperienceLoader").done(function(e){var n=r.resources.consume(a.settings).mediaBaseUrl;e.run(i,t,n,r)})})},o.prototype.recursiveGetReferences=function(e,t,r,i){var n=this;if(r>=t.length)return void i(e);var o=t[r];this.getRefernceAsync(o).done(function(s){e[o]=s,n.recursiveGetReferences(e,t,r+1,i)})},o.prototype.getRefernceAsync=function(e){var t=this,r=this._map[e];return r&&null!==r.referenceString?(r.isAnchored||(r.callback(r.referenceString),r.isAnchored=!0),n.default.wrap(r.referenceString)):(r={referenceString:null,signal:new i,callback:null,isAnchored:!1},this._map[e]=r,r.signal.getPromise().then(function(){return t.getRefernceAsync(e)}))},o}(o);return f}),define("odsp-next/models/operation/OperationErrorType",["require","exports"],function(){var e;return function(e){e[e.unknown=0]="unknown",e[e.multiple=1]="multiple"}(e||(e={})),e}),define("odsp-next/models/operation/OperationError",["require","exports","./OperationErrorType"],function(e,t,r){var i=function(){function e(e){this.errorType=e.errorType||r.unknown,this.message=e.message,this.payloads=e.payloads||{}}return e}();return i}),define("odsp-next/models/itemSet/ItemSetContent",["require","exports"],function(){var e=function(){function e(e){this.items=new Array(e||0),this.groupings=null}return e}();return e}),define("odsp-next/models/itemSet/ItemSet",["require","exports","./ItemSetContent","knockout","odsp-shared/utilities/object/EqualityComparers"],function(e,t,r,i,n){var o=function(){function e(e,t,o){this.key=e||"",this.content=i.observable(new r(o)),this.content.equalityComparer=n.objectStrictEquality,this.schema=i.observableArray([]),this.schema.equalityComparer=n.arrayStrictEquality,this.context=i.utils.extend({},t),this.contentTypes=i.observableArray([]),this.isPlaceholder=!0,this.version=0}return e}();return o}),define("odsp-next/dataSources/item/IGetWorkProgressContext",["require","exports"],function(e,t){t.IGetWorkProgressTypes={itemCopy:"itemCopy",albumFolderExtraction:"albumFolderExtraction",faceGrouping:"faceGrouping"}}),define("odsp-next/dataSources/item/ITaskProgress",["require","exports"],function(e,t){!function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Completed=2]="Completed",e[e.Canceled=3]="Canceled",e[e.Failed=4]="Failed"}(t.ITaskStatuses||(t.ITaskStatuses={}));t.ITaskStatuses}),define("odsp-next/providers/operation/MoveCopyItemsAsyncOperation",["require","exports","knockout","../../models/operation/OperationType","../../models/operation/OperationState","../../models/operation/OperationBatch","../../dataSources/upload/NameConflictBehavior","../../dataSources/item/IGetWorkProgressContext","odsp-utilities/async/Async","../../models/operation/OperationError","../../controls/commands/Commands.resx","../../controls/operation/monitor/OperationMonitor.resx","../../models/item/ItemType","../../dataSources/item/ITaskProgress"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h){var m=function(){function e(){}return e.registerOperation=function(t,a,u,l,c,d,p,h){h||(h=new o);var m={items:[t],parentKey:a.parentKey,targetId:a.targetId,targetKey:a.targetKey,cid:a.cid,group:a.group,isMove:a.isMove,nameConflict:a.nameConflict,taskId:a.taskId,deleteSource:a.deleteSource,isAsync:a.isAsync},f=c.register({name:t.name,type:a.isMove?i.moveItems:i.copyItems,iconName:t.iconName,payloads:{moveItems:{item:t,destination:u.peek(),source:t.parent},copyItems:{item:t,destination:u.peek(),source:t.parent,taskId:p}},batch:h,actions:{rename:{isAvailable:r.observable(!1),execute:function(){return m.nameConflict=s.rename,f.actions().rename.isAvailable(!1),f.actions().overwrite.isAvailable(!1),f.state(n.started),e.handleMoveCopyAsyncItems(m,r.observableArray([f]),l,d,p)}},overwrite:{isAvailable:r.observable(!1),execute:function(){return m.nameConflict=s.overwrite,f.actions().rename.isAvailable(!1),f.actions().overwrite.isAvailable(!1),f.state(n.started),e.handleMoveCopyAsyncItems(m,r.observableArray([f]),l,d,p)
}},cancel:{isAvailable:r.observable(!0),execute:function(){return m.taskId=a.taskId,f.actions().rename.isAvailable(!1),f.actions().overwrite.isAvailable(!1),f.state(n.canceled),e.cancelAsyncOperation(m,f,l,d,p)}},moveAnyway:{isAvailable:r.observable(!1),execute:function(){return m.deleteSource=!0,m.isMove=!1,m.isAsync=!0,f.actions().moveAnyway.isAvailable(!1),f.actions().rename.isAvailable(!1),f.actions().overwrite.isAvailable(!1),f.state(n.started),e.handleMoveCopyAsyncItems(m,f,l,d,p)}},moveLockedFile:{isAvailable:r.observable(!1),execute:function(){return m.overrideLock=!0,f.actions().moveLockedFile.isAvailable(!1),d.moveItems(m)}}},progress:{minimum:0,maximum:1,current:0}});return f.state(n.started),f},e.handleGetWorkProgressSuccess=function(t,i,o,s,a,u){var l=!1,c=!1;if(r.utils.arrayForEach(i,function(r){for(var i,o=0,s=t.progress;o<s.length;o++){var a=s[o];if(a.id===r.payloads.peek().copyItems.taskId){i=a;break}}var u=function(){r.progress.current(1),r.state(n.completed),c=!0};if(i){var d=i.error,p=h.ITaskStatuses[i.status];d?e.handleMoveCopyError(d,r):p===h.ITaskStatuses.Completed?u():p===h.ITaskStatuses.Failed?r.state(n.failed):l=!0}else u()}),c&&(u.invalidateItem(o.parentKey),u.invalidateItem(o.targetKey)),l){var d=e.async.setTimeout(function(){a(s)},e.ASYNC_TASK_RETRY_WAIT);this._activeAsyncTasks[o.taskId]=d}},e.cancelAsyncOperation=function(t,r,i,n,o){var s=o||t.taskId,a=this._activeAsyncTasks[o];return a&&(e.async.clearTimeout(a),delete this._activeAsyncTasks[o]),i.cancelWork({workItemIds:[s]})},e.moveCopyOperationFailure=function(e,t){return r.utils.arrayForEach(t,function(e){e.state(n.failed)}),e},e.handleMoveCopyAsyncItems=function(t,r,i,n,o){var s=this;if(t.isMove)throw new Error("Async move not implemented in the API layer");var u=(t.isMove?null:i.copyItemsAsync).bind(i),l=function(t,r,o){var l=function(o){i.getWorkProgress(o).then(function(i){e.handleGetWorkProgressSuccess(i,r,t,o,l,n)})},c=function(i){t.taskId=i.id;for(var n={workItemIds:[i.id],type:a.IGetWorkProgressTypes.itemCopy},u=0;u<r.length;u++){var c=r[u];!c.payloads.peek().copyItems.taskId&&i&&i.progress&&(c.payloads.peek().copyItems.taskId=i.progress[u]&&i.progress[u].id)}var d=e.async.setTimeout(function(){l(n)},e.ASYNC_TASK_RETRY_WAIT);return s._activeAsyncTasks[o]=d,d};if(o){var d={id:o,progress:null,pageStats:null,targetId:null};return c(d)}return u(t).then(c,function(i){return e.moveCopyOperationFailure(i,r,t)})};return e.markAllOperationsAsStarted(r),l(t,r(),o)},e.handleMoveCopyError=function(t,r){var i=t.code;i===e.ODC_NAME_COLLISION_ERROR_CODE?(r.actions().rename.isAvailable(!0),r.actions().overwrite.isAvailable(!0),r.actions().cancel.isAvailable(!0),r.error(new l({message:d.strings.conflictUploadErrorText}))):i===e.ODB_NAME_COLLISION_ERROR_CODE?r.payloads().moveItems.item.parentKey===r.payloads().moveItems.destination.key?(r.actions().cancel.isAvailable(!0),r.error(new l({message:d.strings.sameLocationMoveCopyErrorText}))):r.payloads().moveItems.item.type===p.Folder?(r.actions().cancel.isAvailable(!0),r.error(new l({message:d.strings.conflictUploadFolderErrorText}))):(r.actions().overwrite.isAvailable(!0),r.actions().cancel.isAvailable(!0),r.error(new l({message:d.strings.conflictUploadWithoutRenameErrorText}))):i===e.ODB_FILE_LOCKED_ERROR_CODE?(r.actions().cancel.isAvailable(!0),t.message&&r.error(new l({message:t.message}))):i===e.ODC_FILE_SIZE_LIMIT_ERROR_CODE?r.actions().cancel.isAvailable(!0):i===e.ODC_MOVE_INTO_MOUNTED_ERROR_CODE?(r.actions().moveAnyway.isAvailable(!0),r.error(new l({message:c.strings.moveItemCannotMoveOwnItemIntoMountPointError}))):i===e.ODC_MOVE_INTO_OWN_ERROR_CODE?(r.actions().moveAnyway.isAvailable(!0),r.error(new l({message:c.strings.moveItemCannotMoveSharedItemIntoOwnFolderError}))):i===e.ODC_FILE_LOCKED&&(r.actions().cancel.isAvailable(!0),r.actions().moveLockedFile.isAvailable(!0),r.error(new l({message:t.message}))),r.state(n.failed)},e.markAllOperationsAsStarted=function(e){r.utils.arrayForEach(e(),function(e){e.state(n.started)})},e.ASYNC_TASK_RETRY_WAIT=5e3,e.ODC_NAME_COLLISION_ERROR_CODE=1e3,e.ODC_FILE_SIZE_LIMIT_ERROR_CODE=2e3,e.ODC_MOVE_INTO_MOUNTED_ERROR_CODE=2028,e.ODC_MOVE_INTO_OWN_ERROR_CODE=2029,e.ODC_FILE_LOCKED=9001,e.ODB_NAME_COLLISION_ERROR_CODE=-2130575257,e.ODB_FILE_LOCKED_ERROR_CODE=-2147018894,e.async=new u,e._activeAsyncTasks={},e}();return m}),define("odsp-next/providers/ProviderHelpers",["require","exports"],function(){var e=function(){function e(){}return e.resultSetHasData=function(e,t){for(var r=t.start,i=t.end,n=e.length,o=!0,s=r;i>s&&n>s;s++)if(!e[s]){o=!1;break}return o},e}();return e}),define("odsp-next/models/task/TaskStatus",["require","exports"],function(e,t){var r;!function(e){e[e.started=0]="started",e[e.succeeded=1]="succeeded",e[e.failed=2]="failed",e[e.canceled=3]="canceled"}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("odsp-next/models/task/Task",["require","exports","./TaskStatus"],function(e,t,r){var i=function(){function e(e,t){if("string"==typeof e)this.key=e,this.input=t,this.status=r.default.started;else{var i=e;this.key=i.key,this.input=i.input,this.output=i.output,this.status=i.status,this.error=i.error}}return e.prototype.succeed=function(t){var i=new e(this);return i.output=t,i.status=r.default.succeeded,delete i.error,i},e.prototype.fail=function(t){var i=new e(this);return i.error=t,i.status=r.default.failed,i},e.prototype.cancel=function(){var t=new e(this);return delete t.error,t.status=r.default.canceled,t},e.prototype.restart=function(){var t=new e(this.key,this.input);return t},e.prototype.changeInput=function(t){var r=t(this.input),i=new e(this.key,r);return i.output=this.output,i.status=this.status,i.error=this.error,i},e.prototype.changeOutput=function(t){var r=t(this.output),i=new e(this.key,this.input);return i.output=r,i.status=this.status,i.error=this.error,i},e.prototype.compare=function(e){var t=!e||this.input!==e.input||this.output!==e.output||this.error!==e.error||this.status!==e.status;return t?{previous:e,current:this}:null},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-next/providers/item/ItemProvider",["require","exports","odsp-shared/base/BaseModel","../../models/item/OneDriveItem","../../models/store/ItemsStore","odsp-utilities/async/Promise","../../resources/ModelResourceKeys","../../resources/DataSourceResourceKeys","../../resources/UtilityResourceKeys","../../resources/ProviderResourceKeys","../../models/operation/OperationState","../../models/operation/OperationBatch","../../models/operation/OperationType","../../models/operation/OperationError","../../models/itemSet/ItemSet","knockout","../operation/MoveCopyItemsAsyncOperation","../../dataSources/upload/NameConflictBehavior","../ProviderHelpers","odsp-utilities/object/ObjectUtil","../../models/task/Task","../../utilities/navigation/NavigationHelper","odsp-shared/utilities/knockout/Projections"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m,f,g,y,v,_,S,T){var b=100,C="end",x=function(e){function t(t){e.call(this,t),this._navigation=this.resources.consume(u.navigation),this._store=this.resources.consume(s.itemsStore),this._operationProvider=this.resources.consume(l.operation),this._itemDataSource=this.resources.consume(a.items),this._recycleBinItemDataSource=this.resources.consume(a.recycleBin),this._sharedWithMeItemDataSource=this.resources.consume(a.sharedWithMe),this._recentItemDataSource=this.resources.consume(a.recent),this._docsInCommonItemDataSource=this.resources.consume(a.docsInCommon),this._searchItemDataSource=this.resources.consume(a.searchItems),this._popularItemDataSource=this.resources.consume(a.popular),this._recentUnpopularItemDataSource=this.resources.consume(a.recentUnpopular),this._registeredProjections={},this._pendingGetItemRequests={}}return __extends(t,e),t.prototype.getCapabilities=function(){return this._itemDataSource.getCapabilities()},t.prototype.getItem=function(e){return this._getItem(this._itemDataSource,e)},t.prototype.getSingleItem=function(e){return this._itemDataSource.getSingleItem(e)},t.prototype.getItemSync=function(e){var t=this.getItemSetKey(e),r=this._store.getItem(e.parentKey),n=this._getItemSet(t,e);if(!r){var o=new i(e.parentKey);this._store.setItem(o),r=this._store.getItem(e.parentKey)}if(!n){var s=r.peek(),a=0;if(s&&s.folder&&s.folder.childCount&&(a=s.folder.childCount),n=new m(t,e,a),n.item=r,e.needSchema!==!1){var u=this._itemDataSource.getColumns(s,null);n.schema(u&&(u.length>0?u:[]))}this._store.setItemSet(t,n)}return n},t.prototype.getItemContents=function(e){return this._itemDataSource.getItemContents(e)},t.prototype.getRecycledItems=function(e){return e.skipCache=!0,this._getItem(this._recycleBinItemDataSource,e,0===e.startIndex)},t.prototype.getSharedWithMe=function(e){return this._getItem(this._sharedWithMeItemDataSource,e)},t.prototype.getDocsInCommon=function(e){return this._getItem(this._docsInCommonItemDataSource,e)},t.prototype.getRecent=function(e){return this._getItem(this._recentItemDataSource,e)},t.prototype.getPopular=function(e){return this._getItem(this._popularItemDataSource,e)},t.prototype.getRecentUnpopular=function(e){return this._getItem(this._recentUnpopularItemDataSource,e)},t.prototype.removeFromRecent=function(e){var t=this;return this._recentItemDataSource.removeFromRecent(e).then(function(r){return r&&t.invalidateItem(e.parentKey),r})},t.prototype.removeMountPoint=function(e){var t=this;return this._itemDataSource.removeMountPoint(e).then(function(r){return r&&t.invalidateItem(e.parentKey),r})},t.prototype.createMountPoint=function(e){return this._itemDataSource.createMountPoint(e).then(function(e){return e},function(e){return o.default.wrapError(e)})},t.prototype.getSearchItems=function(e){return this._getItem(this._searchItemDataSource,e)},t.prototype.createFolder=function(e,t){var r=this,i=[new S.default(e.parent.key+"&cf="+e.folderName,e.folderName)];return this._itemDataSource.createFolder(e).then(function(n){r.invalidateItem(e.parent.key),i=i.map(function(e){return e.succeed(n)}),t.update(i)},function(e){var r=new Error(e);return i=i.map(function(e){return e.fail(r)}),t.update(i),o.default.wrapError(r)})},t.prototype.createDocument=function(e,t,r){var i=this;return this._itemDataSource.createDocument(e,t,r).then(function(t){return i.invalidateItem(e),t})},t.prototype.createCustomDocument=function(e,t,r){var i=this,n=this.resources.consume(a.items);return n.createCustomDocument(e,t,r).then(function(t){return i.invalidateItem(e),t})},t.prototype.deleteItems=function(e,t){var r,i=this;r={};var n=e.items.map(function(e){return r[e.id]=new S.default(e.key,e)});return t.update(n),this._itemDataSource.deleteItems(e).then(function(){i.invalidateItem(e.parentKey),n=n.map(function(e){return e.succeed()}),t.update(n)},function(o){i.invalidateItem(e.parentKey);var s=o.data&&o.data.items||[];n=[];for(var a=0;a<s.length;a++){var u=s[a],l=r[u.id];delete r[u.id],l=u.error?l.fail(u.error):l.succeed(),n.push(l)}for(var c in r){var l=r[c];delete r[c],n.push(l.cancel())}t.update(n)})},t.prototype.restoreItems=function(e,t){var r,i=this;r={};var n=e.items.map(function(e){return r[e.id]=new S.default(e.key,e)});return t.update(n),this._itemDataSource.restoreItems(e).then(function(){i.invalidateItem(e.parentKey);for(var r=0,o=e.items;r<o.length;r++){var s=o[r];i.invalidatePhoto(s)}i._store.invalidateAllPhotos(),n=n.map(function(e){return e.succeed()}),t.update(n)},function(o){i.invalidateItem(e.parentKey);var s=o.data&&o.data.items||[];n=[];for(var a=0;a<s.length;a++){var u=s[a],l=r[u.id];delete r[u.id],l=u.error?l.fail(u.error):l.succeed(),n.push(l)}for(var c in r){var l=r[c];delete r[c],n.push(l.cancel())}t.update(n)})},t.prototype.invalidatePhoto=function(e){var t=T.deserializeQuery(e.key);if(delete t.qt,this._store.invalidateItem(T.serializeQuery(t)),e.tags)for(var r=0,i=e.tags;r<i.length;r++){var n=i[r];this._store.invalidateLocation(n.tag)}},t.prototype.updateBundle=function(e,t){var r=this,i=[new S.default(e.item.key,e.item)];return t.update(i),this._itemDataSource.updateBundle(e).then(function(){r.invalidateItem(e.item.parent?e.item.parent.key:e.item.key),i=i.map(function(e){return e.succeed()}),t.update(i)},function(n){r.invalidateItem(e.item.parent?e.item.parent.key:e.item.key);var s=new Error(n);return i=i.map(function(e){return e.fail(s)}),t.update(i),o.default.wrapError(s)})},t.prototype.removeFromSharedList=function(e){var t=this;return this._itemDataSource.removeFromSharedList(e).then(function(r){return t.invalidateItem(e.parentKey),r})},t.prototype.restoreAll=function(e){var t=this;return this._itemDataSource.restoreAll(e).then(function(){return t.invalidateItem(e.parentKey),!0})},t.prototype.renameItem=function(e,t){var r=this,i=[new S.default(e.item.key,e.item)];return t.update(i),this._itemDataSource.renameItem(e).then(function(){r.invalidateItem(e.parentKey),i=i.map(function(e){return e.succeed()}),t.update(i)},function(e){var r=new Error(e);return i=i.map(function(e){return e.fail(r)}),t.update(i),o.default.wrapError(r)})},t.prototype.updateViewCount=function(e){return this._itemDataSource.updateViewCount(e)},t.prototype.reportAbuse=function(e){var t=new d,r=this._operationProvider.register({name:e.item.name,type:p.reportAbuse,payloads:{reportAbuse:{item:e.item}},iconName:e.item.iconName,batch:t}),i=this._itemDataSource.reportAbuse(e);return r.state(c.started),r.progress.maximum(1),i.then(function(e){return r.state(c.completed),r.progress.current(1),e},function(e){return r.state(c.failed),r.error(new h({message:e})),o.default.wrapError(e)})},t.prototype.requestReview=function(e){var t=this,r=new d,i=e.items.map(function(e){var i=t._operationProvider.register({name:e.name,type:p.requestReview,payloads:{requestReview:{item:e}},iconName:e.iconName,batch:r});return i.progress.maximum(1),i.progress.current(0),i}),n=this._itemDataSource.requestReview(e);return i.forEach(function(e){e.state(c.started)}),n.then(function(r){return i.forEach(function(e){e.progress.current(1),e.state(c.completed)}),t.invalidateItem(e.items[0].parent.key),r},function(e){return i.forEach(function(t){t.error(new h({message:e})),t.state(c.failed)}),o.default.wrapError(e)})},t.prototype.saveSortOrder=function(e){var t=this._itemDataSource.saveSortOrder(e);return t.then(function(e){return e},function(){})},t.prototype.addCoverPhotos=function(e){var t=this,r=new d,i=e.target,n=f.observableArray(e.items).map(function(e){var n=t._operationProvider.register({name:e.name,type:p.addCoverPhotos,payloads:{coverPhotos:{parent:i,item:e}},iconName:e.iconName,batch:r});return n.progress.maximum(1),n.progress.current(0),n}),o=this._itemDataSource.addCoverPhotos(e);return f.utils.arrayForEach(n(),function(e){e.state(c.started)}),o.then(function(e){return t.invalidateItem(i.key),f.utils.arrayForEach(n(),function(e){e.progress.current(1),e.state(c.completed)}),e},function(){f.utils.arrayForEach(n(),function(e){return e.state(c.failed)})})},t.prototype.removeCoverPhotos=function(e){var t=this,r=new d,i=e.target,n=f.observableArray(e.items).map(function(e){var n=t._operationProvider.register({name:e.name,type:p.removeCoverPhotos,payloads:{coverPhotos:{parent:i,item:e}},iconName:e.iconName,batch:r});return n.progress.maximum(1),n.progress.current(0),n}),o=this._itemDataSource.removeCoverPhotos(e);return f.utils.arrayForEach(n(),function(e){e.state(c.started)}),o.then(function(e){return t.invalidateItem(i.key),f.utils.arrayForEach(n(),function(e){e.progress.current(1),e.state(c.completed)}),e},function(){f.utils.arrayForEach(n(),function(e){return e.state(c.failed)})})},t.prototype.changeFolderType=function(e){var t=this,r=this._itemDataSource.changeFolderType(e);return r.then(function(r){return t.invalidateItem(e.item.key,!0),r})},t.prototype.updateItemProperty=function(e){var t=this,r=this._itemDataSource.updateItemProperty(e);return r.then(function(r){return t.invalidateItem(e.item.key,!0),r})},t.prototype.getOpenInClientDetails=function(e){var t=this._itemDataSource.getOpenInClientDetails(e);return t.then(function(e){return e},function(){})},t.prototype.invalidateItem=function(e,t,r){if(r&&this._store.emptyAllOtherSets([e]),this._store.invalidateItem(e),t){var i=this._navigation,n=this._store.getItemSetFromItemKey(e),o=n&&n.context;o||(o={parentKey:e,skipCache:!0,authKey:i?i.viewParams.authkey:"",ticket:i?i.viewParams.ticket:"",iAm:i?i.viewParams.iam:""}),this._getItem(this._itemDataSource,o,!0)}},t.prototype.copyItemsAsync=function(e){var t=this;if(e.isMove)throw new Error("Async move not implemented in the API layer");return this.getItem({parentKey:e.targetKey}).then(function(r){var i=new d,n=r.item,o=f.observableArray(e.items).map(function(r){return g.registerOperation(r,e,n,t._itemDataSource,t._operationProvider,t,null,i)});return g.handleMoveCopyAsyncItems(e,o,t._itemDataSource,t)})},t.prototype.copyItems=function(e){return this._handleMoveCopyItems(e)},t.prototype.moveItems=function(e){return this._handleMoveCopyItems(e)},t.prototype.getWorkProgress=function(e){return this._itemDataSource.getWorkProgress(e)},t.prototype.moveCopyOperationSuccess=function(e,t,r){var i=0;return f.utils.arrayForEach(t,function(t){var r=e.items[i],n=r&&r.error;if(n)g.handleMoveCopyError(n,t);else{if(!e.items)throw new Error("No items returned from MoveCopy API");t.progress.current(1),t.state(c.completed)}i++}),this.invalidateItem(r.parentKey),this.invalidateItem(r.targetKey),e},t.prototype.processReferral=function(e,t){return this._itemDataSource.processReferral(e,t)},t.prototype.getItemOcrTextContent=function(e){return this._itemDataSource.getItemOcrTextContent(e)},t.prototype.updateItemOcrInfo=function(e,t,r){var i=this,n=this._itemDataSource.updateItemOcrInfo(e,t,r);return n.then(function(t){return i.invalidateItem(e.key,!0),t},function(e){return e})},t.prototype.rotateItems=function(e,t){var r,i=this,n=this._itemDataSource.rotateItems(e);r={};var o=e.items.map(function(t){return i._previewChanges(t,function(t){t.rotation=(t.rotation+e.rotation)%4}),r[t.key]=new S.default(t.key,t)});return t.update(o),n.then(function(){i.invalidateItem(e.parentKey,!0),o=o.map(function(e){return e.succeed()}),t.update(o)},function(n){i.invalidateItem(e.parentKey,!0);var s=n.data||[];o=[];for(var a=0;a<s.length;a++){var u=s[a],l=r[u.key];i._store.setItem(l.input),delete r[u.key],o.push(l.fail(u.error))}for(var c in r){var l=r[c];delete r[c],o.push(l.succeed())}t.update(o)})},t.prototype.getItemSetKey=function(e,t){var r="";if(r+="parentKey="+e.parentKey,e.ownerId&&(r+="&ownerId="+e.ownerId),e.groupingType&&(r+="&groupingType="+e.groupingType),e.query&&(r+="&query="+e.query.toLowerCase()),e.contextualFilter&&(r+="&ft="+e.contextualFilter.toLowerCase()),r+="&sortField="+(e.sortField||""),r+="&isAscending="+(null===e.isAscending||void 0===e.isAscending?"":e.isAscending),e.filters)for(var i in e.filters)r+="&"+i+"="+e.filters[i];if(e.viewId&&(r+="&viewId="+e.viewId),e.groupBy&&(r+="&groupBy="+e.groupBy),!t&&e.itemSetProjections){var n="";for(var o in e.itemSetProjections)n+=o+"_"+e.itemSetProjections[o];r+="&projection="+n}return r},t.prototype.registerProjection=function(e,t){this._registeredProjections[e]=t},t.prototype._computeProjectedItemSet=function(e,t,r){var i=r.itemSetProjections,n=this._store.getItemSet(e),o=!n||n.isPlaceholder||n.isExpired||n.version!==t.version;if(o){n||(n=new m(e,r),n.item=t.item,n.isTokenBasedApi=t.isTokenBasedApi,n.isPlaceholder=t.isPlaceholder,n.isExpired=t.isExpired,n.version=t.version);for(var s in i){var a=this._registeredProjections[s];a&&a.projectItemSet(n,t,i[s])}this._store.setItemSet(e,n)}return n},t.prototype._handleMoveCopyItems=function(e){var t=this;return this.getItem({parentKey:e.targetKey}).then(function(r){var i=new d,n=(e.isMove?t._itemDataSource.moveItems:t._itemDataSource.copyItems).bind(t._itemDataSource),s=r.item,a=function(e,r){return n(e).then(function(i){return t.moveCopyOperationSuccess(i,r,e)},function(t){return g.moveCopyOperationFailure(t,r,e)})},u=f.observableArray(e.items).map(function(r){var n,u={items:[r],parentKey:e.parentKey,targetId:e.targetId,targetKey:e.targetKey,cid:e.cid,group:e.group,isMove:e.isMove,nameConflict:e.nameConflict,taskId:e.taskId,deleteSource:e.deleteSource,isAsync:e.isAsync,overrideLock:e.overrideLock};return n=t._operationProvider.register({name:r.name,type:e.isMove?p.moveItems:p.copyItems,iconName:r.iconName,payloads:{moveItems:{item:r,destination:s.peek(),source:r.parent},copyItems:{item:r,destination:s.peek(),source:r.parent}},batch:i,actions:{rename:{isAvailable:f.observable(!1),execute:function(){return u.nameConflict=y.rename,n.actions().rename.isAvailable(!1),n.actions().overwrite.isAvailable(!1),n.state(c.started),u.isAsync?g.handleMoveCopyAsyncItems(u,f.observableArray([n]),t._itemDataSource,t):a(u,[n])}},overwrite:{isAvailable:f.observable(!1),execute:function(){return u.nameConflict=y.overwrite,n.actions().rename.isAvailable(!1),n.actions().overwrite.isAvailable(!1),n.state(c.started),u.isAsync?g.handleMoveCopyAsyncItems(u,f.observableArray([n]),t._itemDataSource,t):a(u,[n])}},cancel:{isAvailable:f.observable(!1),execute:function(){return n.actions().rename.isAvailable(!1),n.actions().overwrite.isAvailable(!1),n.state(c.canceled),o.default.wrap(null)}},moveAnyway:{isAvailable:f.observable(!1),execute:function(){return u.deleteSource=!0,u.isMove=!1,u.isAsync=!0,n.actions().moveAnyway.isAvailable(!1),n.actions().rename.isAvailable(!1),n.actions().overwrite.isAvailable(!1),n.state(c.started),g.handleMoveCopyAsyncItems(u,f.observableArray([n]),t._itemDataSource,t)}},moveLockedFile:{isAvailable:f.observable(!1),execute:function(){return u.overrideLock=!0,n.actions().moveLockedFile.isAvailable(!1),t.moveItems(u)}}},progress:{minimum:0,maximum:1,current:0}})});return g.markAllOperationsAsStarted(u),a(e,u())})},t.prototype._getItem=function(e,r,i){var s=this,a=_.deepCopy(r),u=this._store.getItem(r.parentKey),l=this.getItemSetKey(r),c=r.itemSetProjections?this.getItemSetKey(r,!0):l,d=this._getItemSet(l,r),p=d&&d.content.peek().items,h=r.isTokenBasedApi||d&&d.isTokenBasedApi,f=!(i||!u||u.peek()[n.EXPIRED_ITEM_KEY]||!d||d.isExpired||d.isPlaceholder||r.requestAllChildren&&!v.resultSetHasData(p,{start:0,end:p.length})),g=r.startIndex||0,y=r.endIndex||g+(r.pageSize||b);if(y=p&&p.length>0?Math.min(p.length,y):y,g=Math.max(0,Math.min(y,g)),f&&(h||!r.skipInMemoryCache)&&v.resultSetHasData(p,{start:g,end:y}))return o.default.wrap(d);if(u&&u.peek().isStub){if(r.startKey){var S=this._store.getItem(r.startKey);S&&(d.content.peek().items.splice(0,d.content.peek().items.length,this._store.getItem(r.startKey)),d.isPlaceholder=!0,d.isExpired=!1,d.content.valueHasMutated())}return o.default.wrap(d)}this._normalizeContext(r,p,g,y,!f);var T=this._getRequestKey(r),x=this._pendingGetItemRequests[T];if(x)return x;var I=this._store.getNextRequestToken(c);return r.requestToken=I===C?"":I,h&&!I&&(r.startIndex=0),this._pendingGetItemRequests[T]=x=e.getItem(r).then(function(i){u=s._store.getItem(r.parentKey),d=s._store.getItemSet(c),f=!!u&&!!d;var o;if(o=f&&!d.isExpired?d.content.peek().items:[],i.nextRequestToken?(!r.requestToken&&o.length>i.totalChildren&&(o[i.totalChildren]=null),i.totalChildren+=t.TOKEN_BASED_API_EXTRA_ITEMS,s._store.setNextRequestToken(r.parentKey,c,i.nextRequestToken),h=!0,d&&(d.isTokenBasedApi=h)):s._store.setNextRequestToken(r.parentKey,c,C),r.requestToken&&(r.startIndex=o.length-t.TOKEN_BASED_API_EXTRA_ITEMS,i.totalChildren+=o.length-t.TOKEN_BASED_API_EXTRA_ITEMS),i.item&&i.totalChildren>=0){o.length>0&&0===i.totalChildren?o=[]:o.length=i.totalChildren;for(var p=void 0!==i.startIndex?i.startIndex:r.startIndex,g=0,y=0;g<o.length;g++)g>=p&&y<i.children.length&&(o[g]=s._store.getItem(i.children[y].key),y++)}if(i.item){f||(d=new m(c,r),d.item=s._store.getItem(r.parentKey),d&&(d.isTokenBasedApi=h,s._store.setItemSet(c,d))),d.sortField=i.sortField,d.isAscending=i.isAscending,d.isPlaceholder=!1,d.isExpired=!1,r.needSchema!==!1&&d.schema(i.schema&&(i.schema.length>0?i.schema:[]));var S=i.groupings;r.mergeGroupings&&(S=s._mergeGroupings(d.content.peek().groupings,i.groupings)),d.contentTypes(i.contentTypes),d.content({items:o,groupings:S}),d.version++,u&&(u.peek()[n.EXPIRED_ITEM_KEY]=!1)}if(delete s._pendingGetItemRequests[T],r.requestAllChildren&&!v.resultSetHasData(o,{start:0,end:i.totalChildren})){var x=_.deepCopy(r);return x.startIndex+=b,s._getItem(e,x)}return i.isFromBrowserCache?(a.skipCache=!0,s._getItem(e,a,!0)):(r.itemSetProjections&&(d=s._computeProjectedItemSet(l,d,r)),d)},function(e){return delete s._pendingGetItemRequests[T],o.default.wrapError(e)}),x},t.prototype._mergeGroupings=function(e,t){var r=e;if(r&&r.length>0){if(t&&t.length>0)for(var i=0;i<t.length;i++){for(var n=r[i].itemGroups,o=r[i].isAllCollapsed.peek(),s=t[i].itemGroups,a=0;a<s.length;a++){var u=s[a],l=!1;o&&u.state({isCollapsed:!0});for(var c=0;c<n.length;c++){var d=n[c];if(u.groupingId===d.groupingId){if(d.count=u.count,u.state){var p=u.state.peek().isCollapsed;d.state.peek().isCollapsed!==p&&d.state({isCollapsed:p})}l=!0;break}}l||n.push(u)}r[i].itemGroups=n}}else r=t;return r},t.prototype._normalizeContext=function(e,t,r,i,n){var o=e.pageSize||b;if(!e.avoidSeamSnapping){var s=r-r%o===i-i%o;if(n||s)e.startIndex=r-r%o;else{for(;i>r&&t&&t[r];)r++;e.startIndex=r-r%o}}if(void 0===e.pageSize||null===e.pageSize)for(e.pageSize=b;i-e.startIndex>e.pageSize;)e.pageSize+=b},t.prototype._getRequestKey=function(e){var t=this.getItemSetKey(e,!0);return t+="&startIndex="+e.startIndex,t+="&pageSize="+e.pageSize},t.prototype._previewChanges=function(e,t){var r=new i(e.key);f.utils.extend(r,e),t(r),r.isPreview=!0,this._store.setItem(r)},t.prototype._getItemSet=function(e,t){var r=this._store.getItemSet(e);if(t.itemSetProjections){var i=this.getItemSetKey(t,!0),n=this._store.getItemSet(i);n&&(r=this._computeProjectedItemSet(e,n,t))}return r},t.TOKEN_BASED_API_EXTRA_ITEMS=5,t}(r);return x}),define("odsp-utilities/logging/UnhandledErrorHandler",["require","exports","./events/UnhandledError.event"],function(e,t,r){function i(e,t){return e&&e.length>t&&(e=e.substr(0,t-3)+"..."),e}function n(e){var t;if(e){var r=e&&e.toString?e.toString():"InvalidMethod()",n=8===r.indexOf(" ")?9:0,o=r.indexOf(")")+1;if(t=r.substring(n,o),0===t.indexOf("function")||t.indexOf("(")<3){var s=o+u;r=r.replace(/\s\s*/g," "),t=i(r,s)+(s<r.length?"}":"")}}return t}function o(){for(var e=[],t=arguments.callee;t===s||t===o;)try{t=t?t.caller:t}catch(r){t=null}for(var i=0;t&&a>i;){e.push(n(t));try{t=t.caller}catch(r){t=null}i++}return e}function s(e,t,i,n,s){try{window.parent&&window.parent.opener&&"LogOnError"in window.parent.opener&&Function.prototype.apply.call(window.parent.opener.LogOnError,window.parent.opener,[e,t,i,n,s])}catch(a){}var u=s&&s.stack,l=o().join("\n");u=u?u.replace(/[ \t]{2,}/g," "):"",l=l.replace(/[ \t]{2,}/g," ");var c={message:e,url:t,line:i,col:n,stack:u,builtStack:l};r.UnhandledError.logData(c)}var a=10,u=50;window.onerror=s}),define("odsp-shared/utilities/logging/KnockoutErrorHandler",["require","exports","odsp-utilities/logging/ErrorHelper","knockout"],function(e,t,r,i){i.onError=function(e){r.log(e)}});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("odsp-utilities/logging/events/UnhandledPromise.event",["require","exports","odsp-utilities/logging/SingleEventBase","odsp-utilities/logging/Manager"],function(e,t,r,i){var n=function(e){function t(t){e.call(this,"UnhandledPromise,","UnhandledPromise",t)}return __extends(t,e),t.enabled=function(){return i.default.evaluateSamplingRampValue("UnhandledPromiseLogging")},t.logData=function(e,i){return r.SingleEventBase._logData(t,e,i)},t.prototype.isEnabled=function(){return i.default.evaluateSamplingRampValue("UnhandledPromiseLogging")},t.prototype.setSingleData=function(e){this.data.message=this.cleanString(e.message),this.data.extraData=this.cleanString(e.extraData)},t.fullName="UnhandledPromise,",t.shortName="UnhandledPromise",t.metadata={message:{type:"String",isMetric:!1},extraData:{type:"String",isMetric:!1}},t}(r.SingleEventBase);t.UnhandledPromise=n,n.prototype.metadata=n.metadata,Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-utilities/logging/PromiseErrorHandler",["require","exports","./ErrorHelper","../async/Async","../async/Promise","../events/EventGroup","../object/ObjectUtil","../logging/events/UnhandledPromise.event"],function(e,t,r,i,n,o,s,a){var u=function(){function e(){this._outstandingPromiseErrors={},this._async=new i}return e.prototype.log=function(e){var t=this,i=e.id;return e.parent?void(e.handler&&delete this._outstandingPromiseErrors[i]):(this._outstandingPromiseErrors[i]=e,void(1===Object.keys(this._outstandingPromiseErrors).length&&this._async.setTimeout(function(){var e=t._outstandingPromiseErrors;t._outstandingPromiseErrors={},Object.keys(e).forEach(function(t){var i=e[t],o=i.exception?i.exception:i.error;if(o instanceof Error||o&&o.stack?n.default.isCanceled(i)||r.log(o):a.UnhandledPromise.logData({message:"Promise with no error callback",extraData:s.safeSerialize(o)}),window.console&&console.log){var u="Promise with no error callback:"+i.id;console.warn?console.warn(u):console.log(u),console.log(i),o&&o.stack&&console.log(o.stack)}})},0)))},e}(),l=new u,c=new o(l);c.on(n.default,"error",l.log)}),define("odsp-utilities/logging/ErrorUI",["require","exports","./Manager","./events/UnhandledError.event","./events/CaughtError.event","./events/QosError.event","./events/RequireJSError.event","./EventBase"],function(e,t,r,i,n,o,s,a){}),function(){"use strict";/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */
function e(t,i){function n(e,t){return function(){return e.apply(t,arguments)}}var o;if(i=i||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=i.touchBoundary||10,this.layer=t,this.tapDelay=i.tapDelay||200,this.tapTimeout=i.tapTimeout||700,!e.notNeeded(t)){for(var s=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=this,u=0,l=s.length;l>u;u++)a[s[u]]=n(a[s[u]],a);r&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,r,i){var n=Node.prototype.removeEventListener;"click"===e?n.call(t,e,r.hijacked||r,i):n.call(t,e,r,i)},t.addEventListener=function(e,r,i){var n=Node.prototype.addEventListener;"click"===e?n.call(t,e,r.hijacked||(r.hijacked=function(e){e.propagationStopped||r(e)}),i):n.call(t,e,r,i)}),"function"==typeof t.onclick&&(o=t.onclick,t.addEventListener("click",function(e){o(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,r=navigator.userAgent.indexOf("Android")>0&&!t,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,n=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),o=i&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(i&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!r;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var r,i;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),i=t.changedTouches[0],r=document.createEvent("MouseEvents"),r.initMouseEvent(this.determineEventType(e),!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),r.forwardedTouchEvent=!0,e.dispatchEvent(r)},e.prototype.determineEventType=function(e){return r&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;i&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,r;if(t=e.fastClickScrollParent,!t||!t.contains(e)){r=e;do{if(r.scrollHeight>r.offsetHeight){t=r,e.fastClickScrollParent=r;break}r=r.parentElement}while(r)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,r,o;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),r=e.targetTouches[0],i){if(o=window.getSelection(),o.rangeCount&&!o.isCollapsed)return!0;if(!n){if(r.identifier&&r.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=r.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=r.pageX,this.touchStartY=r.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],r=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>r||Math.abs(t.pageY-this.touchStartY)>r?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,s,a,u,l,c=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,s=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,o&&(l=e.changedTouches[0],c=document.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset)||c,c.fastClickScrollParent=this.targetElement.fastClickScrollParent),a=c.tagName.toLowerCase(),"label"===a){if(t=this.findControl(c)){if(this.focus(c),r)return!1;c=t}}else if(this.needsFocus(c))return e.timeStamp-s>100||i&&window.top!==window&&"input"===a?(this.targetElement=null,!1):(this.focus(c),this.sendClick(c,e),i&&"select"===a||(this.targetElement=null,e.preventDefault()),!1);return i&&!n&&(u=c.fastClickScrollParent,u&&u.fastClickLastScrollTop!==u.scrollTop)?!0:(this.needsClick(c)||(e.preventDefault(),this.sendClick(c,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;r&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,i,n,o;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!r)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(i>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(n=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),n[1]>=10&&n[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(o=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],o>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,r){return new e(t,r)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("fastclick",[],function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),define("odsp-next/utilities/fastclick/FastClickLoader",["require","exports","fastclick","odsp-utilities/logging/ErrorHelper"],function(e,t,r,i){return document.body?r.attach(document.body):"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){try{r.attach(document.body)}catch(e){i.log(e)}},!1),r}),define("odsp-shared/utilities/knockout/LocalBindingProvider",["require","exports","knockout"],function(e,t,r){var i=function(){function e(){this._originalProvider=new r.bindingProvider,this._bindingHandlers={},this._bindingContexts=[]}return e.getInstance=function(){return e._instance},e.prototype.nodeHasBindings=function(e){return this._originalProvider.nodeHasBindings(e)},e.prototype.getBindings=function(e,t){try{this._bindingContexts.push(t);var r=this._originalProvider.getBindings(e,t);return r&&this._remapKeys(r,t)}finally{this._bindingContexts.pop()}},e.prototype.getBindingAccessors=function(e,t){try{this._bindingContexts.push(t);var r=this._originalProvider.getBindingAccessors(e,t);return r&&this._remapKeys(r,t)}finally{this._bindingContexts.pop()}},e.prototype.getBindingHandler=function(e){var t=this._bindingContexts.slice(-1)[0];if(t){var i=this._getLocalBindingHandlers(t);if(i){var n=i[e];e=n&&this.getUniqueKeyForBindingHandler(n,e)||e}}return this._bindingHandlers[e]||r.bindingHandlers[e]},e.prototype.getUniqueKeyForBindingHandler=function(t,i){var n=e._BINDING_PROVIDER_UNIQUE_KEY,o=t[n]=t[n]||i+"-local-"+ ++e._lastUniqueKeyOrdinal;return this._bindingHandlers[o]={init:t.init&&t.init.bind(t),update:t.update&&t.update.bind(t),options:t.options,preprocess:t.preprocess&&t.preprocess.bind(t)},this._bindingHandlers[o].after=t.after,t.supportsVirtualElements&&(r.virtualElements.allowedBindings[o]=!0),o},e.prototype._remapKeys=function(e,t){var r=e,i=this._getLocalBindingHandlers(t);if(i){r={};for(var n in e){var o=i[n],s=o&&this.getUniqueKeyForBindingHandler(o,n)||n;r[s]=e[n]}}return r},e.prototype._getLocalBindingHandlers=function(e){for(var t;!(t="object"==typeof e.$data&&e.$data.bindingHandlers)&&e.$parentContext;)e=e.$parentContext;return t},e._instance=new e,e._BINDING_PROVIDER_UNIQUE_KEY="__localBindingProvider__uniqueKey",e._lastUniqueKeyOrdinal=0,e}(),n=i.getInstance();return r.getBindingHandler=n.getBindingHandler.bind(n),r.bindingProvider.instance=n,i}),define("odsp-next/ODBOneDrive",["require","exports","knockout","odsp-shared/utilities/resources/ResourceScope","./resources/ControlResourceKeys","./resources/DataSourceResourceKeys","./resources/LoggingResourceKeys","./resources/ModelResourceKeys","./resources/ProviderResourceKeys","./resources/SPOResourceKeys","./resources/UtilityResourceKeys","./dataSources/base/odb/DataSource","./dataSources/item/odb/DocsInCommonDataSource","./dataSources/download/odb/DownloadDataSource","./dataSources/folderItemCount/odb/FolderItemCountDataSource","./providers/folderItemCount/FolderItemCountProvider","./dataSources/mobileAppPath/BaseIOSMobilePathDataSource","./dataSources/identity/odb/IdentityDataSource","./providers/identity/IdentityProvider","./dataSources/itemActivity/odb/ItemActivityDataSource","./providers/itemActivity/ItemActivityProvider","./models/store/ItemsStore","./models/suiteNav/SuiteNavLinkIds","./dataSources/item/odb/ListDataSource","./providers/operation/OperationProvider","./dataSources/peoplePicker/odb/PeoplePickerDataSource","./providers/peoplePicker/PeoplePickerProvider","./dataSources/policyTip/odb/PolicyTipDataSource","./dataSources/item/odb/RecentDataSource","./dataSources/search/odb/SearchDataSource","./providers/search/SearchProvider","./dataSources/settings/odb/SettingsDataSource","./dataSources/shareByLink/odb/ShareByLinkDataSource","./providers/shareByLink/ShareByLinkProvider","./dataSources/item/odb/SharedWithMeDataSource","./dataSources/sharing/odb/SharingDataSource","./providers/item/ShortcutProvider","./dataSources/suiteNav/odb/SuiteNavDataSource","./providers/suiteNav/SuiteNavProvider","./dataSources/url/odb/UrlDataSource","./dataSources/versionControl/odb/VersionControlDataSource","./utilities/navigation/Navigation","./controls/infoPane/sections/BaseInfoPaneSectionsMap","odsp-utilities/browser/PlatformDetection","./utilities/logging/odb/RUMOneHelper","odsp-next/utilities/logging/odb/BeaconHelper","./utilities/features/Features","./utilities/newFeatureExperience/NewFeatureExperienceEnabler","./providers/item/ItemProvider","odsp-utilities/logging/UnhandledErrorHandler","odsp-utilities/logging/RequireJSErrorHandler","odsp-shared/utilities/logging/KnockoutErrorHandler","odsp-utilities/logging/PromiseErrorHandler","odsp-utilities/logging/ErrorUI","./utilities/fastclick/FastClickLoader","./controls/oneDriveApp/OneDriveApp","odsp-shared/utilities/knockout/ResourceComponentLoader","odsp-shared/utilities/knockout/LocalBindingProvider"],function(e,t,r,i,n,o,s,a,u,l,c,d,p,h,m,f,g,y,v,_,S,T,b,C,x,I,E,D,w,P,R,O,k,U,F,A,N,M,L,B,q,V,K,H,j,W,G,z,Q){var Y=function(){function e(){W.beaconCacheAddToLoggingManager("ODBNext"),this.resourceScope=new i,this.hostSettings=this.resourceScope.expose(l.hostSettings,window._spPageContextInfo),this.resourceScope.expose(l.context,d.getContext(this.hostSettings)),this.navigation=this.resourceScope.expose(c.navigation,new V),this.resourceScope.expose(o.settings,new O),this.resourceScope.expose(o.people,new(this.resourceScope.injected(I))(this.hostSettings)),this.resourceScope.expose(u.people,new(this.resourceScope.injected(E))),this.resourceScope.expose(o.policyTip,new(this.resourceScope.injected(D))(this.hostSettings)),this.resourceScope.expose(o.shareByLink,new(this.resourceScope.injected(k))(this.hostSettings)),this.resourceScope.expose(u.shareByLink,new(this.resourceScope.injected(U))),this.resourceScope.expose(o.folderItemCount,new(this.resourceScope.injected(m))(this.hostSettings)),this.resourceScope.expose(u.folderItemCount,new(this.resourceScope.injected(f))),this.resourceScope.expose(o.itemActivity,new(this.resourceScope.injected(_))(this.hostSettings)),this.resourceScope.expose(u.itemActivity,new(this.resourceScope.injected(S))),this.resourceScope.expose(o.search,new(this.resourceScope.injected(P))(this.hostSettings)),this.resourceScope.expose(u.search,new(this.resourceScope.injected(R))),this.resourceScope.expose(o.sharing,new(this.resourceScope.injected(A))(this.hostSettings)),this.resourceScope.expose(o.suiteNav,new(this.resourceScope.injected(M.SuiteNavDataSource))(this.hostSettings,{workloadId:b.ONEDRIVE,showMySiteSettings:!0,helpNamespace:"Groove",helpId:"ODB_Overview"})),this.resourceScope.expose(u.suiteNav,new(this.resourceScope.injected(L))),this.resourceScope.expose(s.rumOneHelper,new(this.resourceScope.injected(j))),this.resourceScope.expose(o.download,new(this.resourceScope.injected(h))(this.hostSettings)),this.resourceScope.expose(o.versionControl,new(this.resourceScope.injected(q))(this.hostSettings)),this.resourceScope.expose(n.infoPaneSectionsMap,new(this.resourceScope.injected(K))),this.resourceScope.expose(c.platformDetection,new H),this.resourceScope.expose(n.viewParams,r.observable({})),this.resourceScope.expose(u.operation,new(this.resourceScope.injected(x))),this.resourceScope.expose(u.teachingBubble,null),this.resourceScope.expose(o.identity,new(this.resourceScope.injected(y))),this.resourceScope.expose(u.identity,new(this.resourceScope.injected(v))),this.resourceScope.expose(u.shimmedControl,null),this.resourceScope.expose(o.footer,null),this.resourceScope.expose(u.instrumentation,null),this.resourceScope.expose(n.isDebugWindowVisible,r.observable(!0)),this.resourceScope.expose(o.url,new(this.resourceScope.injected(B)));var e=this.resourceScope.expose(a.itemsStore,new T);this.resourceScope.expose(o.items,new(this.resourceScope.injected(C.default))({itemsStore:e,hostSettings:this.hostSettings,listRootFolderWebRelativeUrl:"Documents"})),this.resourceScope.expose(u.shortcut,new(this.resourceScope.injected(N))),this.resourceScope.expose(o.sharedWithMe,new(this.resourceScope.injected(F))(e,this.hostSettings)),this.resourceScope.expose(o.docsInCommon,new(this.resourceScope.injected(p))(e,this.hostSettings)),this.resourceScope.expose(o.recycleBin,null),this.resourceScope.expose(o.searchItems,null),this.resourceScope.expose(o.recent,new(this.resourceScope.injected(w))(e,this.hostSettings)),this.resourceScope.expose(o.popular,null),this.resourceScope.expose(o.recentUnpopular,null),this.resourceScope.expose(o.iosMobileAppPath,new(this.resourceScope.injected(g))),this.resourceScope.expose(c.newFeatureExperienceEnabler,G.default.isFeatureEnabled(G.default.NewFeatureExperience)?new(this.resourceScope.injected(z))({resources:this.resourceScope}):null),this.resourceScope.expose(u.item,new(this.resourceScope.injected(Q)))}return e.prototype.main=function(){this._applyBindings()},e.prototype._applyBindings=function(){var e=document.createElement("div");e.setAttribute("data-bind","component: { name: 'ms-onedrive-app', params: $data }"),document.body.appendChild(e),r.applyBindings({resources:this.resourceScope},e)},e}();(new Y).main(),window.__ko=r});