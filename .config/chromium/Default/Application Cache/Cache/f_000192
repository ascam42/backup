define("odsp-next/bindings/toggle/ToggleBinding",["require","exports","knockout"],function(e,t,i){var o=function(){function e(){}return e.init=function(e,t,o,n,r){var s=t();i.applyBindingsToNode(e,{click:function(){return s(!s())}},r)},e}();return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/ComputedItemSelectionViewModel",["require","exports","../../resources/ControlResourceKeys","odsp-shared/base/ViewModel"],function(e,t,i,o){var n=function(e){function t(){e.call(this),this.selectionModel=this.resources.consume(i.itemsSelection),this._currentItem=this.resources.consume(i.currentItem),this.activeItem=this.createComputed(this._computeActiveItem)}return __extends(t,e),t.prototype.isActiveItemSelected=function(){return 1===this.selectionModel.selection().length},t.prototype._computeActiveItem=function(){var e,t=this.selectionModel.selection().length;return e=0===t?this._currentItem():1===t?this.selectionModel.selection()[0]():null},t}(o);return n}),define("odsp-next/controls/infoPane/sections/activitiesFeed/ActivitiesFeedKeyboardNav",["require","exports","knockout","../../../../models/itemActivity/ItemActivityType"],function(e,t,i,o){var n=function(){function e(){var e=this;this.keyboardOptions=[{target:null,mappings:{Left:this.keyLeft,Right:this.keyRight,Enter:this.onEnter,Space:this.onSpace}},{target:window,mappings:{}}],this.focusableTiles=i.observableArray([]),this.focusedItem=i.observable(),this.sectionHeaderFocus=i.observable(!1),this.sectionHeaderFocus.subscribe(function(t){t?e._focusFirstTile():e.focusedItem()&&e.focusedItem().focused(!1)})}return e.prototype.keyRight=function(e,t){return e.keyNav.trySetExpansion(e.keyNav,!0),t.stopPropagation(),!0},e.prototype.keyLeft=function(e,t){return e.keyNav.trySetExpansion(e.keyNav,!1),t.stopPropagation(),!0},e.prototype.onEnter=function(e,t){return e.keyNav.trySetExpansion(e.keyNav),t.stopPropagation(),!0},e.prototype.onSpace=function(e,t){return e.keyNav.onEnter(e,t)},e.prototype.trySetExpansion=function(e,t){var i=this,n=e.focusedItem();if(n&&n.type===o.aggregate){var r=n,s=r.expanded();if(r.expanded(void 0===t?!r.expanded():t),s!==t){var a=this.focusableTiles.indexOf(r);a>-1&&r.focused()&&(r.expanded()?r.activities.forEach(function(e){i.focusableTiles.splice(++a,0,e)}):a+1<this.focusableTiles().length&&this.focusableTiles.splice(a+1,r.activities.length))}}},e.prototype._focusFirstTile=function(){if(this.focusableTiles()&&this.focusableTiles().length>0){var e=this.focusableTiles()[0];e.focused(!0),this.focusedItem(e)}},e}();return n}),define("odsp-utilities/encoding/HtmlEncoding",["require","exports"],function(){var e=/[<>&'"\\]/g,t={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;","\\":"&#92;"},i=function(){function i(){}return i.encodeText=function(i){return i?i.replace(e,function(e){return t[e]}):""},i}();return i});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/itemActivityTile/HeadlineGenerator",["require","exports","odsp-shared/base/BaseModel","../../resources/ProviderResourceKeys","../../models/itemActivity/ItemActivityChangeType","../../models/itemActivity/ItemActivityType","./ItemActivityTile.resx","./ItemActivityTileAdd.resx","./ItemActivityTileEdit.resx","./ItemActivityTileMove.resx","./ItemActivityTileRemove.resx","./ItemActivityTileRename.resx","./ItemActivityTileRenameOrMove.resx","./ItemActivityTileRestore.resx","./ItemActivityTileShare.resx","odsp-utilities/encoding/HtmlEncoding","odsp-shared/utilities/string/StringHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v='<span class="ms-fontWeight-semibold">',b='<span class="od-ItemActivityTile-ellipsisWrapper">',x='<span class="od-ItemActivityTile-ellipsis" title="{0}">{0}</span>',y="</span>",_=function(e){function t(){e.call(this);var t=this.resources.consume(o.identity);this._userLoginName=t.getIdentity().loginName}return __extends(t,e),Object.defineProperty(t.prototype,"userLoginName",{get:function(){return this._userLoginName},enumerable:!0,configurable:!0}),t.prototype.generateHeadline=function(e){var t=null;if(e.type===r.aggregate){var i=e,o=this._encodeAggregate(i);t=this._generateAggregateHeadline(o)}else if(e.type===r.activity){var n=e,s=this._encodeActivity(n);t=this.generateActivityHeadline(s)}return t},t.prototype.generateActivityHeadline=function(e){var t=this._encodeActivity(e),i=null,o=this._ellipsisText(t.latestName),r=this._ellipsisText(t.previousName);switch(t.itemActivityChangeType){case n.add:i=this._generateAddHeadline(t,o,r);break;case n.edit:i=this._generateEditHeadline(t,o);break;case n.move:i=this._generateMoveHeadline(t,o);break;case n.remove:i=this._generateRemoveHeadline(t,o);break;case n.rename:i=this._generateRenameHeadline(t,o,r);break;case n.renameOrMove:i=this._generateRenameOrMoveHeadline(t,o);break;case n.restore:i=this._generateRestoreHeadline(t,o);break;case n.share:i=this._generateShareHeadline(t,o);break;default:i=s.strings.DataFetchError}return i},t.prototype._encodeAggregate=function(e){for(var t=new Array,i=0;i<e.editors.length;i++){var o=this._encodePerson(e.editors[i]);t.push(o)}for(var n=new Array,i=0;i<e.activities.length;i++){var r=this._encodeActivity(e.activities[i]);n.push(r)}var s={activities:n,editors:t,date:e.date,itemActivityChangeType:e.itemActivityChangeType,type:e.type};return s},t.prototype._encodeActivity=function(e){var t=this._encodePerson(e.editor),i=e.sharedWith,o=new Array;if(i)for(var n=0;n<e.sharedWith.length;n++){var r=this._encodePerson(e.sharedWith[n]);o.push(r)}var s={changeToken:g.encodeText(e.changeToken),editor:t,latestName:g.encodeText(e.latestName),latestFolder:g.encodeText(e.latestFolder),previousName:g.encodeText(e.previousName),previousFolder:g.encodeText(e.previousFolder),sharedWith:o,date:e.date,itemActivityChangeType:e.itemActivityChangeType,type:e.type};return s},t.prototype._encodePerson=function(e){var t={userId:g.encodeText(e.userId),email:g.encodeText(e.email),name:g.encodeText(e.name)};return t},t.prototype._generateAddHeadline=function(e,t){var i=a.strings,o=null;return o=!e.editor||f.isNullOrEmpty(e.editor.name)?f.format(i.AddItemNoEditors,b,t,y):e.editor.email===this._userLoginName?f.format(i.AddItemYou,v,y,b,t,y):f.format(i.AddItem,v,e.editor.name,y,b,t,y)},t.prototype._generateEditHeadline=function(e,t){var i=l.strings,o=null;return o=!e.editor||f.isNullOrEmpty(e.editor.name)?f.format(i.EditNoEditors,b,t,y):e.editor.email===this._userLoginName?f.format(i.EditYou,v,y,b,t,y):f.format(i.Edit,v,e.editor.name,y,b,t,y)},t.prototype._generateMoveHeadline=function(e,t){var i=d.strings,o=this._ellipsisText(e.latestFolder),n=this._ellipsisText(e.previousFolder),r=null,s=!f.isNullOrEmpty(e.latestFolder)&&!f.isNullOrEmpty(e.previousFolder),a=f.isNullOrEmpty(e.latestFolder)&&!f.isNullOrEmpty(e.previousFolder),l=!f.isNullOrEmpty(e.latestFolder)&&f.isNullOrEmpty(e.previousFolder);return r=!e.editor||f.isNullOrEmpty(e.editor.name)?s?f.format(i.MoveFromToNoEditors,b,t,y,b,n,y,b,o,y):a?f.format(i.MoveFromNoEditors,b,t,y,b,n,y):l?f.format(i.MoveToNoEditors,b,t,y,b,o,y):f.format(i.MoveNoEditors,b,t,y):e.editor.email===this._userLoginName?s?f.format(i.MoveFromToYou,v,y,b,t,y,b,n,y,b,o,y):a?f.format(i.MoveFromYou,v,y,b,t,y,b,n,y):l?f.format(i.MoveToYou,v,y,b,t,y,b,o,y):f.format(i.MoveYou,v,y,b,t,y):s?f.format(i.MoveFromTo,v,e.editor.name,y,b,t,y,b,n,y,b,o,y):a?f.format(i.MoveFrom,v,e.editor.name,y,b,t,y,b,n,y):l?f.format(i.MoveTo,v,e.editor.name,y,b,t,y,b,o,y):f.format(i.Move,v,e.editor.name,y,b,t,y)},t.prototype._generateRemoveHeadline=function(e,t){var i=c.strings,o=null;return o=!e.editor||f.isNullOrEmpty(e.editor.name)?f.format(i.RemoveNoEditors,b,t,y):e.editor.email===this._userLoginName?f.format(i.RemoveYou,v,y,b,t,y):f.format(i.Remove,v,e.editor.name,y,b,t,y)},t.prototype._generateRenameHeadline=function(e,t,i){var o=p.strings,n=null;return n=!e.editor||f.isNullOrEmpty(e.editor.name)?e.previousName?f.format(o.RenameFromToNoEditors,b,i,y,b,t,y):f.format(o.RenameToNoEditors,b,t,y):e.editor.email===this._userLoginName?e.previousName?f.format(o.RenameFromToYou,v,y,b,i,y,b,t,y):f.format(o.RenameToYou,v,y,b,t,y):e.previousName?f.format(o.RenameFromTo,v,e.editor.name,y,b,i,y,b,t,y):f.format(o.RenameTo,v,e.editor.name,y,b,t,y)},t.prototype._generateRenameOrMoveHeadline=function(e,t){var i=u.strings,o=null;return o=!e.editor||f.isNullOrEmpty(e.editor.name)?f.format(i.RenameOrMoveNoEditors,b,t,y):e.editor.email===this._userLoginName?f.format(i.RenameOrMoveYou,v,y,b,t,y):f.format(i.RenameOrMove,v,e.editor.name,y,b,t,y)},t.prototype._generateRestoreHeadline=function(e,t){var i=h.strings,o=null;return o=!e.editor||f.isNullOrEmpty(e.editor.name)?f.format(i.RestoreNoEditors,b,t,y):e.editor.email===this._userLoginName?f.format(i.RestoreYou,v,y,b,t,y):f.format(i.Restore,v,e.editor.name,y,b,t,y)},t.prototype._generateShareHeadline=function(e,t){var i=null;return i=!e.editor||f.isNullOrEmpty(e.editor.name)?this._generateNoEditorSharedWith(e.editor,e.sharedWith,t):e.editor.email===this._userLoginName?this._generateYouSharedWith(e.sharedWith,t):this._generateSharedWith(e.editor,e.sharedWith,t)},t.prototype._generateNoEditorSharedWith=function(e,t,i){var o=m.strings,n=null;switch(t.length){case 0:n=f.format(o.ShareNoEditors,b,i,y);break;case 1:n=f.format(o.ShareWithNoEditorsOnePerson,b,i,y,t[0].name);break;case 2:n=f.format(o.ShareWithNoEditorsTwoPersons,b,i,y,t[0].name,t[1].name);break;default:var r=f.getLocalizedCountValue(o.ShareWithNoEditorsMultiplePersons,o.ShareWithNoEditorsMultiplePersonsIntervals,t.length-2);n=f.format(r,b,i,y,t[0].name,t[1].name,String(t.length-2))}return n},t.prototype._generateSharedWith=function(e,t,i){var o=m.strings,n=null;if(t)switch(t.length){case 0:n=f.format(o.ShareWithNoPersons,v,e.name,y,b,i,y);break;case 1:n=f.format(o.ShareWithOnePerson,v,e.name,y,b,i,y,t[0].name);break;case 2:n=f.format(o.ShareWithTwoPersons,v,e.name,y,b,i,y,t[0].name,t[1].name);break;default:var r=f.getLocalizedCountValue(o.ShareWithMultiplePersons,o.ShareWithMultiplePersonsIntervals,t.length-2);n=f.format(r,v,e.name,y,b,i,y,t[0].name,t[1].name,String(t.length-2))}else n=f.format(o.ShareWithNoPersons,v,e.name,y,b,i,y);return n},t.prototype._generateYouSharedWith=function(e,t){var i=m.strings,o=null;if(e)switch(e.length){case 0:o=f.format(i.ShareWithNoPersonsYou,v,y,b,t,y);break;case 1:o=f.format(i.ShareWithOnePerson,v,y,b,t,y,e[0].name);break;case 2:o=f.format(i.ShareWithMultiplePersonsYou,v,y,b,t,y,e[0].name,e[1].name);break;default:var n=f.getLocalizedCountValue(i.ShareWithMultiplePersonsYou,i.ShareWithMultiplePersonsYouIntervals,e.length-2);o=f.format(n,v,y,b,t,y,e[0].name,e[1].name,String(e.length-2))}else o=f.format(i.ShareWithNoPersonsYou,v,y,b,t,y);return o},t.prototype._generateAggregateHeadline=function(e){var t=null,i=e.editors,o=l.strings;if(e.itemActivityChangeType===n.edit&&o)if(this._didYouEdit(e.editors))t=this._generateAggregateHeadlineYou(e);else switch(i.length){case 0:t=f.format(o.AggregateNoEditors);break;case 1:t=f.format(o.AggregateOneEditor,v,i[0].name,y);break;case 2:t=f.format(o.AggregateTwoEditors,v,i[0].name,y,v,i[1].name,y);break;default:var r=f.getLocalizedCountValue(o.AggregateMultipleEditors,o.AggregateMultipleEditorsIntervals,i.length-2);t=f.format(r,v,i[0].name,i[1].name,y,String(i.length-2))}else t=s.strings.DataFetchError;return t},t.prototype._generateAggregateHeadlineYou=function(e){var t,i,o=this,r=l.strings,a=null,d=e.editors;if(d.some(function(e){return e.email===o._userLoginName?(t=e,!0):void 0}),i=d.indexOf(t),i>-1&&(d.splice(i,1),d.unshift(t)),e.itemActivityChangeType===n.edit&&r)switch(d.length){case 1:a=f.format(r.AggregateEditYou,v,y);break;case 2:a=f.format(r.AggregateTwoEditorsYou,v,y,v,d[1].name,y);break;default:var c=f.getLocalizedCountValue(r.AggregateMultipleEditorsYou,r.AggregateMultipleEditorsYouIntervals,d.length-2);a=f.format(c,v,d[1].name,y,String(d.length-2))}else a=s.strings.DataFetchError;return a},t.prototype._ellipsisText=function(e){return f.format(x,e)},t.prototype._didYouEdit=function(e){var t=this;return e.some(function(e){return e.email===t._userLoginName})},t}(i);return _});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/activitiesFeed/ActivitiesFeedHelper",["require","exports","knockout","odsp-shared/base/BaseModel","../../../../models/itemActivity/ItemActivityType","../../../../utilities/datetime/DateTime","../../../../controls/itemActivityTile/HeadlineGenerator","../../../../utilities/locale/Locale"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(){e.call(this),this._headlineGenerator=new(this.managed(s))}return __extends(t,e),t.prototype.convertToTile=function(e,t){var o;if(e.type===n.aggregate){for(var s=e,l=this._getMainEditor(s.editors),d=new Array,c=0,p=s.activities;c<p.length;c++){var u=p[c],h={date:u.date.toLocaleTimeString(a.language,{hour:"numeric",minute:"2-digit"}),editor:u.editor,focused:i.observable(!1),headline:this._headlineGenerator.generateActivityHeadline(u),type:n.activity};d.push(h)}o={activities:d,date:r.GetRelativeDateTimeStringPastWithHourMinute(e.date),editor:l,expanded:i.observable(!1),focused:i.observable(!1),headline:this._headlineGenerator.generateHeadline(s),index:t,type:n.aggregate}}else if(e.type===n.activity){var m=e;o={date:r.GetRelativeDateTimeStringPastWithHourMinute(e.date),editor:m.editor,focused:i.observable(!1),headline:this._headlineGenerator.generateActivityHeadline(m),index:t,type:n.activity}}return o},t.prototype._getMainEditor=function(e){var t,i=this;return e.some(function(e){var o=e.email===i._headlineGenerator.userLoginName;return o&&(t=e),o}),!t&&e.length>0&&(t=e[0]),t},t}(o);return l}),define("odsp-next/providers/itemActivity/ItemActivityAggregator",["require","exports","../../models/itemActivity/ItemActivityType","odsp-shared/utilities/string/StringHelper","../../models/itemActivity/ItemActivityChangeType"],function(e,t,i,o,n){var r=function(){function e(){}return e.process=function(e){for(var t=new Array,o=0;o<e.length;o++)this._addActivity(e[o],t);var n=t.length,r=0===n;if(!r){var s=t[n-1];if(s.type===i.aggregate){var a=s;a.activities.length>1?this._sort(a.activities):this._downgrade(a.activities,t)}}return t},e._addActivity=function(e,t){var o=t.length,r=0===o,s=!1,a=null;if(!r&&(a=t[o-1],s=a.itemActivityChangeType!==e.itemActivityChangeType||a.date.toDateString()!==e.date.toDateString(),s&&a.type===i.aggregate)){var l=a;l.activities.length>1?this._sort(l.activities):this._downgrade(l.activities,t)}if(e.itemActivityChangeType!==n.edit)t.push(e);else if(r||s){var l=this._create(e);t.push(l)}else this._update(a,e)},e._downgrade=function(e,t){1===e.length&&(t.pop(),t.push(e[0]))},e._sort=function(e){e.sort(function(e,t){return e.date.getTime()<t.date.getTime()?1:e.date.getTime()>t.date.getTime()?-1:e.changeToken.localeCompare(t.changeToken)})},e._create=function(e){var t=new Array;o.isNullOrEmpty(e.editor.name)||t.push(e.editor);var n=new Array;n.push(e);var r={activities:n,date:e.date,editors:t,itemActivityChangeType:e.itemActivityChangeType,type:i.aggregate};return r},e._update=function(e,t){var i=e.editors.some(function(e){var i=!0;for(var o in t.editor)i=i&&t.editor[o]===e[o];return i});i||e.editors.push(t.editor),e.itemActivityChangeType=t.itemActivityChangeType,e.activities.push(t)},e}();return r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/activitiesFeed/ActivitiesFeedViewModel",["require","exports","knockout","../../../../bindings/html/BindableHtmlBinding","../../../../resources/ControlResourceKeys","../../../../models/itemActivity/ItemActivityChangeType","../../../../models/item/ItemType","../../../../resources/DataSourceResourceKeys","../../../../utilities/datetime/DateTime","../../ComputedItemSelectionViewModel","./ActivitiesFeed.resx","./ActivitiesFeedKeyboardNav","./ActivitiesFeedHelper","../../../../providers/itemActivity/ItemActivityAggregator","odsp-shared/utilities/string/StringHelper","../../../../bindings/toggle/ToggleBinding","../../../../bindings/selection/SelectionBinding","../../../../bindings/keyboard/KeyboardBinding"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v){var b=500,x='<a href="#">',y="</a>",_=function(e){function t(){e.call(this),this.addBindingHandlers({bindableHtml:o,keyboard:v,toggle:g,selection:f}),this._helper=new(this.managed(u)),this.keyNav=new p,this.itemAggregatesThisWeek=i.observableArray([]),this.itemAggregatesLastWeek=i.observableArray([]),this.itemAggregatesEarlier=i.observableArray([]),this.resxStrings=i.observable(c.strings),this.isExpanded=i.observable(!0),this.hasChanges=i.observable(!0),this.showForEarlierChangesMsg=i.observable(!1),this.forEarlierChangesMsg=m.format(c.strings.ForEarlierChanges,x,y),this._itemActivityProvider=this.resources.consume(a.itemActivity),this._itemActivityProvider&&(this._itemActivityQueryParams={add:!0,deleteObject:!0,fetchLimit:b,group:!0,item:!0,latestFirst:!0,move:!0,rename:!0,restore:!0,roleAssignmentAdd:!0,roleDefinitionAdd:!0,update:!0,user:!0},this.subscribe(this.activeItem,this._updateActivities),this._getInitialActivities())}return __extends(t,e),t.prototype.onFileVersionClick=function(){return this._executeFileVersion(this.activeItem()),!1},t.prototype._executeFileVersion=function(){var e=this.resources.consume(n.actionMap),t=new(this.managed(e.ShowVersionHistoryAction))({});t.execute(null)},t.prototype._getInitialActivities=function(){var e=i.utils.unwrapObservable(this.activeItem);e&&this._updateActivities(e)},t.prototype._updateActivities=function(e){var t=this;this.itemAggregatesThisWeek.removeAll(),this.itemAggregatesLastWeek.removeAll(),this.itemAggregatesEarlier.removeAll(),this.keyNav.focusableTiles.removeAll();var i=e.type===s.Folder&&!this.isActiveItemSelected();this._itemActivityProvider.getItemActivities(e,this._itemActivityQueryParams,i).done(function(i){if(t.hasChanges(0!==i.length),t.hasChanges())for(var o=h.process(i),n=0;n<o.length;n++){var a=o[n],d=t._helper.convertToTile(a,n),c=a.date;l.IsThisWeek(c)?t.itemAggregatesThisWeek.push(d):l.IsLastWeek(c)?t.itemAggregatesLastWeek.push(d):t.itemAggregatesEarlier.push(d),t.keyNav.focusableTiles.push(d)}var p=e.type===s.File&&(!t.hasChanges()||t.hasChanges()&&i[i.length-1].itemActivityChangeType!==r.add);t.showForEarlierChangesMsg(p)})},t}(d);return _}),define("odsp-next/controls/infoPane/sections/activitiesFeed/ActivitiesFeed.html",[],function(){return'<div class="InfoPane-section InfoPaneSection--activitiesfeed" data-bind="keyboard: keyNav.keyboardOptions, css: { \'is-expanded\': isExpanded }, selection: { data: keyNav.focusableTiles, mode: \'single\', direction: \'vertical\', focused: keyNav.focusedItem }"><div class=InfoPane-sectionHeader id=od-ActivitiesFeed-sectionHeader tabindex=0 data-bind="hasFocus: keyNav.sectionHeaderFocus, toggle: isExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: resxStrings().ActivitiesHeader"></span></div><div class=InfoPane-sectionContent role=tree><!--ko if: itemAggregatesThisWeek().length > 0--><div class="od-ActivitiesFeed-listTitle ms-font-mi ms-fontColor-neutralTertiaryAlt ms-fontWeight-semibold" data-bind="text: resxStrings().ActivitiesFeedThisWeekListText"></div><div class=od-ActivitiesFeed-list><div data-bind="foreach: { data: itemAggregatesThisWeek, as: \'activity\' }"><ms-item-activity-tile params="activity: activity"></ms-item-activity-tile></div></div><!--/ko--><!--ko if: itemAggregatesLastWeek().length > 0--><div class="od-ActivitiesFeed-listTitle ms-font-mi ms-fontColor-neutralTertiaryAlt ms-fontWeight-semibold" data-bind="text: resxStrings().ActivitiesFeedLastWeekListText"></div><div class=od-ActivitiesFeed-list><div data-bind="foreach: { data: itemAggregatesLastWeek, as: \'activity\' }"><ms-item-activity-tile params="activity: activity"></ms-item-activity-tile></div></div><!--/ko--><!--ko if: itemAggregatesEarlier().length > 0--><div class="od-ActivitiesFeed-listTitle ms-font-mi ms-fontColor-neutralTertiaryAlt ms-fontWeight-semibold" data-bind="text: resxStrings().ActivitiesFeedEarlierListText"></div><div class=od-ActivitiesFeed-list><div data-bind="foreach: { data: itemAggregatesEarlier, as: \'activity\' }"><ms-item-activity-tile params="activity: activity"></ms-item-activity-tile></div></div><!--/ko--></div><div class=InfoPane-sectionContent><!--ko ifnot: hasChanges()--><span class="od-ActivitiesFeed-noChange ms-font-s" data-bind="text: resxStrings().NoChange"></span><!--/ko--><!--ko if: showForEarlierChangesMsg()--><span class="od-ActivitiesFeed-sectionForEarlierChanges ms-font-s" data-bind="bindableHtml: forEarlierChangesMsg, click: onFileVersionClick, clickBubble: false"></span><!--/ko--></div></div>'}),define("odsp-next/controls/infoPane/sections/activitiesFeed/ActivitiesFeed.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ActivitiesFeed-sectionForEarlierChanges{margin-top:15px}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/scrollIntoView/ScrollIntoViewBinding",["require","exports","../BaseBinding","knockout","../scrollContainer/ScrollContainerBinding"],function(e,t,i,o,n){var r=function(e){function t(t){var i=this;e.call(this,t);var n=this._getScrollContainerElement(),r=this.element;this.createComputed(function(){var e=o.unwrap(i.valueAccessor());if(e.isSelected()){var t=n.scrollTop,s=t+n.offsetHeight,a=r.offsetTop,l=a+r.offsetHeight;t>a?n.scrollTop=a:l>s&&(n.scrollTop=l-n.offsetHeight)}})}return __extends(t,e),t.prototype._getScrollContainerElement=function(){for(var e=this.element;!o.utils.domData.get(e,n.SCROLL_CONTAINER_KEY)&&e.parentElement;)e=e.parentElement;return o.utils.domData.get(e,n.SCROLL_CONTAINER_KEY)&&e||this.element.parentElement},t}(i);return r}),define("odsp-shared/utilities/knockout/Renderers",["require","exports","knockout"],function(e,t,i){function o(e,t){"use strict";var o=document.createElement("div");o.innerHTML=t,i.applyBindings(e,o);var n=o.textContent;return i.cleanNode(o),n}t.renderText=o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/itemActivityTile/ItemActivityTileViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../bindings/html/BindableHtmlBinding","../../models/itemActivity/ItemActivityType","./ItemActivityTile.resx","../../bindings/scrollIntoView/ScrollIntoViewBinding","odsp-shared/utilities/string/StringHelper","../../bindings/toggle/ToggleBinding","odsp-shared/utilities/knockout/Renderers"],function(e,t,i,o,n,r,s,a,l,d,c){var p=function(e){function t(t){if(e.call(this,t),this.addBindingHandlers({bindableHtml:n,scrollIntoView:a,toggle:d}),this.tile=t.activity,this._initObservables(),this.accessibleLabel=this.createComputed(this._computeAccessibleLabel),this.expanded=i.observable(!1),this.isAggregate=!1,this.tile.type===r.aggregate){this.isAggregate=!0;var o=this.tile;this.activities=o.activities}}return __extends(t,e),t.prototype._initObservables=function(){var e=this;if(this.tile.type===r.aggregate){var t=this.tile;this.addDisposable(t.expanded.subscribe(function(t){e.expanded(t)}))}},t.prototype._computeAccessibleLabel=function(){var e,t,i=c.renderText(this,this.tile.headline),o=s.strings;return 0===this.tile.index?this.tile.type===r.activity?t=o.FirstActivityAccessibleLabel:this.tile.type===r.aggregate&&(t=o.FirstAggregateAccessibleLabel):t=this.tile.type===r.aggregate?o.AggregateAccessibleLabel:o.ActivityAccessibleLabel,e=l.format(t,i,this.tile.date)},t}(o);return p}),define("odsp-next/controls/itemActivityTile/ItemActivityTile.html",[],function(){return'<div class=od-ItemActivityTile-section data-bind="css: { \'is-expanded\': expanded }, scrollIntoView: { isSelected: tile.focused || expanded }"><div class="od-ItemActivityTile-sectionHeader ms-font-s" role=treeitem data-bind="attr: { \'aria-label\': accessibleLabel, \'aria-expanded\': expanded, tabindex: tile.index === 0 ? 0 : -1 }, css: { \'od-ItemActivityTile-sectionToggle\': isAggregate, \'od-ItemActivityTile-sectionFocused\': tile.focused }, hasFocus: tile.focused, toggle: expanded"><!--ko if: isAggregate--><i class="od-ItemActivityTile-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i><!--/ko--><div class=od-ItemActivityTile-entity data-bind="component: { name: \'ms-persona\', params: { person: tile.editor, personaSize: $component.personaSize, showPresence: false } }, attr: { \'aria-hidden\': true }"></div><div class=od-ItemActivityTile-details><span data-bind="bindableHtml: tile.headline" class=od-ItemActivityTile-headline></span> <span data-bind="text: tile.date" class="od-ItemActivityTile-date ms-fontColor-neutralSecondary"></span></div></div><!--ko if: isAggregate--><div data-bind="foreach: { data: activities, as: \'activity\' }" role=group><div class=od-ItemActivityTile-sectionContent data-bind="css: {\'od-ItemActivityTile-sectionFocused\': activity.focused }"><ms-item-activity-tile params="activity: activity"></ms-item-activity-tile></div></div><!--/ko--></div>'}),define("odsp-next/controls/itemActivityTile/ItemActivityTile.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ItemActivityTile-ellipsis:hover,.od-ItemActivityTile-sectionToggle{cursor:pointer}html[dir=ltr] .od-ItemActivityTile-section{padding-right:10px}html[dir=rtl] .od-ItemActivityTile-section{padding-left:10px}html[dir=ltr] .od-ItemActivityTile-identity{float:left;margin-right:5px}html[dir=rtl] .od-ItemActivityTile-identity{float:right;margin-left:5px}.od-ItemActivityTile-sectionExpandButton{font-size:17px;position:absolute;color:#666;width:32px;height:32px;line-height:32px;text-align:center;transition:-webkit-transform 167ms cubic-bezier(.1,.9,.2,1);transition:transform 167ms cubic-bezier(.1,.9,.2,1);transition:transform 167ms cubic-bezier(.1,.9,.2,1),-webkit-transform 167ms cubic-bezier(.1,.9,.2,1)}html[dir=ltr] .od-ItemActivityTile-sectionExpandButton{right:0}html[dir=rtl] .od-ItemActivityTile-sectionExpandButton{left:0}.od-ItemActivityTile-section.is-expanded .od-ItemActivityTile-sectionExpandButton{-webkit-transform:rotate(-180deg);-ms-transform:rotate(-180deg);transform:rotate(-180deg)}.od-ItemActivityTile-section .od-ItemActivityTile-sectionContent{display:none}.od-ItemActivityTile-section.is-expanded .od-ItemActivityTile-sectionContent{display:block}.od-ItemActivityTile-sectionHeader{padding:15px 0;min-height:40px}.od-ItemActivityTile-sectionContent{font-size:12px;min-height:40px}html[dir=ltr] .od-ItemActivityTile-sectionContent{padding-left:25px}html[dir=rtl] .od-ItemActivityTile-sectionContent{padding-right:25px}.od-ItemActivityTile-sectionFocused{background-color:#eff6fc}.od-ItemActivityTile-details{display:table}.od-ItemActivityTile-date,.odItemActivityTile-headline{display:block}.od-ItemActivityTile-entity{font-size:12px}html[dir=ltr] .od-ItemActivityTile-entity{float:left}html[dir=rtl] .od-ItemActivityTile-entity{float:right}.od-ItemActivityTile-entity .ms-Persona{overflow:hidden}.od-ItemActivityTile-entity .ms-Persona.ms-Persona--lg .ms-Persona-image{width:40px;height:40px;line-height:40px}.od-ItemActivityTile-entity .ms-Persona-details{display:none}.od-ItemActivityTile-ellipsisWrapper{white-space:nowrap}.od-ItemActivityTile-ellipsis{white-space:nowrap;max-width:130px;overflow:hidden;text-overflow:ellipsis;display:inline-block;vertical-align:text-bottom}")}),define("odsp-next/controls/itemActivityTile/ItemActivityTile",["require","exports","./ItemActivityTileViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ItemActivityTile.html","./ItemActivityTile.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-item-activity-tile",template:e("./ItemActivityTile.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/controls/infoPane/sections/activitiesFeed/ActivitiesFeed",["require","exports","./ActivitiesFeedViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ActivitiesFeed.html","./ActivitiesFeed.css","../../../itemActivityTile/ItemActivityTile"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-activities-feed",template:e("./ActivitiesFeed.html"),viewModel:i});return n}),define("odsp-next/models/tag/TagSourceOptions",["require","exports"],function(){var e;return function(e){e[e.LocationAndEventsAPI=0]="LocationAndEventsAPI",e[e.ObjectDetectors=1]="ObjectDetectors",e[e.LocationBasedPlace=2]="LocationBasedPlace",e[e.UserDefined=3]="UserDefined"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/tags/TagViewModel",["require","exports","odsp-shared/base/ViewModel","../../../../resources/ControlResourceKeys","../../../../resources/DataSourceResourceKeys","knockout"],function(e,t,i,o,n,r){var s=function(e){function t(t){var i=this;e.call(this,t),this._tag=t.tag,this.name="#"+(this._tag.localizedTag||this._tag.tag);var s=this.resources.consume(o.actionMap),a=this.resources.consume(n.url);this.removeAction=new(this.managed(s.RemoveTagAction))({tag:r.observable(this._tag)}),this.navigateAction=new(this.managed(s.NavigationAction))({url:a.getTagUrl(this._tag),target:"_blank"}),this.isDeleting=r.observable(!1),this.tooltip=this.name.length>20?this.name:null,this.createComputed(function(){i.removeAction.isExecuting()&&i.isDeleting(!0)})}return __extends(t,e),t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/tags/TagsSectionViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../../bindings/toggle/ToggleBinding","../../../tagEditor/TagEditor.resx","../../../../models/tag/TagSourceOptions","../../../../resources/ControlResourceKeys","./TagViewModel","odsp-shared/utilities/knockout/Projections"],function(e,t,i,o,n,r,s,a,l){var d=r.strings,c=function(e){function t(t){e.call(this,t);var o=this.resources.consume(a.actionMap);this.addBindingHandlers({toggle:n}),this._item=t.item,this.addAction=new(this.managed(o.EditTagsAction)),this.isTagsExpanded=i.observable(!0),this._initializeTags(),this.addTagLinkLabel=d.editTags,this.sectionHeader=d.sectionHeader}return __extends(t,e),t.prototype._initializeTags=function(){var e=this,t=i.observableArray();this.createComputed(function(){t(e._item().tags||[])}),this.isSectionVisible=this.createComputed(function(){return t().length>0||e.addAction.isAvailable()});var o=this.addDisposable(t.filter(function(e){return e.source!==s[s.LocationAndEventsAPI]}));this.tags=this.addDisposable(o.map({mappingWithDisposeCallback:function(t){var i=new(e.resources.injected(l.default))({tag:t});return{mappedValue:i,dispose:function(){return i.dispose()}}}}))},t}(o);return c}),define("odsp-next/controls/infoPane/sections/tags/TagsSection.html",[],function(){return'<div class="InfoPane-section InfoPaneSection--tags" data-bind="visible: isSectionVisible, css: { \'is-expanded\': isTagsExpanded }"><div class=InfoPane-sectionHeader data-bind="toggle: isTagsExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: sectionHeader"></span></div><div class=InfoPane-sectionContent><div class=InfoPane-tags data-bind="foreach: tags"><div class=InfoPane-tag><a class="InfoPane-tagLink ms-font-m" data-bind="click: navigateAction.execute.bind(navigateAction), attr: { title: tooltip }"><div class=InfoPane-tagName data-bind="text: name"></div></a><!--ko if: removeAction.isAvailable() && !isDeleting()--><a href=# class="InfoPane-removeTag ms-font-m" data-bind="click: removeAction.execute.bind(removeAction)"><i class="ms-Icon ms-Icon--x"></i></a><!--/ko--><!--ko if: isDeleting--><span class="InfoPane-removeTag ms-font-m" data-bind="component: { name: \'ms-loadingSpinner\', params: { loadingText: \'\' } }"></span><!--/ko--></div></div><!--ko if: addAction.isAvailable--><a class=InfoPane-tag-addTag href=# data-bind="automation: \'addTagLink\', text: $component.addTagLinkLabel, click: addAction.execute.bind(addAction)"></a><!--/ko--></div></div>'
}),define("odsp-next/controls/infoPane/sections/tags/TagsSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPane-removeTag,.InfoPane-tag-addTag{display:inline-block;text-decoration:none}.InfoPane-tags{margin-top:8px}.InfoPane-tag{font-size:12px;line-height:32px;background-color:#f8f8f8;border:1px solid #eaeaea;display:inline-block;height:32px;margin:0 8px 8px 0;white-space:nowrap}html[dir=rtl] .InfoPane-tag{margin:0 0 8px 8px}.InfoPane-tagLink{display:inline-block;overflow:hidden;cursor:pointer}.InfoPane-tagName{display:inline-block;padding:0 8px;max-width:180px}.InfoPane-removeTag:hover,.InfoPane-tagLink:hover,.od-Focus--enabled .InfoPane-removeTag:focus,.od-Focus--enabled .InfoPane-tagLink:focus{color:#000;background-color:#eaeaea}.InfoPane-removeTag{color:#767676;width:32px;vertical-align:top;text-align:center}.InfoPane-removeTag .od-LoadingSpinner-loadingGif{vertical-align:text-bottom}.InfoPane-tag-addTag{color:#094AB2;margin-top:5px}")}),define("odsp-next/controls/infoPane/sections/tags/TagsSection",["require","exports","./TagsSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./TagsSection.html","./TagsSection.css","../../../loadingSpinner/LoadingSpinner"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-tags-info-pane-section",template:e("./TagsSection.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/controls/persona/PersonaSizeEnum",["require","exports"],function(){var e;return function(e){e[e.Tiny=1]="Tiny",e[e.XS=2]="XS",e[e.Small=3]="Small",e[e.Medium=4]="Medium",e[e.Large=5]="Large",e[e.XL=5]="XL"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/sharing/SharingSectionViewModel",["require","exports","odsp-shared/base/ViewModel","../../../../bindings/toggle/ToggleBinding","../../../../bindings/html/BindableHtmlBinding","knockout","../../InfoPane.resx","../../../persona/PersonaSizeEnum","../../../../resources/ProviderResourceKeys","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding","../../../../resources/ControlResourceKeys","../../../../models/item/ItemType","../../../../utilities/list/SharingTypeHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h){var m=s.strings,g=function(e){function t(t){e.call(this,t),this.addBindingHandlers({toggle:o,bindableHtml:n}),this.isExpanded=r.observable(!0),this.isLoading=r.observable(!1),this.strings=m,this.scopes=r.observableArray(),this.personaSize=a.Medium;var i=this.resources.consume(p.actionMap);this._currentItemShareAction=new(this.managed(i.ShareAction)),this._sharingProvider=this.resources.consume(l.sharing),this._item=t.item,this._itemKey=this.createComputed(this._computeItemKey),this.subscribe(this._itemKey,this._onItemKeyChanged),this.isShareLinkVisible=this.createComputed(this._computeIsShareLinkVisible),this.statusText=this.createComputed(this._computeStatusText),this._onItemKeyChanged(this._itemKey())}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._getPermissionsPromise&&(this._getPermissionsPromise.cancel(),this._getPermissionsPromise=null)},t.prototype.onScopeClick=function(e){return this._executeShare(e.scope.item),!1},t.prototype.onPermissionRoleClick=function(e,t){return this._executeShare(e.scope.item||this._item,t),!1},t.prototype.onShareClick=function(){return this._executeShare(this._item()),!1},t.prototype._executeShare=function(e,t){var i=this.resources.consume(p.actionMap),o=new(this.managed(i.ShareAction))({item:r.observable(e),selectedPerson:t,canFallbackToParent:!0});o.execute(null)},t.prototype._computeIsShareLinkVisible=function(){return this._currentItemShareAction.isAvailable()},t.prototype._computeStatusText=function(){var e=this._item(),t=this.isLoading(),i="";return this._hasError&&(i=this._errorText),t?i=m.sharingLoadingStatus:h.shouldRequestSharedWithData(e.sharingType)||(i=e.type===u.Folder?m.sharingUnsharedFolderStatus:m.sharingUnsharedFileStatus),i},t.prototype._computeItemKey=function(){var e=this._item();return e?e.key:null},t.prototype._onItemKeyChanged=function(e){var t=this,i=this._item();if(this._getPermissionsPromise&&(this.isLoading(!1),this._getPermissionsPromise.cancel(),this._getPermissionsPromise=null),this.scopes([]),e&&h.shouldRequestSharedWithData(i.sharingType)){var o=this._sharingProvider.getSharingData(this._item());this._hasError=!1,this.isLoading(!0),this._getPermissionsPromise=o.getPermissions(),this._getPermissionsPromise.then(function(e){t.isLoading(!1),t.scopes(t._processScopes(i,e))},function(e){t._errorText=e&&403===e.status?m.accessDenied:m.serverError,t._hasError=!0,t.isLoading(!1)})}},t.prototype._processScopes=function(e,t){for(var i=[],o=0;o<t.length;o++){var n=t[o];if(n&&n.people.length){var r={headerHtml:"",scope:n,people:null};if(n.item&&n.item.key!==this._itemKey()){var s='<a href="#" data-bind="click: function(scopeHeader) { return $component.onScopeClick(scopeHeader); }">{0}</a>',a=d.format(s,c.encodeText(n.item.name));r.headerHtml=d.format(m.sharingScopeHeaderFormat,a)}r.people=n.people,i.push(r)}}return i},t}(i);return g}),define("odsp-next/controls/infoPane/sections/sharing/SharingSection.html",[],function(){return'<div class="SharingSection InfoPane-section" data-bind="css: { \'is-expanded\': isExpanded }"><div class=InfoPane-sectionHeader data-bind="toggle: isExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: strings.sharingHeader"></span><!--ko if: isShareLinkVisible--><a class=SharingSection-shareLink data-bind="text: strings.sharingLink, click: onShareClick, clickBubble: false" href=#></a><!--/ko--></div><div class=InfoPane-sectionContent><div class=SharingSection-status data-bind="text: statusText"></div><div class=SharingSection-shareScope data-bind="foreach: { data: scopes, as: \'scope\' }"><div class=SharingSection-shareScopeHeader data-bind="bindableHtml: headerHtml"></div><div class=SharingSection-shareEntities data-bind="foreach: { data: people, as: \'person\' }"><div class=SharingSection-entity data-bind="component: { name: \'ms-persona\', params: { person: person, changePermissions: function(person) { $component.onPermissionRoleClick(scope, person); }, personaSize: $component.personaSize, showPresence: true } }"></div></div></div></div></div>'}),define("odsp-next/controls/infoPane/sections/sharing/SharingSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPane-sharing{margin-top:8px}.SharingSection-shareLink{line-height:26px;font-size:12px}html[dir=ltr] .SharingSection-shareLink{float:right}html[dir=rtl] .SharingSection-shareLink{float:left}.SharingSection-entity{padding:8px 0;font-size:12px}.SharingSection-entity .ms-Persona .ms-Persona-details{max-width:170px}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/UpdatePermissionsAction",["require","exports","../base/BaseAction","odsp-utilities/async/Promise","../resources/ProviderResourceKeys","odsp-utilities/logging/events/Qos.event"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this.name="UpdatePermissions",this._person=t.person,this._role=t.role,this._isExecuting=t.isExecuting,this._callback=t.callback,this._sharingProvider=this.resources.consume(n.sharing)}return __extends(t,e),t.prototype.onExecute=function(){var e=this;this._isExecuting&&this._isExecuting(!0);var t=function(t){var i={};e._sharingProvider.updatePermissions([e._person],e._person.sharingInfo.item,e._role).then(function(o){e._callback(o.people[0]),i.resultType=r.ResultTypeEnum.Success,t(i)},function(){i.resultType=r.ResultTypeEnum.Failure,t(i)})};return new o.default(t)},t}(i);return s}),define("odsp-next/models/sharing/SharingInfoType",["require","exports"],function(){var e;return function(e){e[e.Email=0]="Email",e[e.User=1]="User",e[e.Group=2]="Group",e[e.Link=3]="Link",e[e.Public=4]="Public",e[e.Friends=5]="Friends",e[e.Facebook=6]="Facebook",e[e.Application=7]="Application",e[e.GroupOwned=99]="GroupOwned"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/personaImage/PersonaImageViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../persona/Persona.resx","../../bindings/css/ClassesBinding","odsp-shared/utilities/string/StringHelper","../../models/sharing/SharingInfoType","../../bindings/imageLoader/ImageLoaderBinding"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){e.call(this,t),this.isImageLoaded=i.observable(!1),this.addBindingHandlers({imageLoader:l,classes:r}),this.person=i.isObservable(t.person)?t.person:i.observable(t.person),this.pictureAlt=this.createComputed(this._computePictureAlt),this._iconType=t.iconType}return __extends(t,e),t.prototype.getIconType=function(e){if(this._iconType)return this._iconType;var t=e?e.type:a.Link;switch(t){case a.User:return"person";case a.Email:return"mail";default:return"people"}},t.prototype._computePictureAlt=function(){return s.format(n.strings.PictureAlt,i.utils.unwrapObservable(this.person().name))},t}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=d}),define("odsp-next/controls/personaImage/PersonaImage.html",[],function(){return'<div class="ms-Persona-image ms-Icon" data-bind="classes: { base: \'ms-Icon--\' + getIconType(person().sharingInfo), mappings: { \'ms-Persona-image--isLoaded\': isImageLoaded } }"><!--ko if: person().image--><img data-bind="imageLoader: { src: person().image, isLoaded: isImageLoaded }, attr: { alt: pictureAlt }"><!--/ko--></div>'}),define("odsp-next/controls/personaImage/PersonaImage.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-Persona-image{display:inline-block;width:50px;height:50px;line-height:40px;border-radius:50%;color:#fff;background:#a6a6a6;font-size:21px;position:relative;overflow:hidden;text-align:center;vertical-align:middle}.ms-Persona-image>img{display:none;position:absolute;left:0;top:0;width:100%;height:100%}.ms-Persona-image--isLoaded>img{display:block}")}),define("odsp-next/controls/personaImage/PersonaImage",["require","exports","./PersonaImageViewModel","odsp-shared/utilities/knockout/ComponentFactory","./PersonaImage.html","./PersonaImage.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-persona-image",template:e("./PersonaImage.html"),viewModel:i.default});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/persona/PersonaViewModel",["require","exports","odsp-shared/base/ViewModel","../commands/CommandViewModel","../../bindings/contextMenu/ContextMenuBinding","../../bindings/contextMenu/ContextMenuHelper","odsp-utilities/logging/events/Engagement.event","../loadingSpinner/LoadingSpinner","knockout","./PersonaSizeEnum","./Persona.resx","../../resources/ProviderResourceKeys","../../models/sharing/SharingRole","../../actions/UpdatePermissionsAction","../../bindings/css/ClassesBinding","../../utilities/features/Features","../personaImage/PersonaImage"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v=function(e){function t(t){var i=this;e.call(this),this.loadingSpinnerTagName=a.tagName,this.personaImageTagName=f.tagName,this.updateSharingRole=function(e){if(e.sharingInfo.role===u.None)i._removePerson(i.person());else{var t=i.person();t.sharingInfo=e.sharingInfo,i.person(t)}i.updatingPermissions(!1)},this.addBindingHandlers({classes:m}),this.showEmail=g.default.isFeatureEnabled(g.default.ShowEmailInPeoplePicker),this.person=l.isObservable(t.person)?t.person:l.observable(t.person),this.updatingPermissions=l.observable(!1),this._removePerson=t.removePerson||function(){return void{}},this._changePermissions=t.changePermissions,this._sharingProvider=this.resources.consume(p.sharing),this.showName=Boolean(void 0===t.showName?!0:t.showName),this.showProfileLink=Boolean(t.profileLinkOn),this.showPresence=Boolean(t.showPresence),this._includeComma=Boolean(t.includeComma),this.personaSize=Boolean(t.personaSize)?l.isObservable(t.personaSize)?t.personaSize:l.observable(t.personaSize):l.observable(d.Small),this.personaImageParams={person:this.person,iconType:t.iconType},this.personaClass=this.createComputed(function(){var e=i.personaSize(),t=void 0===i.person().isResolved||i.person().isResolved?"":"ms-Persona-unresolved ";return i._includeComma&&(t+="ms-Persona--comma "),e===d.Tiny?t+"ms-Persona ms-Persona--tiny":e===d.Small?t+"ms-Persona ms-Persona--sm":e===d.Large?t+"ms-Persona ms-Persona--lg":e===d.XL?t+"ms-Persona ms-Persona--xl":e===d.XS?t+"ms-Persona ms-Persona--xs":e===d.Tiny?t+"ms-Persona ms-Persona--tiny":t+"ms-Persona"}),this.hasSharingInfo=this.createComputed(function(){return Boolean(i.person().sharingInfo)}),this.canChangePermissions=this.createComputed(function(){return Boolean(i.person().sharingInfo&&i.person().sharingInfo.role!==u.Owner)}),this.presenceVisible=this.createComputed(function(){return i.showPresence&&Boolean(i.person().sip)}),this.tooltip=this.person().email,this.updatingText=c.strings.UpdatingText,Boolean(this.person().providerName)&&(this.tooltip+="\n"+this.person().providerName)}return __extends(t,e),t.prototype.getSharingRole=function(e){if(e)switch(e.role){case u.View:return c.strings.View;case u.Edit:return c.strings.Edit;case u.CoOwner:return c.strings.CoOwner;case u.Owner:return c.strings.Owner;case u.Custom:return e.customRole}return""},t.prototype.onSharingRoleClick=function(e,t){if(this._changePermissions)return this._changePermissions(this.person()),[];s.Engagement.logData({name:"UpdatePermissionsMenu.SharingDialog.Click"});var i,a=[],l="";this.person().sharingInfo.role===u.View?(l=c.strings.AllowEdit,i=u.Edit):(l=c.strings.ViewOnly,i=u.View),a[0]=new o({text:l,isToggleable:!1,action:new(this.managed(h))({person:this.person(),role:i,isExecuting:this.updatingPermissions,callback:this.updateSharingRole})}),a[1]=new o({text:c.strings.StopSharing,isToggleable:!1,action:new(this.managed(h))({person:this.person(),role:u.None,isExecuting:this.updatingPermissions,callback:this.updateSharingRole})});var d=new r({items:a,rootElementClass:"ms-Dialog-main"});return n.createContextMenu(t,d,this),a},t}(i);return v}),define("odsp-next/controls/persona/Persona.html",[],function(){return'<div data-bind="attr:{ title: tooltip, \'aria-label\': person().name}, css: personaClass"><div class=ms-Persona-imageArea><div class=ms-Persona-imageCircle><!--ko component: {\n name: personaImageTagName,\n params: personaImageParams\n }--><!--/ko--></div><!--ko if: presenceVisible--><!--ko component: {\n name: \'ms-presence\',\n params: { sip: person().sip }\n }--><!--/ko--><!--/ko--></div><div class=ms-Persona-details><!--ko if: showProfileLink--><a class="ms-Persona-link ms-Persona-primaryText" target=_blank data-bind="attr: {href: person().profilePage}, text: person().name"></a><!--/ko--><!--ko if: !showProfileLink && showName--><div class="ms-Persona-primaryText ms-persona-link" data-bind="text: person().name"></div><!--/ko--><div class=ms-Persona-secondaryText data-bind="visible: !!person().job, text: person().job"></div><div class=ms-Persona-tertiaryText data-bind="visible: !!person().department, text: person().department"></div><div class=ms-Persona-optionalText data-bind="visible: !!person().office, text: person().office"></div><div class=ms-Persona-emailText data-bind="visible: showEmail, text: person().email"></div><!--ko if: canChangePermissions--><div class=ms-Persona-sharingContainer data-bind="visible: !updatingPermissions() && getSharingRole(person().sharingInfo) && personaSize() > 3"><a href=javascript: class=ms-Persona-sharingRole data-bind="click: onSharingRoleClick"><div class=ms-Persona-sharingRole-Text><span data-bind="text: getSharingRole(person().sharingInfo)"></span> <span class=ms-Persona-sharingRole-Chevron><i class="ms-Icon ms-Icon--chevronDown"></i></span></div></a></div><div class=ms-Persona-sharingSpinner data-bind="component: {name: loadingSpinnerTagName, params : {loadingText: updatingText} }, visible: updatingPermissions()"></div><!--/ko--><!--ko if: hasSharingInfo && !canChangePermissions()--><div class=ms-Persona-sharingRole-Text data-bind="text: getSharingRole(person().sharingInfo)"></div><!--/ko--></div></div>'}),define("odsp-next/controls/persona/Persona.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles("html[dir=ltr] .ms-Persona .ms-Persona-imageCircle,html[dir=ltr] .ms-Persona .ms-Persona-placeholder,html[dir=rtl] .ms-Persona .ms-Persona-imageCircle,html[dir=rtl] .ms-Persona .ms-Persona-placeholder{left:0;right:0}.ms-Persona,.ms-Persona .ms-Persona-primaryText,.ms-Persona.ms-Persona--lg .ms-Persona-primaryText,.ms-Persona.ms-Persona--tiny .ms-Persona-primaryText{font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif}.ms-Persona{box-sizing:border-box;margin:0;padding:0;box-shadow:none;color:#333;font-size:14px;font-weight:400;line-height:1;position:relative;width:100%}.ms-Persona .ms-Persona-imageArea{position:relative;display:inline-block;background-color:transparent;width:50px;height:50px}html[dir=ltr] .ms-Persona .ms-Persona-imageArea{margin-right:10px}html[dir=rtl] .ms-Persona .ms-Persona-imageArea{margin-left:10px}.ms-Persona .ms-Persona-imageCircle{width:50px;height:50px;margin:0;border-radius:50%;overflow:hidden;position:absolute;background-color:#a6a6a6}.ms-Persona .ms-Persona-placeholder{color:#fff;position:absolute;font-size:47px;top:7px}.ms-Persona .ms-Persona-image{width:50px;height:50px}.ms-Persona .ms-Persona-image[src=\"\"]{display:none}.ms-Persona .ms-Persona-presence{background-color:#5dd255;position:absolute;height:10px;width:10px;border-radius:50%;top:auto;bottom:-6px;border:2px solid #fff}html[dir=rtl] .ms-Persona .ms-Persona-presence{right:auto}html[dir=ltr] .ms-Persona .ms-Persona-presence{left:auto;right:-2px}html[dir=rtl] .ms-Persona .ms-Persona-presence{left:-2px}.ms-Persona .ms-Persona-row{white-space:nowrap;clear:both;display:inline-block}.ms-Persona.ms-Persona-unresolved .ms-Persona-image{display:none}.ms-Persona .ms-Persona-details{vertical-align:top;max-width:75%;display:inline-block;overflow:hidden;text-overflow:ellipsis;margin-top:4px}.ms-Persona .ms-persona-link{display:inline-block;padding-bottom:3px}.ms-Persona .ms-Persona-primaryText{color:#333;font-size:17px;white-space:nowrap;max-width:100%;overflow:hidden;text-overflow:ellipsis;padding-bottom:3px}.ms-Persona .ms-Persona-optionalText,.ms-Persona .ms-Persona-secondaryText,.ms-Persona .ms-Persona-sharingRole-Text,.ms-Persona .ms-Persona-sharingSpinner,.ms-Persona .ms-Persona-tertiaryText{color:#666;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;margin-bottom:3px;white-space:nowrap;height:auto;overflow:hidden;text-overflow:ellipsis}.ms-Persona .ms-Persona-sharingRole-Text{margin:2px 0}.ms-Persona .ms-Persona-optionalText,.ms-Persona .ms-Persona-tertiaryText{display:none}.ms-Persona .ms-Persona-sharingRole{cursor:pointer;display:inline-block}.ms-Persona.ms-Persona--tiny{padding:0;display:inline-block}.ms-Persona.ms-Persona--tiny .ms-Persona-image,.ms-Persona.ms-Persona--tiny .ms-Persona-imageArea,.ms-Persona.ms-Persona--tiny .ms-Persona-imageCircle,.ms-Persona.ms-Persona--tiny .ms-Persona-optionalText,.ms-Persona.ms-Persona--tiny .ms-Persona-secondaryText,.ms-Persona.ms-Persona--tiny .ms-Persona-sharingRole-Text,.ms-Persona.ms-Persona--tiny .ms-Persona-sharingSpinner,.ms-Persona.ms-Persona--tiny .ms-Persona-tertiaryText,.ms-Persona.ms-Persona--xs .ms-Persona-secondaryText{display:none}html[dir=ltr] .ms-Persona.ms-Persona--tiny{margin-left:4px}html[dir=rtl] .ms-Persona.ms-Persona--tiny{margin-right:4px}.ms-Persona.ms-Persona--tiny .ms-Persona-details{height:14px;margin-top:0;line-height:14px}html[dir=ltr] .ms-Persona.ms-Persona--tiny .ms-Persona-details{padding-left:15px}html[dir=rtl] .ms-Persona.ms-Persona--tiny .ms-Persona-details{padding-right:15px}.ms-Persona.ms-Persona--tiny .ms-Persona-presence{vertical-align:text-bottom;padding-top:0;height:10px;width:10px;top:10px;border:0}html[dir=ltr] .ms-Persona.ms-Persona--tiny .ms-Persona-presence{right:auto}html[dir=ltr] .ms-Persona.ms-Persona--sm .ms-Persona-presence,html[dir=ltr] .ms-Persona.ms-Persona--xs .ms-Persona-presence{right:-1px}html[dir=rtl] .ms-Persona.ms-Persona--tiny .ms-Persona-presence{left:auto}html[dir=rtl] .ms-Persona.ms-Persona--sm .ms-Persona-presence,html[dir=rtl] .ms-Persona.ms-Persona--xs .ms-Persona-presence{left:-1px}.ms-Persona.ms-Persona--tiny .ms-Persona-primaryText{color:#333;font-size:12px;padding-top:2px}.ms-Persona.ms-Persona--tiny.ms-Persona--comma{padding:0;background-color:transparent}.ms-Persona.ms-Persona--tiny.ms-Persona--comma .ms-Persona-primaryText:after{content:','}.ms-Persona.ms-Persona--xs .ms-Persona-image,.ms-Persona.ms-Persona--xs .ms-Persona-imageArea,.ms-Persona.ms-Persona--xs .ms-Persona-imageCircle{width:30px;height:30px}.ms-Persona.ms-Persona--xs .ms-Persona-imageArea{margin:2px 2px 0}html[dir=ltr] .ms-Persona.ms-Persona--xs .ms-Persona-imageArea{margin-right:10px}html[dir=rtl] .ms-Persona.ms-Persona--xs .ms-Persona-imageArea{margin-left:10px}.ms-Persona.ms-Persona--xs .ms-Persona-placeholder{font-size:28px;top:4px}.ms-Persona.ms-Persona--xs .ms-Persona-presence{height:8px;width:8px;bottom:-1px}html[dir=rtl] .ms-Persona.ms-Persona--xs .ms-Persona-details{padding-right:0}html[dir=ltr] .ms-Persona.ms-Persona--xs .ms-Persona-details{padding-left:0;padding-right:4px;margin-right:4px}html[dir=rtl] .ms-Persona.ms-Persona--xs .ms-Persona-details{padding-left:4px;margin-left:4px}.ms-Persona.ms-Persona--xs .ms-Persona-primaryText{font-size:14px;padding-top:3px}.ms-Persona.ms-Persona--sm .ms-Persona-image,.ms-Persona.ms-Persona--sm .ms-Persona-imageArea,.ms-Persona.ms-Persona--sm .ms-Persona-imageCircle{width:40px;height:40px}html[dir=ltr] .ms-Persona.ms-Persona--sm .ms-Persona-imageArea{margin-left:4px}html[dir=rtl] .ms-Persona.ms-Persona--sm .ms-Persona-imageArea{margin-right:4px}.ms-Persona.ms-Persona--sm .ms-Persona-placeholder{font-size:38px;top:5px}.ms-Persona.ms-Persona--sm .ms-Persona-presence{height:10px;width:10px;bottom:-1px;margin:0}.ms-Persona.ms-Persona--sm .ms-Persona-primaryText{font-size:14px;padding:0}.ms-Persona.ms-Persona--sm .ms-Persona-secondaryText{padding:0;margin-top:5px}.ms-Persona.ms-Persona--lg .ms-Persona-image,.ms-Persona.ms-Persona--lg .ms-Persona-imageArea,.ms-Persona.ms-Persona--lg .ms-Persona-imageCircle{width:70px;height:70px}.ms-Persona.ms-Persona--lg .ms-Persona-imageArea{height:78px}.ms-Persona.ms-Persona--lg .ms-Persona-details{padding-top:6px}html[dir=ltr] .ms-Persona.ms-Persona--lg .ms-Persona-imageArea{margin-right:10px}html[dir=rtl] .ms-Persona.ms-Persona--lg .ms-Persona-imageArea{margin-left:10px}.ms-Persona.ms-Persona--lg .ms-Persona-placeholder{font-size:68px;top:10px}html[dir=ltr] .ms-Persona.ms-Persona--lg .ms-Persona-placeholder{left:-5px}html[dir=rtl] .ms-Persona.ms-Persona--lg .ms-Persona-placeholder{right:-5px}.ms-Persona.ms-Persona--lg .ms-Persona-presence{height:16px;width:16px;bottom:4px}html[dir=ltr] .ms-Persona.ms-Persona--lg .ms-Persona-presence{right:-2px}html[dir=rtl] .ms-Persona.ms-Persona--lg .ms-Persona-presence{left:-2px}.ms-Persona.ms-Persona--lg .ms-Persona-primaryText{line-height:12px}.ms-Persona.ms-Persona--lg .ms-Persona-tertiaryText{display:block}.ms-Persona.ms-Persona--lg .ms-Persona-optionalText,.ms-Persona.ms-Persona--lg .ms-Persona-secondaryText,.ms-Persona.ms-Persona--lg .ms-Persona-sharingRole-Text,.ms-Persona.ms-Persona--lg .ms-Persona-tertiaryText{line-height:12px;margin-top:8px;margin-bottom:0}.ms-Persona.ms-Persona--xl .ms-Persona-image,.ms-Persona.ms-Persona--xl .ms-Persona-imageArea,.ms-Persona.ms-Persona--xl .ms-Persona-imageCircle{width:100px;height:100px}.ms-Persona.ms-Persona--xl .ms-Persona-placeholder{font-size:95px;top:12px}.ms-Persona.ms-Persona--xl .ms-Persona-presence{height:24px;width:24px}.ms-Persona.ms-Persona--xl .ms-Persona-details{padding-left:20px}.ms-Persona.ms-Persona--xl .ms-Persona-primaryText{font-size:21px;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;margin-top:2px}.ms-Persona.ms-Persona--xl .ms-Persona-secondaryText{padding-top:7px}.ms-Persona.ms-Persona--xl .ms-Persona-optionalText,.ms-Persona.ms-Persona--xl .ms-Persona-tertiaryText{padding-top:8px;display:block}.ms-Persona.ms-Persona--darkText .ms-Persona-primaryText{color:#212121}.ms-Persona.ms-Persona--darkText .ms-Persona-optionalText,.ms-Persona.ms-Persona--darkText .ms-Persona-secondaryText,.ms-Persona.ms-Persona--darkText .ms-Persona-tertiaryText{color:#333}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/presence/PresenceViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","../../resources/ProviderResourceKeys","../../dataSources/peoplePicker/IPresenceType","../../bindings/css/ClassesBinding","./Presence.resx"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){var i=this;e.call(this),this.strings=a.strings,this.addBindingHandlers({classes:s}),this.sip=o.isObservable(t.sip)?t.sip:o.observable(t.sip||""),this.presenceType=o.observable(r.Unknown),this._dataProvider=this.resources.consume(n.people),this.registerPresence(this.sip()),this.isVisible=Boolean(this._presenceDisposable),this._sipSubscriptionOld=this.sip.subscribe(function(e){i.unRegisterPresence(e)},this,"beforeChange"),this._sipSubscriptionNew=this.sip.subscribe(function(e){i.registerPresence(e)},this),this.presenceClass=this.createComputed(this._computePresenceClass),this.presenceTypeText=this.createComputed(this._computePresenceTypeText)}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this.unRegisterPresence(this.sip()),Boolean(this._sipSubscriptionOld)&&this._sipSubscriptionOld.dispose(),Boolean(this._sipSubscriptionNew)&&this._sipSubscriptionNew.dispose()},t.prototype.registerPresence=function(e){var t=this;Boolean(this._dataProvider)&&Boolean(e)&&(this._presenceDisposable=this._dataProvider.subscribePresence(e,function(e){t._presenceCallback(e)}))},t.prototype.unRegisterPresence=function(){Boolean(this._presenceDisposable)&&this._presenceDisposable.dispose()},t.prototype._presenceCallback=function(e){this.isDisposed===!1&&Boolean(this.presenceType)&&this.presenceType(e)},t.prototype._computePresenceTypeText=function(){var e=this.presenceType(),t="";switch(e){case r.Online:t=this.strings.online;break;case r.Busy:t=this.strings.busy;break;case r.DoNotDisturb:t=this.strings.doNotDisturb;break;case r.BeRightBack:t=this.strings.beRightBack;break;case r.Away:t=this.strings.away;break;case r.Offline:t=this.strings.offline;break;case r.Hidden:break;case r.Unknown:}return t},t.prototype._computePresenceClass=function(){var e=this.presenceType(),t="ms-Presence ",i="";switch(e){case r.Online:i="ms-Presence--Online";break;case r.Busy:i="ms-Presence--Busy";break;case r.DoNotDisturb:i="ms-Presence--DoNotDisturb";break;case r.BeRightBack:i="ms-Presence--BeRightBack";break;case r.Away:i="ms-Presence--Away";break;case r.Offline:i="ms-Presence--Offline";break;case r.Hidden:i="ms-Presence--Hidden";break;case r.Unknown:i="ms-Presence--Hidden";break;default:i="ms-Presence--Hidden"}return t+i},t}(i);return l}),define("odsp-next/controls/presence/Presence.html",[],function(){return"<a data-bind=\"css: presenceClass, visible: isVisible, attr: {title: presenceTypeText, href: 'sip:' + sip(), 'aria-label': presenceTypeText}\" class=ms-Persona-presence></a>"}),define("odsp-next/controls/presence/Presence.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-Presence{display:inline-block;width:12px;height:12px;z-index:1;margin:3px;border-radius:50%;border:2px solid #fff;vertical-align:bottom}.ms-Presence.ms-Presence--Online{background-color:#7dbc00}.ms-Presence.ms-Presence--Busy{background-color:#e9001b}.ms-Presence.ms-Presence--DoNotDisturb{background-color:#eb0615}.ms-Presence.ms-Presence--Away,.ms-Presence.ms-Presence--BeRightBack{background-color:#f9ce15}.ms-Presence.ms-Presence--Offline{background-color:#bd2eae}.ms-Presence.ms-Presence--Hidden{background-color:#f1f1f1}.od-focus--enabled a.ms-Presence{box-shadow:none}.od-focus--enabled .ms-Presence:focus:before{position:absolute;top:0;bottom:0;left:0;right:0;border:1px solid #666;content:'';border-radius:50%}")}),define("odsp-next/controls/presence/Presence",["require","exports","./PresenceViewModel","odsp-shared/utilities/knockout/ComponentFactory","./Presence.html","./Presence.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-presence",template:e("./Presence.html"),viewModel:i});return n}),define("odsp-next/controls/persona/Persona",["require","exports","./PersonaViewModel","odsp-shared/utilities/knockout/ComponentFactory","./Persona.html","./Persona.css","../presence/Presence"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-persona",template:e("./Persona.html"),viewModel:i});return n}),define("odsp-next/controls/infoPane/sections/sharing/SharingSection",["require","exports","./SharingSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./SharingSection.html","./SharingSection.css","../../../persona/Persona"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-sharing-info-pane-section",template:e("./SharingSection.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/bindings/editableText/EditableText.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-EditableText .ms-TextField{display:none;min-height:32px;margin:0}.od-EditableText .ms-TextField-field.od-EditableText-textArea{min-height:32px;outline-style:none;margin:0 0 -4px}.od-EditableText-textArea{resize:none;overflow:hidden;cursor:text}a.od-EditableText-readOnlyArea{width:100%;text-decoration:none;border:1px solid transparent;padding:4px 3px 5px 8px;min-height:32px;display:block;font-size:14px;outline:0;box-sizing:border-box;word-wrap:break-word;cursor:default}html[dir=rtl] a.od-EditableText-readOnlyArea{padding:4px 8px 5px 3px}a.od-EditableText-readOnlyArea,a.od-EditableText-readOnlyArea:hover,a.od-EditableText-readOnlyArea:visited{color:#333}a.od-EditableText-readOnlyArea--interactive:focus,a.od-EditableText-readOnlyArea--interactive:hover{border-color:#c8c8c8;cursor:text}a.od-EditableText-readOnlyArea--empty{color:#a6a6a6}.od-EditableText--editMode .ms-TextField{display:block}.od-EditableText--editMode .od-EditableText-readOnlyArea{display:none}")}),define("odsp-next/bindings/editableText/EditableTextBinding",["require","exports","odsp-utilities/encoding/HtmlEncoding","odsp-utilities/events/EventGroup","odsp-utilities/domUtils/DomUtils","odsp-utilities/async/Async","knockout","./EditableText.css"],function(e,t,i,o,n,r,s){var a="od-EditableText",l="od-EditableText--editMode",d="ms-TextField-field od-EditableText-textArea",c=0,p="od-EditableText-readOnlyArea",u="od-EditableText-readOnlyArea--empty",h="od-EditableText-readOnlyArea--interactive",m={ESC:27,ENTER:13},g=function(){function e(){}return e.init=function(t,c,g,f,v){var b=c(),x=f,y=b.maxLength?' maxlength="'+b.maxLength+'" ':"",_='<div class="ms-TextField ms-TextField--multiline"><textarea data-bind="value: $data.text" class="'+d+'"'+y+"></textarea></div>",k='<a data-bind="text: $data.text" class="'+p+'" href="javascript:void(0)"></a>';
n.toggleClass(t,a,!0),t.innerHTML=_+k;var T,S=t.querySelector("textarea"),w=t.querySelector("a"),P=new o(null),I=new r,C=function(){if((void 0===b.isEditable||b.isEditable())&&(n.toggleClass(t,l,!0),e._updateTextAreaHeight(S),S.focus(),S.select))try{S.select()}catch(i){}},E=function(){b.onSubmitChange&&(b.onSubmitChange.call(x,S.value),n.toggleClass(t,l,!1))},F=function(e){T=e.keyCode,b.onRevertChange&&T===m.ESC&&(b.text(S.value),b.onRevertChange.call(x),n.toggleClass(t,l,!1)),T===m.ENTER&&(b.text(S.value),E()),e.stopPropagation()},M=function(){b.text(S.value)},O=function(){T!==m.ENTER&&E()};return s.applyBindingsToDescendants(v,t),P.on(w,"click",C),P.on(S,"keydown",F),P.on(S,"keyup",M),P.on(S,"blur",O),s.computed(function(){var t=!b.text(),o=void 0===b.isEditable||b.isEditable();b.placeholder&&(S.setAttribute("placeholder",b.placeholder()),t&&(w.innerHTML=b.placeholder())),S.value=b.text(),t||(w.innerHTML=i.encodeText(b.text())),n.toggleClass(w,u,t),n.toggleClass(w,h,o),e._updateTextAreaHeight(S)},null,{disposeWhenNodeIsRemoved:t}),s.utils.domNodeDisposal.addDisposeCallback(t,function(){I.dispose(),P.dispose()}),s.unwrap(b.hasFocus)&&I.setTimeout(function(){C(null)},300),{controlsDescendantBindings:!0}},e._updateTextAreaHeight=function(e){e.offsetHeight<e.scrollHeight&&(e.style.height=e.scrollHeight+c+"px")},e}();return g});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/caption/CaptionSectionViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../../bindings/keyboard/KeyboardBinding","../../../../bindings/editableText/EditableTextBinding","../../../../resources/ControlResourceKeys","../../InfoPane.resx"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){e.call(this,t);var o=this.resources.consume(s.actionMap);this.item=t.item,this.hasFocus=t.hasFocus,this.isEditable=i.observable(!1),this.placeholder=i.observable(""),this.text=i.observable(""),this._updateCaptionAction=new(this.managed(o.UpdateCaptionAction))({caption:this.text}),this.addBindingHandlers({keyboard:n,editableText:r}),this.createComputed(this._computeItemChanged)}return __extends(t,e),t.prototype.onRevertChange=function(){var e=this.item();this.text(e&&e.caption||"")},t.prototype.onSubmitChange=function(){var e=this.item();this._updateCaptionAction.isAvailable()&&e.caption!==this.text.peek()&&(e.caption=this.text.peek(),this._updateCaptionAction.execute(null))},t.prototype._computeItemChanged=function(){var e=this.item(),t=e&&e.caption||"",i=e&&!!e.photo,o=this._updateCaptionAction.isAvailable(),n=i?a.strings.captionAddCaption:a.strings.captionAddDescription;this.isEditable(o),this.placeholder(o?n:""),this.text(t)},t}(o);return l}),define("odsp-next/controls/infoPane/sections/caption/CaptionSection.html",[],function(){return'<div class=CaptionSection><div data-bind="editableText: { text: text, hasFocus: hasFocus, maxLength: 255, placeholder: placeholder, isEditable: isEditable, onRevertChange: onRevertChange, onSubmitChange: onSubmitChange }" class=CaptionSection--caption></div></div>'}),define("odsp-next/controls/infoPane/sections/caption/CaptionSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".CaptionSection--caption{margin:8px}")}),define("odsp-next/controls/infoPane/sections/caption/CaptionSection",["require","exports","./CaptionSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./CaptionSection.html","./CaptionSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-caption-section",template:e("./CaptionSection.html"),viewModel:i,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/notifications/NotificationsSectionViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../../controls/infoPane/InfoPane.resx","../../../../resources/ProviderResourceKeys"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this.strings=n.strings,this._item=t.item,this.statusText=i.observable(""),this.createComputed(this._computeItemChanged)}return __extends(t,e),t.prototype._computeItemChanged=function(){var e=this,t=this._item();this.statusText(n.strings.notificationsLoading);var i=this.resources.consume(r.subscriptions);i.getSubscriptions(t.id).then(function(){e.statusText("")},function(){e.statusText(n.strings.notificationsFailed)})},t}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),define("odsp-next/controls/infoPane/sections/notifications/NotificationsSection.html",[],function(){return'<div class=od-NotificationsSection><div class=od-NotificationsSection-title data-bind="text: strings.notificationsTitle"></div><input type=checkbox id=od-NotificationsSection-toggle class=ms-Toggle-input> <label for=od-NotificationsSection-toggle class=ms-Toggle-field><span class="ms-Label ms-Label--off"></span> <span class="ms-Label ms-Label--on"></span></label><div class=od-NotificationsSection-status data-bind="text: statusText"></div></div>'}),define("odsp-next/controls/infoPane/sections/notifications/NotificationsSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles("html[dir=ltr] .od-NotificationsSection{padding-left:18px}html[dir=rtl] .od-NotificationsSection{padding-right:18px}.od-NotificationsSection .od-NotificationsSection-title{font-size:12px;margin-bottom:10px}.od-NotificationsSection .od-NotificationsSection-status{font-size:12px;position:absolute;display:inline-block}html[dir=ltr] .od-NotificationsSection .od-NotificationsSection-status{margin-left:10px}html[dir=rtl] .od-NotificationsSection .od-NotificationsSection-status{margin-right:10px}")}),define("odsp-next/controls/infoPane/sections/notifications/NotificationsSection",["require","exports","./NotificationsSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./NotificationsSection.html","./NotificationsSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-notifications-section",template:e("./NotificationsSection.html"),viewModel:i.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/fieldRender/FieldRenderer",["require","exports"],function(){var e=function(){function e(e,t){this._column=e,this._parentViewModel=t,this._key=this._column.key,this._parentViewModel&&this._parentViewModel.registerFieldRenderer(this._key,this)}return e.prototype.isCacheable=function(){return!Boolean(this._parentViewModel)},e.prototype.renderField=function(e){var t=e[this._column.key];return void 0===t&&(t=e.properties[this._column.key]),void 0===t?"":t},e.prototype._getThis=function(){return"$data.getFieldRenderer('"+this._key+"')"},e.prototype._getOnClick=function(){return"function(data, evt) { "+this._getThis()+".onClick(evt); }"},e}();return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/ComputedFieldRenderer",["require","exports","./FieldRenderer"],function(e,t,i){var o=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.fieldRenderer=function(){return new i(this._column)},t}(i);return o}),define("odsp-next/utilities/string/FileSizeFormatter",["require","exports","odsp-shared/utilities/string/StringHelper","./StringUtilities.resx"],function(e,t,i,o){var n=o.strings,r=1024,s=1024*r,a=1024*s,l=function(){function e(){}return e.formatSize=function(t,o){var l="";return"number"==typeof t&&(t>0||o)&&(t>=a?l=i.format(n.fileSizeGB,e._preciseRound(t/a,2)):t>=s?l=i.format(n.fileSizeMB,e._preciseRound(t/s,2)):t>=r?l=i.format(n.fileSizeKB,e._preciseRound(t/r,2)):1===t?l=i.format(n.fileSizeBytesSingular,t):void 0===t||isNaN(t)||(l=i.format(n.fileSizeBytesPlural,t))),l},e._preciseRound=function(e,t){return String(Math.round(e*Math.pow(10,t))/Math.pow(10,t))},e}();return l});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/FileSizeFieldRenderer",["require","exports","./FieldRenderer","../../utilities/string/FileSizeFormatter"],function(e,t,i,o){var n=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.renderField=function(e){return o.formatSize(e.size)},t}(i);return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/nameField/NameFieldRenderer",["require","exports","../FieldRenderer","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding","../../../resources/DataSourceResourceKeys"],function(e,t,i,o,n,r){var s=function(e){function t(t,i){e.call(this,t,void 0),this._urlDataSource=i.resources.consume(r.url)}return __extends(t,e),t.prototype.renderField=function(i){var r=n.encodeText(e.prototype.renderField.call(this,i)),s=n.encodeText(i.properties.nameFieldAriaLabel),a=this._urlDataSource.getDefaultClickUrl(i,{preferCurrentView:!0});return o.format(t._template,s,r,a?a:"#")},t._template='<a tabindex="-1" href="{2}" data-bind="event: {click: function(obj, ev) { return $data.onClick(null, ev); },mousedown: function(obj, ev) { return $data.onMouseDown(null, ev); } }" aria-label="{0}" title="{1}">{1}</a>',t}(i);return s}),define("odsp-next/controls/fieldRender/dateField/DateField.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-DateField--newItem{color:#107c10;margin-right:3px}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/dateField/DateFieldRenderer",["require","exports","../FieldRenderer","odsp-shared/utilities/string/StringHelper","./DateField.css"],function(e,t,i,o){var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(i){var n=o.format(t._textTemplate,e.prototype.renderField.call(this,i));if(i.dateModifiedValue){var r=new Date(i.dateModifiedValue).getTime();r&&Math.abs(Date.now()-r)<=36e5&&(n=t._indicatorTemplate+n)}return n},t._textTemplate="<span>{0}</span>",t._indicatorTemplate='<span class="od-DateField--newItem">&#10033;</span>',t}(i);return n}),define("odsp-next/controls/fieldRender/FieldRender.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-SharedWithField,.od-UserField{cursor:pointer;text-decoration:none;text-overflow:ellipsis;overflow:hidden}.od-SharedWithField-icon{display:inline-block}html[dir=ltr] .od-SharedWithField-icon{margin-right:6px}html[dir=rtl] .od-SharedWithField-icon{margin-left:6px}")}),define("odsp-next/controls/fieldRender/sharedField/SharedField.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles("html[dir=ltr] .od-SharedField--shared::before{padding-right:4px}html[dir=rtl] .od-SharedField--shared::before{padding-left:4px}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/sharedField/SharedFieldRenderer",["require","exports","../FieldRenderer","odsp-shared/utilities/string/StringHelper","../FieldRender.css","./SharedField.css"],function(e,t,i,o){var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(){var e=this._parentViewModel.getTextValue(this._column);return Boolean(e)?t._iconTemplate+o.format(t._template,e):""},t._iconTemplate='<i class="od-SharedField--shared ms-Icon ms-Icon--people"></i>',t._template="<span>{0}</span>",t}(i);return n}),define("odsp-next/controls/sharingWizard/SharingWizardState",["require","exports"],function(){var e;return function(e){e[e.loading=0]="loading",e[e.shareByLink=1]="shareByLink",e[e.sharedWith=2]="sharedWith",e[e.invite=3]="invite",e[e.switchLinks=4]="switchLinks",e[e.error=5]="error",e[e.createLink=6]="createLink"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/sharedWithField/SharedWithFieldViewModel",["require","exports","knockout","../FieldRender.resx","odsp-utilities/encoding/HtmlEncoding","odsp-shared/base/ViewModel","odsp-utilities/async/RequireHelper","../../tabbedSharing/SharingTab","../../sharingWizard/SharingWizardState","../../../utilities/features/Features"],function(e,t,i,o,n,r,s,a,l,d){var c=function(t){function r(e){var o=this;t.call(this,e),this._item=e.item,this.imageClass=i.observable(""),this.imageAlt=i.observable(""),this.sharingString=this.createComputed(function(){return o.render()})}return __extends(r,t),r.prototype.onClick=function(t){var i=this;if(d.default.isFeatureEnabled(d.default.SharingDialogRedux)){var o=s.promise(e,"../../../actions/ShareByLinkAction");o.then(function(e){var o=new(i.resources.injected(e))({startState:l.sharedWith});o.execute(t)})}else{var o=s.promise(e,"../../../actions/ShareAction");o.then(function(e){var o=new(i.resources.injected(e))({activeTab:a.sharedWith});o.execute(t)})}},r.prototype.render=function(){var e=Number(this._item().properties.PrincipalCount),t=this._item().properties.SharedWithUsers;1>e?(this.imageClass("ms-Icon ms-Icon--lock"),this.imageAlt(o.strings.SharedWithNoneIcon)):(this.imageClass("ms-Icon ms-Icon--people"),this.imageAlt(o.strings.SharedWithSomeIcon));var i=o.strings.SharedWithNone_Short;if(e>0&&Boolean(t)&&t.length>0){var r=e-1,s=t[t.length-1].value;r>0?(i=o.strings.UserFieldInlineAndMore,i=i.replace("^1",s.toString()),i=i.replace("^2",r.toString())):i=s.toString()}else e>0&&(i=o.strings.SharingHintShared_Short);return n.encodeText(i)},r}(r);return c});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/sharedWithField/SharedWithFieldRenderer",["require","exports","knockout","../FieldRenderer","./SharedWithFieldViewModel","odsp-shared/utilities/string/StringHelper","../FieldRender.css"],function(e,t,i,o,n,r){var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){this.sharedWithViewModel=new(this._parentViewModel.resources.injected(n))({item:i.observable(e)});var o=this.sharedWithViewModel.sharingString(),s=this.sharedWithViewModel.imageClass(),a=this.sharedWithViewModel.imageAlt();return r.format(t._template,this._getOnClick(),s,a,o)},t.prototype.onClick=function(e){this.sharedWithViewModel.onClick(e)},t._template='<div class="od-SharedWithField" href="javascript: " title="{3}" data-bind="click: {0}"><span class="od-SharedWithField-icon"><i class="{1}" alt="{2}"></i></span><span class="ms-noWrap ms-imnSpan ms-displayInlineBlock">{3}</span></div>',t}(o);return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/textField/TextFieldViewModel",["require","exports","odsp-shared/base/ViewModel"],function(e,t,i){var o=function(e){function t(t){e.call(this,t),this._parent=null,this._parent=t.parent}return __extends(t,e),t.prototype.getTextValue=function(e){return this._parent.getTextValue(e)},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/dotDotDot/DotDotDotViewModel",["require","exports","../textField/TextFieldViewModel","../../../bindings/contextMenu/ContextMenuBinding","../../../resources/PagesResourceKeys","odsp-utilities/logging/events/Engagement.event"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._item=t.item}return __extends(t,e),t.prototype.onDotDotDotClicked=function(e,t){var i=null;try{i=this.resources.consume(n.listViewContextMenuCommandSet)}catch(s){r.Engagement.logData({name:"CalloutMenu.Uninitialized"})}if(Boolean(i)){var a=this.resources.consume(n.listViewContextMenuHelper);o.createContextMenu(t,a.peek(),this._item),r.Engagement.logData({name:"Ellipsis.Callout.Click"})}else r.Engagement.logData({name:"CalloutMenu.NotLoaded"})},t}(i);return s}),define("odsp-next/controls/fieldRender/dotDotDot/DotDotDot.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-callout{display:inline-block;cursor:pointer}.ms-callout-icon{color:#094AB2}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/dotDotDot/DotDotDotFieldRenderer",["require","exports","knockout","../FieldRenderer","./DotDotDotViewModel","odsp-shared/utilities/string/StringHelper","./DotDotDot.css"],function(e,t,i,o,n,r){var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){return this.dotDotDotViewModel=new(this._parentViewModel.resources.injected(n))({item:i.observable(e)}),r.format(t._template,this._getOnClick())},t.prototype.onClick=function(e){this.dotDotDotViewModel.onDotDotDotClicked(null,e)},t._template='<div class="ms-callout" data-bind="click: {0}"><i class="ms-Icon ms-Icon--ellipsis ms-callout-icon"></i></div>',t}(o);return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/userField/UserFieldViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","odsp-shared/utilities/object/SchemaMapper","odsp-utilities/async/RequireHelper"],function(e,t,i,o,n,r){var s=function(t){function o(e){t.call(this,e);var o=e.item();this.item=i.observable(o),this._column=e.column,this.users=i.observableArray(null);var n=o.properties[this._column.key];n&&n.length&&this.users(n)}return __extends(o,t),o.prototype.getAriaLabel=function(e){return this._column.name+", "+e},o.prototype.launchPersonaCard=function(t,i){var n=this;void 0===i&&(i=0);var s=this.users.peek()[i];if(s&&s.sip){var a=r.promise(e,"../../personaCard/PersonaCardLauncher");a.then(function(e){var i=o._schemaMapper.forwardTransform(s),r=new(n.managed(e))(i);r.show(t)})}},o._schemaMapper=new n([{from:"title",to:"name"},{from:"email",to:"email"},{from:"picture",to:"image"},{from:"sip",to:"sip"},{from:"sip",to:"userId"}]),o}(o);return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/userField/UserFieldRenderer",["require","exports","knockout","../FieldRenderer","./UserFieldViewModel","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding","../FieldRender.css"],function(e,t,i,o,n,r,s){var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){this._userFieldViewModel=new(this._parentViewModel.resources.injected(n))({item:i.observable(e),column:this._column});var o=this._userFieldViewModel.users.peek();if(!o)return"";for(var a="",l=0,d=0;d<o.length;d++){var c=o[d],p=s.encodeText(c.title),u=s.encodeText(this._userFieldViewModel.getAriaLabel(p));a+=r.format(t._template,this._getOnClickIndex(l++),u,p)}return a},t.prototype.onClick=function(e,t){this._userFieldViewModel.launchPersonaCard(e,t)},t.prototype._getOnClickIndex=function(e){return"function(data, evt) { "+this._getThis()+".onClick(evt, "+e+"); }"},t._template='<div class="od-UserField" data-bind="click: {0}" aria-label="{1}"><span class="ms-noWrap ms-imnSpan ms-displayInlineBlock">{2}</span></div>',t}(o);return a});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/iconField/IconFieldViewModel",["require","exports","../textField/TextFieldViewModel","../../fileTypeIcon/OverlayType","../../../models/policyTip/PolicyTipType","odsp-utilities/async/RequireHelper","odsp-utilities/logging/events/Engagement.event"],function(e,t,i,o,n,r,s){var a=function(t){function i(e){t.call(this,e),this.item=e.item,this.iconFieldViewModelType=i}return __extends(i,t),i.getOverlayType=function(e){var t=e(),i=o.none;return t.policyTip?i=t.policyTip>=n.block?o.block:o.notify:t.isViolation?i=o.block:t.hasMissingMetadata?i=o.notify:t.properties.CheckedOutUserId&&(i=o.checkOut),i},i.getHoverText=function(e){var t=e();return t.tooltipText?t.tooltipText:null},i.getOnClick=function(t,i){return t().policyTip?function(o){s.Engagement.logData({name:"PolicyTip.LaunchFromListView"});var n=r.promise(e,"../../../actions/PolicyTipAction");return n.then(function(e){var n=new(i.injected(e))({item:t});n.execute(o)}),!1}:null},i}(i);return a});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/FileTypeIconFieldRenderer",["require","exports","knockout","./FieldRenderer","../fileTypeIcon/FileTypeIconViewModel","./iconField/IconFieldViewModel","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding","../fileTypeIcon/FileTypeIcon.css"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){var o=i.observable(e),l={iconName:e.iconName,iconUrl:e.iconUrl,desiredSize:16,overlayType:r.getOverlayType(o),iconFieldAriaLabel:e.properties.iconFieldAriaLabel,hoverText:r.getHoverText(o),onClick:r.getOnClick(o,this._parentViewModel.resources)};this.fileTypeIconViewModel=new(this._parentViewModel.resources.injected(n))(l);var d=Boolean(this.fileTypeIconViewModel.onClick)?"FileTypeIcon FileTypeIcon--clickable":"FileTypeIcon",c=this.fileTypeIconViewModel.overlayUrl,p=Boolean(c)?s.format(t._overlayImageTemplate,c):"",u=this.fileTypeIconViewModel.iconFieldAriaLabel;return s.format(t._template,d,this.fileTypeIconViewModel.hoverText,this._getOnClick(),this.fileTypeIconViewModel.iconUrl,Boolean(u)?'alt="'+a.encodeText(u)+'"':"",this.fileTypeIconViewModel.width,this.fileTypeIconViewModel.height,p)},t.prototype.onClick=function(e){"function"==typeof this.fileTypeIconViewModel.onClick&&this.fileTypeIconViewModel.onClick(e)},t._template='<span class="{0}" title="{1}" data-bind="click: {2}" tabindex="-1"><img class="FileTypeIcon-icon" src="{3}" {4} style="width: {5}px; height: {6}px; font-size: {6}px" />{7}</span>',t._overlayImageTemplate='<img class="FileTypeIcon-overlay" src="{0}" />',t}(o);return l}),define("odsp-next/controls/fieldRender/tagField/TagField.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-TagField{height:54px;box-sizing:border-box;cursor:pointer}.od-TagField .od-TagField-image{width:50px;height:50px;background-color:rgba(0,0,0,.25)}html[dir=ltr] .od-TagField .od-TagField-image{float:left}html[dir=rtl] .od-TagField .od-TagField-image{float:right}.od-TagField .od-TagField-name{max-width:150px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;vertical-align:middle;height:100%;color:#333}html[dir=rtl] .od-TagField .od-TagField-name{margin-right:10px}html[dir=ltr] .od-TagField .od-TagField-name{margin-left:10px;float:left;margin-right:5px}html[dir=rtl] .od-TagField .od-TagField-name{float:right;margin-left:5px}.od-TagField .od-TagField-count{color:#767676;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:11px;font-weight:400;line-height:54px}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/tagField/TagFieldRenderer",["require","exports","../FieldRenderer","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding","../../../controls/tagEditor/TagEditor.resx","./TagField.css"],function(e,t,i,o,n,r){var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){var i=o.format(t._textTemplate,e.thumbnails&&e.thumbnails.length>0?o.format(e.thumbnails[0].url,50,50):"",n.encodeText(e.name),n.encodeText(o.format(r.strings.photosCount,e.childCount)));return i},t._textTemplate='<div class="od-TagField"><div class="od-TagField-image"><img src="{0}" alt=""/></div><div class="od-TagField-name ms-font-m">{1}</div><div class="od-TagField-count">{2}</div></div>',t}(i);return s}),define("odsp-next/controls/fieldRender/urlField/UrlField.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-field-picture{cursor:pointer;max-width:100%;max-height:100%}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/urlField/UrlFieldRenderer",["require","exports","../FieldRenderer","odsp-shared/utilities/string/StringHelper","./UrlField.css"],function(e,t,i,o){var n=function(e){function t(t,i,o){e.call(this,t,i),this._isPicture=Boolean(o)}return __extends(t,e),t.prototype.renderField=function(e){var i=e.properties[this._column.key];if(!i)return"";var n=e.properties[this._column.key+".desc"];Boolean(n)||(n=i);var r=this._isPicture?t._templatePicture:t._templateUrl;return o.format(r,i,n,this._getOnClick())},t.prototype.onClick=function(e){if(Boolean(e)&&Boolean(e.target)){var t=e.target,i=null;"A"===t.tagName?i=t.href:"IMG"===t.tagName&&(i=t.src),Boolean(i)&&window.open(i,"_blank")}},t._templateUrl='<a href="{0}" title="{0}" target="_blank" data-bind="click: {2}">{1}</a>',t._templatePicture='<img src="{0}" title="{1}" class="ms-field-picture" data-bind="click: {2}"></a>',t}(i);return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/alert/AlertViewerViewModel",["require","exports","odsp-shared/base/ViewModel","./AlertViewer.resx","../../resources/ProviderResourceKeys","../../resources/UtilityResourceKeys","../progressSpinnerFlat/ProgressSpinnerFlat","knockout"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){e.call(this,t),this.loadingLabel=o.strings.AlertLoadingLabel,this.progressSpinnerFlatTagName=s.tagName,this.isLoading=a.observable(!0),this.alertUrl=t.alertUrl,this.showInDialog=t.showInDialog,this.heightOffset=t.heightOffset}return __extends(t,e),t.prototype.iframeOnLoad=function(e,t){var i=this,o=t.target;if(o&&o.contentWindow){var n=o.contentWindow.document,r=n.getElementById("contentBox"),s=n.getElementById("s4-workspace");this.async.setTimeout(function(){i.showInDialog&&i._setupIframeElementFunctions(o),i.isLoading(!1),o.style.height&&"0px"!==o.style.height||!r||(o.style.height=Math.min(r.clientHeight+i.heightOffset,.85*document.body.clientHeight)+"px"),!s||s.style.height&&"0px"!==s.style.height||(s.style.height=o.style.height)},10)}},t.prototype._setupIframeElementFunctions=function(e){var t=this,i=function(){var e=t.resources.consume(n.dialog);e.currentDialog().dismiss()},o=function(e){if("string"==typeof e){var i=t.resources.consume(r.navigation);i.navigateTo(e)}else{var o=t.resources.consume(n.dialog);o.currentDialog().complete()}},s=function(e){var i=t.resources.consume(r.navigation);i.navigateTo(e)};e.cancelPopUp=i,e.commitPopup=o,e.navigateParent=s},t}(i);return l}),define("odsp-next/controls/alert/AlertViewer.html",[],function(){return'<div class=od-AlertViewer><iframe frameborder=0 data-bind="attr: {src: alertUrl}, event: {load: iframeOnLoad}, visible: !isLoading()" style=width:100%></iframe><label class=ms-Dialog-subText data-bind="text: loadingLabel, visible: isLoading"></label><div class=od-AlertViewer-ProgressContainer data-bind="visible: isLoading"><div data-bind="component: {name: progressSpinnerFlatTagName}"></div></div></div>'}),define("odsp-next/controls/alert/AlertViewer.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-AlertViewer iframe{border:none;width:100%}.od-AlertViewer .od-AlertViewer-ProgressContainer{width:250px;padding:15px 0}")}),define("odsp-next/controls/alert/AlertViewer",["require","exports","./AlertViewerViewModel","odsp-shared/utilities/knockout/ComponentFactory","./AlertViewer.html","./AlertViewer.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-alert-viewer",template:e("./AlertViewer.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/lookupField/LookupFieldViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../resources/ProviderResourceKeys","../../../utilities/browser/WindowSize","../../alert/AlertViewer","odsp-utilities/logging/events/Qos.event"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){e.call(this,t);var o=t.item();this.item=i.observable(o),this._column=t.column,this.lookups=i.observableArray(null);var n=o.properties[this._column.key];n&&n.length>0&&this.lookups(n)}return __extends(t,e),t.prototype.launchLookupDisplayForm=function(e,t){var i=this._column.dispFormUrl;i+="&ID=",i+=t,i+="&RootFolder=*&IsDlg=1";var o=this.resources.consume(n.dialog),l=o.requestDialog({title:"",size:r.Large,component:{name:s.tagName,params:{alertUrl:i,showInDialog:!0,heightOffset:134}}});return l.wait().then(function(){return{resultType:a.ResultTypeEnum.Success}})},t}(o);return l});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/lookupField/LookupFieldRenderer",["require","exports","knockout","../FieldRenderer","./LookupFieldViewModel","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding"],function(e,t,i,o,n,r,s){var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){this._lookupFieldViewModel=new(this._parentViewModel.resources.injected(n))({item:i.observable(e),column:this._column});for(var o=this._lookupFieldViewModel.lookups.peek(),a="",l=0;l<o.length;l++){var d=o[l],c=s.encodeText(d.lookupValue);a+=r.format(t._template,this._getOnClickFieldValue(d.lookupId),c,c)}return a},t.prototype.onClick=function(e,t){this._lookupFieldViewModel.launchLookupDisplayForm(e,t)
},t.prototype._getOnClickFieldValue=function(e){return"function(data, evt) { "+this._getThis()+".onClick(evt, "+e+"); }"},t._template='<div class="od-UserField" data-bind="click: {0}" aria-label="{1}"><span class="ms-noWrap ms-imnSpan ms-displayInlineBlock">{2}</span></div>',t}(o);return a});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/taxonomyField/TaxonomyFieldViewModel",["require","exports","knockout","odsp-shared/base/ViewModel"],function(e,t,i,o){var n=function(e){function t(t){e.call(this,t);var o=t.item();this.item=i.observable(o),this._column=t.column,this.terms=i.observableArray(null);var n=o.properties[this._column.key];!n||n instanceof Array||""===n||(n=[{Label:n.Label,TermID:n.TermID}]),n&&n.length>0&&this.terms(n)}return __extends(t,e),t}(o);return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldRender/taxonomyField/TaxonomyFieldRenderer",["require","exports","knockout","../FieldRenderer","./TaxonomyFieldViewModel","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding"],function(e,t,i,o,n,r,s){var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.renderField=function(e){this._taxonomyFieldViewModel=new(this._parentViewModel.resources.injected(n))({item:i.observable(e),column:this._column});for(var o=this._taxonomyFieldViewModel.terms(),a="",l=0;l<o.length;l++){var d=o[l],c=s.encodeText(d.Label);a+=r.format(t._template,c,c)}return a},t._template='<div class="od-UserField" aria-label="{0}"><span class="ms-noWrap ms-imnSpan ms-displayInlineBlock">{1}</span></div>',t}(o);return a}),define("odsp-next/controls/fieldRender/FieldRenderManager",["require","exports","../list/interfaces/ColumnFieldType","./FieldRenderer","./ComputedFieldRenderer","./FileSizeFieldRenderer","./nameField/NameFieldRenderer","./dateField/DateFieldRenderer","./sharedField/SharedFieldRenderer","./sharedWithField/SharedWithFieldRenderer","./dotDotDot/DotDotDotFieldRenderer","./userField/UserFieldRenderer","./FileTypeIconFieldRenderer","./tagField/TagFieldRenderer","./urlField/UrlFieldRenderer","./lookupField/LookupFieldRenderer","./taxonomyField/TaxonomyFieldRenderer"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v=function(){function e(){}return e.RenderFieldByType=function(t,i,o){return e.GetFieldRenderer(t,o).renderField(i)},e.GetFieldRenderer=function(e,t){var v=null;if(null!=t.fieldRenderer&&t.fieldRenderer.isCacheable())return t.fieldRenderer;switch(t.fieldType){case i.Computed:v=new n(t).fieldRenderer();break;case i.FileSize:v=new r(t);break;case i.Name:v=new s(t,e);break;case i.Shared:v=new l(t,e);break;case i.SharedWith:v=new d(t,e);break;case i.DotDotDot:v=new c(t,e);break;case i.User:v=new p(t,e);break;case i.FileIcon:v=new u(t,e);break;case i.DateTime:v=new a(t);break;case i.Tag:v=new h(t,e);break;case i.Hyperlink:v=new m(t,e);break;case i.Image:v=new m(t,e,!0);break;case i.Lookup:v=new g(t,e);break;case i.Taxonomy:v=new f(t,e);break;default:v=new o(t)}return t.fieldRenderer=v,v},e}();return v}),define("odsp-next/controls/fieldEditor/BaseFieldEditor.html",[],function(){return'<!--ko if: isEdit--><label class="od-FieldEditor-fieldTitle ms-Label" data-bind="text: title, attr: { \'for\': inputElementId }, css: { \'is-required\' : field.schema.Required }"></label><div><div class=od-FieldEditor-controlContainer data-bind="bindableHtml: controlHtml, css: { \'od-FieldEditor-controlContainer--globalEdit\': fieldsManager.globalEditMode }"></div><!--ko ifnot: fieldsManager.globalEditMode() || inlineEdit--><button class="od-FieldEditor-Edit ms-Button ms-Button--primary" data-bind="event: { click: saveChanges }"><span class="ms-Icon ms-Icon--check"></span></button><!--/ko--></div><div class=od-FieldEditor-fieldDescription data-bind="text: description"></div><!--/ko--><!--ko ifnot: isEdit--><label class="od-FieldEditor-fieldTitle ms-Label" data-bind="text: title, css: { \'is-required\' : field.schema.Required }"></label><div><div class=od-FieldEditor-controlContainer--display data-bind="css: { \'od-FieldEditor-controlContainer--globalEdit\': fieldsManager.globalEditMode, \'od-FieldEditor-controlContainer--inlineEdit\': inlineEdit }, attr: { tabindex: inlineEdit? \'0\' : \'-1\' }, event: { click: inlineEdit? editField : null }, hasFocus: isReadFocused, keyboard: { Enter: inlineEdit? editField : null }"><!--ko if: !field.data() && inlineEdit--><span class=od-FieldEditor-placeHolder data-bind="text: fieldPlaceHolder"></span><!--/ko--><!--ko if: field.data() || !inlineEdit--><div data-bind="bindableHtml: renderHtml"></div><!--/ko--></div><!--ko ifnot: fieldsManager.globalEditMode--><!--ko ifnot: isReady--><div class=od-FieldEditor-loadingSpinner data-bind="component: {name: loadingSpinnerTagName, params: {loadingText: \'\'}}"></div><!--/ko--><!--ko if: isReady() && isSaved()--><i class="od-FieldEditor-isSaved ms-Icon ms-Icon--check"></i><!--/ko--><!--ko if: isReady() && !inlineEdit && !isSaved()--><button class="od-FieldEditor-Edit ms-Button" data-bind="event: { click: editField }"><span class="ms-Icon ms-Icon--pencil"></span></button><!--/ko--><!--/ko--></div><!--/ko--><!--ko if: aggregateValidation.hasError--><div class=od-FieldEditor-required data-bind="text: aggregateValidation.errorText"></div><!--/ko-->'}),define("odsp-next/controls/fieldEditor/BaseFieldEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-FieldEditor-fieldTitle{width:100%}.od-FieldEditor-fieldDescription{font-size:12px;color:#333}.od-FieldEditor-loadingSpinner{float:right!important;margin:2px}.od-FieldEditor-Edit{display:inline-block;width:30px;height:30px;min-width:30px;min-height:30px;padding:0}.ms-Button--primary{color:#fff}.od-FieldEditor-controlContainer{display:inline-block;width:calc(100% - 21px);min-height:30px;vertical-align:top;margin-right:1px}.od-FieldEditor-controlContainer--display{display:inline-block;width:calc(100% - 42px);min-height:20px;background:#f4f4f4;border-bottom:1px solid transparent;vertical-align:top;margin-right:1px;outline:0;padding:5px 0;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400}.od-FieldEditor-controlContainer--inlineEdit{background:0 0;cursor:pointer;width:calc(100% - 21px)}.od-FieldEditor-controlContainer--inlineEdit:focus,.od-FieldEditor-controlContainer--inlineEdit:hover{border-color:#a6a6a6}.od-FieldEditor-controlContainer--globalEdit{width:100%!important;margin-right:0!important}.od-FieldEditor-required{color:#e81123}.od-FieldEditor-isSaved{float:right!important;margin-top:7px;color:#0078d7;font-size:14px}.od-FieldEditor-placeHolder{color:#a6a6a6;font-size:12px;font-weight:400}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/BaseFieldEditorViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","./FieldEditor.resx","../../bindings/html/BindableHtmlBinding","odsp-utilities/guid/Guid","../../models/clientForm/IClientForm","../loadingSpinner/LoadingSpinner","../list/interfaces/ColumnFieldType","../fieldRender/FieldRenderManager","odsp-shared/utilities/resources/ResourceScope","../../bindings/keyboard/KeyboardBinding","./BaseFieldEditor.html","./BaseFieldEditor.css"],function(e,t,i,o,n,r,s,a,l,d,c,p,u){var h=function(t){function o(o){var n=this;t.call(this,o.viewModelParams),this.inputElementId=s.default.generate(),this.isSelected=i.observable(!1),this.loadingSpinnerTagName=l.tagName,this.isReady=i.observable(!0),this.waitingForRenderUpdate=!1,this.inlineEdit=!1,this.fullHtml=e("./BaseFieldEditor.html"),this.arraySeparatorToken=";#",this._renderWidth=190,this.resources||(this.resources=new p),this.addBindingHandlers({bindableHtml:r,keyboard:u}),this.field=o.field,this.title=this.field.schema.Title,this.description=this.field.schema.Description,this.isEdit=i.pureComputed(function(){return n.field.mode()===a.ClientFormMode.edit&&n.isReady()===!0}),this.fieldsManager=o.fieldsManager,this.isSaved=i.observable(!1),this.isReadFocused=i.observable(!1),this.fieldPlaceHolder=this.getFieldPlaceHolderString(),this.clientValidation={hasError:i.observable(!1),errorText:i.observable("")},this.aggregateValidation={hasError:i.pureComputed(function(){return n.field.hasException()||n.clientValidation.hasError()}),errorText:i.pureComputed(function(){var e=n.clientValidation.errorText();return""!==e?e:n.field.errorMessage()})},this.subscribe(this.field.mode,function(e){e===a.ClientFormMode.edit&&n.fieldsManager.globalEditMode.peek()!==!0?n.async.setImmediate(function(){return n.isSelected(!0)}):n.saveChanges()}),this._fieldRender=this.getFieldRenderForClientFormField(this.field),this.renderHtml=i.observable(this._fieldRender.renderField(this.fieldsManager.item.peek()))}return __extends(o,t),o.prototype.updateRenderHtml=function(){var e=this;this.renderHtml(this._fieldRender.renderField(this.fieldsManager.item.peek())),this.waitingForRenderUpdate&&(this.isReady(!0),this.isSaved(!0),this.isReadFocused(!0),this.async.setTimeout(function(){e.isSaved(!1)},1e3),this.waitingForRenderUpdate=!1)},o.prototype.editField=function(){return this.field.mode(a.ClientFormMode.edit),!1},o.prototype.saveChanges=function(){var e=this;if(this.beforeSave&&this.beforeSave(),this.fieldsManager.globalEditMode.peek()===!1&&this.field.serverData!==this.field.data.peek()){if(!this.validate())return;this.waitingForRenderUpdate=!0,this.isReady(!1),this.fieldsManager.saveChanges().done(function(){return e.aggregateValidation.hasError.peek()?void e.isReady(!0):void e.field.mode(a.ClientFormMode.display)})}else this.field.mode(a.ClientFormMode.display)},o.prototype.getFieldRenderer=function(){return this._fieldRender},o.prototype.registerFieldRenderer=function(){},o.prototype.getFieldPlaceHolderString=function(){switch(this.field.schema.FieldType.toLowerCase()){case"choice":return n.strings.SingleChoiceEditorPlaceHolder;case"multichoice":return n.strings.MultiChoiceEditorPlaceHolder;case"text":return n.strings.TextEditorPlaceHolder}return n.strings.DefaultEditorPlaceHolder},o.prototype.validate=function(){return this.clientValidation.errorText(""),this.clientValidation.hasError(!1),this.field.schema.Required&&!this.field.data.peek()?(this.clientValidation.errorText(n.strings.RequiredField),this.clientValidation.hasError(!0),!1):!0},o.prototype.convertFormStringToArray=function(e){return e?e.split(this.arraySeparatorToken).filter(function(e){return e.length>0}):[]},o.prototype.getFieldRenderForClientFormField=function(e){var t=this.mapClientFormFieldToColumnFieldType(e),o={key:e.schema.Name,name:e.schema.Title,fieldType:t,width:this._renderWidth,isVisible:!0,isVisibleMobile:!0,isCollapsable:!1,isIcon:!1,sortable:!1,filterable:!1,isSorted:!1,isFocused:i.observable(!1),isAscending:!0};return c.GetFieldRenderer(this,o)},o.prototype.mapClientFormFieldToColumnFieldType=function(e){var t;switch(e.schema.FieldType.toLowerCase()){case"url":var i=e.schema;t=1===i.DisplayFormat?d.Image:d.Hyperlink;break;case"usermulti":case"user":t=d.User;break;case"lookup":case"lookupmulti":t=d.Lookup;break;case"taxonomyfieldtype":case"taxonomyfieldtypemulti":t=d.Taxonomy;break;default:t=d.Text}return t},o}(o);return h}),define("odsp-next/controls/fieldEditor/textEditor/TextEditor.html",[],function(){return'<div data-bind="childFocus: isChildFocused"><input class="od-TextEditor-input ms-TextField-field" type=text data-bind="hasfocus: isSelected, textInput: textInput, attr: { id: inputElementId, \'aria-invalid\': aggregateValidation.hasError }, event: { dblclick: onDoubleClick }, keyboard: { mappings: { Enter: onEnter, Down: onDown, Esc: onEsc }, context: $data, allowInputEvents: true }"><!--ko if:isAutoFillOpen--><div tabindex=0 class=od-TextEditor-AutoFill data-bind="css: {\'isFocused\': isAutoFillSelected}, text: autoFillSuggestion, event: { click: onClick }, dismiss: isAutoFillOpen() && closeAutoFill"></div><!--/ko--></div>'}),define("odsp-next/controls/fieldEditor/textEditor/TextEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-TextEditor-input.ms-TextField-field{width:100%;box-sizing:border-box;border:1px solid transparent;outline:0}.od-TextEditor-input.ms-TextField-field:focus{border-bottom:1px solid #0078d7}.od-TextEditor-AutoFill{font-size:14px;border:1px solid #a6a6a6;overflow-y:auto;position:absolute;background-color:#fff;max-height:300px;padding:5px;z-index:3001;min-width:192px}.od-TextEditor-AutoFill.isFocused{background-color:#a8d1ef}.od-TextEditor-AutoFill:not(.isFocused):hover{background-color:#eaeaea}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/textEditor/TextEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../../resources/DataSourceResourceKeys","../../../bindings/keyboard/KeyboardBinding","../../../bindings/dismiss/DismissBinding","../../../models/clientForm/IClientForm","../../../bindings/focus/ChildFocusBinding","./TextEditor.html","./TextEditor.css"],function(e,t,i,o,n,r,s,a,l){var d=function(t){function o(o){var d=this;t.call(this,o),this.controlHtml=e("./TextEditor.html"),this._clientFormDataSource=this.resources.consume(n.clientForm),this.autoFillSuggestion=i.observable(""),this.isAutoFillOpen=i.observable(!1),this.isAutoFillSelected=i.observable(!1),this.isChildFocused=i.observable(!1),this.inlineEdit=!0,this.textInput=i.observable(this.field.data.peek()),this._delayedTextInput=this.createComputed(function(){return d.textInput()}).extend({rateLimit:400}),this.subscribe(this._delayedTextInput,function(e){var t=e.length,i=d.autoFillSuggestion.peek();0===t?(d.isAutoFillOpen(!1),d.autoFillSuggestion("")):0!==i.toLowerCase().indexOf(e.toLowerCase())&&d._getAutoFillSuggestion()}),this.addBindingHandlers({keyboard:r,dismiss:s,childFocus:l}),this.subscribe(this.autoFillSuggestion,function(){d.isAutoFillSelected(!1)}),this.subscribe(this.isChildFocused,function(e){e||d.field.mode.peek()!==a.ClientFormMode.edit||d.fieldsManager.globalEditMode.peek()||d.field.mode(a.ClientFormMode.display)}),this.beforeSave=function(){d.field.data(d.textInput.peek())}}return __extends(o,t),o.prototype.onEnter=function(){return this.isAutoFillSelected()?this._onAutoFillPicked():this.isChildFocused(!1),!1},o.prototype.onDown=function(){return this.isAutoFillOpen.peek()?this.isAutoFillSelected(!0):this._getAutoFillSuggestion(),!1},o.prototype.onEsc=function(){return this.textInput(this.field.serverData),this.isChildFocused(!1),this.isReadFocused(!0),!1},o.prototype.onClick=function(){return this._onAutoFillPicked(),this.isChildFocused(!1),!1},o.prototype.onDoubleClick=function(){this.textInput.peek()||this._getAutoFillSuggestion()},o.prototype.closeAutoFill=function(){this._abortQuery(),this.autoFillSuggestion(""),this.isAutoFillOpen(!1)},o.prototype._onAutoFillPicked=function(){this.textInput(this.autoFillSuggestion()),this._abortQuery(),this.isAutoFillOpen(!1),this.isAutoFillSelected(!1)},o.prototype._getAutoFillSuggestion=function(){var e=this;this._abortQuery(),this._autoFillQueryPromise=this._clientFormDataSource.getLatestFieldValueModifiedByMe(this.field.schema.Name,this.field.schema.FieldType,this.textInput.peek()),this.trackPromise(this._autoFillQueryPromise.then(function(t){e.autoFillSuggestion(t),e.isAutoFillOpen(t?!0:!1)},function(){e.autoFillSuggestion(""),e.isAutoFillOpen(!1)}))},o.prototype._abortQuery=function(){this._autoFillQueryPromise&&this._autoFillQueryPromise.cancel()},o}(o);return d}),define("odsp-next/bindings/clientRect/ClientRectBinding",["require","exports","knockout","odsp-utilities/async/Async","odsp-utilities/events/EventGroup"],function(e,t,i,o,n){function r(){"use strict";for(var e in m)a(m[e])}function s(){"use strict";for(;h.length;){var e=h.pop();e.isDisposed||(m[e.id]=e,a(e))}}function a(e){"use strict";var t=e.element.getBoundingClientRect(),i=t.top<window.innerHeight&&t.bottom>=0;(e.allowHiddenSizeUpdates||i)&&e.size({bottom:t.bottom,height:t.height,left:t.left,right:t.top,top:t.top,width:t.width}),e.isOnScreen&&e.isOnScreen(i)}var l=50,d=50,c=new o,p=new n(window),u=0,h=[],m={};p.on(window,"resize",c.debounce(r,l)),p.on(window,"scroll",c.throttle(r,d,{leading:!1}));var g=function(){function e(){}return e.init=function(e,t){var o=t(),n={id:u++,element:e,isDisposed:!1,size:o.size,isOnScreen:o.isOnScreen,allowHiddenSizeUpdates:o.allowHiddenSizeUpdates};h.push(n),c.setTimeout(s,0),i.utils.domNodeDisposal.addDisposeCallback(e,function(){n.isDisposed=!0,delete m[n.id]})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=g}),define("odsp-next/controls/fieldEditor/noteEditor/NoteEditor.html",[],function(){return"<!--ko ifnot: richText--><textarea class=od-NoteEditor-input data-bind=\"hasFocus: isSelected, title: field.schema.Name, value: field.data, attr: { id: inputElementId, rows: field.schema.NumberOfLines, 'aria-invalid': aggregateValidation.hasError }\"></textarea><!--/ko--><!--ko if: richText()&&!richTextFullHtml()--><div class=od-NoteEditor-input contenteditable=true role=textbox aria-autocomplete=both aria-multiline=true data-bind=\"hasFocus: isSelected, bindableHtml: field.data, attr: { id: inputElementId, 'aria-invalid': aggregateValidation.hasError }\"></div><!--/ko--><!--ko if: richTextFullHtml--><div data-bind=\"component: { name: 'od-listfocus-editorhost' , params: { isOpen: richTextFullHtml, size: size } }\"><div class=od-NoteEditor-iframe-loader><!--ko component: { name: 'ms-iframe-loader', params: iframeLoaderParams }--><!--/ko--></div></div><!--/ko-->"}),define("odsp-next/controls/fieldEditor/noteEditor/NoteEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-NoteEditor-input,.od-NoteEditor-input:focus,.od-NoteEditor-input:hover{outline:transparent solid 1px}.od-NoteEditor-input{margin:0;box-shadow:none;border:1px solid #c8c8c8;border-radius:0;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;color:#333;height:32px;padding:6px 10px 8px;min-width:180px;width:100%;min-height:100px;box-sizing:border-box}.od-NoteEditor-input:hover{border-color:#767676}.od-NoteEditor-input:focus{border-color:#0078d7}.od-NoteEditor-input:-moz-placeholder,.od-NoteEditor-input:-ms-input-placeholder,.od-NoteEditor-input::-moz-placeholder,.od-NoteEditor-input::-webkit-input-placeholder{color:#666}.od-NoteEditor-iframe-loader{position:absolute;top:10%;left:10%;height:80%;width:80%}.od-NoteEditor-iframe-loader .ms-IframeLoader-progress{position:absolute;top:50%;left:50%}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/listFocusEditorHost/DefaultCommandSet",["require","exports","odsp-shared/base/BaseModel","../commands/CommandViewModel","../../utilities/icons/Icon","knockout"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),t.isOpen&&(this.commands=r.observableArray([new(this.managed(o))({icon:n.x,callback:function(){t.isOpen(!1)},keys:["Esc"],isSideCommand:!0})]))}return __extends(t,e),t}(i);return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/listFocusEditorHost/ListFocusEditorHostViewModel",["require","exports","knockout","../../bindings/clientRect/ClientRectBinding","../../bindings/host/HostBinding","./DefaultCommandSet","odsp-shared/base/ViewModel"],function(e,t,i,o,n,r,s){var a=function(e){function t(t){e.call(this,t),this.isOpen=t.isOpen||i.observable(!0),this.size=t.size||i.observable({width:0,height:0}),this.commandSet=t.commandSet?t.commandSet:new(this.managed(r))({isOpen:t.isOpen}),this.addBindingHandlers({clientRect:o.default,host:n}),this.isOpen.subscribe(function(e){!e&&t.onClose&&t.onClose()})}return __extends(t,e),t}(s);return a}),define("odsp-next/controls/listFocusEditorHost/ListFocusEditorHost.html",[],function(){return'<!--ko if: isOpen--><div data-bind="component: { name: \'od-one-up-overlay\' }"><div class="od-ListFocusEditorHost-container od-theme--darkTransparent" data-bind="clientRect: { size: size }"><!--ko if: commandSet--><div class=od-ListFocusEditorHost-commandBar data-bind="component: { name: \'ms-command-bar\', params: { commandSet: commandSet, isMobile: false } }"></div><!--/ko--><!--ko host: {}--><!--/ko--></div></div><!--/ko-->'}),define("odsp-next/controls/listFocusEditorHost/ListFocusEditorHost.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ListFocusEditorHost-container{height:100%;width:100%;position:absolute;background-color:#000}.od-ListFocusEditorHost-commandBar{visibility:inherit;opacity:1;position:absolute;left:0;right:0;top:0;z-index:2;padding:0 8px;height:40px;transition:visibility 0s linear 267ms,opacity 267ms linear,top 267ms linear;background-color:rgba(0,0,0,.7)}.od-ListFocusEditorHost-commandBar .CommandBar{background:0 0;padding:0;height:40px}html[dir=ltr] .od-ListFocusEditorHost-commandBar .CommandBar-sideArea .CommandBarItem:last-child{margin-right:0}html[dir=rtl] .od-ListFocusEditorHost-commandBar .CommandBar-sideArea .CommandBarItem:last-child{margin-left:0}")}),define("odsp-next/controls/listFocusEditorHost/ListFocusEditorHost",["require","exports","./ListFocusEditorHostViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ListFocusEditorHost.html","./ListFocusEditorHost.css","../commandBar/CommandBar","odsp-next/controls/overlays/oneUp/OneUpOverlay"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-listfocus-editorhost",template:e("./ListFocusEditorHost.html"),viewModel:i,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/noteEditor/NoteEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../../resources/DataSourceResourceKeys","../../../models/clientForm/IClientForm","../../../bindings/clientRect/ClientRectBinding","../../../resources/ModelResourceKeys","./NoteEditor.html","./NoteEditor.css","../../listFocusEditorHost/ListFocusEditorHost","../../iframeLoader/IframeLoader"],function(e,t,i,o,n,r,s,a){var l=function(t){function o(o){var l=this;t.call(this,o),this.controlHtml=e("./NoteEditor.html"),this.richText=i.observable(!1),this.richTextFullHtml=i.observable(!1);var d=this.field.schema;this.richText(d.RichText),1===d.RichTextMode&&(this.isLoading=i.observable(!0),this.addBindingHandlers({clientRect:s.default}),this.size=i.observable({width:0,height:0}),this.iframeElement=i.observable(null),this.richTextFullHtml(!0),this._urlDataSource=this.fieldsManager.resources.consume(n.url),this.richTextEditorUrl=this._urlDataSource.getRichTextEditorIframeUrl(d.Name,this.fieldsManager.item.peek().properties.ID),this._itemsStore=this.resources.consume(a.itemsStore),this.iframeLoaderParams={url:this.richTextEditorUrl,showLoadingLabel:!1,onload:this.iframeOnLoad.bind(this),isLoading:this.isLoading,iframeElement:this.iframeElement,isInFullPage:!0},this.subscribe(this.size,function(){l._updateRichTextEditorSize(l.iframeElement.peek())}),this.subscribe(this.field.mode,function(e){e===r.ClientFormMode.edit&&1===d.RichTextMode&&(l.richTextFullHtml(!0),l.isLoading(!0))}),this.subscribe(this.richTextFullHtml,function(e){e||l.field.mode(r.ClientFormMode.display)}))}return __extends(o,t),o.prototype.saveChanges=function(){var e=arguments;this.richText.peek()&&e&&e.length>1&&e[1].currentTarget&&this.field.data(e[1].currentTarget.innerHTML),t.prototype.saveChanges.call(this)},o.prototype.iframeOnLoad=function(e){var t=this,i=e.target;if(i&&i.contentWindow){var o=i.contentWindow.document,n=this._updateRichTextEditorSize(i);if(n){var r=o.getElementsByClassName("ms-formlabel");if(r&&r.length>1){var s=r[0];s.style.display="none"}i.cancelPopUp=function(){t.richTextFullHtml(!1)}}else this._itemsStore.invalidateItem(this.fieldsManager.item.peek().parentKey),this.richTextFullHtml(!1);this.isLoading(!1)}},o.prototype._updateRichTextEditorSize=function(e){var t=!1;if(e){var i=e.contentWindow.document,n=i.getElementsByClassName("ms-rtestate-field");n.length>0&&(t=!0);for(var r=0;r<n.length;r++){var s=n[r];s.style.height=.8*this.size().height-o.HEIGHTOFFSET+"px",s.style.width=.8*this.size().width-o.WIDTHOFFSET+"px"}}return t},o.HEIGHTOFFSET=255,o.WIDTHOFFSET=35,o}(o);return l}),define("odsp-next/controls/fieldEditor/booleanEditor/BooleanEditor.html",[],function(){return'<label class=od-BooleanEditor data-bind="css: { \'od-BooleanEditor-checked\': checkedValue }"><button data-bind="css: { \'od-BooleanEditor-button-checked\': checkedValue }, hasFocus: isSelected, toggle: checkedValue"></button></label> <span class=od-BooleanEditor-span data-bind="text: displayValue"></span>'}),define("odsp-next/controls/fieldEditor/booleanEditor/BooleanEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-BooleanEditor-span{vertical-align:middle;margin-left:3px}.od-BooleanEditor{display:inline-block;width:60px;height:30px;border:1px solid #c8c8c8;background-color:#fff;border-radius:30px;transition:background-color .4s;vertical-align:middle;cursor:pointer}.od-BooleanEditor:hover{border-color:#767676}.od-BooleanEditor button{position:relative;left:0;width:30px;height:30px;transition:left .4s;border-radius:30px;border-style:none;background-color:#3a96dd;cursor:pointer}.od-BooleanEditor button.od-BooleanEditor-button-checked{left:30px!important}.od-BooleanEditor.od-BooleanEditor-checked{background-color:#d7eaf9}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/booleanEditor/BooleanEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../../bindings/toggle/ToggleBinding","./BooleanEditor.resx","./BooleanEditor.html","./BooleanEditor.css"],function(e,t,i,o,n,r){var s=function(t){function o(o){t.call(this,o),this.controlHtml=e("./BooleanEditor.html"),this.displayValue=i.observable(""),this.addBindingHandlers({toggle:n}),this.displayValue("1"===this.field.data.peek()?r.strings.yes:r.strings.no),this.checkedValue=i.pureComputed({read:function(){return"1"===this.field.data()},write:function(e){this.field.data(e?"1":"0"),this.displayValue(e?r.strings.yes:r.strings.no)},owner:this})}return __extends(o,t),o}(o);return s}),define("odsp-next/controls/fieldEditor/numberEditor/NumberEditor.html",[],function(){return"<input class=od-NumberEditor-input type=number data-bind=\"hasFocus: isSelected, value: field.data, attr: { id: inputElementId, 'aria-invalid': aggregateValidation.hasError }\">"}),define("odsp-next/controls/fieldEditor/numberEditor/NumberEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-NumberEditor-input,.od-NumberEditor-input:focus,.od-NumberEditor-input:hover{outline:transparent solid 1px}.od-NumberEditor-input{margin:0;box-shadow:none;border:1px solid #c8c8c8;border-radius:0;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;color:#333;height:32px;padding:6px 10px 8px;min-width:180px;width:100%;box-sizing:border-box}.od-NumberEditor-input:hover{border-color:#767676}.od-NumberEditor-input:focus{border-color:#0078d7}.od-NumberEditor-input:-moz-placeholder,.od-NumberEditor-input:-ms-input-placeholder,.od-NumberEditor-input::-moz-placeholder,.od-NumberEditor-input::-webkit-input-placeholder{color:#666}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/numberEditor/NumberEditorViewModel",["require","exports","../BaseFieldEditorViewModel","./NumberEditor.html","./NumberEditor.css"],function(e,t,i){var o=function(t){function i(){t.apply(this,arguments),this.controlHtml=e("./NumberEditor.html")}return __extends(i,t),i}(i);return o}),define("odsp-next/controls/fieldEditor/pictureEditor/PictureEditor.html",[],function(){return'<div class=od-PictureEditor-container><div class=od-PictureEditor-subLabel data-bind="text: strings.url"></div><input class=od-PictureEditor-input type=text data-bind="value: url, attr: { id: inputElementId, placeholder: strings.url }"><div class=od-PictureEditor-subLabel data-bind="text: strings.display"></div><input class=od-PictureEditor-input type=text data-bind="value: altText, attr: { id: inputElementId, placeholder: strings.display }"></div>'}),define("odsp-next/controls/fieldEditor/pictureEditor/PictureEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-PictureEditor-input,.od-PictureEditor-input:focus,.od-PictureEditor-input:hover{outline:transparent solid 1px}.od-PictureEditor-input{box-shadow:none;border:1px solid #c8c8c8;border-radius:0;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;color:#333;height:32px;padding:6px 10px 8px;min-width:180px;width:100%;box-sizing:border-box;margin:1px}.od-PictureEditor-input:hover{border-color:#767676}.od-PictureEditor-input:focus{border-color:#0078d7}.od-PictureEditor-input:-moz-placeholder,.od-PictureEditor-input:-ms-input-placeholder,.od-PictureEditor-input::-moz-placeholder,.od-PictureEditor-input::-webkit-input-placeholder{color:#666}.od-PictureEditor-container{width:100%;box-sizing:border-box;background:#f4f4f4;padding:5px}.od-PictureEditor-subLabel{font-family:'Segoe UI Light WestEuropean','Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/pictureEditor/PictureEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","./PictureEditor.resx","./PictureEditor.html","./PictureEditor.css"],function(e,t,i,o,n){var r=function(t){function o(o){var r=this;t.call(this,o),this.controlHtml=e("./PictureEditor.html"),this.strings=n.strings;var s=this.field.data.peek(),a=s&&s.search?s.search(/[^,],[^,]/):-1;-1===a?(this.url=i.observable(s),this.altText=i.observable("")):(this.url=i.observable(s.substr(0,a+1).trim()),this.altText=i.observable(s.substr(a+2).trim())),this.subscribe(this.url,function(e){r._setConcatinatedValue(e,r.altText.peek())}),this.subscribe(this.altText,function(e){r._setConcatinatedValue(r.url.peek(),e)})}return __extends(o,t),o.prototype._setConcatinatedValue=function(e,t){if(Boolean(e)){var i=e.replace(/\,/g,",,");i+=", ",Boolean(t)&&(i+=t),this.field.data(i)}else this.field.data("")},o}(o);return r
}),define("odsp-next/controls/fieldEditor/peopleEditor/PeopleEditor.html",[],function(){return"<div class=od-PeopleEditor data-bind=\"component: {name: 'ms-people-picker', params: {peoplePickerQueryParams: peoplePickerQueryParams, selectedPeople: selectedPeople }}\"></div>"}),define("odsp-next/controls/fieldEditor/peopleEditor/PeopleEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-PeopleEditor{position:relative}.od-PeopleEditor .PeoplePicker{border-color:#c8c8c8}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/peopleEditor/PeopleEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","odsp-shared/utilities/object/SchemaMapper","./PeopleEditor.html","./PeopleEditor.css"],function(e,t,i,o,n){var r=function(t){function o(o){var r=this;t.call(this,o),this.controlHtml=e("./PeopleEditor.html"),this.selectedPeople=i.observable([]),this.peoplePickerQueryParams={allowEmailAddresses:!1,allowOnlyEmailAddresses:!1,allowMultipleEntities:this.field.schema.AllowMultipleValues,allUrlZones:!1,maximumEntitySuggestions:50,required:!1};var s=[{from:"DisplayText",to:"name"},{from:"EntityData.Email",to:"email"},{from:"EntityData.AccountName",to:"userId"},{from:"EntityData.Title",to:"job"},{from:"EntityData.Department",to:"department"},{from:"EntityData.SIPAddress",to:"sip"}],a=new n(s,function(e,t){e.hasOwnProperty("EntityData")&&(e=e.EntityData,e.DisplayText=t.DisplayText)}),l=this.field.data.peek();if(Boolean(l)&&Boolean(l.length)){this.selectedPeople(a.forwardTransform(l));for(var d=0;d<this.selectedPeople().length;d++)this.selectedPeople()[d].isResolved=!0,this.selectedPeople()[d].rawData=l[d]}this._overTheWireOriginal=this._getOverTheWireValue(this.selectedPeople.peek()),this.subscribe(this.selectedPeople,function(e){var t=r._getOverTheWireValue(e);t!==r._overTheWireOriginal&&r.field.data(t)})}return __extends(o,t),o.prototype._getOverTheWireValue=function(e){var t=[],i="";if(null!==e&&void 0!==e){for(var o=0;o<e.length;o++){var n=e[o].rawData;Boolean(n)&&(delete n.Claim,delete n.EntityDataElements,n.EntityData&&delete n.EntityData.DisplayText,t.push(n))}i=JSON.stringify(t)}return i},o}(o);return r}),define("odsp-next/controls/fieldEditor/lookupEditor/LookupEditor.html",[],function(){return'<!--ko if: lookupMulti--><div><div class=od-LookupEditor-container data-bind="foreach: options"><label class=od-LookupEditor-label><input type=checkbox data-bind="attr: {value: $data.value }, checked: $parent.selectedValues"> <span data-bind="text: display"></span></label></div></div><!--/ko--><!--ko ifnot: lookupMulti--><select class="ms-Dropdown-select od-LookupEditor-select" data-bind="options: options, optionsText: \'display\', optionsValue: \'value\', value: selectedValue"></select><!--/ko-->'}),define("odsp-next/controls/fieldEditor/lookupEditor/LookupEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-LookupEditor-label,.od-LookupEditor-select{font-family:'Segoe UI Light WestEuropean','Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif}.od-LookupEditor-select{min-height:30px;width:100%;padding:6px 10px 8px;border:1px solid #c8c8c8;background-color:#fff}.od-LookupEditor-select:hover{border-color:#767676}.od-LookupEditor-select:focus{border-color:#094AB2}.od-LookupEditor-label{display:block;margin-bottom:3px}.od-LookupEditor-container{width:100%;box-sizing:border-box;background:#f4f4f4;padding:5px;max-height:200px;overflow-y:auto}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/lookupEditor/LookupEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","./LookupEditor.resx","./LookupEditor.html","./LookupEditor.css"],function(e,t,i,o,n){var r=function(t){function o(i){var o=this;t.call(this,i),this.controlHtml=e("./LookupEditor.html"),this.displayFieldName="",this.valueFieldName="",this.lookupMulti=!1;var n=i.field.schema;this.options=this._populateChoiceArray(n.Choices),this.displayFieldName=i.fieldNameForDisplayRead,this.valueFieldName=i.fieldNameForValueRead,this.lookupMulti="lookupmulti"===n.FieldType.toLowerCase(),this.options=this._populateChoiceArray(n.Choices),this._populateSelectedValues(),this.lookupMulti?this.subscribe(this.selectedValues,function(e){var t=[];if(e){for(var i=0;i<e.length;i++)t.push(e[i]+";#_");o.field.data(t.join(";#"))}}):this.subscribe(this.selectedValue,function(e){if(null!==e&&void 0!==e){var t=o.convertFormStringToArray(o.field.serverData);o.field.data(t&&t.length>0&&t[0]===e.toString()?o.field.serverData:e.toString())}})}return __extends(o,t),o.prototype._populateSelectedValues=function(){var e=this.convertFormStringToArray(this.field.data.peek());if(!this.lookupMulti)return void(this.selectedValue=i.observable(e.length>0?e[0]:-1));var t=[];if(e&&e.length)for(var o=0;o<e.length;o++)o/2===Math.floor(o/2)&&t.push(e[o]);this.selectedValues=i.observableArray(t)},o.prototype._populateChoiceArray=function(e){var t=[],i=Boolean(e)?e.length:0;if(this.lookupMulti||t.push({display:n.strings.none,value:""}),0>=i)return t;for(var o=0;i>o;o++)t.push({display:e[o][this.displayFieldName],value:e[o][this.valueFieldName]});return t},o}(o);return r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/focus/SelectOnFocusBinding",["require","exports","../BaseBinding"],function(e,t,i){var o=function(e){function t(t){e.call(this,t);var i=this.valueAccessor();this._isPermanent="object"==typeof i&&i.isPermanent||!1,document.activeElement===this.element&&this._select(),this.events.on(this.element,"focus",this._onFocus),this.events.on(this.element,"focusin",this._onFocus),this.events.on(this.element,"mouseup",this._onMouseUp)}return __extends(t,e),t.prototype._select=function(){return this._isPermanent||!this._hasSelected?(this.element.select(),this._hasSelected=!0,!0):!1},t.prototype._onFocus=function(){return this._select(),!0},t.prototype._onMouseUp=function(){return this._select()?!1:void 0},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/itemNameEditor/ItemNameEditorViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","./ItemNameEditor.resx","../../bindings/focus/SelectOnFocusBinding"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this.namePlaceholder=n.strings.NewNamePlaceholder,this.nameLabel=n.strings.NewNameLabel,this.name=t.name,this.extension=t.extension,this.status=t.status||i.observable(""),this.hasError=t.hasError||i.observable(!1),this.isEnabled=t.isEnabled||i.observable(!0),this.hasFocus=t.hasFocus||i.observable(!0),this.addBindingHandlers({selectOnFocus:r.default})}return __extends(t,e),t}(o);return s}),define("odsp-next/controls/itemNameEditor/ItemNameEditor.html",[],function(){return'<div class=od-ItemNameEditor data-bind="css: { \'od-ItemNameEditor--noExtension\': !extension }"><div class=ms-TextField><label class="od-ItemNameEditor-nameLabel ms-Label" data-bind="text: nameLabel"></label> <span class=od-ItemNameEditor-input><input class=ms-TextField-field type=text data-bind="value: name, textInput: name, hasFocus: hasFocus, selectOnFocus, attr: { placeholder: namePlaceholder }, css: { \'od-ItemNameEditor-input--error\': hasError }, enable: isEnabled, automation: \'itemNameEditor-Input\'"></span> <span class=od-ItemNameEditor-extension data-bind="text: extension"></span></div><div class=od-ItemNameEditor-status data-bind="text: status, css: { \'od-ItemNameEditor-status--error\': hasError }"></div></div>'}),define("odsp-next/controls/itemNameEditor/ItemNameEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ItemNameEditor-nameLabel.ms-Label{display:none}.od-ItemNameEditor-input{display:table-cell;width:100%}.od-ItemNameEditor-extension{display:table-cell}html[dir=ltr] .od-ItemNameEditor-extension{padding-left:5px}html[dir=rtl] .od-ItemNameEditor-extension{padding-right:5px}.od-ItemNameEditor--noExtension .od-ItemNameEditor-input{display:block;width:auto}.od-ItemNameEditor--noExtension .od-ItemNameEditor-extension{display:none}.od-ItemNameEditor-status{margin-top:12px;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400;color:#094AB2}.od-ItemNameEditor-status--error{color:#a80000}.od-ItemNameEditor-input--error{border-color:#a80000!important}")}),define("odsp-next/controls/itemNameEditor/ItemNameEditor",["require","exports","./ItemNameEditorViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ItemNameEditor.html","./ItemNameEditor.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-item-name-editor",template:e("./ItemNameEditor.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/controls/fieldEditor/fileEditor/FileEditor.html",[],function(){return'<div data-bind="component: { name : itemNameEditorTagName, params: itemNameEditorParams }"></div>'});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/fileEditor/FileEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../itemNameEditor/ItemNameEditor","./FileEditor.html"],function(e,t,i,o,n){var r=function(t){function o(o){var r=this;t.call(this,o),this.controlHtml=e("./FileEditor.html"),this.itemNameEditorTagName=n.tagName;var s,a=this.field.data(),l=a.lastIndexOf("."),d=a.lastIndexOf(".")>=0?a.substring(l):"";this.itemNameEditorParams={name:i.pureComputed({read:function(){return a=r.field.data(),l=a.lastIndexOf("."),s=l>0?a.substring(0,l):a},write:function(e){r.field.data(""!==d?e+d:e)}}),extension:d}}return __extends(o,t),o}(o);return r}),define("odsp-next/controls/fieldEditor/choiceEditor/DropdownChoiceEditor.html",[],function(){return'<!--ko ifnot: allowFillIn--><select class=od-DropdownChoice-select " data-bind="options: choices, value: selectedValue"></select><!--/ko--><!--ko if: allowFillIn--><div class=od-ChoiceEditor-container><label class=od-ChoiceEditor-label data-bind="click: selectDropdown"><input class=od-RadioChoice-input type=radio data-bind="attr: { name: $parent.groupName }, checked: selectedChoiceIndex, checkedValue: dropdownChoiceCheckedValue"><select class=od-RadioChoice-select data-bind="options: choices, value: selectedValue"></select></label><div data-bind=click:setFocusOnFillInInput><label class=od-ChoiceEditor-label><input class=od-RadioChoice-input type=radio data-bind="attr: { name: $parent.groupName }, checked: selectedChoiceIndex, checkedValue: fillInChoiceCheckedValue"> <span class=od-RadioChoice-span data-bind="text: fillInChoiceDisplayText"></span></label> <input type=text class=od-ChoiceEditor-fillin data-bind="value: fillInChoiceValue, element: fillInInput"></div></div><!--/ko-->'}),define("odsp-next/controls/fieldEditor/choiceEditor/ChoiceEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ChoiceEditor-fillin,.od-ChoiceEditor-fillin:focus,.od-ChoiceEditor-fillin:hover{outline:transparent solid 1px}.od-SingleChoiceEditor .ms-ContextualMenu-link,.od-SingleChoiceEditor .ms-Dropdown-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.od-CheckboxChoice-input,.od-CheckboxChoice-span,.od-RadioChoice-input,.od-RadioChoice-span{vertical-align:middle}.od-DropdownChoice-select,.od-RadioChoice-select{min-height:30px;font-family:'Segoe UI Light WestEuropean','Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;padding:6px 10px 8px;border:1px solid #c8c8c8;background-color:#fff}.od-DropdownChoice-select:hover,.od-RadioChoice-select:hover{border-color:#767676}.od-DropdownChoice-select:focus,.od-RadioChoice-select:focus{border-color:#094AB2}.od-DropdownChoice-select{width:100%}.od-RadioChoice-select{vertical-align:middle;min-width:40%;max-width:80%;margin-left:4px}.od-ChoiceEditor-fillin{box-sizing:border-box;margin:0;box-shadow:none;border:1px solid #c8c8c8;border-radius:0;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;color:#333;height:32px;padding:6px 10px 8px;width:100%;min-width:180px}.od-ChoiceEditor-fillin:hover{border-color:#767676}.od-ChoiceEditor-fillin:focus{border-color:#0078d7}.od-ChoiceEditor-fillin:-moz-placeholder,.od-ChoiceEditor-fillin:-ms-input-placeholder,.od-ChoiceEditor-fillin::-moz-placeholder,.od-ChoiceEditor-fillin::-webkit-input-placeholder{color:#666}.od-ChoiceEditor-label{display:block;margin-bottom:3px;font-family:'Segoe UI Light WestEuropean','Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif}.od-ChoiceEditor-container{width:100%;box-sizing:border-box;background:#f4f4f4;padding:5px}.od-SingleChoiceEditor-caretDown{color:#666;font-size:17px;position:absolute;right:9px;top:9px}.od-SingleChoiceEditor .ms-TextField{position:relative;margin:0;background-color:#fff}.od-SingleChoiceEditor .ms-TextField-field{border:1px solid transparent;outline:0}.od-SingleChoiceEditor .ms-TextField-field:focus{border-bottom:1px solid #0078d7}.od-SingleChoiceEditor .ms-ContextualMenu{width:215px;box-shadow:none;border-top:0}.od-SingleChoiceEditor .ms-ContextualMenu-item .has-separator{border-bottom:1px solid #a6a6a6}.od-SingleChoiceEditor .ms-Dropdown-title{box-sizing:border-box;margin:0;border:1px solid transparent;cursor:pointer;display:block;height:30px;padding:4px 33px 5px 8px;position:relative;outline:0}.od-SingleChoiceEditor .ms-Dropdown-title:focus{border-bottom:1px solid #0078d7}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/choiceEditor/DropdownChoiceEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../FieldEditor.resx","../../../bindings/element/ElementBinding","./DropdownChoiceEditor.html","./ChoiceEditor.css"],function(e,t,i,o,n,r){var s=function(t){function o(o){var s=this;t.call(this,o),this.controlHtml=e("./DropdownChoiceEditor.html"),this.fillInChoiceCheckedValue=-1,this.dropdownChoiceCheckedValue=0;var a=this.field.schema;this.choices=a.Choices,this.selectedValue=i.observable(this.field.data.peek()),this.allowFillIn=a.FillInChoice,this.groupName="od-DropdownChoiceEditor-"+this.inputElementId,this.allowFillIn&&(this.addBindingHandlers({element:r}),this.selectedChoiceIndex=i.observable(this.choices.indexOf(this.field.data.peek())>-1?0:-1),this.fillInChoiceDisplayText=n.strings.ChoiceFillInDisplayText,this.fillInInput=i.observable(null),this.fillInChoiceValue=i.observable(""),this.dropdownElement=i.observable(null),this.selectedChoiceIndex()===this.fillInChoiceCheckedValue&&this.fillInChoiceValue(this.field.data.peek()),this.subscribe(this.selectedChoiceIndex,function(){s.field.data(s.selectedChoiceIndex()!==s.fillInChoiceCheckedValue?s.selectedValue():s.fillInChoiceValue())}),this.subscribe(this.fillInChoiceValue,function(e){s.field.data(e)})),this.subscribe(this.selectedValue,function(e){s.field.data(e)})}return __extends(o,t),o.prototype.selectDropdown=function(){return this.selectedChoiceIndex(this.dropdownChoiceCheckedValue),!0},o.prototype.setFocusOnFillInInput=function(){this.selectedChoiceIndex(this.fillInChoiceCheckedValue);var e=this.fillInInput();return e&&(e.focus(),e.select()),!0},o}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),define("odsp-next/controls/fieldEditor/choiceEditor/ChoiceEditorHelper",["require","exports","knockout"],function(e,t,i){var o=function(){function e(){}return e.getChoicesArray=function(e,t,i){for(var o=[],r=[],s=[],a=t.schema,l=a.Choices,d=t.data.peek(),c=0;c<l.length;c++){var p=l[c],u=new n(p,p);r.push(u),p===d&&i(u)}e=e.split("<br>")[0];var h=document.createElement("DIV");h.innerHTML=e;var m=h.querySelector("#diidFilter"+t.schema.Name);if(null!=m)for(var g=m.childNodes.length,f=m.childNodes,v=1;g>v;v++){var b=f[v].value.toString();if(b&&-1===l.indexOf(b)){var x=new n(b,b);s.push(x),b===d&&i(x)}}return s.length>0&&r[r.length-1].hasSeparator(!0),o=r.concat(s)},e}();t.ChoiceEditorHelper=o;var n=function(){function e(e,t){this.selected=i.observable(!1),this.focused=i.observable(!1),this.hasSeparator=i.observable(!1),this.value=t,this.display=e}return e}();t.Choice=n,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),define("odsp-next/controls/fieldEditor/choiceEditor/SingleChoiceEditor.html",[],function(){return"<div class=od-SingleChoiceEditor><div class=ms-TextField><!--ko if: allowFillIn--><input class=ms-TextField-field data-bind=\"attr: {placeholder: fieldPlaceHolder}, textInput: fillInChoiceValue, hasFocus: isFocused, keyboard: { allowInputEvents: true, mappings: { Enter: onEnter, Esc: onEsc } }, selection: { data: choices, mode: 'single', direction: 'vertical', selectionModel: selectionModel, allowInputEvents: true, focused: selectedChoice }\"><!--/ko--><!--ko ifnot: allowFillIn--><span class=ms-Dropdown-title tabindex=0 data-bind=\"text: selectedChoiceDisplayValue, keyboard: { Enter: onEnter, Esc: onEsc }, hasFocus: isFocused, selection: { data: choices, mode: 'single', direction: 'vertical', selectionModel: selectionModel, allowInputEvents: true, focused: selectedChoice }\"></span><!--/ko--><i class=\"od-SingleChoiceEditor-caretDown ms-Icon ms-Icon--caretDown\"></i></div><ul class=ms-ContextualMenu data-bind=\"foreach: { data: choices, as: 'choice' }, css: {'is-open': isFocused}\"><li class=ms-ContextualMenu-item data-bind=\"css: { 'has-separator': choice.hasSeparator }\"><a class=ms-ContextualMenu-link href=# data-bind=\"event: { mousedown: $parent.selectChoice.bind($parent) }, css: { 'is-selected': choice.selected, 'has-separator': choice.hasSeparator }, attr: { title: choice.display }\"><span class=ms-ContextualMenu-linkText data-bind=\"text: choice.display\"></span></a></li></ul></div>"});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/choiceEditor/SingleChoiceEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../../models/clientForm/IClientForm","../../../bindings/selection/SelectionBinding","../../../models/selection/SelectionModel","./ChoiceEditorHelper","../../../resources/DataSourceResourceKeys","../../../bindings/keyboard/KeyboardBinding","./SingleChoiceEditor.html","./ChoiceEditor.css"],function(e,t,i,o,n,r,s,a,l,d){var c=function(t){function o(o){var a=this;t.call(this,o),this.controlHtml=e("./SingleChoiceEditor.html"),this._clientFormDataSource=this.resources.consume(l.clientForm);var c=this.field.schema;this.selectedChoice=i.observable(null),this.selectionModel=new s,this.allowFillIn=c.FillInChoice,this.choices=i.observableArray([]),this._choiceHash={},this._populateChoiceArray(),this.fillInChoiceValue=i.observable(null),this.isFocused=i.observable(!1),this.inlineEdit=!0,this.selectedChoiceDisplayValue=this.createPureComputed(function(){return a.selectedChoice()?a.selectedChoice().display:void 0}),this.addBindingHandlers({selection:r,keyboard:d}),this.subscribe(this.field.mode,function(e){e===n.ClientFormMode.edit&&a.isFocused(!0)}),this.subscribe(this.isFocused,function(e){e||a.field.mode.peek()!==n.ClientFormMode.edit||a.fieldsManager.globalEditMode.peek()||a.field.mode(n.ClientFormMode.display)}),this.beforeSave=function(){var e=a.fillInChoiceValue.peek();e&&a._addFillInChoice(e),a.selectedChoice()&&a.field.data(a.selectedChoice().value)}}return __extends(o,t),o.prototype.onEnter=function(){var e=this.fillInChoiceValue.peek();return(e||this.selectedChoice())&&(e&&this._addFillInChoice(e),this.fieldsManager.globalEditMode.peek()?this.isFocused(!1):this.saveChanges()),!1},o.prototype.onEsc=function(){return this.fillInChoiceValue(""),this.selectedChoice(null),this.isFocused(!1),this.isReadFocused(!0),!1},o.prototype.selectChoice=function(e){this.fillInChoiceValue(""),this.selectionModel.selectItem(e),this.fieldsManager.globalEditMode.peek()?this.isFocused(!1):this.saveChanges()},o.prototype._addFillInChoice=function(e){var t=this._choiceHash[e];if(!t){var i=this.field.schema.Choices.length;i===this.choices().length&&this.choices()[i-1].hasSeparator(!0),t=new a.Choice(e,e),this.choices.push(t)}this.fillInChoiceValue(""),this.selectionModel.selectItem(t)},o.prototype._populateChoiceArray=function(){var e=this;this._clientFormDataSource.getFieldFilterData(this.field.schema.Name).then(function(t){var i=a.ChoiceEditorHelper.getChoicesArray(t,e.field,e.selectedChoice);e.choices(i),e.selectedChoice()&&e.selectionModel.selection([e.selectedChoice()]);for(var o=0;o<i.length;o++){var n=i[o];e._choiceHash[n.value]=n}})},o}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c}),define("odsp-next/controls/fieldEditor/choiceEditor/ChoiceFormatType",["require","exports"],function(){var e;return function(e){e[e.DropDown=0]="DropDown",e[e.Radio=1]="Radio"}(e||(e={})),e}),define("odsp-next/controls/fieldEditor/choiceEditor/RadioChoiceEditor.html",[],function(){return'<div class=od-ChoiceEditor-container><div data-bind="foreach: choices"><label class=od-ChoiceEditor-label><input class=od-RadioChoice-input type=radio data-bind="attr: { name: $parent.groupName }, checked: $parent.selectedChoiceIndex, checkedValue: $index"> <span class=od-RadioChoice-span data-bind=text:$data></span></label></div><!--ko if: allowFillIn--><div data-bind=click:setFocusOnFillInInput><label class=od-ChoiceEditor-label><input class=od-RadioChoice-input type=radio data-bind="attr: { name: $parent.groupName }, checked: selectedChoiceIndex, checkedValue: fillInChoiceCheckedValue"> <span class=od-RadioChoice-span data-bind="text: fillInChoiceDisplayText"></span></label> <input type=text class=od-ChoiceEditor-fillin data-bind="value: fillInChoiceValue, element: fillInInput"></div><!--/ko--></div>'});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/choiceEditor/RadioChoiceEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../../models/clientForm/IClientForm","../FieldEditor.resx","../../../bindings/element/ElementBinding","./RadioChoiceEditor.html","./ChoiceEditor.css"],function(e,t,i,o,n,r,s){var a=function(t){function o(o){var a=this;t.call(this,o),this.controlHtml=e("./RadioChoiceEditor.html"),this.fillInChoiceCheckedValue=-1;var l=this.field.schema;this.choices=l.Choices,this.selectedChoiceIndex=i.observable(this.choices.indexOf(this.field.data.peek())),this.allowFillIn=l.FillInChoice,this.groupName="od-RadioChoiceEditor-"+this.inputElementId,this.allowFillIn&&(this.addBindingHandlers({element:s}),this.fillInChoiceDisplayText=r.strings.ChoiceFillInDisplayText,this.fillInInput=i.observable(null),this.fillInChoiceValue=i.observable(""),this.selectedChoiceIndex()===this.fillInChoiceCheckedValue&&this.fillInChoiceValue(this.field.data.peek()),this.subscribe(this.fillInChoiceValue,function(e){a.field.mode()===n.ClientFormMode.edit&&a.selectedChoiceIndex()===a.fillInChoiceCheckedValue&&a.field.data(e)})),this.subscribe(this.selectedChoiceIndex,function(e){a.field.mode()===n.ClientFormMode.edit&&e!==a.fillInChoiceCheckedValue&&a.field.data(a.choices[e])})}return __extends(o,t),o.prototype.setFocusOnFillInInput=function(){this.selectedChoiceIndex(this.fillInChoiceCheckedValue);var e=this.fillInInput();return e&&(e.focus(),e.select()),!0},o}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}),define("odsp-next/controls/fieldEditor/choiceEditor/MultiChoiceEditor.html",[],function(){return'<div class=od-ChoiceEditor-container><div data-bind="foreach: choices"><label class=od-ChoiceEditor-label><input class=od-CheckboxChoice-input type=checkbox data-bind="checked: $parent.selectedChoices, checkedValue: $index"> <span class=od-CheckboxChoice-span data-bind=text:$data></span></label></div><!--ko if: allowFillIn--><div><label class=od-ChoiceEditor-label data-bind="click: toggleFillInChoice"><input class=od-CheckboxChoice-input type=checkbox data-bind="checked: selectedChoices, checkedValue: fillInChoiceCheckedValue"> <span class=od-CheckboxChoice-span data-bind="text: fillInChoiceDisplayText"></span></label> <input type=text class=od-ChoiceEditor-fillin data-bind="value: fillInChoiceValue, element: fillInInput, click: selectFillInChoice, attr: { tabindex: fillInInputTabIndex }"></div><!--/ko--></div>'});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/choiceEditor/MultiChoiceEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../FieldEditor.resx","../../../models/clientForm/IClientForm","../../../bindings/element/ElementBinding","./MultiChoiceEditor.html","./ChoiceEditor.css"],function(e,t,i,o,n,r,s){var a=function(t){function o(o){var a=this;t.call(this,o),this.controlHtml=e("./MultiChoiceEditor.html"),this.fillInChoiceCheckedValue=-1;var l=this.field.schema;this.choices=l.MultiChoices,this.allowFillIn=l.FillInChoice,this.allowFillIn&&(this.fillInChoiceDisplayText=n.strings.ChoiceFillInDisplayText,this.fillInChoiceValue=i.observable(""),this.fillInInput=i.observable(null),this.fillInInputTabIndex=i.observable(-1),this.addBindingHandlers({element:s})),this.selectedChoices=i.observableArray(this._getSelectedChoicesArray(this.convertFormStringToArray(this.field.data.peek()))),this.subscribe(this.selectedChoices,function(e){a.field.mode()===r.ClientFormMode.edit&&a.field.data(a._getMultiChoiceValue(e))}),this.allowFillIn&&this.subscribe(this.fillInChoiceValue,function(){a.field.mode()===r.ClientFormMode.edit&&a.field.data(a._getMultiChoiceValue(a.selectedChoices()))})}return __extends(o,t),o.prototype.toggleFillInChoice=function(e,t){return"INPUT"===t.srcElement.tagName&&(-1!==this.selectedChoices().indexOf(this.fillInChoiceCheckedValue)?(this.fillInInputTabIndex(0),this.fillInInput().focus(),this.fillInInput().select()):this.fillInInputTabIndex(-1)),!0},o.prototype.selectFillInChoice=function(){return-1===this.selectedChoices().indexOf(this.fillInChoiceCheckedValue)&&(this.selectedChoices.push(this.fillInChoiceCheckedValue),this.fillInInputTabIndex(0),this.fillInInput().focus(),this.fillInInput().select()),!0},o.prototype._getSelectedChoicesArray=function(e){for(var t=[],i=0;i<e.length;i++){for(var o=e[i],n=!0,r=0;r<this.choices.length;r++)if(o===this.choices[r]){t.push(r),n=!1;break}n&&(t.push(-1),this.fillInChoiceValue&&this.fillInChoiceValue(o))}return t},o.prototype._getMultiChoiceValue=function(e){for(var t="",i=";#",o=0;o<e.length;o++){var n=e[o];t+=i,n!==this.fillInChoiceCheckedValue?t+=this.choices[n]:this.allowFillIn&&this.fillInChoiceValue.peek()&&(t+=this.fillInChoiceValue.peek())}return t+=t?i:""},o}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}),define("odsp-next/controls/taxonomy/suggestions/TaxonomySuggestion",["require","exports","knockout"],function(e,t,i){var o=function(){function e(e){var t=this;this.selected=i.observable(!1),this.focused=i.observable(!1),this.term=i.observable(null),this.term(e),this.id="",this.rowTitle=i.pureComputed(function(){return t.term().label+t.term().paths[0]})}return e}();return o}),define("odsp-next/controls/taxonomy/term/TaxonomyTermDisplayMode",["require","exports"],function(){var e;return function(e){e[e.inSuggestion=0]="inSuggestion",e[e.inFormField=1]="inFormField"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/taxonomy/suggestions/TaxonomySuggestionsViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","../../../bindings/dismiss/DismissBinding","../tagging/TaxonomyTagging.resx","./TaxonomySuggestion","../term/TaxonomyTermDisplayMode"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){var i=this;e.call(this),this.termDisplaymode=a.inSuggestion,this.addBindingHandlers({dismiss:n}),this.context=t,this.headerText=o.observable(r.strings.SuggestionDropDownHeader),this.context.suggestedTerms&&this.context.suggestedTerms.peek().length>0&&this.updateSuggestions(this.context.suggestedTerms.peek()),this.subscribe(this.context.suggestedTerms,function(e){i.updateSuggestions(e)}),this.subscribe(this.context.trimmingLimit,function(e){i.updateTrimmingLimit(e)})}return __extends(t,e),t.prototype.onItemClicked=function(e){var t=e;this.context.selectedTerm(t.term.peek()),this.context.showingSuggestions(!1)},t.prototype.close=function(){this.context.showingSuggestions(!1)},t.prototype.updateSuggestions=function(e){var t=[],i=this.context.trimmingLimit.peek();if(e&&e.length>0){e=e.sort(function(e,t){return e.label.toLowerCase()===t.label.toLowerCase()?0:e.label.toLowerCase()<t.label.toLowerCase()?-1:1}),i>0&&e.length>i&&(e=e.slice(0,i-1));for(var o=0;o<e.length;o++){var n=e[o];t.push(new s(n))}}t.length>0&&this.context.suggestions(t)},t.prototype.updateTrimmingLimit=function(e){var t=this.context.suggestions();if(t&&e>0&&t.length>e)for(var i=t.length-e,o=0;i>o;o++)t.pop();this.context.suggestions.valueHasMutated()},t}(i);return l}),define("odsp-next/controls/taxonomy/suggestions/TaxonomySuggestions.html",[],function(){return'<div class=TaxonomySuggestions-Container data-bind="dismiss: {isOpen:context.showingSuggestions, close: close}"><div class=TaxonomySuggestions-Header id=TaxonomySuggestions-Header data-bind="text: headerText"></div><!--ko foreach: context.suggestions--><div class=TaxonomySuggestions-Suggestion data-bind="attr: {title: rowTitle()}, css: {\'AutoFill-focused\': $data.focused, \'AutoFill-separator\': $data.hasSeparator }, click: $parent.onItemClicked.bind($parent), scrollIntoView: { isSelected: $data.focused }"><div data-bind="component: { name: \'ms-taxonomyTerm\', params: { term: term, displaymode: $parent.termDisplaymode, starts: $parent.context.starts } }"></div></div><!--/ko--></div>'}),define("odsp-next/controls/taxonomy/suggestions/TaxonomySuggestions.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".TaxonomySuggestions-Container{border:1px solid #a6a6a6;overflow-y:auto;position:absolute;background-color:#fff;max-height:300px;min-width:300px;max-width:400px;z-index:3002}.TaxonomySuggestions-Suggestion{box-sizing:border-box;overflow:hidden;width:100%}.TaxonomySuggestions-Suggestion.AutoFill-focused{background-color:#a8d1ef;outline:transparent solid 1px}.TaxonomySuggestions-Suggestion:not(.AutoFill-focused):hover{background-color:#eaeaea}.TaxonomySuggestions-Suggestion.AutoFill-separator{border-bottom:1px solid #a6a6a6}")}),define("odsp-next/controls/taxonomy/suggestions/TaxonomySuggestions",["require","exports","./TaxonomySuggestionsViewModel","odsp-shared/utilities/knockout/ComponentFactory","./TaxonomySuggestions.html","./TaxonomySuggestions.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-taxonomySuggestions",template:e("./TaxonomySuggestions.html"),viewModel:i,synchronous:!0});
Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/taxonomy/term/TaxonomyTermViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","./TaxonomyTermDisplayMode"],function(e,t,i,o,n){var r=function(e){function t(i){var r=this;e.call(this),this.context=i,this.term=o.isObservable(this.context.term)?this.context.term:o.observable(this.context.term),this.inSuggestionMode=this.createPureComputed(function(){return r.context?r.context.displaymode===n.inSuggestion:!1}),this.inFormFieldMode=this.createPureComputed(function(){return r.context?r.context.displaymode===n.inFormField:!1}),this.startingLabel=this.createPureComputed(function(){return r.term&&r.term()&&r.term().label&&0===r.term().label.toLowerCase().indexOf(r.context.starts().toLowerCase())&&r.term().label.length>=r.context.starts().length?r.term().label.substr(0,r.context.starts().length):null}),this.remainingLabel=this.createPureComputed(function(){return r.term&&r.term()&&r.term().label&&0===r.term().label.toLowerCase().indexOf(r.context.starts().toLowerCase())&&r.term().label.length>=r.context.starts().length?r.term().label.substr(r.context.starts().length):null}),this.labelWithDelimter=this.createPureComputed(function(){return r.term().label+t.TERM_DELIMITER}),this.tooltip=this.createPureComputed(function(){return r.term().paths&&r.term().paths.length>0?r.term().label+" "+r.term().paths[0]:r.term().label}),this.termClass=this.createPureComputed(function(){return" TaxonomyTerm-inFormFieldMode"}),this.focusedInField=this.addDisposable(o.pureComputed({read:function(){return r.inFormFieldMode()&&r.context.index()===r.context.focusedTermIndex()},write:function(e){e&&r.context.focusedTermIndex(r.context.index.peek())}}))}return __extends(t,e),t.prototype.onFocus=function(e,t){this.context.taggingModel&&this.context.taggingModel.taggedTermCursorToEnd&&(this.placeCaretAtEnd(t.currentTarget),this.context.taggingModel.taggedTermCursorToEnd=!1)},t.prototype.onClick=function(e,t){return t.cancelBubble=!0,t.stopPropagation(),!1},t.prototype.placeCaretAtEnd=function(e){if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(e),o.collapse(!1),o.select()}},t.INVALID_TERM_ID="00000000-0000-0000-0000-000000000000",t.LABEL_ID_DELIMITER="|",t.TERM_DELIMITER=";",t}(i);return r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/taxonomy/tree/TaxonomyTreeViewModel",["require","exports","odsp-shared/base/ViewModel","./TaxonomyTree.resx","../../../resources/DataSourceResourceKeys","../../progressSpinnerFlat/ProgressSpinnerFlat","../term/TaxonomyTermViewModel","knockout","odsp-utilities/domUtils/DomUtils"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){e.call(this,t),this.loadingLabel=o.strings.TaxonomyTreeLoadingLabel,this.progressSpinnerFlatTagName=r.tagName,this.taggingParams=t.taggingParams,this.taggedTerms=a.isObservable(this.taggingParams.taggedTerms)?this.taggingParams.taggedTerms:a.observableArray([]),this.treeOpen=a.isObservable(t.treeOpen)?t.treeOpen:a.observable(!0),this.isLoading=a.observable(!0),this.taxonomyTreeUrl=this.getTaxonomyTreeUrl()}return __extends(t,e),t.prototype.iframeOnLoad=function(e,t){var i=this,o=t.target;if(o&&o.contentWindow){var n=o.contentWindow.document,r=l.getElementByTagAndPartialId(n,"input","OkButton"),s=l.getElementByTagAndPartialId(n,"input","CancelButton");r&&s&&(r.onclickListenerAdded||(r.onclickListenerAdded=!0,this.events.on(r,"click",function(){i.handleTreeDialogResults(n),i.treeOpen(!1)})),s.onclickListenerAdded||(s.onclickListenerAdded=!0,this.events.on(s,"click",function(){i.treeOpen(!1)}))),this.isLoading(!1),this.treeOpen(!0),this.setInnerDialogStyle(n),this.async.setTimeout(function(){o.style.height&&"0px"!==o.style.height||(o.style.height=.618*document.body.clientHeight+"px")},200)}},t.prototype.handleTreeDialogResults=function(e){var t=l.getElementByTagAndPartialId(e,"input","FieldEditorHiddenInput");if(t){var i=t.value;try{var o=i.split(s.TERM_DELIMITER),n=o.map(function(e){var t=e.split(s.LABEL_ID_DELIMITER),i={};return i.label=t[0],i.termId=t[1],i.isValid=i.termId!==s.INVALID_TERM_ID,i});0===n.filter(function(e){return!e.isValid}).length&&this.taggedTerms(n)}catch(r){}}},t.prototype.getTaxonomyTreeUrl=function(){var e=this.resources.consume(n.taxonomy);return e.getTaxonomyTreeUrl(this.convertToTermsRawString(this.taggedTerms.peek()),{name:this.taggingParams.fieldName,id:this.taggingParams.fieldId,isMulti:this.taggingParams.allowMultipleValues},this.taggingParams.taxonomyQueryParams)},t.prototype.convertToTermsRawString=function(e){for(var t="",i=0;i<e.length;i++){var o=e[i];o.isValid&&(t+=o.label+s.LABEL_ID_DELIMITER+o.termId,i<e.length-1&&(t+=s.TERM_DELIMITER))}return t},t.prototype.setInnerDialogStyle=function(e){var t=e.getElementById("FieldEditoreditableRegion");if(t){var i=t.parentElement;i.style.width="100%"}},t}(i);return d}),define("odsp-next/controls/taxonomy/tree/TaxonomyTree.html",[],function(){return'<div class=taxonomy-tree><iframe class=taxonomy-tree-iframe data-bind="attr: {src: taxonomyTreeUrl}, event: {load: iframeOnLoad}, visible: !isLoading()"></iframe><div class=taxonomy-tree-ProgressContainer data-bind="visible: isLoading"><div data-bind="component: {name: progressSpinnerFlatTagName}"></div></div></div>'}),define("odsp-next/controls/taxonomy/tree/TaxonomyTree.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".taxonomy-tree iframe{border:none;width:100%}.taxonomy-tree .taxonomy-tree-ProgressContainer{width:250px;padding:15px 0}")}),define("odsp-next/controls/taxonomy/tree/TaxonomyTree",["require","exports","./TaxonomyTreeViewModel","odsp-shared/utilities/knockout/ComponentFactory","./TaxonomyTree.html","./TaxonomyTree.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-Taxonomy-Tree-Tagging",template:e("./TaxonomyTree.html"),viewModel:i,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/taxonomy/term/TaxonomyTerm.html",[],function(){return'<div class=TaxonomyTerm data-bind="attr:{ title: tooltip() }, css: termClass"><!--ko if: inSuggestionMode()--><span class=Termlabel-userinput data-bind="text: startingLabel()"></span><!----><span class=Termlabel-remaining data-bind="text: remainingLabel()"></span> <span class=Termlabel-path data-bind="text: term().paths[0], visible: !!term().paths"></span><!--/ko--><!--ko if: inFormFieldMode()--><span class=Termlabel-valid contenteditable=true spellcheck=false data-bind="text: labelWithDelimter(), click: onClick, event: {input: context.taggingModel.onTaggedTermTextChange.bind(context.taggingModel, context.index), keydown: context.taggingModel.onTaggedTermKeydown.bind(context.taggingModel, context.index), focus: onFocus }, hasFocus: focusedInField"></span>&nbsp;<!--/ko--></div>'}),define("odsp-next/controls/taxonomy/term/TaxonomyTerm.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles("html[dir=ltr] .TaxonomyTerm .Termlabel-path,html[dir=rtl] .TaxonomyTerm .Termlabel-path{left:0}.TaxonomyTerm .Termlabel-invalid,.TaxonomyTerm .Termlabel-remaining,.TaxonomyTerm .Termlabel-valid{position:relative;display:inline}.TaxonomyTerm{box-sizing:border-box;margin:0;padding:0;box-shadow:none;color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:14px;font-weight:400;position:relative;width:100%}.TaxonomyTerm .Termlabel-userinput{position:relative;display:inline;background-color:#ff0}.TaxonomyTerm .Termlabel-path{margin:0;overflow:hidden}html[dir=ltr] .TaxonomyTerm .Termlabel-path,html[dir=rtl] .TaxonomyTerm .Termlabel-path{right:0}.TaxonomyTerm .Termlabel-valid{text-decoration:underline;padding-left:2px;left:1px}.TaxonomyTerm .Termlabel-valid:focus{outline:0;border:0}.TaxonomyTerm .Termlabel-invalid{border-bottom:dashed;color:red;left:1px}.TaxonomyTerm.TaxonomyTerm-inFormFieldMode{display:inline}")}),define("odsp-next/controls/taxonomy/term/TaxonomyTerm",["require","exports","./TaxonomyTermViewModel","odsp-shared/utilities/knockout/ComponentFactory","./TaxonomyTerm.html","./TaxonomyTerm.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-taxonomyTerm",template:e("./TaxonomyTerm.html"),viewModel:i,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/taxonomy/tagging/TaxonomyTaggingViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","odsp-utilities/logging/events/Qos.event","../../../resources/ProviderResourceKeys","../../../resources/DataSourceResourceKeys","../../../bindings/selection/SelectionBinding","../../../bindings/keyboard/KeyboardBinding","../../../bindings/toggle/ToggleBinding","../../../bindings/scrollIntoView/ScrollIntoViewBinding","../../../models/selection/SelectionModel","../suggestions/TaxonomySuggestions","../tree/TaxonomyTree","../term/TaxonomyTerm","./TaxonomyTagging.resx","../term/TaxonomyTermDisplayMode","../../progressSpinnerFlat/ProgressSpinnerFlat","../../../models/dialog/DialogState","../../../utilities/browser/WindowSize"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x){var y=function(t){function i(i){var n=this;t.call(this),this.inputTitle=g.strings.InputHint,this.taxonomyTermTagName=m.default.tagName,this.taxonomySuggestionsTagName=u.default.tagName,this.progressSpinnerFlatTagName=v.tagName,this.taxonomyTreeTagName=h.default.tagName,this.placeholderText=g.strings.InputPlaceholderText,this.termDisplaymode=f.inFormField,this.error=o.observable(""),this.selectionModel=new p,this.addBindingHandlers({selection:a,keyboard:l,scrollIntoView:c,toggle:d}),this.dataProvider=this.resources.consume(r.taxonomy),this.taggingParams=i,this.queryParams=i.taxonomyQueryParams,this.taggedTerms=i.taggedTerms||o.observableArray([]),this.allowMultipleValues=i.allowMultipleValues,this.userInput=o.observable(""),this.suggestionQueryRunning=o.observable(!1),this.textBoxIsFocused=o.observable(!1),this.error=o.observable(null),this.focusedSuggestion=o.observable(null),this.treeOpen=o.observable(!1);var b=this.resources.consume(s.settings),x=b.mediaBaseUrl;this.treeToggleImg=e.toUrl(x+"/images/taxonomy/taxonomycopyterm.png"),this.treeToggleLabel=g.strings.WebTaggingDialogTitle+i.fieldTitle,this.showPlaceholder=this.createPureComputed(function(){return 0===n.taggedTerms().length&&!n.textBoxIsFocused()&&0===n.userInput().length}),this.disableInputBox=this.createPureComputed(function(){return!n.allowMultipleValues&&1===n.taggedTerms().length}),this.matchQueryRunning=!1,this.taggedTermCursorToEnd=!1,this.focusedTermIndex=o.observable(-1),this.subscribe(this.userInput,function(e){n.getSuggestionsForInputText(e)}),this.initSuggestionContext(),this.subscribe(this.suggestionContext.selectedTerm,function(e){n.handleSelectedSuggestion(e)}),this.inputSize=this.createPureComputed(function(){return n.userInput()?n.userInput().length+1:1})}return __extends(i,t),i.prototype.handleInputFocus=function(){this.textBoxIsFocused()||this.textBoxIsFocused(!0),this.userInput().length>0&&!this.suggestionContext.showingSuggestions()&&this.getSuggestionsForInputText(this.userInput.peek()),this.focusedTermIndex(-1)},i.prototype.handleInputBlur=function(){this.textBoxIsFocused()&&this.textBoxIsFocused(!1)},i.prototype.onEnter=function(){var e=this.selectionModel.selection();return e&&1===e.length&&this.suggestionContext.selectedTerm(e[0].term()),!1},i.prototype.onTab=function(){var e=this.selectionModel.selection();return e&&1===e.length?this.suggestionContext.selectedTerm(e[0].term()):1===this.suggestionContext.suggestions().length&&this.suggestionContext.selectedTerm(this.suggestionContext.suggestions()[0].term()),!1},i.prototype.onBackspace=function(){return 0===this.userInput().length&&this.taggedTerms&&this.taggedTerms().length>0&&(this.taggedTermCursorToEnd=!0,this.focusedTermIndex(this.taggedTerms().length-1)),!0},i.prototype.inputPaste=function(){},i.prototype.onTaggedTermKeydown=function(e,t,i){var o=i.keyCode,n=i.currentTarget,r=this.taggedTerms();if(37===o){var s=this.GetCursorLocation(n);if(0===s&&e()>0)return this.taggedTermCursorToEnd=!0,this.focusedTermIndex(e.peek()-1),!1}if(39===o){var s=this.GetCursorLocation(n);if(s===n.innerHTML.length){if(e()<r.length-1)return this.focusedTermIndex(e.peek()+1),!1;if(e()===r.length-1)return this.textBoxIsFocused(!0),!1}}return i.cancelBubble=!0,i.stopPropagation(),!0},i.prototype.onTaggedTermTextChange=function(e,t,i){var o=i.currentTarget;if(0===o.innerHTML.length){var n=this.taggedTerms();delete n[e()],n=n.filter(Boolean),e()>0&&(this.taggedTermCursorToEnd=!0,this.focusedTermIndex(e.peek()-1)),this.taggedTerms(n)}},i.prototype.launchTree=function(){var e=this,t=this.resources.consume(r.dialog),i=t.requestDialog({title:g.strings.WebTaggingDialogTitle+this.taggingParams.fieldTitle,size:x.Large,component:{name:this.taxonomyTreeTagName,params:{treeOpen:this.treeOpen,taggingParams:this.taggingParams}}});return this.subscribe(this.treeOpen,function(){i&&!e.treeOpen()&&i.state(b.completed)}),i.wait().then(function(){return{resultType:n.ResultTypeEnum.Success}}),!1},i.prototype.getSuggestionsForInputText=function(e){var t=this;if(this.textBoxIsFocused()&&this.queryParams){if(0===e.length)return void(this.suggestionContext.showingSuggestions()&&this.suggestionContext.showingSuggestions(!1));this.suggestionQueryRunning()&&this.abortSuggestionQuery(),this.suggestionQueryRunning(!0);var i=this.dataProvider.getSuggestions(e,this.queryParams),o=function(i){i&&i.length>0?(i=t.filterTaggedTerms(i,t.taggedTerms.peek()),i.length>0&&t.displaySuggestions(i,e)):t.suggestionContext.showingSuggestions()&&t.dismissSuggestions(),t.suggestionQueryRunning(!1),t.cleanErrors()},n=function(e){t.suggestionQueryRunning(!1),e&&"Canceled"!==e.name&&(t.error(g.strings.ServerError),t.dismissSuggestions())};i.promise&&i.promise.done(o,n)}},i.prototype.cleanErrors=function(){this.error("")},i.prototype.filterTaggedTerms=function(e,t){for(var i=[],o=0;o<e.length;o++){var n=e[o],r=t.filter(function(e){return e.label===n.label&&e.termId===n.termId});0===r.length&&i.push(n)}return i},i.prototype.displaySuggestions=function(e,t){this.suggestionContext.starts(t),this.suggestionContext.suggestedTerms(e),this.suggestionContext.showingSuggestions(!0)},i.prototype.abortSuggestionQuery=function(){this.suggestionQueryRunning()&&this.suggestionQueryRunning(!1)},i.prototype.handleSelectedSuggestion=function(e){e&&e.isValid&&(this.abortSuggestionQuery(),this.userInput(""),this.taggedTerms.push(e),this.dismissSuggestions()),this.textBoxIsFocused()||this.textBoxIsFocused(!0)},i.prototype.dismissSuggestions=function(){this.abortSuggestionQuery(),this.suggestionContext.showingSuggestions(!1),this.initSuggestionContext()},i.prototype.initSuggestionContext=function(){this.suggestionContext?(this.suggestionContext.selectedTerm(null),this.suggestionContext.suggestedTerms([]),this.suggestionContext.trimmingLimit(10),this.suggestionContext.showingSuggestions(!1),this.suggestionContext.starts(null),this.suggestionContext.suggestions([])):this.suggestionContext={selectedTerm:o.observable(null),suggestedTerms:o.observableArray([]),trimmingLimit:o.observable(10),showingSuggestions:o.observable(!1),starts:o.observable(null),suggestions:o.observableArray([])}},i.prototype.GetCursorLocation=function(e){var t,i,o=0;if(window.getSelection)t=window.getSelection(),t.rangeCount&&(i=t.getRangeAt(0),(i.commonAncestorContainer.parentNode===e||i.commonAncestorContainer===e)&&(o=i.endOffset));else if(document.selection&&document.selection.createRange&&(i=document.selection.createRange(),i.parentElement()===e)){var n=document.createElement("span");e.insertBefore(n,e.firstChild);var r=i.duplicate();r.moveToElementText(n),r.setEndPoint("EndToEnd",i),o=r.text.length}return o},i}(i);return y}),define("odsp-next/controls/taxonomy/tagging/TaxonomyTagging.html",[],function(){return'<div class=taxonomyWebTagging id=taxonomyWebTagging data-bind="click: handleInputFocus, attr: {title: inputTitle}"><div class=taxonomyWebTagging-container><!--ko foreach: taggedTerms--><div class=taxonomyWebTagging-taggedTerms-term data-bind="component: { name: $parent.taxonomyTermTagName, params: {term: $data, starts: \'\', displaymode: $parent.termDisplaymode, taggingModel: $parent, index: $index, focusedTermIndex: $parent.focusedTermIndex } }"></div><!--/ko--><input class=taxonomyWebTagging-textBox id=taxonomyWebTagging-textBox type=text autocomplete=off autocapitalize=off autocorrect=off autofocus aria-haspopup=true data-bind="textInput: userInput, attr:{ size: inputSize, \'aria-label\': inputTitle }, disable: disableInputBox, event:{focus: handleInputFocus, blur: handleInputBlur, paste: inputPaste}, hasFocus: textBoxIsFocused, selection: { data: suggestionContext.suggestions, focused: focusedSuggestion, mode: \'single\', direction: \'vertical\', selectionModel: selectionModel, allowInputEvents: true }, keyboard: { mappings: {Enter: onEnter, Backspace: onBackspace, Left: onBackspace, Tab: onTab}, context: $data, allowInputEvents: true }"><!--ko if: showPlaceholder()--><span class=taxonomyWebTagging-ghostText aria-hidden=true data-bind="text: placeholderText"></span><!--/ko--></div><div class=taxonomyWebTagging-treeToggle><img data-bind="attr: {src: treeToggleImg, \'aria-label\': treeToggleLabel}, event: {click: launchTree}, keyboard: { Enter: launchTree, Space: launchTree, context: $data, allowInputEvents: true }"></div><div class=taxonomyWebTagging-progressBoxContainer><div class=taxonomyWebTagging-progressBox data-bind="component: {name: progressSpinnerFlatTagName}, visible: suggestionQueryRunning()"></div></div><!--<p><span data-bind="text: positionInfoText()"></span></p>--></div><!--ko if:suggestionContext.showingSuggestions()--><div id=taxonomyWebTagging-Suggestions data-bind="component: {name: taxonomySuggestionsTagName, params: {selectedTerm: suggestionContext.selectedTerm, suggestedTerms: suggestionContext.suggestedTerms, trimmingLimit: suggestionContext.trimmingLimit, showingSuggestions: suggestionContext.showingSuggestions, starts: suggestionContext.starts, suggestions: suggestionContext.suggestions} }"></div><!--/ko--><div aria-live=assertive class=taxonomyWebTagging-error data-bind="text: error(), visible: !!error() && error().length > 0"></div>'}),define("odsp-next/controls/taxonomy/tagging/TaxonomyTagging.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".taxonomyWebTagging,.taxonomyWebTagging-container,.taxonomyWebTagging-treeToggle{box-sizing:border-box;max-height:78px;position:relative}.taxonomyWebTagging-treeToggle{display:inline-block;float:right;top:5px;right:2px}.taxonomyWebTagging-container{border:1px solid #a6a6a6;background-color:#fff;width:90%;display:inline-block;padding-top:4px}.taxonomyWebTagging-container .taxonomyWebTagging-taggedTerms{display:inline}.taxonomyWebTagging-container .taxonomyWebTagging-taggedTerms-term{display:inline;margin-right:3px}.taxonomyWebTagging{background-color:#fff;width:100%;overflow-y:auto;overflow-x:hidden}.taxonomyWebTagging-textBox{border:0 solid #ababab;background-color:transparent;margin:2px;vertical-align:top;outline:0}.taxonomyWebTagging-textBox::-ms-clear{display:none}.taxonomyWebTagging-textBox:focus{outline-color:transparent}.taxonomyWebTagging-progressBoxContainer{width:100%}.taxonomyWebTagging-progressBoxContainer .taxonomyWebTagging-progressBox{margin-top:-6px}.taxonomyWebTagging-ghostText{position:absolute;top:2px;color:#767676;white-space:nowrap}html[dir=ltr] .taxonomyWebTagging-ghostText{left:5px}html[dir=rtl] .taxonomyWebTagging-ghostText{right:5px}.taxonomyWebTagging-error{color:#a80000}")}),define("odsp-next/controls/taxonomy/tagging/TaxonomyTagging",["require","exports","./TaxonomyTaggingViewModel","odsp-shared/utilities/knockout/ComponentFactory","./TaxonomyTagging.html","./TaxonomyTagging.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-taxonomyTagging",template:e("./TaxonomyTagging.html"),viewModel:i,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/fieldEditor/taxonomyEditor/TaxonomyEditor.html",[],function(){return'<div data-bind="component: {name: taxonomyTaggingTagName, params: {taggedTerms: taggingParams.taggedTerms, taxonomyQueryParams: taggingParams.taxonomyQueryParams, allowMultipleValues:taggingParams.allowMultipleValues, fieldName:taggingParams.fieldName, fieldId:taggingParams.fieldId, fieldTitle:taggingParams.fieldTitle } }"></div>'});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/taxonomyEditor/TaxonomyEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../taxonomy/tagging/TaxonomyTagging","../../taxonomy/term/TaxonomyTermViewModel","../../../models/clientForm/IClientForm","./TaxonomyEditor.html"],function(e,t,i,o,n,r,s){var a=function(t){function o(o){var a=this;t.call(this,o),this.controlHtml=e("./TaxonomyEditor.html"),this.taxonomyTaggingTagName=n.default.tagName;var l=o.field.schema,d=this.convertRawDataToTerms(o.field.data.peek()),c=i.observableArray([]);d&&d.length>0&&c(d),this.taggingParams={taggedTerms:c,allowMultipleValues:l.AllowMultipleValues,fieldName:l.Name,fieldTitle:l.Title,fieldId:l.Id,taxonomyQueryParams:{lcid:l.Lcid||1033,sspList:l.SspId,termSetList:l.TermSetId,anchorId:l.AnchorId||r.INVALID_TERM_ID,isSpanTermStores:l.IsSpanTermStores||!1,isSpanTermSets:l.IsSpanTermSets||!1,isIncludeUnavailable:!1,isIncludeDeprecated:!1,isAddTerms:l.IsAddTerms||!1,isIncludePathData:!1,excludeKeyword:l.Name?!1:"TaxKeyword"!==l.Name,excludedTermset:r.INVALID_TERM_ID,isUseCommaAsDelimiter:l.IsUseCommaAsDelimiter||!0,isIncludeTermSetName:!1,webServiceUrl:l.WebServiceUrl,allowFillIn:l.AllowFillIn||!0}},this.subscribe(c,function(e){if(null!==e&&void 0!==e){var t=e.reduce(function(e,t){return e+t.label+r.LABEL_ID_DELIMITER+t.termId+r.TERM_DELIMITER},"");a.field.data(t),a.field.mode()===s.ClientFormMode.edit}})}return __extends(o,t),o.prototype.convertRawDataToTerms=function(e){return e?e.split(r.TERM_DELIMITER).map(function(e){var t=e.split(r.LABEL_ID_DELIMITER),i=t[0],o=t[1],n={};return n.termId=o,n.label=i,n.isValid=o!==r.INVALID_TERM_ID,n}):[]},o}(o);return a}),define("odsp-next/controls/fieldEditor/dateTimeEditor/DateTimeEditor.html",[],function(){return'<input class=od-DateTimeEditor-input type=text maxlength=45 data-bind="attr: { id: inputElementId }, element: inputElement, value: dateValue"> <span data-bind="dismiss: { close: closeDatePicker, dismissOnResize: true, dismissOnScroll: true }"><button class=od-DateTimeEditor-icon data-bind="toggle: dateTimePickerOpen"><span class="ms-Icon ms-Icon--calendar"></span></button><!--ko if: dateTimePickerOpen--><div data-bind="component: { name: \'od-overlay\', params: { alignToParent: true }}"><iframe class=od-DateTimeEditor-iFrame data-bind="attr: {src: dateTimeControlIframeUrl()}, element: iframeElement"></iframe></div><!--/ko--></span>'}),define("odsp-next/controls/fieldEditor/dateTimeEditor/DateTimeEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-DateTimeEditor-icon{font-size:26px;vertical-align:bottom;padding:0;border:0;width:30px;height:30px}.od-DateTimeEditor-input{height:26px}.od-DateTimeEditor-iFrame{width:204px;border:0;position:absolute}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/fieldEditor/dateTimeEditor/DateTimeEditorViewModel",["require","exports","knockout","../BaseFieldEditorViewModel","../../../resources/DataSourceResourceKeys","odsp-utilities/encoding/HtmlEncoding","odsp-shared/utilities/string/StringHelper","../../../bindings/element/ElementBinding","../../../bindings/dismiss/DismissBinding","../../../bindings/toggle/ToggleBinding","odsp-utilities/encoding/UriEncoding","./DateTimeEditor.html","./DateTimeEditor.css","../../overlays/Overlay"],function(e,t,i,o,n,r,s,a,l,d,c){var p=function(t){function o(o){var r=this;t.call(this,o),this.controlHtml=e("./DateTimeEditor.html"),this._urlDataSource=this.fieldsManager.resources.consume(n.url),this._iframeBaseUrl=this._getDateTimeIframeControlBaseUrl(),this.dateTimePickerOpen=i.observable(!1),this.iframeElement=i.observable(null),this.inputElement=i.observable(null),this.addBindingHandlers({element:a,dismiss:l,toggle:d});var s=this._parseDate(this.field.data());this.dateValue=i.observable(s.Date),this.dateTimeControlIframeUrl=i.observable(""),this.subscribe(this.dateValue,function(){r.field.data(r.dateValue())}),this.subscribe(this.iframeElement,function(e){e&&(e.resultfield||(e.resultfield=r.inputElement()),"undefined"==typeof e.firstUp&&(e.firstUp=!0),e.OnSelectDateCallback||(e.OnSelectDateCallback=function(e,t){r.dateValue(t),r.closeDatePicker()}))}),this.subscribe(this.dateTimePickerOpen,function(e){e&&r.dateTimeControlIframeUrl(r._getDateTimeIframeControlUrl())})}return __extends(o,t),o.prototype.closeDatePicker=function(){return this.dateTimePickerOpen(!1),!0},o.prototype._parseDate=function(e){var t={Hour:"0",Minute:"0",Date:e?e.trim():""};if(null===e||""===e)return t;var i=this.field.schema,o=e.lastIndexOf(i.TimeSeparator);if(-1===o||o===e.length-1)return t;var n=e.substring(o+1);if(isNaN(Number(n)))return t;t.Minute=n;var r=e.substring(0,o),s=r.lastIndexOf(" ");if(-1===s||s===r.length-1)return t;var a=r.substring(s+1);return isNaN(Number(a))?t:(t.Hour=a,t.Date=r.substring(0,s),t)},o.prototype._getDateTimeIframeControlUrl=function(){return this._iframeBaseUrl||(this._iframeBaseUrl=this._getDateTimeIframeControlBaseUrl()),this._iframeBaseUrl+"&date="+c.encodeURIComponent(this.dateValue())},o.prototype._getDateTimeIframeControlBaseUrl=function(){var e=this.field.schema;return s.format(this._urlDataSource.getDateTimeControlIframeUrl()+"?cal={0}&lcid={1}&langid={2}&&tz={3}&ww={4}&fdow={5}&fwoy={6}&hj={7}&swn={8}&minjday={9}&maxjday={10}",r.encodeText(String(e.CalendarType)),r.encodeText(String(e.LocaleId)),r.encodeText(String(e.LanguageId)),r.encodeText(String(e.TimeZoneDifference)),r.encodeText(String(e.WorkWeek)),r.encodeText(String(e.FirstDayOfWeek)),r.encodeText(String(e.FirstWeekOfYear)),r.encodeText(String(e.HijriAdjustment)),r.encodeText(String(e.ShowWeekNumber)),r.encodeText(String(e.MinJDay)),r.encodeText(String(e.MaxJDay)))},o}(o);return p}),define("odsp-next/controls/fieldEditor/FieldEditorFactory",["require","exports","../fieldEditor/textEditor/TextEditorViewModel","../fieldEditor/noteEditor/NoteEditorViewModel","../fieldEditor/booleanEditor/BooleanEditorViewModel","../fieldEditor/numberEditor/NumberEditorViewModel","./pictureEditor/PictureEditorViewModel","../fieldEditor/peopleEditor/PeopleEditorViewModel","./lookupEditor/LookupEditorViewModel","../fieldEditor/fileEditor/FileEditorViewModel","../fieldEditor/choiceEditor/DropdownChoiceEditorViewModel","../fieldEditor/choiceEditor/SingleChoiceEditorViewModel","../fieldEditor/choiceEditor/ChoiceFormatType","../fieldEditor/choiceEditor/RadioChoiceEditorViewModel","../fieldEditor/choiceEditor/MultiChoiceEditorViewModel","../fieldEditor/taxonomyEditor/TaxonomyEditorViewModel","../fieldEditor/dateTimeEditor/DateTimeEditorViewModel"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v=function(){function e(){}return e.getFieldEditor=function(e,t){switch(e.schema.FieldType.toLowerCase()){case"choice":return new p.default({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"datetime":return new f({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"multichoice":return new m.default({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"file":return new d({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"text":return new i({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"boolean":return new n({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"number":case"currency":return new r({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"note":return new o({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"lookup":case"lookupmulti":return new l({viewModelParams:{resources:t.resources},field:e,fieldsManager:t,fieldNameForDisplayRead:"LookupValue",fieldNameForValueRead:"LookupId",fieldNameForValueWrite:"lookupId"});case"usermulti":case"user":return new a({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"taxonomyfieldtype":case"taxonomyfieldtypemulti":return new g({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}});case"url":var c=e.schema;return new s(1===c.DisplayFormat?{field:e,fieldsManager:t,viewModelParams:{resources:t.resources}}:{field:e,fieldsManager:t,viewModelParams:{resources:t.resources}})}return null},e.getChoiceFieldEditor=function(e,t){var i=e.schema;return i.FormatType===u.Radio?new h.default({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}}):i.FormatType===u.DropDown?new c.default({field:e,fieldsManager:t,viewModelParams:{resources:t.resources}}):null},e}();return v});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/clientForm/ClientFormViewModel",["require","exports","knockout","./ClientForm.resx","odsp-shared/base/ViewModel","../../models/clientForm/IClientForm","../loadingSpinner/LoadingSpinner","../fieldEditor/FieldEditorFactory","odsp-utilities/async/Promise"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){var n=this;e.call(this,t.viewModelParams),this.isLoading=i.observable(!1),this.loadingSpinnerTagName=s.tagName,this.children=i.observableArray(),this.saveLabel=o.strings.SaveLabel,this.cancelLabel=o.strings.CancelLabel,this._editingField=null,this._clientForm=t.clientForm,this.item=this._clientForm.item,this.globalEditMode=i.pureComputed(function(){return n._clientForm.mode()===r.ClientFormMode.edit}),this.showEditControlButtons=Boolean(t.showEditControlButtons)?this.globalEditMode:i.pureComputed(function(){return!1}),this.subscribe(this.item,function(){n._clientForm.updateValues().done(function(){for(var e=n.children(),t=0,i=e.length;i>t;t++)e[t].updateRenderHtml()})});for(var l=0,d=this._clientForm.fields.length;d>l;l++){var c=a.getFieldEditor(this._clientForm.fields[l],this);c&&(this.children.push(c),this.handleFieldModeChange(this._clientForm.fields[l]))}}return __extends(t,e),t.prototype.onSaveClick=function(){for(var e=this,t=0,i=this.children.peek();t<i.length;t++){var o=i[t];o.beforeSave&&o.beforeSave()}this._clientForm.saveChanges().done(function(t){t&&e._clientForm.mode(r.ClientFormMode.display)})},t.prototype.onCancelClick=function(){this._clientForm.mode(r.ClientFormMode.display)},t.prototype.saveChanges=function(){return this._clientForm.mode.peek()===r.ClientFormMode.display?this._clientForm.saveChanges():l.default.wrap(!0)
},t.prototype.handleFieldModeChange=function(e){var t=this;this.subscribe(e.mode,function(i){i===r.ClientFormMode.edit?(null!==t._editingField&&t._editingField.mode(r.ClientFormMode.display),t._editingField=e):t._editingField===e&&(t._editingField=null)})},t}(n);return d}),define("odsp-next/controls/clientForm/ClientForm.html",[],function(){return'<div class=od-ClientForm><div class=od-ClientFormFields><!--ko if:isLoading--><div class=od-ClientFormFields-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot:isLoading--><div class=od-ClientFormFields-fieldsContainer><!--ko foreach:children--><div class=od-ClientFormFields-field data-bind="bindableHtml: fullHtml"></div><!--/ko--></div><!--/ko--></div><!--ko if:showEditControlButtons--><div class="od-ClientForm-editButtonsContainer ms-Dialog-actionsRight"><button class="ms-Dialog-action ms-Button" data-bind="event: { click: onSaveClick }"><span data-bind="text: saveLabel" class=ms-Button-label></span></button> <button class="ms-Dialog-action ms-Button ms-Button--primary" data-bind="event: { click: onCancelClick }"><span data-bind="text: cancelLabel" class=ms-Button-label></span></button></div><!--/ko--></div>'}),define("odsp-next/controls/clientForm/ClientForm.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ClientForm,.od-ClientFormFields-fieldsContainer{width:100%}.ms-Dialog .od-ClientFormFields-fieldsContainer{width:100%;max-height:800px;overflow-y:scroll}.od-ClientFormFields-field{padding:4px 3px}.od-ClientFormFields-loadingSpinner{text-align:center;padding:75px 0}.od-ClientForm-editButtonsContainer{margin-top:20px}")}),define("odsp-next/controls/clientForm/ClientForm",["require","exports","./ClientFormViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ClientForm.html","./ClientForm.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-client-form",template:e("./ClientForm.html"),viewModel:i,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/properties/PropertiesSectionViewModel",["require","exports","knockout","../../../../controls/clientForm/ClientForm","../../../../models/clientForm/IClientForm","../../../../bindings/toggle/ToggleBinding","../../ComputedItemSelectionViewModel","../../../loadingSpinner/LoadingSpinner","../../InfoPane.resx","../../../../resources/ProviderResourceKeys"],function(e,t,i,o,n,r,s,a,l,d){var c=l.strings,p=function(e){function t(){e.call(this),this.isExpanded=i.observable(!0),this.isLoading=i.observable(!0),this.clientFormTag=o.tagName,this.clientFormParams=null,this.loadingSpinnerTagName=a.tagName,this.clientFormEditLink=c.clientFormEditLink,this.clientFormTitle=c.clientFormTitle,this.addBindingHandlers({toggle:r}),this._clientFormProvider=this.resources.consume(d.clientForm),this.subscribe(this.activeItem,this._updateProperties),this._updateProperties()}return __extends(t,e),t.prototype.onEditClick=function(){var e=i.dataFor(document.getElementsByClassName("spo-Properties-clientForm")[0]).clientFormParams.clientForm;e.mode(n.ClientFormMode.edit)},t.prototype._updateProperties=function(){var e=this,t=this.activeItem.peek().key;this._currentItemKey&&this._currentItemKey===t||(this._currentItemKey=t,this.isLoading(!0),this.async.setImmediate(function(){e._clientFormProvider.getClientForm({clientFormType:n.ClientFormType.editItem,item:e.activeItem,contentType:e.activeItem.peek().properties.ContentType}).done(function(t){t.mode(n.ClientFormMode.display),e.clientFormParams={clientForm:t,showEditControlButtons:!0},e.isLoading(!1)})}))},t}(s);return p}),define("odsp-next/controls/infoPane/sections/properties/PropertiesSection.html",[],function(){return'<div class="InfoPane-section InfoPaneSection--properties" data-bind="css: {\'is-expanded\': isExpanded}"><div class=InfoPane-sectionHeader id=spo-Properties-sectionHeader tabindex=0 data-bind="toggle: isExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: clientFormTitle"></span> <a class=spo-Properties-editLink data-bind="click: onEditClick, clickBubble: false, text: clientFormEditLink" href=#></a></div><div class=InfoPane-sectionContent><!--ko if: isLoading--><div class=od-ClientFormFields-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot: isLoading--><div class=spo-Properties-clientForm data-bind="component: {name: clientFormTag, params: clientFormParams}"></div><!--/ko--><!--/ko--></div></div>'}),define("odsp-next/controls/infoPane/sections/properties/PropertiesSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPaneSection--properties{width:100%;background-color:#f4f4f4}.spo-Properties-editLink{line-height:26px;font-size:12px}html[dir=ltr] .spo-Properties-editLink{float:right}html[dir=rtl] .spo-Properties-editLink{float:left}")}),define("odsp-next/controls/infoPane/sections/properties/PropertiesSection",["require","exports","./PropertiesSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./PropertiesSection.html","./PropertiesSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-properties-section",template:e("./PropertiesSection.html"),viewModel:i});return n}),define("odsp-next/bindings/bingMap/BingMap.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".BingMap-controls{background-color:#f8f8f8;border:1px solid #eaeaea;box-sizing:border-box;width:213px;padding:3px}.BingMap-controls-icon{display:inline-block;cursor:pointer}.BingMap-controls-icon .ms-Icon{color:#094AB2;font-size:10px}html[dir=ltr] .BingMap-controls-icon:first-child{margin-right:5px}html[dir=rtl] .BingMap-controls-icon:first-child{margin-left:5px}.BingMap-controls-icon:last-child{display:inline-block;margin-top:2px}html[dir=ltr] .BingMap-controls-icon:last-child{float:right;margin-right:5px}html[dir=rtl] .BingMap-controls-icon:last-child{float:left;margin-left:5px}")}),define("odsp-next/bindings/bingMap/BingMapBinding",["require","exports","knockout","odsp-utilities/async/Async","odsp-utilities/logging/ErrorHelper","../../controls/infoPane/InfoPane.resx","./BingMap.css"],function(e,t,i,o,n,r){var s=r.strings,a="AkQiChx2gUgMUwPYSb1Vg15L-fSor6dm_tNjKDcpIN04-6qD2eu8OlYZXvPg0yfa",l="http://www.bing.com/maps/?v=2&where1=",d=6,c=500,p=10,u=213,h=140,m=function(){function t(){}return t.init=function(n,r){var l,m=this,g=i.utils.unwrapObservable(r())||{},f=new o(this),v=0,b=d,x=!1,y=function(){if(!x){if(!Microsoft.Maps.Location)return void(b>0?(b--,v+=c,f.setTimeout(y,v)):n.innerHTML=s.locationMapFailedLoadLocationText);var e={credentials:a,enableSearchLogo:!1,enableClickableLogo:!1,showDashboard:!1,showScalebar:!1,showMapTypeSelector:!1,center:new Microsoft.Maps.Location(g.latitude(),g.longitude()),disableKeyboardInput:!0,zoom:p,width:g.width||u,height:g.height||h},o=document.createElement("div");n.appendChild(o),l=new Microsoft.Maps.Map(o,e),t._addMapControls(n,l,g),i.computed(function(){g.latitude(),g.longitude(),t._updateMap.call(m,l,g)},null,{disposeWhenNodeIsRemoved:n})}};e(["bingmaps"],y.bind(this)),i.utils.domNodeDisposal.addDisposeCallback(n,function(){x=!0,f.dispose()})},t._addMapControls=function(e,i,o){var n=function(e){var t=i.getZoom()+e;i&&i.setView({zoom:t})},r=function(){return n(-1),!1},s=function(){return n(1),!1},a=function(){var e=l+o.latitude()+", "+o.longitude();return window.open(e,"_blank"),!1},d=document.createElement("div");d.className="BingMap-controls",d.appendChild(t._getIcon("minus",!0,r.bind(this))),d.appendChild(t._getIcon("plus",!0,s.bind(this))),d.appendChild(t._getIcon("popout",!1,a.bind(this))),e.appendChild(d)},t._getIcon=function(e,t,i){var o=document.createElement("div");o.className="BingMap-controls-icon",o.onclick=i;var n=document.createElement("i");return n.className="ms-Icon ms-Icon--"+e+(t?" ms-Icon--circle":""),o.appendChild(n),o},t._updateMap=function(e,t){try{var i=t.latitude(),o=t.longitude();e.setView({center:new Microsoft.Maps.Location(i,o)}),e.entities.clear();var r=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(i,o),null);e.entities.push(r),e.blur()}catch(s){n.log(s)}},t}();return m}),define("odsp-next/utilities/jsonp/JSONP",["require","exports","odsp-utilities/async/Promise"],function(e,t,i){var o="OneDrive_JSONPCallback_",n=6e4,r=function(){function e(){}return e.fetch=function(t){var r=function(r,s){var a=i.default.timeout(n).then(function(){s("JSONP call timeout, url: "+t)}),l=o+e._jsonpCallbackCounter++,d=document.createElement("script");window[l]=e._evalJSONP(r,s,d,l,a),t+=(-1===t.indexOf("?")?"?":"&")+"jsonp="+l,d.src=t,document.getElementsByTagName("head")[0].appendChild(d)};return new i.default(r)},e._evalJSONP=function(e,t,i,o,n){return function(r){var s=!1;if(i.parentElement.removeChild(i),delete window[o],n.cancel(),"string"==typeof r)try{s=JSON.parse(r)}catch(a){t(a)}else s=JSON.parse(JSON.stringify(r)),s?e(r):t("JSONP call returned invalid or empty JSON")}},e._jsonpCallbackCounter=0,e}();return r}),define("odsp-next/dataSources/bing/BingDataSource",["require","exports","odsp-utilities/async/Promise","odsp-shared/utilities/string/StringHelper","../../utilities/jsonp/JSONP","../../controls/infoPane/InfoPane.resx"],function(e,t,i,o,n,r){var s=r.strings,a="AkQiChx2gUgMUwPYSb1Vg15L-fSor6dm_tNjKDcpIN04-6qD2eu8OlYZXvPg0yfa",l="https://dev.virtualearth.net/REST/v1/Locations/{0},{1}?entityType=adminDistrict&c="+(window.$Config&&$Config.mkt||"en-us")+"&key="+a,d={},c=function(){function e(){}return e.prototype.getLocationName=function(e,t){var r=d[e+","+t]||"";return r?i.default.wrap(r):n.fetch(o.format(l,e,t)).then(function(i){var n=i&&200===i.statusCode&&i.resourceSets,a=n&&n.length&&n[0].resources,l=a&&a.length&&a[0].address;if(l){var c=l.locality,p=l.adminDistrict,u=l.countryRegion;u&&(r=u,p?(r=o.format(s.locationMapLocationTextWithoutCity,p,u),c&&(r=o.format(s.locationMapLocationText,c,p,u))):c&&(r=o.format(s.locationMapLocationTextWithoutDistrict,c,u))),d[e+","+t]=r}return r})},e}();return c});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/location/LocationSectionViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../../controls/infoPane/InfoPane.resx","../../../../bindings/toggle/ToggleBinding","../../../../bindings/bingMap/BingMapBinding","../../../../dataSources/bing/BingDataSource"],function(e,t,i,o,n,r,s,a){var l=n.strings,d=function(e){function t(t){e.call(this,t),this.addBindingHandlers({toggle:r,bingMap:s}),this._bingDataSource=new(this.managed(a)),this.location=i.observable(""),this.bingMapOptions={latitude:i.observable(0),longitude:i.observable(0)},this.isTagsExpanded=i.observable(!0),this.sectionHeader=l.locationInfoPaneHeader,this.item=t.item,this.createComputed(this._computeItemChanged)}return __extends(t,e),t.prototype._computeItemChanged=function(){var e=this,t=this.item();t&&t.geoLocation&&(this._bingDataSource.getLocationName(t.geoLocation.latitude,t.geoLocation.longitude).then(function(t){e.location(t)}),this.bingMapOptions.latitude(t.geoLocation.latitude),this.bingMapOptions.longitude(t.geoLocation.longitude))},t}(o);return d}),define("odsp-next/controls/infoPane/sections/location/LocationSection.html",[],function(){return'<div class="InfoPane-section InfoPaneSection--location" data-bind="css: { \'is-expanded\': isTagsExpanded }"><div class=InfoPane-sectionHeader data-bind="toggle: isTagsExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: sectionHeader"></span></div><div class=InfoPane-sectionContent><div class=InfoPane-location><div class=InfoPane-location-area><div data-bind="bingMap: bingMapOptions"></div><div class=InfoPane-location-text data-bind="text: location"></div></div></div></div></div>'}),define("odsp-next/controls/infoPane/sections/location/LocationSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPane-location-text{margin-top:10px}")}),define("odsp-next/controls/infoPane/sections/location/LocationSection",["require","exports","./LocationSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./LocationSection.html","./LocationSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-location-section",template:e("./LocationSection.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/models/item/FolderCategory",["require","exports"],function(){var e;return function(e){e[e.documents=0]="documents",e[e.photos=1]="photos",e[e.favorites=2]="favorites"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/folderTypeEditor/FolderTypeEditorViewModel",["require","exports","odsp-shared/base/ViewModel","../infoPane/InfoPane.resx","../../models/item/FolderCategory","knockout"],function(e,t,i,o,n,r){var s=function(e){function t(t){var i=this;e.call(this,t),this.infoPaneResx=o,this.category=t.category,this.typeDocuments=n[n.documents],this.typePhotos=n[n.photos],this.categoryText=r.observable(n[this.category()]),this.subscribe(this.categoryText,function(){i.category(n[i.categoryText()])})}return __extends(t,e),t}(i);return s}),define("odsp-next/controls/folderTypeEditor/FolderTypeEditor.html",[],function(){return'<div class=FolderTypeEditor><div class=FolderTypeEditor-option><div class=ms-ChoiceField><input class=ms-ChoiceField-input type=radio name=folderType id=folderTypeDocuments data-bind="attr: { value: typeDocuments }, checked: categoryText"> <label for=folderTypeDocuments class=ms-ChoiceField-field><span class=ms-Label data-bind="text: infoPaneResx.strings.informationFolderTypeDocuments"></span></label></div></div><div class=FolderTypeEditor-option><div class=ms-ChoiceField><input type=radio name=folderType id=folderTypePhotos value=photos data-bind="attr: { value: typePhotos }, checked: categoryText" class=ms-ChoiceField-input> <label for=folderTypePhotos class=ms-ChoiceField-field><span class=ms-Label data-bind="text: infoPaneResx.strings.informationFolderTypePhotos"></span></label></div></div></div>'}),define("odsp-next/controls/folderTypeEditor/FolderTypeEditor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".FolderTypeEditor-option+.FolderTypeEditor-option{margin-top:10px}.ms-ChoiceField .ms-ChoiceField-field{display:inline-block}")}),define("odsp-next/controls/folderTypeEditor/FolderTypeEditor",["require","exports","./FolderTypeEditorViewModel","odsp-shared/utilities/knockout/ComponentFactory","./FolderTypeEditor.html","./FolderTypeEditor.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-folder-type-editor",template:e("./FolderTypeEditor.html"),viewModel:i,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/ChangeFolderTypeAction",["require","exports","../base/BaseSelectionAction","odsp-utilities/async/Promise","odsp-utilities/logging/events/Qos.event","../resources/ProviderResourceKeys","../controls/infoPane/InfoPane.resx","../controls/folderTypeEditor/FolderTypeEditor","../models/dialog/DialogState","../models/identity/IdentityType","../utilities/icons/Icon","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p){var u=function(e){function t(t){e.call(this,t),this.name="ChangeFolderType",this.isSingleSelectAction=!0,this.canFallbackToParent=!0,this._identityProvider=this.resources.consume(r.identity)}return __extends(t,e),t.prototype.onSelectionExecute=function(e){var t=this,i=e[0],d=i.category,u=p.observable(d),h=this.resources.consume(r.dialog),m=h.requestDialog({title:s.strings.informationChangeFolderTitle,component:{name:a.tagName,params:{category:u}},actions:[{name:s.strings.informationSave,execute:function(){return o.default.wrap(l.completed)},isAvailable:this.createComputed(function(){return i.category!==u()}),isDefault:!0,icon:c.save,automationId:"changeFolderTypeSave"}]});return m.wait().then(function(){var e=t.resources.consume(r.item);return e.changeFolderType({category:u(),item:i}).then(function(){return{resultType:n.ResultTypeEnum.Success}})})},t.prototype.onSelectionIsAvailable=function(e,t){var i=this._identityProvider.getIdentity();return i&&i.type!==d.anonymous&&void 0!==t.category},t}(i);return u}),define("odsp-shared/utilities/string/TimeFormatter",["require","exports"],function(){var e=":",t=1e3,i=60*t,o=60*i,n=function(){function n(){}return n.formatTime=function(n){var r="",s=!1;if(n>=o){var a=Math.floor(n/o);n%=o,r+=a+e,s=!0}var l=Math.floor(n/i);n%=i,10>l&&s&&(r+="0"),r+=l+e;var d=Math.floor(n/t);return 10>d&&(r+="0"),r+=d},n}();return n}),define("odsp-next/models/item/ItemHelper",["require","exports","../../models/item/ItemType","./Item.resx","odsp-shared/utilities/string/StringHelper"],function(e,t,i,o,n){var r=["docx","doc","docm","dotm","dotx","xlsx","xlsb","xls","xlsm","pptx","ppsx","ppt","pps","pptm","potm","ppam","potx","ppsm","pdf"],s="Doc",a="One",l="Ppt",d="Xls",c="Vsd",p="Lib",u="Drive",h="CDDrive",m="USBDrive",g="ExtDrive",f="NetDrive",v={WinDocuments:p,WinLibrary:p,WinMusic:p,WinPictures:p,WinPodcastLibrary:p,WinVideos:p,WinDrive:u,CDDrive:h,GenericDrive:u,UsbDrive:m,ExternalDrive:g,NetworkStorage:f,Accdb:"Mdb",Doc:s,Docm:s,Docx:s,Dot:s,Dotm:s,Dotx:s,Exe:"Exe",Html:"Html",Mdb:"Mdb",Mpp:"Mpp",Mpt:"Mpp",Odp:l,Ods:d,Odt:s,One:a,Onepkg:a,Onetoc2:a,Notebook:"OneNotebook",Pot:l,Potm:l,Potx:l,Ppa:l,Ppam:l,Pps:l,Ppsm:l,Ppsx:l,Ppt:l,Pptm:l,Pptx:l,Pub:"Pub",Rtf:"Rtf",Txt:"Txt",Vdw:c,Vsd:c,Vsdm:c,Vsdx:c,Vsl:c,Vss:c,Vssm:c,Vssx:c,Vst:c,Vstm:c,Vstx:c,Xaml:"Xaml",Xla:d,Xlam:d,Xll:d,Xls:d,Xlsb:d,Xlsm:d,Xlsx:d,Xlt:d,Xltm:d,Xltx:d,Xml:"Xml",Xps:"Xps",Xsn:"Xsn",Zip:"Zip"},b=function(){function e(){}return e.getFriendlyItemType=function(t){var r=t.extension,s=r&&r.substring("."===r[0]?1:0).toUpperCase(),a=e.getNormalizedExtension(t.iconType),l=o.strings.fileTypeNoExtension;return a||t.type!==i.Folder?t.panorama?l=o.strings.fileTypePanorama:t.photo&&!t.video?l=n.format(o.strings.fileTypeImage,s||"").trim():a?l=o.strings["fileType"+a]:s&&(l=n.format(o.strings.fileTypeUnknown,s)):l=o.strings.fileTypeFolder,l},e.getNormalizedExtension=function(e){return v[e]},e.isOfficeDoc=function(e){return e&&-1!==r.indexOf(e)},e}();return b});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/information/InformationSectionViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../../bindings/toggle/ToggleBinding","../../../../controls/infoPane/InfoPane.resx","../../../../actions/ChangeFolderTypeAction","../../../../models/item/ItemType","../../../../models/item/FolderCategory","odsp-shared/utilities/string/StringHelper","../../../../dataSources/url/QueryType","../../../../utilities/string/FileSizeFormatter","odsp-shared/utilities/string/TimeFormatter","../../../../models/item/ItemHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h){var m=function(e){function t(t){e.call(this,t),this._changeFolderTypeAction=new(this.managed(s))({}),this.item=t.item,this.infoPaneResx=r,this.isInformationExpanded=i.observable(!0),this.addBindingHandlers({toggle:n}),this.fileType=this.createComputed(this._computeFileType),this.isAudio=this.createComputed(this._computeIsAudio),this.isFolderTypeVisible=this.createComputed(this._computeIsFolderTypeVisible),this.dateTaken=this.createComputed(this._computeDateTaken),this.folderType=this.createComputed(this._computeFolderType),this.dimensions=this.createComputed(this._computeDimensions),this.duration=this.createComputed(this._computeDuration),this.bitRate=this.createComputed(this._computeBitRate),this.camera=this.createComputed(this._computeCamera),this.shot=this.createComputed(this._computeShot),this.track=this.createComputed(this._computeTrack),this.disc=this.createComputed(this._computeDisc),this.locations=this.createComputed(this._computeLocations),this.modified=this.createComputed(this._computeModified),this.deleted=this.createComputed(this._computeDeleted),this.addedBy=this.createComputed(this._computeAddedBy),this.dateCreated=this.createComputed(this._computeCreated),this.dateShared=this.createComputed(this._computeDateShared),this.path=this.createComputed(this._computePath),this.originalLocation=this.createComputed(this._computeOriginalLocation),this.size=this.createComputed(this._computeSize),this.panoramaResolution=this.createComputed(this._computePanoramaResolution),this.panoramaRange=this.createComputed(this._computePanoramaRange),this.visitorViews=this.createComputed(this._computeVisitorViews)}return __extends(t,e),t.prototype.onChangeFolderTypeClicked=function(e){return this._changeFolderTypeAction.execute(e),!1},t.prototype._computeFileType=function(){var e=this.item(),t="";return e.isBundle||void 0!==e.virtualItemType||(t=h.getFriendlyItemType(e)),t},t.prototype._computeIsAudio=function(){var e=this.item();return!!e&&!!e.audio},t.prototype._computeIsFolderTypeVisible=function(){var e=this.item();return!!e&&e.type===a.Folder&&!e.isBundle&&!e.isSpecialFolder&&void 0===e.virtualItemType&&this._changeFolderTypeAction.isAvailable()},t.prototype._computeDateTaken=function(){var e=this.item(),t=e.photo||e.video?e:null;return t?t.dateTaken:""},t.prototype._computeFolderType=function(){var e="";switch(this.item().category){case l.documents:e=r.strings.informationFolderTypeDocuments;break;case l.photos:e=r.strings.informationFolderTypePhotos;break;case l.favorites:e=r.strings.informationFolderTypeFavorites}return e},t.prototype._computeVisitorViews=function(){var e=this.item();return e.statistics.views},t.prototype._computeDimensions=function(){var e,t,i="",o=this.item(),n=o.photo,s=o.video,a=o.panorama;return n&&!a&&(e=n.width,t=n.height),s&&(e=s.width,t=s.height),e&&t&&(i=d.format(r.strings.informationDimensionsFormat,e,t)),i},t.prototype._computeDuration=function(){var e="",t=this.item();if(t.video){var i=t.video.duration;i>0&&(e=u.formatTime(i))}return e},t.prototype._computeBitRate=function(){var e="",t=this.item(),i=t.video,o=i&&i.bitrate;if(o){var n="Kilo",s=1e3,a=1e6;o>a&&(n="Mega",s=a),e=d.format(r.strings["information"+n+"BitrateFormat"],Math.floor(o/s))}return e},t.prototype._computeCamera=function(){var e=this.item(),t=!!e.photo&&e.photo.cameraModel;return t||(t=!!e.video&&e.video.cameraModel),t},t.prototype._computeShot=function(){var e="",t=this.item(),i=t.photo;if(i){var o=i.exposureNumerator,n=o&&o.toString(),s=i.exposureDenominator;s&&1!==s&&(n=d.format(r.strings.informationShotExposureFormat,o,s));var a=i.focalRatio?i.focalRatio.toString():"";a=a&&d.format(r.strings.informationShotFStopFormat,a);var l=i.focalLength?i.focalLength.toString():"";l=l&&d.format(r.strings.informationShotFocalLengthFormat,l),e=[n,a,l].join(" ").trim()}return e},t.prototype._computeTrack=function(){var e=this.item(),t=e.audio,i=t&&t.track,o=t&&t.trackCount,n="";return i&&o?n=d.format(r.strings.informationTrackAndDiscFormat,i,o):i&&(n=i.toString()),n},t.prototype._computeDisc=function(){var e=this.item(),t=e.audio,i=t&&t.disc,o=t&&t.discCount,n="";return t&&(i>1||o>1)&&(n=o>=i?d.format(r.strings.informationTrackAndDiscFormat,i,o):i&&i.toString()),n},t.prototype._computeLocations=function(){var e=this.item(),t=[];if(e.locations)for(var i=0,o=e.locations.length;o>i;i++){var n=e.locations[i];n&&t.push(n)}return t},t.prototype._computeModified=function(){var e=this.item(),t="";return e.queryType!==c.RecycleBin&&(t=e.dateModified),t},t.prototype._computeDeleted=function(){var e=this.item(),t="";return e.queryType===c.RecycleBin&&(t=e.dateDeleted),t},t.prototype._computeAddedBy=function(){return this.item().creatorName},t.prototype._computeCreated=function(){return this.item().dateCreated},t.prototype._computeDateShared=function(){return this.item().dateShared},t.prototype._computePath=function(){var e=[],t=this.item();if(!t.audio&&t.parent&&t.queryType!==c.RecycleBin)for(var i=t;i;)e.unshift(i.name),i=i.parent;return e},t.prototype._computeOriginalLocation=function(){var e=this.item(),t="";return(e.queryType===c.RecycleBin||e.queryType===c.Search||e.queryType===c.SharedWithMe||e.queryType===c.SharedWithMeODB)&&(t=e.location),t},t.prototype._computeSize=function(){var e=this.item();return void 0!==e.size?p.formatSize(e.size):""},t.prototype._computePanoramaResolution=function(){var e=this.item(),t=e.panorama,i="";return t&&t.resolution&&(i=d.format(r.strings.informationPanoramaResolutionFormat,t.resolution)),i},t.prototype._computePanoramaRange=function(){var e=this.item(),t=e.panorama,i="";return t&&t.horizontalFov&&t.verticalFov&&(i=d.format(r.strings.informationPanoramaRangeFormat,Math.round(t.horizontalFov),Math.round(t.verticalFov))),i},t}(o);return m}),define("odsp-next/controls/infoPane/sections/information/InformationSection.html",[],function(){return'<div class="InfoPane-section InfoPaneSection--information" data-bind="css: { \'is-expanded\': isInformationExpanded }"><div class=InfoPane-sectionHeader data-bind="toggle: isInformationExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: infoPaneResx.strings.informationHeader"></span></div><div class="InfoPane-sectionContent InfoPaneSection-information"><table><tbody><!--ko if: !!fileType()--><tr><th data-bind="text: infoPaneResx.strings.informationFiletype"></th><td data-bind="text: fileType"></td></tr><!--/ko--><!--ko if: isFolderTypeVisible--><tr><th data-bind="text: infoPaneResx.strings.informationFolderType"></th><td><div data-bind="text: folderType"></div><a class=InfoPaneSection-information-changeType href=# data-bind="click: onChangeFolderTypeClicked, text: infoPaneResx.strings.informationFolderTypeChange"></a></td></tr><!--/ko--><!--ko if: !!visitorViews()--><tr><th data-bind="text: infoPaneResx.strings.informationVisitorViews"></th><td data-bind="text: visitorViews"></td></tr><!--/ko--><!--ko if: !!dateTaken()--><tr><th data-bind="text: infoPaneResx.strings.informationDateTaken"></th><td data-bind="text: dateTaken"></td></tr><!--/ko--><!--ko if: !!dimensions()--><tr><th data-bind="text: infoPaneResx.strings.informationDimensions"></th><td data-bind="text: dimensions"></td></tr><!--/ko--><!--ko if: !!duration()--><tr><th data-bind="text: infoPaneResx.strings.informationDuration"></th><td data-bind="text: duration"></td></tr><!--/ko--><!--ko if: !!bitRate()--><tr><th data-bind="text: infoPaneResx.strings.informationBitrate"></th><td data-bind="text: bitRate"></td></tr><!--/ko--><!--ko if: !!camera()--><tr><th data-bind="text: infoPaneResx.strings.informationCamera"></th><td data-bind="text: camera"></td></tr><!--/ko--><!--ko if: !!shot()--><tr><th data-bind="text: infoPaneResx.strings.informationShot"></th><td data-bind="text: shot"></td></tr><!--/ko--><!--ko if: isAudio--><!--ko if: !!item().audio.title--><tr class=InfoPaneSection-information-groupPadding><th data-bind="text: infoPaneResx.strings.informationTitle"></th><td data-bind="text: item().audio.title"></td></tr><!--/ko--><tr><th data-bind="text: infoPaneResx.strings.informationAlbum"></th><td data-bind="text: (item().audio.album || infoPaneResx.strings.informationUnknownAlbum)"></td></tr><!--ko if: !!item().audio.albumArtist--><tr><th data-bind="text: infoPaneResx.strings.informationAlbumArtist"></th><td data-bind="text: item().audio.albumArtist"></td></tr><!--/ko--><tr><th data-bind="text: infoPaneResx.strings.informationArtist"></th><td data-bind="text: (item().audio.artist || infoPaneResx.strings.informationUnknownArtist)"></td></tr><!--ko if: !!track()--><tr><th data-bind="text: infoPaneResx.strings.informationTrack"></th><td data-bind="text: track"></td></tr><!--/ko--><!--ko if: !!disc()--><tr><th data-bind="text: infoPaneResx.strings.informationDisc"></th><td data-bind="text: disc"></td></tr><!--/ko--><!--ko if: !!item().audio.composers--><tr><th data-bind="text: infoPaneResx.strings.informationComposers"></th><td data-bind="text: item().audio.composers"></td></tr><!--/ko--><!--ko if: !!item().audio.genre--><tr><th data-bind="text: infoPaneResx.strings.informationGenre"></th><td data-bind="text: item().audio.genre"></td></tr><!--/ko--><!--ko if: !!item().audio.year && item().audio.year.toString()--><tr><th data-bind="text: infoPaneResx.strings.informationYear"></th><td data-bind="text: item().audio.year"></td></tr><!--/ko--><!--ko if: !!item().audio.copyright--><tr><th data-bind="text: infoPaneResx.strings.informationCopyright"></th><td data-bind="text: item().audio.copyright"></td></tr><!--/ko--><!--/ko--><!--ko if: !!locations() && locations().length > 0--><tr><th data-bind="text: infoPaneResx.strings.informationLocations"></th><td><div data-bind="foreach: { data: locations, as: \'location\' }"><div data-bind="text: location"></div></div></td></tr><!--/ko--><!--ko if: !!modified()--><tr class=InfoPaneSection-information-groupPadding><th data-bind="text: infoPaneResx.strings.informationModified"></th><td data-bind="text: modified"></td></tr><!--/ko--><!--ko if: !!deleted()--><tr><th data-bind="text: infoPaneResx.strings.informationDeleted"></th><td data-bind="text: deleted"></td></tr><!--/ko--><!--ko if: !!addedBy()--><tr><th data-bind="text: infoPaneResx.strings.informationAddedBy"></th><td data-bind="text: addedBy"></td></tr><!--/ko--><!--ko if: !!dateCreated()--><tr><th data-bind="text: infoPaneResx.strings.informationDateCreated"></th><td data-bind="text: dateCreated"></td></tr><!--/ko--><!--ko if: !!dateShared()--><tr><th data-bind="text: infoPaneResx.strings.informationDateShared"></th><td data-bind="text: dateShared"></td></tr><!--/ko--><!--ko if: !!path() && path().length > 0--><tr><th data-bind="text: infoPaneResx.strings.informationPath"></th><td><div data-bind="foreach: { data: path, as: \'location\' }"><span class=InfoPaneSection-information-path data-bind="text: location"></span></div></td></tr><!--/ko--><!--ko if: !!originalLocation()--><tr><th data-bind="text: infoPaneResx.strings.informationOriginalLocation"></th><td data-bind="text: originalLocation"></td></tr><!--/ko--><!--ko if: !!size()--><tr class=InfoPaneSection-information-groupPadding><th data-bind="text: infoPaneResx.strings.informationSize"></th><td data-bind="text: size"></td></tr><!--/ko--><!--ko if: !!panoramaResolution()--><tr class=InfoPaneSection-information-groupPadding><th data-bind="text: infoPaneResx.strings.informationPanoramaResolution"></th><td data-bind="text: panoramaResolution"></td></tr><!--/ko--><!--ko if: !!panoramaRange()--><tr><th data-bind="text: infoPaneResx.strings.informationPanoramaRange"></th><td data-bind="text: panoramaRange"></td></tr><!--/ko--></tbody></table></div></div>'}),define("odsp-next/controls/infoPane/sections/information/InformationSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPaneSection-information table{border-spacing:0;width:100%}.InfoPaneSection-information tr:first-child td,.InfoPaneSection-information tr:first-child th{padding-top:0}.InfoPaneSection-information td,.InfoPaneSection-information th{padding:8px 0;width:50%;word-break:break-all}.InfoPaneSection-information th{vertical-align:top;color:#666;font-weight:400}html[dir=ltr] .InfoPaneSection-information th{text-align:left}html[dir=rtl] .InfoPaneSection-information th{text-align:right}.InfoPaneSection-information-changeType{text-decoration:none;margin-top:5px}.InfoPaneSection-information-changeType:visited{color:#094AB2}html[dir=ltr] .InfoPaneSection-information-path{float:left}html[dir=rtl] .InfoPaneSection-information-path{float:right}.InfoPaneSection-information-path:after{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-family:Office365Icons;font-style:normal;font-weight:400;line-height:1;speak:none;color:#a6a6a6;padding:0 5px;content:'\\e08a'}html[dir=rtl] .InfoPaneSection-information-path:after{content:'\\e089'}.InfoPaneSection-information-path:last-child:after{content:'';display:none}")
}),define("odsp-next/controls/infoPane/sections/information/InformationSection",["require","exports","./InformationSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./InformationSection.html","./InformationSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-information-info-pane-section",template:e("./InformationSection.html"),viewModel:i,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/policyTip/PolicyTipSectionViewModel",["require","exports","../../InfoPane.resx","odsp-shared/base/ViewModel","../../../../models/item/Item.resx","../../../../models/policyTip/PolicyTipType","odsp-utilities/async/RequireHelper","odsp-utilities/logging/events/Engagement.event","knockout"],function(e,t,i,o,n,r,s,a,l){var d=function(t){function o(e){var o=this;t.call(this,e),this._item=e.item,this.viewTipLink=i.strings.policyTipLaunchDialogLink,this.backgroundClass=this.createPureComputed(function(){var e=o._item();return e&&e.policyTip?"od-PolicyTipSection--"+(e.policyTip>=r.block?"block":"notify"):""}),this.iconClass=this.createPureComputed(function(){var e=o._item();return e&&e.policyTip?e.policyTip>=r.block?"ms-Icon--drm ms-fontColor-redDark":"ms-Icon--alert ms-fontColor-orange":""}),this.text=this.createPureComputed(function(){var e=o._item(),t=n.strings;return e&&e.policyTip?e.policyTip>=r.block?t.policyTipBlockText:t.policyTipNotifyText:""}),this.subscribe(this._item,function(e){e.policyTip&&a.Engagement.logData({name:"PolicyTip.InfoPaneSection.Shown"})})}return __extends(o,t),o.prototype.onViewTipClick=function(t){var i=this;a.Engagement.logData({name:"PolicyTip.InfoPaneSection.ViewTip.Click"});var o=this._item(),n=s.promise(e,"../../../../actions/PolicyTipAction");return n.then(function(e){var n=new(i.resources.injected(e))({item:l.observable(o)});n.execute(t)}),!1},o}(o);return d}),define("odsp-next/controls/infoPane/sections/policyTip/PolicyTipSection.html",[],function(){return'<div class="od-PolicyTipSection InfoPane-section is-expanded"><div class=InfoPane-sectionContent data-bind="css: backgroundClass"><i class="od-PolicyTipSection-icon ms-Icon" data-bind="css: iconClass"></i><div class=od-PolicyTipSection-text><span data-bind="text: text"></span><br><a href=javascript: data-bind="click: onViewTipClick, text: viewTipLink"></a></div></div></div>'}),define("odsp-next/controls/infoPane/sections/policyTip/PolicyTipSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles("html[dir=ltr] .od-PolicyTipSection.InfoPane-section{padding-left:20px}html[dir=rtl] .od-PolicyTipSection.InfoPane-section{padding-right:20px}.od-PolicyTipSection .InfoPane-sectionContent{padding:8px}.od-PolicyTipSection--notify{background-color:rgba(216,59,1,.2)}.od-PolicyTipSection--block{background-color:rgba(232,17,35,.2)}.od-PolicyTipSection-icon{padding-top:2px;font-size:17px}html[dir=ltr] .od-PolicyTipSection-icon{float:left}html[dir=rtl] .od-PolicyTipSection-icon{float:right}html[dir=ltr] .od-PolicyTipSection-text{margin-left:25px}html[dir=rtl] .od-PolicyTipSection-text{margin-right:25px}")}),define("odsp-next/controls/infoPane/sections/policyTip/PolicyTipSection",["require","exports","./PolicyTipSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./PolicyTipSection.html","./PolicyTipSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-policy-tip-section",template:e("./PolicyTipSection.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/models/item/EntityTagType",["require","exports"],function(){var e;return function(e){e[e.email=0]="email",e[e.url=1]="url",e[e.phone=2]="phone",e[e.text=3]="text",e[e.other=4]="other"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/sections/extractedText/ExtractedTextSectionViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../../controls/infoPane/InfoPane.resx","../../../../bindings/toggle/ToggleBinding","../../../../resources/ProviderResourceKeys","../../../../models/item/EntityTagType","../../../../bindings/editableText/EditableTextBinding","../../../../models/sharing/SharingRole","odsp-utilities/logging/ErrorHelper"],function(e,t,i,o,n,r,s,a,l,d,c){var p=n.strings,u=function(e){function t(t){e.call(this,t),this.addBindingHandlers({toggle:r,editableText:l}),this._itemProvider=this.resources.consume(s.item),this.infoPaneResx=n,this.extractedText=i.observable(""),this.extractedEmail=i.observable(""),this.extractedPhone=i.observable(""),this.extractedUrl=i.observable(""),this.currentExtractedText=i.observable(""),this.currentExtractedEmail=i.observable(""),this.currentExtractedPhone=i.observable(""),this.currentExtractedUrl=i.observable(""),this.isSectionExpanded=i.observable(!0),this.isEditable=i.observable(!1),this.sectionHeader=p.extractedTextHeader,this.item=t.item,this.createComputed(this._computeItemChanged),this.isSectionVisible=this.createComputed(this._computeSectionVisible)}return __extends(t,e),t.prototype.onRevertChange=function(){this.extractedEmail(this.currentExtractedEmail.peek()),this.extractedText(this.currentExtractedText.peek()),this.extractedUrl(this.currentExtractedUrl.peek()),this.extractedPhone(this.currentExtractedPhone.peek())},t.prototype.onSubmitChange=function(){var e=this.item(),t=this.extractedEmail.peek()!==this.currentExtractedEmail.peek()||this.extractedText.peek()!==this.currentExtractedText.peek()||this.extractedUrl.peek()!==this.currentExtractedUrl.peek()||this.extractedPhone.peek()!==this.currentExtractedPhone.peek();if(e&&t){var i=[];if(e.ocr&&e.ocr.entityTags)for(var o,n,r=0;r<e.ocr.entityTags.length;r++)o=e.ocr.entityTags[r],n={id:o.id,content:o.content,type:o.type},o.type===a[a.email]?n.content=this.extractedEmail.peek():o.type===a[a.url]?n.content=this.extractedUrl.peek():o.type===a[a.phone]&&(n.content=this.extractedPhone.peek()),i.push(n);this._itemProvider.updateItemOcrInfo(e,this.extractedText.peek(),i).then(function(){},function(e){c.log(e)})}},t.prototype._computeSectionVisible=function(){return!!(this.currentExtractedEmail()||this.currentExtractedPhone()||this.currentExtractedText()||this.currentExtractedUrl())},t.prototype._computeItemChanged=function(){var e=this,t=this.item();if(t){if(this.isEditable(t.sharingRole===d.Owner),t.ocr&&t.ocr.entityTags)for(var i,o=0;o<t.ocr.entityTags.length;o++)i=t.ocr.entityTags[o],i.type===a[a.email]?(this.currentExtractedEmail(i.content),this.extractedEmail(i.content)):i.type===a[a.url]?(this.currentExtractedUrl(i.content),this.extractedUrl(i.content)):i.type===a[a.phone]&&(this.currentExtractedPhone(i.content),this.extractedPhone(i.content));this._itemProvider.getItemOcrTextContent(t).then(function(t){e.currentExtractedText(t),e.extractedText(t)},function(e){c.log(e)})}},t}(o);return u}),define("odsp-next/controls/infoPane/sections/extractedText/ExtractedTextSection.html",[],function(){return'<div class="InfoPane-section InfoPaneSection--extractedText" data-bind="css: { \'is-expanded\': isSectionExpanded }, visible: isSectionVisible"><div class=InfoPane-sectionHeader data-bind="toggle: isSectionExpanded"><i class="InfoPane-sectionExpandButton ms-Icon ms-Icon--chevronDown"></i> <span class=InfoPane-sectionHeaderText data-bind="text: sectionHeader"></span></div><div class=InfoPane-sectionContent><div class=InfoPane-extractedText-label data-bind="visible: !!currentExtractedEmail(), text: infoPaneResx.strings.extractedTextEmailTypeName"></div><div class=InfoPane-extractedText-content data-bind="visible: !!currentExtractedEmail(), editableText: { text: extractedEmail, maxLength: 50, isEditable: isEditable, onRevertChange: onRevertChange, onSubmitChange: onSubmitChange }"></div><div class=InfoPane-extractedText-label data-bind="visible: !!currentExtractedUrl(), text: infoPaneResx.strings.extractedTextUrlTypeName"></div><div class=InfoPane-extractedText-content data-bind="visible: !!currentExtractedUrl(), editableText: { text: extractedUrl, maxLength: 50, isEditable: isEditable, onRevertChange: onRevertChange, onSubmitChange: onSubmitChange }"></div><div class=InfoPane-extractedText-label data-bind="visible: !!currentExtractedPhone(), text: infoPaneResx.strings.extractedTextPhoneTypeName"></div><div class=InfoPane-extractedText-content data-bind="visible: !!currentExtractedPhone(), editableText: { text: extractedPhone, maxLength: 50, isEditable: isEditable, onRevertChange: onRevertChange, onSubmitChange: onSubmitChange }"></div><div class=InfoPane-extractedText-label data-bind="visible: !!currentExtractedText(), text: infoPaneResx.strings.extractedTextTextTypeName"></div><div class=InfoPane-extractedText-content data-bind="visible: !!currentExtractedText(), editableText: { text: extractedText, maxLength: 200, isEditable: isEditable, onRevertChange: onRevertChange, onSubmitChange: onSubmitChange }"></div></div></div>'}),define("odsp-next/controls/infoPane/sections/extractedText/ExtractedTextSection.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPane-extractedText-content{margin-bottom:10px;display:block}.InfoPane-extractedText-label{color:#666}")}),define("odsp-next/controls/infoPane/sections/extractedText/ExtractedTextSection",["require","exports","./ExtractedTextSectionViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ExtractedTextSection.html","./ExtractedTextSection.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-extracted-text-section",template:e("./ExtractedTextSection.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/models/item/UrlType",["require","exports"],function(){var e;return function(e){e[e.download=0]="download",e[e.open=1]="open",e[e.textContent=2]="textContent",e[e.viewInBrowser=3]="viewInBrowser",e[e.bingClickInstrumentation=4]="bingClickInstrumentation"}(e||(e={})),e}),define("odsp-next/models/item/OcrEngineVersion",["require","exports"],function(){var e;return function(e){e[e.TagsOnly=0]="TagsOnly",e[e.Other=1]="Other"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/infoPane/InfoPaneViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../resources/ControlResourceKeys","../../utilities/features/Features","../../bindings/toggle/ToggleBinding","odsp-shared/utilities/string/StringHelper","./InfoPane.resx","./sections/activitiesFeed/ActivitiesFeed","./sections/activitiesFeed/ActivitiesFeed.resx","./sections/tags/TagsSection","./sections/sharing/SharingSection","./sections/caption/CaptionSection","./sections/notifications/NotificationsSection","./sections/properties/PropertiesSection","./sections/location/LocationSection","./sections/information/InformationSection","./sections/policyTip/PolicyTipSection","../../models/sharing/SharingRole","./sections/extractedText/ExtractedTextSection","../../models/item/UrlType","../../models/item/OcrEngineVersion","../../models/item/ItemType","../../resources/DataSourceResourceKeys","../../bindings/css/ClassesBinding","../../bindings/clientRect/ClientRectBinding","../../utilities/browser/ResponsiveUI","../../resources/UtilityResourceKeys","odsp-utilities/object/ObjectUtil","../../utilities/browser/WindowSize","odsp-shared/utilities/object/EqualityComparers","../../dataSources/url/QueryType","odsp-shared/utilities/knockout/Projections"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_,k,T,S,w,P,I,C,E,F,M,O){var L=l.strings,A=289,D=function(e){function t(t){e.call(this,t),this.addBindingHandlers({toggle:s,classes:w,clientRect:P.default}),this._selection=this.resources.consume(n.itemsSelection),this._currentItem=this.resources.consume(n.currentItem),this._sectionsMap=this.resources.consume(n.infoPaneSectionsMap),this._responsiveUI=this.resources.consume(C.responsiveUI),this.activitiesFeedResx=i.observable(c.strings),this._contextualCurrentItem=i.observable(this._currentItem()),this._contextualCurrentItem.equalityComparer=M.objectStrictEquality,this.resources.expose(n.currentItem,this._contextualCurrentItem),this.showPreview=void 0===t.showPreview?!0:t.showPreview,this.item=this.createComputed(this._computeItem),this.item.equalityComparer=M.objectStrictEquality,this.isSingleItemSelect=this.createComputed(this._computeIsSingleItemSelect),this.selectionMessage=this.createComputed(this._computeSelectionMessage),this.isActivityFeatureEnabled=r.default.isFeatureEnabled(r.default.InfoPaneActivityFeed),this.isPreviewVisible=this.createComputed(this._computePreviewVisible),this._captionHasFocus=t.captionHasFocus,this._initializeAvailableSections(),this.tileSize=this.createComputed(this._computeTileSize),this.size=i.observable({width:0,height:0}),this.size.equalityComparer=E.deepCompare,this.sizeCss=this.createPureComputed(this._computeSizeCss),this.showItemUrl=r.default.isFeatureEnabled(r.default.ShowItemLinkInPreviewPane)}return __extends(t,e),t.prototype._computeTileSize=function(){var e,t=this.item();if(t&&t.photo&&t.photo.width&&t.photo.height){var i=Math.max(.5,Math.min(2,t.photo.width/t.photo.height));e={width:A,height:Math.floor(A/i)}}else e={width:A,height:A};return e},t.prototype._computeItem=function(){var e,t=this._currentItem(),o=this._computeSelectionLength();return e=0===o?t:1===o?i.utils.unwrapObservable(this._selection.selection()[0]):null,this._contextualCurrentItem(e),e},t.prototype._computeIsSingleItemSelect=function(){return this._computeSelectionLength()<2},t.prototype._computeSelectionMessage=function(){var e=null,t=this._computeSelectionLength();return t>1&&(e=a.format(L.selectedItemsFormatString,t)),e},t.prototype._computeSelectionLength=function(){var e=0;return this._selection&&(e=this._selection.selection().length),e},t.prototype._computePreviewVisible=function(){var e=!1;return this.item()&&(e=Boolean(this.item().previewIFrameUrl)),e},t.prototype._initializeAvailableSections=function(){var e,t=this,o={item:this._contextualCurrentItem},n={item:this._contextualCurrentItem,hasFocus:this._captionHasFocus};try{e="splist"===this.resources.consume(S.url).getAppSubfolder()}catch(s){e=!1}var a=[{name:"caption",component:{name:h.tagName,params:n},isAvailable:function(e){return void 0!==e.caption&&!e.isRootFolder&&!e.isBundle}},{name:"notifications",component:{name:m.default.tagName,params:o},isAvailable:function(e){return e.type===T.File&&r.default.isFeatureEnabled(r.default.EnableNotificationSubscriptions)}},{name:"policyTip",component:{name:b.tagName,params:o},isAvailable:function(e){return!!e.policyTip}},{name:"location",component:{name:f.tagName,params:o},isAvailable:function(e){return!!e.geoLocation&&e.geoLocation.latitude&&e.geoLocation.longitude&&e.sharingRole===x.Owner}},{name:"tags",component:{name:p.tagName,params:o},isAvailable:function(e){return!!e.tags}},{name:"extractedText",component:{name:y.tagName,params:o},isAvailable:function(e){return!(!e.photo||!e.urls||!e.urls[_[_.textContent]]||e.ocr&&e.ocr.engineVersion===k[k.TagsOnly])}},{name:"properties",component:{name:g.tagName,params:o},isAvailable:function(t){return e&&!t.isPlaceholder&&!t.isRootFolder}},{name:"sharing",component:{name:u.tagName,params:o},isAvailable:function(e){return t._isSharingVisible(e)}},{name:"activities",component:{name:d.tagName,params:o},isAvailable:function(e){return t.isActivityFeatureEnabled&&(e.isRootFolder||void 0!==e.properties.ID)&&(e.type===T.File||e.type===T.Folder)}},{name:"information",component:{name:v.tagName,params:o},isAvailable:function(e){return!e.isPlaceholder&&!e.isRootFolder}}];this._sectionsMap.Comments&&a.push({name:"comments",component:{name:this._sectionsMap.Comments.tagName,params:o},isAvailable:function(e){return!e.isPlaceholder&&!e.isRootFolder}}),this.availableSections=this.addDisposable(i.observableArray(a).filter(function(e){var i=t._contextualCurrentItem();return!!i&&e.isAvailable(i)}))},t.prototype._isSharingVisible=function(e){var t=!1;if(e&&!e.isRootFolder&&e.queryType!==O.RecycleBin)switch(e.sharingRole){case x.Owner:case x.Edit:case x.CoOwner:t=!0;break;default:t=!1}return t},t.prototype._computeSizeCss=function(){var e=this.size(),t=I.determineWindowSize(e.width);this.availableSections().length<5&&t>F.Large&&(t=F.Large);var i=I.determineCssClass(t);return i},t}(o);Object.defineProperty(t,"__esModule",{value:!0}),t.default=D}),define("odsp-next/controls/infoPane/InfoPane.html",[],function(){return'<div class=InfoPane data-bind="classes: { base: \'od-InfoPane--\' + sizeCss() }, clientRect: { size: size }"><!--ko if: item--><!--ko if: showPreview--><div class=InfoPane-itemTile role=presentation data-bind="component: { name: \'ms-item-tile\', params: { item: item, key: item().key, cellSize: tileSize, isInteractable: false } }, visible: !isPreviewVisible()"></div><ms-iframe params="title:\'\', url: item().previewIFrameUrl, isExcludeFromScreenReader: true" role=presentation data-bind="visible: isPreviewVisible"></ms-iframe><!--ko if: showItemUrl--><div data-bind="component: { name: \'od-item-url\', params: { item: item } }"></div><!--/ko--><!--/ko--><!--ko foreach: availableSections--><div class=od-InfoPane-section data-bind="classes: { base: \'od-InfoPane-section--\' + name }, component: component"></div><!--/ko--><!--/ko--><!--ko if: selectionMessage--><div class="InfoPane-selectionMessage ms-font-l" data-bind="text: selectionMessage"></div><!--/ko--></div>'}),define("odsp-next/controls/infoPane/InfoPane.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPane,.InfoPane-section{box-sizing:border-box}.InfoPane:after,.InfoPane:before{display:table;content:\"\";line-height:0}.InfoPane:after{clear:both}.InfoPane-itemTile{display:block;width:auto;height:176px;position:relative;margin:8px}.InfoPane-itemTile .ItemTile-namePlate{padding-left:9px}.InfoPane-sectionHeaderText{color:#333;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:17px;font-weight:400}.InfoPane-section{padding:20px 20px 22px 40px;display:inline-block;width:100%}html[dir=rtl] .InfoPane-section{padding:20px 40px 22px 20px}.InfoPane-sectionHeader{position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:32px;line-height:32px;cursor:pointer}.InfoPane-sectionExpandButton.ms-Icon{font-size:17px;position:absolute;color:#666;width:32px;height:32px;line-height:32px;text-align:center;transition:-webkit-transform 167ms cubic-bezier(.1,.9,.2,1);transition:transform 167ms cubic-bezier(.1,.9,.2,1);transition:transform 167ms cubic-bezier(.1,.9,.2,1),-webkit-transform 167ms cubic-bezier(.1,.9,.2,1)}html[dir=ltr] .InfoPane-sectionExpandButton.ms-Icon{left:-32px}html[dir=rtl] .InfoPane-sectionExpandButton.ms-Icon{right:-32px}.InfoPane-section.is-expanded .InfoPane-sectionExpandButton.ms-Icon{-webkit-transform:rotate(-180deg);-ms-transform:rotate(-180deg);transform:rotate(-180deg)}.InfoPane-section .InfoPane-sectionContent{display:none}.InfoPane-section.is-expanded .InfoPane-sectionContent{display:block}.InfoPane-sectionContent{margin-top:10px;font-size:12px}.InfoPane-selectionMessage{margin:0 0 20px 14px}html[dir=rtl] .InfoPane-selectionMessage{margin:0 14px 20px 0}.lg .InfoPane-selectionMessage,.xlg .InfoPane-selectionMessage,.xxlg .InfoPane-selectionMessage,.xxxlg .InfoPane-selectionMessage{margin-top:18px;font-size:21px}.od-InfoPane-selectFile{color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400;margin:0 0 20px 14px}html[dir=rtl] .od-InfoPane-selectFile{margin:0 14px 20px 0}.od-InfoPane--lg .od-InfoPane-section{width:50%;margin:0 50% 0 0}html[dir=rtl] .od-InfoPane--lg .od-InfoPane-section{margin:0 0 0 50%}.od-InfoPane--lg .od-InfoPane-section:nth-child(-n+3){margin:0;float:right;clear:right}html[dir=rtl] .od-InfoPane--lg .od-InfoPane-section:nth-child(-n+3){margin:0}.od-InfoPane--lg .od-InfoPane-section:nth-child(1){width:100%;float:none;clear:both}.od-InfoPane--xlg .od-InfoPane-section,.od-InfoPane--xxlg .od-InfoPane-section,.od-InfoPane--xxxlg .od-InfoPane-section{width:33.33333333%;margin:0 33.33333333%}html[dir=rtl] .od-InfoPane--xlg .od-InfoPane-section,html[dir=rtl] .od-InfoPane--xxlg .od-InfoPane-section,html[dir=rtl] .od-InfoPane--xxxlg .od-InfoPane-section{margin:0 33.33333333%}.od-InfoPane--xlg .od-InfoPane-section:nth-child(-n+4),.od-InfoPane--xxlg .od-InfoPane-section:nth-child(-n+4),.od-InfoPane--xxxlg .od-InfoPane-section:nth-child(-n+4){margin:0;float:left;clear:left}html[dir=rtl] .od-InfoPane--xlg .od-InfoPane-section:nth-child(-n+4),html[dir=rtl] .od-InfoPane--xxlg .od-InfoPane-section:nth-child(-n+4),html[dir=rtl] .od-InfoPane--xxxlg .od-InfoPane-section:nth-child(-n+4){margin:0}.od-InfoPane--xlg .od-InfoPane-section:nth-child(1),.od-InfoPane--xxlg .od-InfoPane-section:nth-child(1),.od-InfoPane--xxxlg .od-InfoPane-section:nth-child(1){width:100%;float:none;clear:both}.od-InfoPane--xlg .od-InfoPane-section:nth-child(2),.od-InfoPane--xxlg .od-InfoPane-section:nth-child(2),.od-InfoPane--xxxlg .od-InfoPane-section:nth-child(2){float:right;clear:both}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/iFrameCtrl/IFrameCtrlViewModel",["require","exports","odsp-shared/base/ViewModel","knockout"],function(e,t,i,o){var n=function(e){function t(t){e.call(this);var i=t.url,n=t.title||"";this.url="string"==typeof i?o.observable(i):i,this.title="string"==typeof n?o.observable(n):n,this.isExcludeFromScreenReader=t.isExcludeFromScreenReader||!1,this.tabindex=this.isExcludeFromScreenReader?"-1":null,this.role=this.isExcludeFromScreenReader?"presentation":null,this.isVisible=this.createComputed(this._computeIsVisible),this.isTitleVisible=this.createComputed(this._computeIsTitleVisible),this.iframeOnLoad=function(e,i){t.onload&&t.onload(i)}}return __extends(t,e),t.prototype._computeIsVisible=function(){return Boolean(this.url())},t.prototype._computeIsTitleVisible=function(){return Boolean(this.title())},t}(i);return n}),define("odsp-next/controls/iFrameCtrl/IFrameCtrl.html",[],function(){return'<div class=IFrame data-bind="visible: isVisible"><div class=ms-IFrameCtrl-title data-bind="visible: isTitleVisible, text: title()"></div><iframe class=ms-IFrameCtrl-iFrame data-bind="attr: {src: url(), role: role, tabindex: tabindex}, event: {load: iframeOnLoad}"></iframe></div>'}),define("odsp-next/controls/iFrameCtrl/IFrameCtrl.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-IFrameCtrl-title{font-size:17px}.ms-IFrameCtrl-iFrame{width:100%;border:0;min-height:300px}")}),define("odsp-next/controls/iFrameCtrl/IFrameCtrl",["require","exports","./IFrameCtrlViewModel","odsp-shared/utilities/knockout/ComponentFactory","./IFrameCtrl.html","./IFrameCtrl.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-iframe",template:e("./IFrameCtrl.html"),viewModel:i});return n}),define("odsp-next/controls/list/interfaces/ColumnType",["require","exports"],function(){var e;return function(e){e[e.name=0]="name",e[e.other=1]="other",e[e.size=2]="size",e[e.dateTaken=3]="dateTaken",e[e.dateModified=4]="dateModified",e[e.location=5]="location",e[e.type=6]="type",e[e.dateAccessed=7]="dateAccessed",e[e.dateShared=8]="dateShared",e[e.dateDeleted=9]="dateDeleted",e[e.displayName=10]="displayName",e[e.sharing=11]="sharing",e[e.userArranged=12]="userArranged",e[e.childCount=13]="childCount"}(e||(e={})),e}),define("odsp-next/controls/itemTile/SubTextIconType",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.sharing=1]="sharing",e[e.checkOut=2]="checkOut",e[e.notify=3]="notify",e[e.block=4]="block",e[e.playButton=5]="playButton"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/focus/DelayedHasFocusBinding",["require","exports","../BaseBinding"],function(e,t,i){var o=3,n=30,r=function(e){function t(t){e.call(this,t),this._hasFocus=this.valueAccessor(),this._asyncUpdateFocus=this.async.debounce(this._updateFocus,n),this.events.on(this.element,"focus",this._onFocus),this.events.on(this.element,"blur",this._onBlur),this.subscribe(this._hasFocus,this._onHasFocusChanged),this._startUpdateFocus()}return __extends(t,e),t.prototype._onFocus=function(){this._hasFocus(!0),this._startUpdateFocus()},t.prototype._onBlur=function(){this._hasFocus(!1),this._startUpdateFocus()},t.prototype._onHasFocusChanged=function(){this._startUpdateFocus()},t.prototype._startUpdateFocus=function(){this._focusAttempts=0,this._updateFocus()},t.prototype._updateFocus=function(){var e=this._hasFocus.peek();this.element&&(e?(this._focusAttempts++,this.element.focus(),!this._checkIfFocused()&&this._focusAttempts<o&&this._asyncUpdateFocus()):this.element.blur())},t.prototype._checkIfFocused=function(){var e,t=this.element.ownerDocument;try{e=t.activeElement}catch(i){e=t.body}return e===this.element},t}(i);return r}),define("odsp-utilities/math/Transform",["require","exports","./Point"],function(e,t,i){var o=function(){function e(e,t){void 0===e&&(e=new i),void 0===t&&(t=1),this.translate=e,this.scale=t}return e.areEqual=function(e,t,o){return void 0===o&&(o=1e-6),i.areEqual(e.translate,t.translate,o)&&Math.abs(Math.log(e.scale/t.scale))<o},e.zoom=function(t,i,o){return new e(t.subtract(i).scale(o-1),o)},e.prototype.apply=function(e){return e.scale(this.scale).add(this.translate)},e.prototype.multiply=function(t){return new e(this.translate.add(t.translate.scale(this.scale)),this.scale*t.scale)},e.prototype.invert=function(){return new e(this.translate.scale(-1/this.scale),1/this.scale)},e.IDENTITY=new e,e}();return o}),define("odsp-shared/models/image/Alignments",["require","exports","odsp-utilities/math/Transform","odsp-utilities/math/Point"],function(e,t,i,o){function n(){"use strict";for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return new l(e.map(function(e){return e.name}).join("-"),function(t,o){for(var n=i.IDENTITY,r=0;r<e.length;r++){var s=e[r],a={width:t.width*n.scale,height:t.height*n.scale};n=s.getTransform(a,o).multiply(n)}return n})}function r(e){"use strict";if("string"==typeof e)e=a[e];else if("object"==typeof e)return e;switch(e){case a.top:return t.top;case a.fitHeight:return t.fitHeight;case a.fitWidth:return t.fitWidth;case a.fit:return t.fitCenter;case a.center:return t.center;default:return t.coverCenter}}function s(e){"use strict";return e instanceof Array?n.apply(void 0,e.map(r)):n.apply(void 0,[e].map(r))}!function(e){e[e.cover=0]="cover",e[e.center=1]="center",e[e.fit=2]="fit",e[e.fitWidth=3]="fitWidth",e[e.fitHeight=4]="fitHeight",e[e.top=5]="top"}(t.AlignmentType||(t.AlignmentType={}));var a=t.AlignmentType,l=function(){function e(e,t){this.name=e,this.getTransform=t}return e}();t.center=new l(a[a.center],function(e,t){var n=new o((t.width-e.width)/2,(t.height-e.height)/2);return new i(n)}),t.top=new l(a[a.top],function(e,t){var n=new o((t.width-e.width)/2,0);return new i(n)}),t.fitWidth=new l(a[a.fitWidth],function(e,t){var n=t.width/e.width;return new i(o.ORIGIN,Math.min(n,1))}),t.fitHeight=new l(a[a.fitHeight],function(e,t){var n=t.height/e.height;return new i(o.ORIGIN,Math.min(n,1))}),t.fit=new l(a[a.top],function(e,i){var o,n=e.width/e.height,r=i.width/i.height;return o=n>r?t.fitWidth:t.fitHeight,o.getTransform(e,i)}),t.cover=new l(a[a.cover],function(e,i){var o,n=e.width/e.height,r=i.width/i.height;return o=n>r?t.fitHeight:t.fitWidth,o.getTransform(e,i)}),t.fitCenter=n(t.fit,t.center),t.coverCenter=n(t.cover,t.center),t.getAlignment=r,t.createAlignment=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/image/frame/ImageFrameViewModel",["require","exports","odsp-shared/base/ViewModel","odsp-shared/utilities/string/StringHelper","../../thumbnailTile/ThumbnailCache","odsp-shared/models/image/Alignments","odsp-utilities/object/ObjectUtil","knockout"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t,i){e.call(this,t,i),this._image=t.image,this._alignment=r.createAlignment(t.alignment),this._desiredSize=t.desiredSize||a.observable(),this._thumbnailCache=i&&i.thumbnailCache||n.default.getInstance(),this._isLoaded=t.isLoaded||a.observable(!1),this._coverage=t.coverage||a.observable({minimum:1,maximum:1}),this._images=this.createComputed(this._computeImages).extend(i&&i.imagesExtenders||{rateLimit:{timeout:300,method:"notifyWhenChangesStop"}}),this._images.equalityComparer=s.deepCompare,this.imageStackParams={images:this._images,desiredSize:this._desiredSize,isLoaded:this._isLoaded,scale:t.scale,alignment:this._alignment,fadeIn:t.fadeIn,allowLoading:t.allowLoading}}return __extends(t,e),t.prototype._computeImages=function(){var e=this._image(),t=this._desiredSize(),i=window.devicePixelRatio||1,o=[];if(e){var n;if(t&&t.width&&t.height){var r={width:t.width*i,height:t.height*i};if(e.width&&e.height){var s=this._alignment.getTransform(e,r);n={width:s.scale*e.width,height:s.scale*e.height}}else e.getAligned&&(e=e.getAligned(r,this._alignment))}else n=e;if(n&&e.width&&!this._isLoaded.peek()){var a=this._thumbnailCache.getCoveragePercent(e,n),l=this._coverage(),d=l.minimum,c=void 0===d?1:d,p=l.maximum,u=void 0===p?1:p,h=l.fallback,m=c*a,g=u*a,f=this._thumbnailCache.retrieve(e,g,m);if(f)o.push({width:e.width,height:e.height,url:f.url,rotation:e.rotation});else if(h){var v={width:n.width*h,height:n.height*h},b=this._getDerivedImage(e,v);this._thumbnailCache.register(e,b,v,!1),o.push(b)}}var x=this._getDerivedImage(e,n||t);o[0]&&o[0].url===x.url||(n&&this._thumbnailCache.register(e,x,n,!1),o.push(x))}return o},t.prototype._getDerivedImage=function(e,t){var i;return i=e.getAligned?e.getAligned(t,this._alignment).url:o.format(e.url,Math.ceil(t.width),Math.ceil(t.height)),{width:e.width,height:e.height,url:i,rotation:e.rotation}},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=l}),define("odsp-next/controls/image/frame/ImageFrame.html",[],function(){return"<span class=od-ImageFrame data-bind=\"component: { name: 'od-image-stack', params: imageStackParams }\"></span>"}),define("odsp-next/controls/image/frame/ImageFrame.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ImageFrame{display:block;position:absolute;top:0;left:0;bottom:0;right:0}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/image/stack/ImageStackViewModel",["require","exports","odsp-shared/base/ViewModel","knockout"],function(e,t,i,o){var n;!function(e){e[e.initialized=0]="initialized",e[e.assigned=1]="assigned",e[e.loaded=2]="loaded",e[e.blocked=3]="blocked"}(n||(n={}));var r=function(e){function t(t,i){var r=this;e.call(this,t,i),this.tiles=o.observableArray(),this._state=n.initialized,this._images=t.images||o.observable([]),this._nextImages=[],this._desiredSize=t.desiredSize,this._isLoaded=t.isLoaded||o.observable(!1),this._alignment=t.alignment,this._scale=t.scale,this.fadeIn=t.fadeIn||o.observable(!0),this._allowLoading=t.allowLoading||o.observable(!0),this.createComputed(function(){return r._onAllowLoadingChanged(r._allowLoading())
}),this.createComputed(function(){return r._onImagesChanged(r._images())})}return __extends(t,e),t.prototype._onImagesChanged=function(e){(t=this._nextImages).splice.apply(t,[0,this._nextImages.length].concat(e)),this._handleRotations(),this._load();var t},t.prototype._onLoaded=function(){this._state=n.loaded,this._isLoaded(!0),this.async.clearTimeout(this._failedToLoadTimeoutId),this._failedToLoadTimeoutId=0,this.fadeIn.peek()?this._animationCompletedTimeoutId=this.async.setTimeout(this._onAnimationCompleted,2e3):this._onAnimationCompleted()},t.prototype._onAnimationCompleted=function(){this._state=n.initialized,this._clean(),this._onAllowLoadingChanged(this._allowLoading.peek()),this._load()},t.prototype._onFailedToLoad=function(){this._state=n.initialized,this._onAllowLoadingChanged(this._allowLoading.peek()),this._load()},t.prototype._load=function(){var e=this;if(this._state===n.initialized){var t=this._nextImages.shift();if(t){this._checkIsTileLoaded&&this._checkIsTileLoaded.dispose(),this.async.clearTimeout(this._animationCompletedTimeoutId),this._animationCompletedTimeoutId=0,this.async.clearTimeout(this._failedToLoadTimeoutId),this._failedToLoadTimeoutId=0;var i=this._isTileLoaded=o.observable(!1);this.tiles.push({image:o.observable(t),desiredSize:this._desiredSize,isLoaded:i,alignment:this._alignment,scale:this._scale}),this._state=n.assigned,this._checkIsTileLoaded=this.createComputed(function(){i()&&e._onLoaded()}),i.peek()||(this._failedToLoadTimeoutId=this.async.setTimeout(this._onFailedToLoad,1e4))}}},t.prototype._clean=function(){this.tiles.splice(0,this.tiles.peek().length-1)},t.prototype._handleRotations=function(){var e=this._nextImages[0];if(e){for(var t=!1,i=this.tiles.peek(),o=0;o<i.length;o++){var n=i[o];this._isEquivalentImage(n.image.peek(),e)&&(n.image(e),o===i.length-1&&(t=!0))}t&&this._nextImages.shift()}},t.prototype._onAllowLoadingChanged=function(e){e&&this._state===n.blocked?(this._state=n.initialized,this._load()):e||this._state!==n.initialized||(this._state=n.blocked)},t.prototype._isEquivalentImage=function(e,t){return e.url===t.url},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),define("odsp-next/controls/image/stack/ImageStack.html",[],function(){return"<span class=od-ImageStack data-bind=\"css: { 'od-ImageStack--fade': fadeIn }, template: { foreach: tiles }\"><span class=od-ImageStack-tile data-bind=\"css: { 'od-ImageStack-tile--isLoaded': $data.isLoaded, }, component: { name: 'od-image-tile', params: $data }\"></span></span>"}),define("odsp-next/controls/image/stack/ImageStack.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ImageStack,.od-ImageStack-tile{display:block;position:absolute;top:0;left:0;bottom:0;right:0}.od-ImageStack{overflow:hidden}.od-ImageStack-tile{opacity:0}.od-ImageStack-tile--isLoaded{opacity:1}.od-ImageStack--fade .od-ImageStack-tile--isLoaded{transition:opacity 217ms linear 50ms}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/image/tile/ImageTileViewModel",["require","exports","odsp-shared/base/ViewModel","odsp-shared/base/Rotation","../../../bindings/css/ClassesBinding","../../../bindings/imageLoader/ImageLoaderBinding","odsp-shared/utilities/string/StringHelper","odsp-utilities/math/Transform","odsp-shared/models/image/Alignments","../../thumbnailTile/ThumbnailCache","knockout"],function(e,t,i,o,n,r,s,a,l,d,c){var p=100,u=4,h=2,m=90,g=2,f=function(e){function t(t,i){e.call(this,t,i),this.addBindingHandlers({imageLoader:r,classes:n}),this._image=t.image||c.observable(),this._scale=t.scale||c.observable(1),this._desiredSize=t.desiredSize||c.observable(),this._alignment=l.createAlignment(t.alignment),this._isLoaded=t.isLoaded||c.observable(!1),this._thumbnailCache=i&&i.thumbnailCache||d.default.getInstance(),this.imageUrl=this.createPureComputed(this._computeImageUrl),this.actualSize=c.observable(),this._rotation=this.createPureComputed(this._computeRotation),this._finalSize=this.createPureComputed(this._computeFinalSize),this.imageStyle=this.createPureComputed(this._computeStyle),this.isRotating=c.observable(!1),this.isLoaded=c.observable(!1),this.createComputed(this._computeUpdateIsLoaded),this.createComputed(this._computeRecordImage),this.createComputed(this._computeSetIsRotating),this.createComputed(this._computeClearIsRotating).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}})}return __extends(t,e),t.prototype._computeImageUrl=function(){var e=this._image();return e&&e.url&&s.format(e.url,e.width,e.height)||""},t.prototype._computeFinalSize=function(){var e,t=this._image(),i=this._scale();if(t&&!t.width){var o=this.actualSize(),n=window.devicePixelRatio||1;e=o&&{width:o.width*i/n,height:o.height*i/n}}else e=t&&{width:t.width*i,height:t.height*i};return e},t.prototype._computeStyle=function(){var e,t=this._desiredSize(),i=this._finalSize(),n=this._rotation();if(i){var r;r=t&&t.width&&t.height?t:i;var s,l=this._alignment.getTransform(i,r),d=l.translate.x/r.width,c=l.translate.y/r.height,f=l.scale*i.width/r.width;if(n===o.none)s="";else{var v;if(n%h===o.none)v=a.IDENTITY;else{var b={width:i.height,height:i.width},x=this._alignment.getTransform(b,r);v=x.multiply(l.invert())}s="rotate("+n%u*m+"deg) scale("+v.scale.toFixed(6)+")"}e={left:(d*p).toFixed(g)+"%",top:(c*p).toFixed(g)+"%",width:(f*p).toFixed(g)+"%","-webkit-transform":s,"-ms-transform":s,transform:s}}else e={};return e},t.prototype._computeRotation=function(){var e=this._image();return e&&e.rotation||o.none},t.prototype._computeSetIsRotating=function(){this._rotation(),c.computedContext.isInitial()||this.isRotating(!0)},t.prototype._computeClearIsRotating=function(){var e=this.isRotating();e&&this.isRotating(!1)},t.prototype._computeRecordImage=function(){var e=this._image();e&&this.isLoaded()&&this._thumbnailCache.record(e)},t.prototype._computeUpdateIsLoaded=function(){this._isLoaded(this.isLoaded()&&!!this.actualSize())},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=f}),define("odsp-next/controls/image/tile/ImageTile.html",[],function(){return"<span class=od-ImageTile data-bind=\"classes: { mappings: { 'od-ImageTile--isLoaded': isLoaded, 'od-ImageTile--isDimensioned': !!actualSize(), 'od-ImageTile--isRotating': isRotating } }\"><img class=od-ImageTile-image data-bind=\"imageLoader: { src: imageUrl, actualSize: actualSize, isLoaded: isLoaded }, style: imageStyle\"></span>"}),define("odsp-next/controls/image/tile/ImageTile.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-ImageTile,.od-ImageTile img{display:block}.od-ImageTile{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}.od-ImageTile-image{display:block;visibility:hidden;position:absolute;box-sizing:border-box}.od-ImageTile--isLoaded.od-ImageTile--isDimensioned .od-ImageTile-image{visibility:inherit}.od-ImageTile--isRotating .od-ImageTile-image{transition:-webkit-transform 167ms cubic-bezier(.1,.25,.75,.9);transition:transform 167ms cubic-bezier(.1,.25,.75,.9);transition:transform 167ms cubic-bezier(.1,.25,.75,.9),-webkit-transform 167ms cubic-bezier(.1,.25,.75,.9)}")}),define("odsp-next/controls/image/tile/ImageTile",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./ImageTileViewModel","./ImageTile.html","./ImageTile.css"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-image-tile",template:e("./ImageTile.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/image/stack/ImageStack",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./ImageStackViewModel","./ImageStack.html","./ImageStack.css","../tile/ImageTile"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-image-stack",template:e("./ImageStack.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/image/frame/ImageFrame",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./ImageFrameViewModel","./ImageFrame.html","./ImageFrame.css","../stack/ImageStack"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-image-frame",template:e("./ImageFrame.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/newBadge/NewBadgeViewModel",["require","exports","odsp-shared/base/ViewModel","../../controls/commands/Commands.resx"],function(e,t,i,o){var n=function(e){function t(t){e.call(this,t),this.newItemText=o.strings.Create.toUpperCase(),this._size=t.desiredSize}return __extends(t,e),t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/newBadge/NewBadge.html",[],function(){return'<div class=od-newBadge><span class="od-newBadge-icon ms-Icon ms-Icon--glimmer"></span> <span class=od-newBadge-text data-bind="text: newItemText"></span></div>'}),define("odsp-next/controls/newBadge/NewBadge.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-newBadge{font-size:11px;font-family:'Segoe UI Semibold WestEuropean','Segoe UI Semibold','Segoe WP Semibold','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-weight:600}.od-newBadge .od-newBadge-icon{-webkit-transform:translate(0,-.6em);-ms-transform:translate(0,-.6em);transform:translate(0,-.6em)}html[dir=ltr] .od-newBadge .od-newBadge-icon{margin-right:-.46em}html[dir=rtl] .od-newBadge .od-newBadge-icon{margin-left:-.46em;-webkit-transform:translate(0,-.6em) scale(-1,1);-ms-transform:translate(0,-.6em) scale(-1,1);transform:translate(0,-.6em) scale(-1,1)}")}),define("odsp-next/controls/newBadge/NewBadge",["require","exports","./NewBadgeViewModel","odsp-shared/utilities/knockout/ComponentFactory","./NewBadge.html","./NewBadge.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-new-badge",template:e("./NewBadge.html"),viewModel:i.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/itemTile/ItemTileViewModel",["require","exports","odsp-shared/base/ViewModel","../dragAndDrop/DragType","knockout","../../models/item/ItemType","../../resources/ControlResourceKeys","../dragAndDrop/DropHelper","odsp-utilities/object/ObjectUtil","../../utilities/list/SharingTypeHelper","../../resources/DataSourceResourceKeys","../../actions/OpenRelation","../../resources/UtilityResourceKeys","../../utilities/string/FileSizeFormatter","../../controls/list/interfaces/ColumnType","../../models/policyTip/PolicyTipType","../../dataSources/url/QueryType","./SubTextIconType","../../resources/ProviderResourceKeys","../../bindings/focus/DelayedHasFocusBinding","../../bindings/dragAndDrop/DragAndDropBinding","odsp-utilities/domUtils/DomUtils","../../utilities/features/Features","../../controls/thumbnailTile/ThumbnailTile","../../controls/image/frame/ImageFrame","../newBadge/NewBadge","../../utilities/browser/WindowSize"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_,k,T,S,w,P){var I,C=50,E=48,F=.77;t.TEMPLATE_TAGS={folder:"ms-item-tile-folder",file:"ms-item-tile-file",photo:"ms-item-tile-photo",tag:"ms-item-tile-tag",video:"ms-item-tile-video"};var M=function(i){function M(e){var t=this;i.call(this,e),this.selectionModel=this.resources.consume(s.itemsSelection),this.isDroppingTarget=n.observable(!1),this.isReceivingDrop=n.observable(!1),this.isSelected=n.observable(!1),this.isFocused=n.observable(!1),this.ignoreClickTime=n.observable(0),this.selectionModel=this.resources.consume(s.itemsSelection),this._urlDataSource=this.resources.consume(c.url),this.parentItem=this.resources.consume(s.currentItem),this.item=this.resources.expose(s.currentItem,n.isObservable(e.item)?e.item:n.observable(e.item)),this._platform=this.resources.consume(u.platformDetection),this._mobile=this.resources.consume(u.mobile),this.templateName=this.createComputed(this._computeTemplateName);var o=this.resources.consume(s.actionMap);this._action=new(this.managed(o.DefaultClickAction))({item:this.item,openRelation:p.specified,userInvokedItem:!0,sourceEngagement:"ItemTile.Click"}),this.isInvokable=this.createComputed(this._computeIsInvokable),this.thumbnail=this.createComputed(this._computeThumbnail),this.thumbnail.equalityComparer=l.deepCompare,this.linkUrl=this.createPureComputed(this._computeLinkUrl),this.subText=this.createComputed(this._computeSubText),this.folderChildCount=n.observable(""),this.childCount=this.createComputed(this._computeChildCount),this.tagCount=this.createComputed(this._computeTagCount),this.longTagTooltip=this.createComputed(this._computeLongTagTooltip),this.isShared=this.createComputed(this._computeIsShared),this._subTextIconType=this.createComputed(this._computeSubTextIconType),this.subTextIconUrl=this.createComputed(this._computeSubTextIconUrl),this.subTextIconClass=this.createComputed(this._computeSubTextIconClass),this.isSubTextVisible=this.createComputed(this._computeIsSubTextVisible),this.isInteractable=void 0===e.isInteractable?!0:e.isInteractable,this.isSelectable=this.createComputed(this._computeIsSelectable),this.showTagCount=k.default.isFeatureEnabled(k.default.ShowTagCountInPhotos),this.newBadgeTagName=w.default.tagName,this.newBadgeParams={desiredSize:n.observable(P.Small)},this.isCheckVisible=this.createComputed(function(){return t._platform.isMobile&&(t._mobile.showItemCheck()||t.selectionModel.selection().length>0)}),this.pulseTarget=n.observable(),this._dropHelper=new(this.managed(a)),this.imageRect=e.cellSize||n.observable({width:100,height:100}),this.imageRect.equalityComparer=l.deepCompare,this.iconSize=this.createPureComputed(this._computeIconSize),this.desiredSize=this.createPureComputed(this._computeDesiredIconSize),this.draggable=this.isInteractable,this.isDroppable=this.createComputed(this._computeIsDroppable),this.tabindex=this.createComputed(function(){return t.isFocused()?0:-1}),this.createComputed(function(){var e=t.item();t._updateSelectionSubscription(e.key)}),this.createComputed(function(){var e=t.isReceivingDrop();e&&t.isReceivingDrop(!1)}).extend({rateLimit:{timeout:1450,method:"notifyWhenChangesStop"}}),this.photoThumbnailTagName=k.default.isFeatureEnabled(k.default.UseImageFrameInItemTilePhoto)?S.default.tagName:T.tagName,this.fileThumbnailTagName=k.default.isFeatureEnabled(k.default.UseImageFrameInItemTileFile)?S.default.tagName:T.tagName,this.addBindingHandlers({delayedHasFocus:x,dragAndDrop:y.default})}return __extends(M,i),M.prototype.dispose=function(){i.prototype.dispose.call(this),this._updateSelectionSubscription(null)},M.prototype.onItemCheckClick=function(e,t){var i=this.resources.consume(s.itemsSelection);return t.shiftKey?i.selectToItem(this.item):i.toggleItemSelected(this.item),i.setItemFocus(this.item,!!t.shiftKey),t.preventDefault(),t.stopPropagation(),!1},M.prototype.onClick=function(e,t){var i=this.ignoreClickTime(),o=(new Date).getTime();return i&&C>=o-i?(t.stopPropagation(),t.preventDefault(),!1):t.shiftKey||t.ctrlKey||t.metaKey?!0:(this.onInvoke(t),t.stopPropagation(),t.preventDefault(),!1)},M.prototype.onMouseDown=function(e,t){if(!this.isInteractable)return!0;var i=!!_.findAncestor(t.target,"ItemTile-rowCheck"),o=this.selectionModel.isItemSelected(this.item);t.shiftKey||t.ctrlKey||t.metaKey||(o||i||this.selectionModel.clear(),i||this.selectionModel.setItemSelected(this.item,!0))},M.prototype.onInvoke=function(e){var t=!!_.findAncestor(e.target,"ItemTile-rowCheck");t||this._action.isAvailable.peek()&&this._action.execute(e).done()},M.prototype.getDragData=function(){var e=this.item(),t=null;return e.isDraggable&&this.selectionModel.isItemSelected(this.item)&&(t={type:o.OneDriveItem,item:this.item(),selectionModel:this.selectionModel}),t},M.prototype.onMayReceiveDrop=function(e){var t=this.item&&this.item.peek&&this.item.peek();return t&&t.isDropEnabled&&e.item!==t&&(e.type===o.OneDriveItem||e.type===o.FileUpload)?{targetName:t.name}:null},M.prototype.onReceiveDrop=function(e){var t=this._dropHelper.processDrop(e,this.item.peek());return t&&this.isReceivingDrop(!0),t},M.prototype.onRemoveDropLocation=function(){this.isDroppingTarget(!1),this.pulseTarget().enablePulsing(!0)},M.prototype.getItem=function(){return this.item},M.prototype.isTag=function(){var e=this.item();return!!e.tagInfo},M.prototype.isFolder=function(){var e=this.item();return e.type===r.Folder&&!e.isAlbum&&!e.faceGroup},M.prototype.isFile=function(){var e=this.item();return e.type!==r.Folder&&!this.isMedia()},M.prototype.isMedia=function(){var e=this.item();return!!e.photo},M.prototype.isAlbum=function(){var e=this.item();return e.isAlbum},M.prototype.isVideo=function(){var e=this.item();return!!e.video},M.prototype.isFaceGroup=function(){var e=this.item();return!!e.faceGroup},M.prototype.hasNewBadge=function(){var e=this.item();return!!e.properties.newAutoAlbumTag},M.prototype._computeSubTextIconType=function(){var e=this.item();return e.isViolation||e.policyTip&&e.policyTip>=g.block?v.block:e.properties.CheckedOutUserId?v.checkOut:e.policyTip===g.notify?v.notify:e.video&&this._urlDataSource.isCurrentQuery(f.Photos)?v.playButton:this.isShared()?v.sharing:v.none},M.prototype._computeSubTextIconUrl=function(){return this._subTextIconType()!==v.checkOut?"":(void 0===I&&(I=this.resources.consume(c.settings).mediaBaseUrl),void 0!==I?e.toUrl(I+"/images/overlays/checkoutoverlaygrid.svg"):"")},M.prototype._computeSubTextIconClass=function(){var e="ms-Icon  ";switch(this._subTextIconType()){case v.sharing:return e+"ItemTile-sharingIcon ItemTile-subTextIcon ms-Icon--people";case v.checkOut:return e+"ItemTile-subTextImageShort";case v.block:return e+"ItemTile-blockIcon ItemTile-subTextIcon ms-Icon--drm";case v.notify:return e+" ItemTile-subTextIcon ms-Icon--alert";case v.playButton:return e+"ItemTile-playButton ms-Icon--play";default:return""}},M.prototype._computeTemplateName=function(){var e,i=this.item();return e=i.tagInfo?t.TEMPLATE_TAGS.tag:i.type===r.Folder?t.TEMPLATE_TAGS.folder:i.photo?t.TEMPLATE_TAGS.photo:i.video&&this._urlDataSource.isCurrentQuery(f.Photos)?t.TEMPLATE_TAGS.video:t.TEMPLATE_TAGS.file},M.prototype._computeIsSelectable=function(){var e=this.item();return this.isInteractable&&this.selectionModel.canSelectItem(this.item)&&!e.tagInfo},M.prototype._computeThumbnail=function(){var e=null,t=this.item();return t&&t.thumbnails&&t.thumbnails.length?(e=t.thumbnails[0],{url:e.url,width:e.width,height:e.height,rotation:t.rotation,getAligned:e.getAligned,fitToSize:e.fitToSize}):null},M.prototype._computeIconSize=function(){var e=this.thumbnail();return e?32:96},M.prototype._computeDesiredIconSize=function(){var e=this.thumbnail(),t=(this.imageRect().height-E)*F;return e?32:Math.min(96,Math.ceil(t))},M.prototype._computeIsSubTextVisible=function(){var e=this.item(),t=this.parentItem?this.parentItem():null,i=e.type!==r.Folder||t&&(t.queryType===f.SharedWithMe||t.queryType===f.SharedWithMeODB);return i},M.prototype._computeLinkUrl=function(){var e=this.item(),t=this.resources.consume(s.currentItemSet),i=this._urlDataSource.getDefaultClickUrl(e,{preferCurrentView:!0,itemSet:t()});return i},M.prototype._computeSubText=function(){var e="",t=this.item(),i=this.resources.consume(s.currentItemSet),o=i?m[i().sortField]:m.name;switch(o){case m.size:e=h.formatSize(t.size);break;case m.dateTaken:e=t.dateTaken;break;case m.dateModified:e=t.dateModified;break;default:e=t.defaultSubText||""}return e},M.prototype._computeChildCount=function(){var e=this,t=this.item(),i="",o=this.resources.consume(c.url).getQueryType();if(t.type===r.Folder&&(t.queryType!==f.RecycleBin||t.folder.totalCount>0))if(void 0!==t.childCount)i=String(t.childCount);else if(o===f.Files){var n=this.resources.consume(b.folderItemCount);if(n){var s=n.getFolderItemCountInfo(t);s.then(function(i){Boolean(i)&&(t.childCount=i.itemCount,e.folderChildCount(String(t.childCount)))},function(){})}}return this.folderChildCount(i),this.folderChildCount()},M.prototype._computeTagCount=function(){var e=this.item();return e.tagInfo&&e.folder?String(e.folder.childCount):""},M.prototype._computeLongTagTooltip=function(){var e=this.item();return e.tagInfo&&e.name&&e.name.length>50?e.name:""},M.prototype._computeIsShared=function(){var e=this.item().sharingType;return d.showSubTextSharingIcon(e)},M.prototype._computeIsDroppable=function(){var e=this.item();return e.isDropEnabled&&this.isInteractable},M.prototype._computeIsInvokable=function(){return this._action.isAvailable()},M.prototype._updateSelectionSubscription=function(e){this._selectionSubscription&&(this._selectionSubscription.dispose(),this._selectionSubscription=null),this.selectionModel&&e&&this.isInteractable&&(this._selectionSubscription=this.selectionModel.registerSelectable(e,this))},M}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=M}),define("odsp-next/controls/itemTile/ItemTile.html",[],function(){return"<div class=ItemTile data-bind=\"delayedHasFocus: isFocused, css: { 'is-tag': isTag(), 'is-folder': isFolder(), 'is-file': isFile(), 'is-media': isMedia(), 'is-receivingDrop': isReceivingDrop, 'is-dropping': isDroppingTarget, 'is-checkVisible': isCheckVisible, 'can-select': isSelectable, 'has-thumbnail': thumbnail() !== null, 'is-selected': isSelectable() && isSelected(), 'is-focused': isInteractable && isFocused(), 'od-ItemTile--isAlbum': isAlbum() || isFaceGroup(), 'od-ItemTile--isVideo': isVideo(), 'od-ItemTile--isInteractable': isInteractable, 'od-ItemTile--isInvokable': isInvokable }, attr: { tabindex: tabindex }, dragAndDrop: { mayReceiveDrop: onMayReceiveDrop, isDragging: isDroppingTarget, receiveDrop: onReceiveDrop }\"><a tabindex=-1 data-bind=\"event: { click: onClick, mousedown: onMouseDown }, attr: { 'href': linkUrl, 'title': longTagTooltip }, automation: 'link'\"><div class=ItemTile-content data-bind=\"template: templateName\"></div><div class=ItemTile-selector><div class=ItemTile-frame data-bind=\"attr: { title: item().tooltipText }\"></div><ms-item-check class=ItemTile-rowCheck data-bind=\"automation: 'select-link', event: { click: onItemCheckClick }\"></ms-item-check></div></a></div>"}),define("odsp-next/controls/itemTile/ItemTileFolder.html",[],function(){return'<div class=ItemTile-image data-bind="component: { name: \'od-folder-cover-tile\', params: { item: item, imageRect: imageRect, pulseTarget: pulseTarget } }"></div><div class=ItemTile-dragDropIcon></div><div class=ItemTile-namePlate><div class=ItemTile-folderBeak></div><div class=ItemTile-folderBeakHighlight></div><!--ko if: !isSubTextVisible() && isShared()--><i class="ItemTile-sharingIcon ms-Icon ms-Icon--people"></i><!--/ko--><!--ko if: hasNewBadge()--><div class=ItemTile-newBadge><!--ko component: { name: newBadgeTagName, params: newBadgeParams }--><!--/ko--></div><!--/ko--><div class=ItemTile-name data-bind="visible: !item().faceGroup, text: item().name"></div><div class=ItemTile-childCount data-bind="text: childCount"></div><div class=ItemTile-subText data-bind="if: isSubTextVisible"><i class=ms-Icon data-bind="css: { \'ItemTile-sharingIcon ms-Icon--people\': isShared, \'ms-Icon--bundle\': item().isBundle }"></i> <span data-bind="text: subText"></span></div></div>'}),define("odsp-next/controls/itemTile/ItemTileFile.html",[],function(){return"<div class=ItemTile-fileContainer><div class=ItemTile-fileIconContainer><div class=ItemTile-fileIcon data-bind=\"css: { 'ItemTile-fileIcon--thumbnail': !!thumbnail(), 'ItemTile-fileIcon--noThumbnail': !thumbnail() }, component: { name: 'ms-file-type-icon', params: { iconName: item().iconName, iconSize: iconSize(), desiredSize: desiredSize() } }\"></div></div><!--ko component: {\n name: fileThumbnailTagName,\n params: {\n image: thumbnail,\n desiredSize: imageRect,\n alignment: ['fitWidth', 'top']\n }\n }--><!--/ko--><div class=ItemTile-namePlate><div class=ItemTile-name data-bind=\"text: item().displayName\"></div><div class=ItemTile-subText><img class=ItemTile-subTextImage data-bind=\"attr: { src: subTextIconUrl }, visible: subTextIconUrl\"> <i data-bind=\"css: subTextIconClass, visible: !subTextIconUrl()\"></i> <span data-bind=\"text: subText\"></span></div></div></div>"}),define("odsp-next/controls/itemTile/ItemTilePhoto.html",[],function(){return'<!--ko component: {\n name: photoThumbnailTagName,\n params: {\n image: thumbnail,\n desiredSize: imageRect,\n alignment: \'cover\'\n }\n}--><!--/ko--><div class=ItemTile-namePlate data-bind="visible: item().isViolation"><div class=ItemTile-name data-bind="text: item().displayName"></div><div class=ItemTile-subText><img class=ItemTile-subTextImage data-bind="attr: { src: subTextIconUrl }, visible: subTextIconUrl"> <i data-bind="css: subTextIconClass, visible: !subTextIconUrl()"></i></div></div>'}),define("odsp-next/controls/itemTile/ItemTileTag.html",[],function(){return'<div class=ItemTile-image data-bind="component: { name: \'od-folder-cover-tile\', params: { item: item, thumbnail: thumbnail, imageRect: imageRect, pulseTarget: pulseTarget } }, dragAndDrop: { mayReceiveDrop: onMayReceiveDrop, isDragging: isDroppingTarget, receiveDrop: onReceiveDrop }"></div><div class=ItemTile-nameCover><div class="ItemTile-tagText ms-fontWeight-regular"><div class=ItemTile-name data-bind="text: item().name"></div><!--ko if: showTagCount--><div class=ItemTile-tagCount data-bind="text: tagCount"></div><!--/ko--></div></div>'}),define("odsp-next/controls/itemTile/ItemTileVideo.html",[],function(){return'<!--ko component: {\n name: photoThumbnailTagName,\n params: {\n image: thumbnail,\n desiredSize: imageRect\n }\n}--><!--/ko--><span class=ItemTile-playButton><i data-bind="css: subTextIconClass"></i></span>'}),define("odsp-next/controls/itemTile/ItemTile.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ItemTile,.ItemTile-image{top:0;left:0;right:0}.ItemTile,.ItemTile-dragDropIcon,.ItemTile-image{position:absolute;bottom:0}.ItemTile-fileIcon,.ItemTile-tagText{text-align:center}.ItemTile{cursor:pointer;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;overflow:hidden;-webkit-transform:translateZ(0);transform:translateZ(0)}@media screen and (-ms-high-contrast:active){.ItemTile{border:1px solid #fff}}@media screen and (-ms-high-contrast:black-on-white){.ItemTile{border:1px solid #000}}.ItemTile:focus{outline:transparent solid 1px}.od--isNonMobile .ItemTile{transition:-webkit-transform .1s linear;transition:transform .1s linear;transition:transform .1s linear,-webkit-transform .1s linear}.od--isNonMobile .ItemTile:active{-webkit-transform:scale(.96);-ms-transform:scale(.96);transform:scale(.96)}.ItemTile-dragDropIcon{top:8px;right:2px;left:2px;background-color:#eaeaea;box-shadow:0 0 0 1px #c8c8c8;opacity:0;-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%)}.ItemTile-fileContainer,.ItemTile.is-file,.ItemTile.is-file .ThumbnailTile-thumbnail,.ItemTile.is-file .od-ImageStackTile,.ItemTile.is-folder .ThumbnailTile-thumbnail,.ItemTile.is-folder .od-ImageStackTile,.ItemTile.is-media,.ItemTile.is-media .ThumbnailTile-thumbnail,.ItemTile.is-media .od-ImageStackTile{background-color:#f4f4f4}.ItemTile-folderOverlay{position:absolute;display:inline-block;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);width:92px;height:92px}.ItemTile-fileContainer,.ItemTile-fileIconContainer,.ItemTile-photo{top:0;left:0;right:0;position:absolute}.ItemTile-photo{bottom:0}.ItemTile.is-file .ItemTile-fileContainer{border:1px solid #eaeaea}@media screen and (-ms-high-contrast:active){.ItemTile:focus{outline:0}.ItemTile.is-file .ItemTile-fileContainer{border:0}}.ItemTile.is-file .ThumbnailTile-thumbnail.ThumbnailTile-thumbnail--portrait{height:auto;bottom:50px;overflow:hidden}.ItemTile.is-file .ThumbnailTile-thumbnail img,.ItemTile.is-file .od-ImageStack-tile img{box-shadow:0 0 8px 0 rgba(0,0,0,.06)}.ItemTile.is-media .ThumbnailTile::after,.ItemTile.is-media .od-ImageFrame::after{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;box-shadow:inset 0 0 0 1px rgba(0,0,0,.06)}.ItemTile-fileContainer{bottom:0}.ItemTile-fileIconContainer{bottom:50px}.ItemTile.is-file.has-thumbnail .ItemTile-fileIcon{z-index:1;margin:0;top:auto;bottom:0;padding:4px}html[dir=rtl] .ItemTile.is-file.has-thumbnail .ItemTile-fileIcon{left:auto}html[dir=ltr] .ItemTile.is-file.has-thumbnail .ItemTile-fileIcon{right:auto;left:0}html[dir=ltr] .ItemTile-rowCheck,html[dir=rtl] .ItemTile.is-file.has-thumbnail .ItemTile-fileIcon{right:0}.ItemTile-fileIcon--thumbnail{position:absolute;top:50%;left:0;right:0;margin:-48px}html[dir=ltr] .ItemTile-subTextIcon,html[dir=ltr] .ItemTile-subTextImage,html[dir=ltr] .ItemTile-subTextImageShort{margin-right:4px}html[dir=rtl] .ItemTile-subTextIcon,html[dir=rtl] .ItemTile-subTextImage,html[dir=rtl] .ItemTile-subTextImageShort{margin-left:4px}.ItemTile-fileIcon--noThumbnail{position:relative;text-align:center;margin-top:14px}.ItemTile-rowCheck{display:none;position:absolute;top:0;width:100%;height:100%;opacity:0}html[dir=rtl] .ItemTile-rowCheck{left:0}.od-ItemTile--isInvokable .ItemTile-rowCheck{width:40px;height:40px}.is-checkVisible .ItemTile-rowCheck{opacity:1}.ItemTile.is-folder .ItemTile-rowCheck,.ItemTile.od-ItemTile--isAlbum .ItemTile-frame{top:6px}html[dir=ltr] .ItemTile.is-folder .ItemTile-rowCheck{right:-1px}html[dir=rtl] .ItemTile.is-folder .ItemTile-rowCheck{left:-1px}.ItemTile.is-folder.is-dropping .ItemTile-rowCheck,.ItemTile.is-folder.is-receivingDrop .ItemTile-rowCheck{opacity:0}.can-select .ItemTile-rowCheck{display:block}.ItemTile.is-selected .ItemTile-rowCheck,.ItemTile:hover,.ItemTile:hover .ItemTile-rowCheck{opacity:1}.od-ItemTile-selector{display:none}.od-ItemTile--isInteractable .od-ItemTile-selector{display:block}.ItemTile-frame{position:absolute;display:none;left:2px;top:2px;right:2px;bottom:2px;box-shadow:0 0 0 2px #c8c8c8;outline:transparent solid 1px}@media screen and (-ms-high-contrast:active){.ItemTile-frame{outline:#fff solid 2px}}@media screen and (-ms-high-contrast:black-on-white){.ItemTile-frame{outline:#000 solid 2px}}.ItemTile.is-folder .ItemTile-frame,.ItemTile.od-ItemTile--isAlbum .ITemTile-frame{top:8px}.ItemTile.is-folder.is-tag .ItemTile-frame{top:2px}.ItemTile.is-folder.is-dropping .ItemTile-frame,.ItemTile:hover .ItemTile-frame{display:block}.ItemTile.is-folder.is-dropping .ItemTile-frame{box-shadow:0 0 0 2px #094AB2}.od-focus--enabled .ItemTile.is-focused .ItemTile-frame{display:block;border:1px solid #fff;box-shadow:0 0 0 2px #767676}@media screen and (-ms-high-contrast:active){.ItemTile.is-folder .ItemTile-frame,.ItemTile.od-ItemTile--isAlbum .ITemTile-frame,.od-focus--enabled .ItemTile.is-focused .ItemTile-frame{top:2px}}.ItemTile.is-folder.is-dropping .ItemTile-dragDropIcon{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);-webkit-animation-name:fadeIn;animation-name:fadeIn;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:167ms;animation-duration:167ms}.ItemTile.is-folder.is-dropping .ItemTile-dragDropIcon:before{position:absolute;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Office365Icons;display:inline-block;content:'\\e27c';font-size:42px;color:#c8c8c8;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.ItemTile .ItemCheck{position:absolute;top:8px}html[dir=ltr] .ItemTile .ItemCheck{right:8px}html[dir=rtl] .ItemTile .ItemCheck{left:8px}.ItemTile-namePlate{position:absolute;bottom:0;left:0;right:0;min-height:20px;padding:4px 8px 8px;background-color:#fff;color:#333;white-space:nowrap;text-overflow:ellipsis}.ItemTile.is-file .ItemTile-namePlate{opacity:.9;border-top:1px solid #eaeaea;min-height:35px}.ItemTile.is-media .ItemTile-namePlate{opacity:.9;border-top:1px solid #eaeaea;min-height:17px}.ItemTile.is-folder .ItemTile-namePlate{background-color:#094AB2;color:#fff;border-top:1px solid #fff;transition:-webkit-transform 367ms cubic-bezier(.1,.9,.2,1);transition:transform 367ms cubic-bezier(.1,.9,.2,1);transition:transform 367ms cubic-bezier(.1,.9,.2,1),-webkit-transform 367ms cubic-bezier(.1,.9,.2,1)}.ItemTile.is-folder .ItemTile-namePlate::before{content:'';position:absolute;width:32%;height:16px;border-top:1px solid #fff;top:-16px;background:#094AB2;overflow:hidden}html[dir=ltr] .ItemTile.is-folder .ItemTile-namePlate::before{padding-left:1px;right:0}html[dir=rtl] .ItemTile.is-folder .ItemTile-namePlate::before{padding-right:1px;left:0}.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon:after,.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon:before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Office365Icons;display:inline-block;top:50%;left:50%;opacity:1;position:absolute}.ItemTile.is-folder.is-dropping .ItemTile-namePlate,.ItemTile.is-folder.is-receivingDrop .ItemTile-namePlate{-webkit-transform:translate3d(0,28px,0);transform:translate3d(0,28px,0)}.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);opacity:1;-webkit-animation-name:fadeOut;animation-name:fadeOut;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:.1s;animation-duration:.1s;-webkit-animation-delay:1.25s;animation-delay:1.25s}.ItemTile-iconFadeInOut,.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon:after,.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon:before{-webkit-animation-duration:.85s;-moz-animation-duration:.85s;-ms-animation-duration:.85s;-o-animation-duration:.85s}.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon:after{content:'\\e041';font-size:28px;color:#fff;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-animation-name:fadeAndScale;animation-name:fadeAndScale;-webkit-animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-timing-function:cubic-bezier(.1,.9,.2,1);-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-delay:.25s;animation-delay:.25s}.ItemTile.is-folder.is-receivingDrop .ItemTile-dragDropIcon:before{content:'\\e001';font-size:42px;color:#107c10;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-animation-name:fadeAndScale;animation-name:fadeAndScale;-webkit-animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-timing-function:cubic-bezier(.1,.9,.2,1);-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-delay:.25s;animation-delay:.25s}.ItemTile-nameCover{background-color:rgba(0,0,0,.25);position:absolute;font-family:\"Segoe UI Semibold\";text-shadow:0 0 8px #000;top:0;width:100%;height:100%}html[dir=ltr] .ItemTile-nameCover{left:0}html[dir=rtl] .ItemTile-nameCover{right:0}.ItemTile-tagText{position:relative;color:#fff;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);padding:0 8px}.ItemTile-folderBeak,.ItemTile-folderBeakHighlight{position:absolute;top:-16px;overflow:hidden}html[dir=ltr] .ItemTile-folderBeak,html[dir=ltr] .ItemTile-folderBeakHighlight{right:32%}html[dir=rtl] .ItemTile-folderBeak,html[dir=rtl] .ItemTile-folderBeakHighlight{left:32%}.ItemTile-folderBeak::before{content:'';position:absolute;top:1px;width:20px;height:30px;background-color:#094AB2;-webkit-transform-origin:top left;-ms-transform-origin:top left;transform-origin:top left;-webkit-transform:rotate(40deg);-ms-transform:rotate(40deg);transform:rotate(40deg)}html[dir=ltr] .ItemTile-folderBeak::before{right:-19px}html[dir=rtl] .ItemTile-folderBeak::before{left:-19px}.ItemTile-folderBeak{width:18px;height:18px}.ItemTile-folderBeakHighlight{width:16px;height:16px}.ItemTile-folderBeakHighlight::before{content:'';position:absolute;top:0;width:1px;height:30px;background-color:#fff;-webkit-transform-origin:top left;-ms-transform-origin:top left;transform-origin:top left;-webkit-transform:rotate(40deg);-ms-transform:rotate(40deg);transform:rotate(40deg)}html[dir=ltr] .ItemTile-folderBeakHighlight::before{right:0}html[dir=rtl] .ItemTile-folderBeakHighlight::before{left:0}html[dir=rtl] .ItemTile-folderBeak::before,html[dir=rtl] .ItemTile-folderBeakHighlight::before{-webkit-transform-origin:top right;-ms-transform-origin:top right;transform-origin:top right;-webkit-transform:rotate(-40deg);-ms-transform:rotate(-40deg);transform:rotate(-40deg)}.ItemTile-childCount,.ItemTile-name,.ItemTile-subText{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.ItemTile-name{font-size:15px;line-height:20px}.ItemTile.is-tag .ItemTile-name{max-height:4.1em;font:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:17px;white-space:normal;text-overflow:normal;word-wrap:break-word;line-height:23px;padding-bottom:4px}.ItemTile-tagCount{font:'Segoe UI Semibold WestEuropean','Segoe UI Semibold','Segoe WP Semibold','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;line-height:10px;opacity:.85}.ItemTile-sharingIcon{font-size:11px}.ItemTile.is-folder .ItemTile-sharingIcon{line-height:20px}html[dir=ltr] .ItemTile.is-folder .ItemTile-sharingIcon{float:right}html[dir=rtl] .ItemTile.is-folder .ItemTile-sharingIcon{float:left}.ItemTile.is-folder .ItemTile-subText .ItemTile-sharingIcon{float:inherit!important;line-height:1}.ItemTile-childCount{position:absolute;top:-14px;padding:0 3px;font-size:11px}html[dir=ltr] .ItemTile-childCount{left:68%}html[dir=rtl] .ItemTile-childCount{right:68%}.ItemTile-subText{font-size:11px;opacity:.7}.ItemTile-subTextImage{width:14px;height:14px}.ItemTile-subTextImageShort{width:12px;height:12px}.ItemTile-subTextIcon{font-size:14px}.ItemTile-blockIcon{color:#a80000}.ItemTile.od-ItemTile--isAlbum .ItemTile-folderBeak,.ItemTile.od-ItemTile--isAlbum .ItemTile-folderBeakHighlight{display:none}.ItemTile.od-ItemTile--isAlbum .ItemTile-name{font-size:12px;position:absolute;bottom:24px}.ItemTile.od-ItemTile--isAlbum .ItemTile-namePlate{height:80px;background:linear-gradient(0deg,rgba(0,0,0,.58),rgba(0,0,0,0));color:#fff;left:2px;right:2px}html[dir=ltr] .ItemTile.od-ItemTile--isAlbum .ItemTile-childCount,html[dir=rtl] .ItemTile.od-ItemTile--isAlbum .ItemTile-namePlate>.ItemTile-sharingIcon,html[dir=rtl] .ItemTile.od-ItemTile--isAlbum .ItemTile-subText{left:10px}html[dir=ltr] .ItemTile.od-ItemTile--isAlbum .ItemTile-namePlate>.ItemTile-sharingIcon,html[dir=ltr] .ItemTile.od-ItemTile--isAlbum .ItemTile-subText,html[dir=rtl] .ItemTile.od-ItemTile--isAlbum .ItemTile-childCount{right:10px}.ItemTile.od-ItemTile--isAlbum .ItemTile-childCount{top:auto;bottom:10px;padding:0;font-size:10px;color:rgba(255,255,255,.8)}.ItemTile.od-ItemTile--isAlbum .ItemTile-name{left:10px;right:10px}.ItemTile.od-ItemTile--isAlbum .ItemTile-frame{top:8px}.ItemTile.od-ItemTile--isAlbum .ItemTile-rowCheck{top:6px}.ItemTile.od-ItemTile--isAlbum .ItemTile-namePlate>.ItemTile-sharingIcon,.ItemTile.od-ItemTile--isAlbum .ItemTile-subText{position:absolute;bottom:10px}@-webkit-keyframes fadeAndScale{0%{-webkit-transform:translate(-50%,-50%) scale(.85,.85);transform:translate(-50%,-50%) scale(.85,.85);opacity:0;-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}25%{-webkit-transform:translate(-50%,-50%) scale(1,1);transform:translate(-50%,-50%) scale(1,1);opacity:1}75%{-webkit-transform:translate(-50%,-50%) scale(1,1);transform:translate(-50%,-50%) scale(1,1);opacity:1;-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}100%{-webkit-transform:translate(-50%,-50%) scale(.85,.85);transform:translate(-50%,-50%) scale(.85,.85);opacity:0}}@keyframes fadeAndScale{0%{-webkit-transform:translate(-50%,-50%) scale(.85,.85);transform:translate(-50%,-50%) scale(.85,.85);opacity:0;-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out}25%{-webkit-transform:translate(-50%,-50%) scale(1,1);transform:translate(-50%,-50%) scale(1,1);opacity:1}75%{-webkit-transform:translate(-50%,-50%) scale(1,1);transform:translate(-50%,-50%) scale(1,1);opacity:1;-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in}100%{-webkit-transform:translate(-50%,-50%) scale(.85,.85);transform:translate(-50%,-50%) scale(.85,.85);opacity:0}}.ItemTile-iconFadeInOut{-webkit-animation-name:fadeAndScale;animation-name:fadeAndScale;-webkit-animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-timing-function:cubic-bezier(.1,.9,.2,1);-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-delay:.25s;animation-delay:.25s}.ItemTile-newBadge{position:absolute;top:35px}html[dir=ltr] .ItemTile-newBadge{left:1px}html[dir=rtl] .ItemTile-newBadge{right:1px}")
});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/folderCoverTile/FolderCoverTileViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../resources/DataSourceResourceKeys","../../resources/UtilityResourceKeys"],function(e,t,i,o,n,r){var s,a=5,l=function(t){function o(e){t.call(this),s||(s=this.resources.consume(r.platformDetection).isRetinaSupported?"64_2x":"64"),this._mediaBaseUrl=this.resources.consume(n.settings).mediaBaseUrl,this.imageRect=e.imageRect,this._item=e.item,this._lastThumbnails=-1,this._thumbnailIndex=-1,this._isPulsingEnabled=!0,this.pulseRecords=i.observableArray(),this.createComputed(this._computeRecords),e.pulseTarget&&e.pulseTarget(this)}return __extends(o,t),o.prototype.canPulse=function(){var e=this._item();return!!(e&&e.thumbnails&&e.thumbnails.length>1)},o.prototype.enablePulsing=function(e){this._isPulsingEnabled=e},o.prototype.pulse=function(){this.canPulse()&&this._isPulsingEnabled&&(this._pushNextRecord(),this.pulseRecords.shift(),this._updatePulseClasses())},o.prototype._computeRecords=function(){var e=this._item();if(e){var t=e.key?e.key:"",i=e.thumbnails?e.thumbnails.length:-1;if(t!==this._lastKey||i!==this._lastThumbnails){this._lastKey=t,this._lastThumbnails=i,this.pulseRecords.removeAll(),this._thumbnailIndex=-1;var o=e&&e.folder?e.folder.totalCount:null;0===o?this._pushFolderRecord(!0):this._initializeRecord(),this._updatePulseClasses()}}},o.prototype._pushFolderRecord=function(e){this.pulseRecords.push({className:i.observable("od-FolderCoverTile-empty"),isThumbnailVisible:i.observable(!1),isWatermarkVisible:i.observable(!1),watermarkUrl:i.observable(""),isEmpty:e,thumbnail:i.observable(null)})},o.prototype._initializeRecord=function(){var e;for(e=0;a-2>e;e++)this._pushFolderRecord(!1);for(e=0;2>e;e++)this._pushNextRecord()},o.prototype._pushNextRecord=function(){var e=this._getNextThumbnail();this.pulseRecords.push({className:i.observable(),thumbnail:i.observable(e),isThumbnailVisible:i.observable(!1),isWatermarkVisible:i.observable(!1),watermarkUrl:i.observable("")})},o.prototype._updatePulseClasses=function(){for(var e=this.pulseRecords(),t=0;t<e.length;t++){var o=e[t],n=e.length-t-1;o.isEmpty||o.className("od-FolderCoverTile-item"+n),o.isThumbnailVisible(!(!o.thumbnail()||!(o.isThumbnailVisible()||2>n)));var r=i.utils.unwrapObservable(this._item),s=!r.tagInfo&&!o.isThumbnailVisible()&&(1===n||r.isAlbum);o.isWatermarkVisible(s),o.watermarkUrl(s?this._getFolderWatermarkUrl():null)}},o.prototype._getFolderWatermarkUrl=function(){var t=this._item(),i="genericfolder";switch(t.isAlbum&&(i="photofolder"),t.isSpecialFolder&&t.specialFolderCanonicalName){case"Music":i="musicfolder";break;case"Documents":i="documentfolder";break;case"Photos":i="photofolder"}return e.toUrl(this._mediaBaseUrl+"/images/watermarks/"+s+"/"+i+".png")},o.prototype._getNextThumbnail=function(){var e=null,t=this._item();return t&&t.thumbnails&&t.thumbnails.length?(this._thumbnailIndex=(this._thumbnailIndex+1)%t.thumbnails.length,e=t.thumbnails[this._thumbnailIndex],{url:e.url,width:e.width,height:e.height,rotation:t.rotation}):null},o}(o);return l}),define("odsp-next/controls/folderCoverTile/FolderCoverTile.html",[],function(){return'<div class=od-FolderCoverTile data-bind="foreach: pulseRecords"><div data-bind="attr: { \'class\': className }"><!--ko if: isThumbnailVisible--><ms-thumbnail-tile class=od-FolderCoverTile-image params="image: thumbnail, desiredSize: $parent.imageRect"></ms-thumbnail-tile><!--/ko--><!--ko if: isWatermarkVisible--><img class=od-FolderCoverTile-watermark data-bind="attr: { src: watermarkUrl }"><!--/ko--></div></div>'}),define("odsp-next/controls/folderCoverTile/FolderCoverTile.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-FolderCoverTile,.od-FolderCoverTile-image,.od-FolderCoverTile>div{position:absolute;bottom:0}.od-FolderCoverTile{left:0;right:0;top:0;overflow:hidden}.od-FolderCoverTile-image{left:0;right:0;top:0;opacity:0;transition:opacity .6s linear .6s;background-color:#eaeaea}.od-FolderCoverTile-watermark{position:absolute;left:50%;top:38%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);max-width:64px;max-height:64px}.od-FolderCoverTile-item0 .od-FolderCoverTile-image,.od-FolderCoverTile-item1 .od-FolderCoverTile-image{opacity:1}.od-FolderCoverTile-empty{left:2px;right:2px;top:8px;box-shadow:0 0 0 1px #eaeaea;background-color:#fff}.od-FolderCoverTile-item0,.od-FolderCoverTile-item1{left:2px;right:2px;top:8px;background-color:#eaeaea;box-shadow:0 0 0 1px #c8c8c8}.od-FolderCoverTile-item0{-webkit-transform:translateY(100%);-ms-transform:translateY(100%);transform:translateY(100%)}.od-FolderCoverTile-item1{transition:-webkit-transform .6s cubic-bezier(.1,.9,.2,1);transition:transform .6s cubic-bezier(.1,.9,.2,1);transition:transform .6s cubic-bezier(.1,.9,.2,1),-webkit-transform .6s cubic-bezier(.1,.9,.2,1)}.is-tag .od-FolderCoverTile-item2,.od-FolderCoverTile-item2,.od-FolderCoverTile-item3{transition:left .6s cubic-bezier(.1,.9,.2,1),right .6s cubic-bezier(.1,.9,.2,1),top .6s cubic-bezier(.1,.9,.2,1)}.od-FolderCoverTile-item2{left:5px;right:5px;top:5px;background-color:#fff;box-shadow:0 0 0 1px #eaeaea}.od-FolderCoverTile-item3,.od-FolderCoverTile-item4{left:8px;right:8px;top:2px;background-color:#fff;box-shadow:0 0 0 1px #eaeaea}.od-FolderCoverTile-item4{opacity:0}.is-tag .od-FolderCoverTile-item1,.is-tag .od-FolderCoverTile-item2,.is-tag .od-FolderCoverTile-item3{box-shadow:none}.is-tag .od-FolderCoverTile-item1{left:0;right:0;top:0}.is-tag .od-FolderCoverTile-item2{left:2px;right:2px;top:8px;background-color:#eaeaea}")}),define("odsp-next/controls/folderCoverTile/FolderCoverTile",["require","exports","./FolderCoverTileViewModel","odsp-shared/utilities/knockout/ComponentFactory","./FolderCoverTile.html","./FolderCoverTile.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-folder-cover-tile",template:e("./FolderCoverTile.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/controls/itemTile/ItemTile",["require","exports","./ItemTileViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ItemTile.html","./ItemTileFolder.html","./ItemTileFile.html","./ItemTilePhoto.html","./ItemTileTag.html","./ItemTileVideo.html","./ItemTile.css","../thumbnailTile/ThumbnailTile","../folderCoverTile/FolderCoverTile","../fileTypeIcon/FileTypeIcon","../image/frame/ImageFrame"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-item-tile",template:e("./ItemTile.html"),viewModel:i.default,synchronous:!0});return o.registerTemplate(i.TEMPLATE_TAGS.folder,e("./ItemTileFolder.html")),o.registerTemplate(i.TEMPLATE_TAGS.file,e("./ItemTileFile.html")),o.registerTemplate(i.TEMPLATE_TAGS.photo,e("./ItemTilePhoto.html")),o.registerTemplate(i.TEMPLATE_TAGS.tag,e("./ItemTileTag.html")),o.registerTemplate(i.TEMPLATE_TAGS.video,e("./ItemTileVideo.html")),n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/itemUrl/ItemUrlViewModel",["require","exports","../../resources/DataSourceResourceKeys","odsp-utilities/logging/events/Engagement.event","./ItemUrl.resx","../../dataSources/url/QueryType","../../bindings/focus/SelectOnFocusBinding","odsp-shared/base/ViewModel"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){e.call(this,t),this._item=t.item,this.itemUrl=this.createPureComputed(this._getItemUrl),this.itemUrlLabel=n.strings.itemUrlLabel,this.addBindingHandlers({selectOnFocus:s.default})}return __extends(t,e),t.prototype.onLinkCopied=function(){o.Engagement.logData({name:"InfoPane.Link.Copy"})},t.prototype._getItemUrl=function(){var e="",t=this._item();if(t&&!t.isPlaceholder){var o=this.resources.consume(i.url);t.isRootFolder&&o.getQueryType()!==r.Files||(e=t.openUrl,e&&0!==e.indexOf("/")||(e=o.getItemUrl(this._item().key)))}return e},t}(a);Object.defineProperty(t,"__esModule",{value:!0}),t.default=l}),define("odsp-next/controls/itemUrl/ItemUrl.html",[],function(){return'<div class="ms-TextField InfoPane-itemLink"><label class=ms-Label data-bind="text: itemUrlLabel"></label> <input class=ms-TextField-field role=presentation readonly data-bind="value: itemUrl, attr: {title: itemUrl}, copy: onLinkCopied, selectOnFocus: { isPermanent: true }"></div>'}),define("odsp-next/controls/itemUrl/ItemUrl.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".InfoPane-itemLink{position:relative;margin:8px}")}),define("odsp-next/controls/itemUrl/ItemUrl",["require","exports","./ItemUrlViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ItemUrl.html","./ItemUrl.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-item-url",template:e("./ItemUrl.html"),viewModel:i.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/infoPane/InfoPane",["require","exports","./InfoPaneViewModel","odsp-shared/utilities/knockout/ComponentFactory","./InfoPane.html","./InfoPane.css","../iFrameCtrl/IFrameCtrl","../itemTile/ItemTile","../itemUrl/ItemUrl"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-info-pane",template:e("./InfoPane.html"),viewModel:i.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/personaCard/PersonaCardViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","../progressSpinnerFlat/ProgressSpinnerFlat","../../resources/ProviderResourceKeys","./PersonaCard.resx","odsp-utilities/encoding/HtmlEncoding","odsp-utilities/logging/events/Engagement.event"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){var i=this;e.call(this),this.progressSpinnerFlatTagName=n.tagName,this.strings=s.strings;var r=t.payloadParams;this._calloutHeight=t.calloutHeight,this.isDataReady=o.observable(!1),this.getPersonaCardData(r),this.userID=o.observable(r.sip),this.name=o.observable(r.name),this.email=o.observable(r.email),this.phone=o.observable(""),this.office=o.observable(""),this.job=o.observable(""),this.department=o.observable(""),this.image=o.observable(""),this.sip=o.observable(r.sip),this.profilePage=o.observable(""),this.showOrg=o.observable(!1),this.showPhone=o.observable(!0),this.showChat=o.observable(!1),this.showMail=o.observable(!1),this.managerChain=o.observableArray([]),this.directReports=o.observableArray([]),this.async.setTimeout(function(){i._calloutHeight&&i._calloutHeight(i._calloutHeight.peek()+1)},13)}return __extends(t,e),t.prototype.encodeString=function(e){return a.encodeText(e)},t.prototype.resetCard=function(e){this.isDataReady(!1),this.getPersonaCardData(e),this._setPersonData(e),this.managerChain([]),this.directReports([]),this.showOnlyPhone()},t.prototype.showOnlyPhone=function(){this.showOrg(!1),this.showPhone(!0),this.showChat(!1),this.showMail(!1)},t.prototype.showOnlyMail=function(){this.showOrg(!1),this.showPhone(!1),this.showChat(!1),this.showMail(!0)},t.prototype.showOnlyChat=function(){this.showOrg(!1),this.showPhone(!1),this.showChat(!0),this.showMail(!1)},t.prototype.showOnlyOrg=function(){this.showOrg(!0),this.showPhone(!1),this.showChat(!1),this.showMail(!1),this._calloutHeight(350)},t.prototype.getPersonaCardData=function(e){var t=this;if(l.Engagement.logData({name:"PersonaCard.Launched"}),Boolean(e.sip)){var i=this.resources.consume(r.people),o=i.getPersonaDetails(e.sip);o.done(function(e){var i=e.personDetails;t._setPersonData(i),t.managerChain(e.managerChain),t.directReports(e.directReports),t.isDataReady(!0)})}},t.prototype._setPersonData=function(e){this.sip(e.sip||""),this.userID(e.userId||""),this.name(e.name||""),this.email(e.email||""),this.phone(e.phone||""),this.office(e.office||""),this.job(e.job||""),this.department(e.department||""),this.image(e.image||""),this.profilePage(e.profilePage||"")},t}(i);return d}),define("odsp-next/controls/personaCard/PersonaCard.html",[],function(){return'<div class=ms-PersonaCard data-bind="css : {\'ms-PersonaCard-isOrgActive\': showOrg()}"><div class=PersonaCard-progressBox data-bind="component: {name: progressSpinnerFlatTagName}, visible: (isDataReady() === false)"></div><ms-persona params="person:$data, personaSize: 5, profileLinkOn: true, showPresence: true" class=PersonaCard-personaContainer></ms-persona><div class=ms-PersonaCard-actions><div class=ms-PersonaCard-mainActions role=tablist><a class=ms-PersonaCard-action id=ms-PersonaCard-chatAction href=javascript:void(0) data-bind="css : {\'ms-PersonaCard-action--isActive\': showChat()}, click: showOnlyChat, attr: {\'aria-selected\': showChat(), \'aria-label\': strings.sendIM, \'title\': strings.sendIM}" role=tab><i class="ms-Icon ms-Icon--chat"></i></a> <a class=ms-PersonaCard-action id=ms-PersonaCard-phoneAction href=javascript:void(0) data-bind="css : {\'ms-PersonaCard-action--isActive\': showPhone()}, click: showOnlyPhone, attr: {\'aria-selected\': showPhone(), \'aria-label\': strings.contact, \'title\': strings.contact}" role=tab><i class="ms-Icon ms-Icon--phone"></i></a> <a class=ms-PersonaCard-action id=ms-PersonaCard-mailAction href=javascript:void(0) data-bind="css: {\'ms-PersonaCard-action--isActive\': showMail()}, click: showOnlyMail, attr: {\'aria-selected\': showMail(), \'aria-label\': strings.sendEmail, \'title\': strings.sendEmail }" role=tab><i class="ms-Icon ms-Icon--mail"></i></a> <a class="ms-PersonaCard-action ms-PersonaCard-orgChart" id=ms-PersonaCard-orgAction href=javascript:void(0) role=tab aria-controls=PersonaCard-orgChart data-bind="css : { \'ms-PersonaCard-action--isActive\': showOrg() }, click: showOnlyOrg, attr: {\'aria-selected\': showOrg(), \'aria-label\': strings.organization, \'title\': strings.organization}"><i class="ms-Icon ms-Icon--org" id=PersonaCard-orgChartTab></i></a></div><div class=ms-PersonaCard-overflow><a class="PersonCard-persona-secondaryText PersonCard-profileLink" target=_blank data-bind="text: strings.viewProfile, attr: {\'href\': profilePage}"></a></div></div><div class=ms-PersonaCard-actionDetailBox aria-live=polite><div class=ms-PersonaCard-detailChat><div class=ms-PersonaCard-actionDetails data-bind="css : {\'ms-PersonaCard-action--isActive\': showChat()}"><div class=ms-PersonaCard-detailLine><span class=ms-PersonaCard-detailLabel data-bind=text:strings.sendIM></span> <a class=ms-Link data-bind="text: sip, attr: {href: \'sip:\'+ sip(), title: strings.sendIM}"></a></div></div><div class=ms-PersonaCard-actionDetails data-bind="css: {\'ms-PersonaCard-action--isActive\': showPhone()}"><div class=ms-PersonaCard-detailLine><span class=ms-PersonaCard-detailLabel data-bind=text:strings.business></span> <span class=ms-Link data-bind="text: phone, attr: {title: strings.contact}"></span></div></div><div class=ms-PersonaCard-actionDetails data-bind="css : {\'ms-PersonaCard-action--isActive\': showMail()}"><div class=ms-PersonaCard-detailLine><span class=ms-PersonaCard-detailLabel data-bind=text:strings.sendEmail></span> <a class=ms-Link data-bind="text: email, attr: {href: \'mailto:\'+ email(), title: strings.sendEmail}"></a></div></div><div class="ms-PersonaCard-actionDetails ms-PersonaCard-detailOrg" data-bind="css : {\'ms-PersonaCard-action--isActive\': showOrg()}"><div class=ms-OrgChart><div class=ms-OrgChart-group><div class=ms-OrgChart-list data-bind=foreach:managerChain><a class=ms-OrgChart-listItem data-bind="click: $parent.resetCard.bind($parent)" href=javascript:void(0)><ms-persona params="person: $data, showPresence: true"></ms-persona></a></div></div><div class=ms-OrgChart-group><div class=ms-OrgChart-list><a class=ms-OrgChart-listItem href=javascript:void(0)><ms-persona params="person:$data, showPresence: true"></ms-persona></a></div></div><div class=ms-OrgChart-group><div data-bind="text: strings.directReports" class="ms-OrgChart-groupTitle PersonCard-persona-primaryText PersonCard-spacer"></div><div class=ms-OrgChart-list data-bind=foreach:directReports><a class=ms-OrgChart-listItem data-bind="click: $parent.resetCard.bind($parent)" href=javascript:void(0)><ms-persona params="person: $data, showPresence: true"></ms-persona></a></div></div></div></div></div></div></div>'}),define("odsp-next/controls/personaCard/PersonaCard.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-PersonaCard,.ms-PersonaCard-actionDetails{-webkit-animation-timing-function:cubic-bezier(.1,.9,.2,1)}html[dir=ltr] .ms-PersonaCard,html[dir=rtl] .ms-PersonaCard{left:0}.ms-PersonaCard-action,.ms-PersonaCard-overflow{display:inline-block;line-height:48px;cursor:pointer}.PersonaCard-progressBox{position:absolute;width:100%;left:0;top:2px;height:4px;z-index:1}.ms-PersonaCard{color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:14px;font-weight:400;-webkit-animation-name:fadeIn,slideUp20;animation-name:fadeIn,slideUp20;-webkit-animation-duration:367ms;-moz-animation-duration:367ms;-ms-animation-duration:367ms;-o-animation-duration:367ms;animation-timing-function:cubic-bezier(.1,.9,.2,1);-webkit-animation-fill-mode:both;animation-fill-mode:both;bottom:0;position:relative;height:200px}.ms-PersonaCard-action.ms-PersonaCard-orgChart,.ms-PersonaCard-actionDetails{-webkit-animation-duration:367ms;-moz-animation-duration:367ms;-ms-animation-duration:367ms;-o-animation-duration:367ms;-webkit-animation-fill-mode:both}html[dir=ltr] .ms-PersonaCard,html[dir=rtl] .ms-PersonaCard{right:0}html[dir=rtl] .ms-PersonaCard-action.ms-PersonaCard-action--isActive:after,html[dir=rtl] .ms-PersonaCard-overflow.ms-PersonaCard-action--isActive:after{right:15px}html[dir=ltr] .ms-PersonaCard-action.ms-PersonaCard-action--isActive:after,html[dir=ltr] .ms-PersonaCard-overflow.ms-PersonaCard-action--isActive:after{left:15px}.ms-PersonaCard.ms-PersonaCard-isOrgActive{height:344px}.PersonaCard-personaContainer>.ms-Persona{background-color:#f4f4f4;padding:12px}.ms-PersonaCard-action,.ms-PersonaCard-actions,.ms-PersonaCard-overflow{padding:0 10px;box-sizing:border-box}.ms-PersonaCard-actions{list-style:none;margin:0;border-bottom:1px solid #c8c8c8;background-color:#fff;height:48px}.ms-PersonaCard-mainActions{width:auto;height:auto;max-width:194px}html[dir=ltr] .ms-PersonaCard-mainActions{float:left}html[dir=ltr] .ms-PersonaCard-overflow,html[dir=rtl] .ms-PersonaCard-mainActions{float:right}.ms-PersonaCard-action{font-size:17px;height:48px;color:#666;position:relative}.ms-PersonaCard-action:hover{color:#212121}.ms-PersonaCard-action.ms-PersonaCard-action--isActive,.ms-PersonaCard-action:active{color:#094AB2}.ms-PersonaCard-action.ms-PersonaCard-action--isActive:after{box-sizing:border-box;-webkit-transform:rotate(45deg);transform:rotate(45deg);-ms-transform:rotate(45deg);content:\"\";width:10px;height:10px;border:1px solid #c8c8c8;background-color:#fff;position:absolute;border-right:none;border-bottom:none;bottom:-4px}.ms-PersonaCard-overflow{height:48px;position:relative;font-size:14px;color:#333;margin-top:-1px}.ms-PersonaCard-overflow.ms-PersonaCard-action--isActive,.ms-PersonaCard-overflow:active,.ms-PersonaCard-overflow:hover{color:#094AB2}.ms-PersonaCard-overflow.ms-PersonaCard-action--isActive:after{box-sizing:border-box;-webkit-transform:rotate(45deg);transform:rotate(45deg);-ms-transform:rotate(45deg);content:\"\";width:10px;height:10px;border:1px solid #c8c8c8;background-color:#fff;position:absolute;border-right:none;border-bottom:none;bottom:-4px}html[dir=ltr] .ms-PersonaCard-actionDetails,html[dir=rtl] .ms-PersonaCard-overflow{float:left}.ms-PersonaCard-orgChart{position:absolute;top:48px}html[dir=ltr] .ms-PersonaCard-orgChart{right:4px}html[dir=rtl] .ms-PersonaCard-orgChart{left:4px}.ms-PersonaCard-actionDetailBox{min-height:48px;overflow-y:auto;overflow-x:hidden;background-color:#fff}.ms-PersonaCard-actionDetails{list-style:none;width:100%;min-height:48px;color:#666;padding:9px 20px;-webkit-animation-name:fadeIn,slideDown20;animation-name:fadeIn,slideDown20;animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-fill-mode:both;box-sizing:border-box;display:none;transition:max-height .25s ease}html[dir=rtl] .ms-PersonaCard-actionDetails{float:right}.ms-PersonaCard-actionDetails.ms-PersonaCard-action--isActive{display:block}.ms-PersonaCard-detailChat,.ms-PersonaCard-detailMail,.ms-PersonaCard-detailOrg,.ms-PersonaCard-detailPhone,.ms-PersonaCard-detailVideo{overflow:hidden;width:100%;padding:0;margin:0}.ms-OrgChart,.ms-PersonaCard-detailOrg{overflow-y:auto}.ms-PersonaCard-detailExpander{color:#333;cursor:pointer;font-size:15px;height:30px;line-height:30px;margin-top:1px;position:absolute;text-align:center;width:30px}html[dir=ltr] .ms-PersonaCard-detailExpander{right:10px}html[dir=rtl] .ms-PersonaCard-detailExpander{left:10px}.ms-PersonaCard-detailExpander:after{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-family:Office365Icons;font-style:normal;font-weight:400;line-height:1;speak:none;content:'\\e087'}.ms-PersonaCard-detailLine{color:#333;line-height:30px}.ms-PersonaCard-detailLabel{color:#666}.ms-PersonaCard-action.ms-PersonaCard-orgChart{max-height:300px;-webkit-animation-name:fadeIn,slideDown20;animation-name:fadeIn,slideDown20;-webkit-animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-fill-mode:both}.ms-PersonaCard-action.ms-PersonaCard-orgChart:after{display:none}.ms-OrgChart{color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:14px;font-weight:400;box-sizing:border-box;margin:0;padding:0;box-shadow:none;-webkit-animation-name:fadeIn,slideDown10;animation-name:fadeIn,slideDown10;-webkit-animation-duration:167ms;-moz-animation-duration:167ms;-ms-animation-duration:167ms;-o-animation-duration:167ms;-webkit-animation-timing-function:cubic-bezier(.1,.25,.75,.9);animation-timing-function:cubic-bezier(.1,.25,.75,.9);-webkit-animation-fill-mode:both;animation-fill-mode:both;height:200px;width:100%}.ms-OrgChart .ms-Persona .ms-Persona-image,.ms-OrgChart .ms-Persona .ms-Persona-imageArea,.ms-OrgChart .ms-Persona .ms-Persona-imageCircle{width:50px;height:50px}.ms-OrgChart-group,.ms-OrgChart-listItem{height:auto;width:100%}.ms-OrgChart .ms-Persona-details{margin-top:5px}.ms-OrgChart-groupTitle{color:#666;line-height:1;padding:4px}.ms-OrgChart-list{padding:4px;margin:12px 0 16px}.ms-OrgChart-listItem{position:relative;list-style:none;margin-bottom:8px;display:block;padding:2px}.ms-OrgChart-listItem:hover{cursor:pointer}.od-focus--enabled .ms-OrgChart-listItem:focus:before{position:absolute;top:0;left:0;right:0;bottom:0;border:1px solid #666;content:''}.ms-OrgChart-listItemBtn{cursor:pointer;position:relative;height:50px;width:100%;background:0 0;border:0;margin:0;padding:0;outline:transparent}html[dir=ltr] .ms-OrgChart-listItemBtn{text-align:left}html[dir=rtl] .ms-OrgChart-listItemBtn{text-align:right}")}),define("odsp-next/controls/personaCard/PersonaCard",["require","exports","./PersonaCardViewModel","odsp-shared/utilities/knockout/ComponentFactory","./PersonaCard.html","./PersonaCard.css","../persona/Persona"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-personaCard",template:e("./PersonaCard.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/personaCard/PersonaCardLauncher",["require","exports","../../resources/ProviderResourceKeys","odsp-shared/base/BaseModel","./PersonaCard","../../utilities/browser/WindowSize","knockout"],function(e,t,i,o,n,r,s){var a=function(e){function t(t){e.call(this,t),this._person=t}return __extends(t,e),t.prototype.show=function(e){var t=this.resources.consume(i.dialog),o=s.observable(0),a=t.requestDialog({title:null,size:r.Small,isCallout:!0,invokerEvent:e,calloutHeight:o,component:{name:n.tagName,params:{payloadParams:this._person,calloutHeight:o,resources:this.resources}},actions:[]});a.wait().then(function(){})},t}(o);return a}),define("odsp-shared/base/KeyCodes",["require","exports"],function(){var e={enter:13,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,a:65};return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/selection/MultiSelectBinding",["require","exports","knockout","../BaseBinding","odsp-shared/base/KeyCodes","../../utilities/events/EventTargetFilters"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t);var o=t.valueAccessor(),n=o.isDefaultSelection;this._isSelectionOnKeyInputEnabled=void 0===o.isSelectionOnKeyInputEnabled?!0:o.isSelectionOnKeyInputEnabled,this._isActive=o.isActive||i.observable(!0),this._layout=o.layout,this._selectionModel=o.selectionModel,this.events.on(this.element,"click",this._onClick),this.events.on(n?document:this.element,"keydown",this._onKeyDown)}return __extends(t,e),t.prototype._onKeyDown=function(e){var t=e.target,i=r.isInputElement(t);if(i||!this._isActive())return!0;var o=this._selectionModel,s=this._layout(),a=o.getFocusIndex(),l=-1,d=!!e.shiftKey,c=!!e.metaKey,p=!!e.ctrlKey,u=!0;switch(e.which){case n.up:l=s.getItemIndexAbove(a),u=l!==a;break;case n.down:l=s.getItemIndexBelow(a),u=l!==a;break;case n.left:l=s.getItemIndexLeft(a),u=l!==a;break;case n.right:l=s.getItemIndexRight(a),u=l!==a;break;case n.home:l=0;break;case n.end:l=o.getItems().length-1;break;case n.space:if(r.isButtonElement(t))return!0;o.toggleIndexSelected(a);break;case n.enter:return r.isButtonElement(t)||!this.element.contains(t)?!0:o.invokeFocusedItem(e);default:return}return l>=0&&(d?(p||c||o.clear(),o.selectToIndex(l),o.setIndexFocus(l,!0)):p||c?o.setIndexFocus(l):(o.clear(),this._isSelectionOnKeyInputEnabled&&o.setIndexSelected(l,!0),o.setIndexFocus(l))),!u},t.prototype._onClick=function(e){var t=this._getItemFromElement(e.target);if(t){var i=this._selectionModel,o=!!e.shiftKey,n=!!e.metaKey,r=!!e.ctrlKey;o?(r||i.clear(),i.selectToItem(t),i.setItemFocus(t,!0)):r||n?(i.setItemSelected(t,!0),i.setItemFocus(t)):((!i.isItemSelected(t)||i.selection().length>1)&&(i.clear(),i.setItemSelected(t,!0)),i.setItemFocus(t)),e.stopPropagation(),e.preventDefault()}},t.prototype._getItemFromElement=function(e){for(var t,o=i.contextFor(e);o&&!t;)t=o&&o.$data&&"function"==typeof o.$data.getItem?o.$data.getItem():null,o=o.$parentContext;return t},t}(o);return s}),define("odsp-next/bindings/viewport/ViewportBinding",["require","exports","knockout","odsp-utilities/async/Async","odsp-utilities/events/EventGroup"],function(e,t,i,o,n){var r=function(){function e(){}return e.init=function(t,r){function s(){a.setTimeout(function(){var i=e.getViewport(t);p(i)},0)}var a=new o(this),l=new n(null),d=r(),c=d.scrollElement||document.body,p=d.viewport||d;s(),l.on(c,"scroll",s),l.on(window,"resize",s),i.utils.domNodeDisposal.addDisposeCallback(t,function(){l.dispose()})},e.getViewport=function(e){var t=e.getBoundingClientRect(),i=window.innerHeight,o={width:t.width,height:i,visibleTop:-t.top,visibleBottom:i-t.top};return o},e}();return r}),define("odsp-next/bindings/customRender/CustomRenderBinding",["require","exports"],function(){var e=function(){function e(){}return e.init=function(){return{controlsDescendantBindings:!0}},e}();return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/pulse/PulseBinding",["require","exports","../BaseBinding"],function(e,t,i){var o=2,n=150,r=5e3,s=function(e){function t(t){var i=this;e.call(this,t),this._pulseTargets=[],this._throttledPulse=this.async.debounce(this.pulse,r),this.createComputed(function(){var e=t.valueAccessor()();if(e&&e.length){var o=e.length;i._pulseTargets=[];for(var n=0;o>n;n++){var r=e[n];if(r&&r.pulseTarget){var s=r.pulseTarget();s&&s.canPulse()&&i._pulseTargets.splice(Math.floor(Math.random()*(1+i._pulseTargets.length)),0,s)}}i._throttledPulse()}else i._pulseTargets=[]})}return __extends(t,e),t.prototype.pulse=function(){var e=this,t=o,i=function(){if(t=Math.min(e._pulseTargets.length,t)){var o=e._pulseTargets.shift();o&&(o.pulse(),e._pulseTargets.push(o),t--)}t?e.async.setTimeout(i,n):e._throttledPulse()};i()},t}(i);return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/viewModels/ListViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","../../../bindings/selection/MultiSelectBinding","../../../bindings/viewport/ViewportBinding","../../../bindings/customRender/CustomRenderBinding","../../../bindings/keyboard/KeyboardBinding","../../../bindings/contextMenu/ContextMenuBinding","../../../bindings/pulse/PulseBinding","../../../utilities/locale/Locale","odsp-utilities/domUtils/DomUtils","odsp-shared/utilities/object/EqualityComparers","odsp-utilities/object/ObjectUtil","odsp-shared/utilities/logging/events/ListViewStartRender.event","odsp-shared/utilities/logging/events/ListViewRendered.event","odsp-utilities/logging/events/Engagement.event","odsp-shared/utilities/knockout/LocalBindingProvider"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v=50,b=200,x=400,y=4,_=4,k=500,T=function(e){function t(t,i){var c=this;e.call(this,t),this.headerParams={},this._renderedCellsByKey={},this._renderedCellsByIndex={},this._visibleCells=[],this._skipFocus=!1,this.viewport={viewport:o.observable({width:0,height:0,visibleTop:0,visibleBottom:0}).extend({rateLimit:0}),scrollElement:this._findScrollElement(i.element,t.scroll)},this.addBindingHandlers({selection:n,viewport:r,contextMenu:l,customRender:s,keyboard:a,pulse:d}),this._asyncEnqueueOffScreenRenders=this.async.debounce(this._enqueueOffScreenRenders,x),this.isSelectionOnKeyInputEnabled=void 0===t.isSelectionOnKeyInputEnabled?!0:t.isSelectionOnKeyInputEnabled,this.visibleModels=o.observable(),this.itemSet=t.itemSet,this.isDefault=t.isDefault,this.isActive=t.isActive,this.items=this.createComputed(this._computeItems),this.selectionModel=t.selectionModel,this.requiredRange=o.observable({start:0,end:0}),this.requiredRange.equalityComparer=h.deepCompare,this.headerType=o.observable(""),this.headerStyle=o.observable(""),this._findElements(i.element,t),this.contextMenuHelper=t.contextMenuHelper,this.tooltip=t.tooltip,this._layoutIteration=t.layoutIterationObservable,this.requireEnsureFocus=!0,this.activeLayout=t.activeLayout||o.observable(),this.activeLayout.equalityComparer=u.objectStrictEquality,f.Engagement.logData({name:"ListView.AppLoad"}),this._change=this.async.debounce(function(){c.isDisposed||c._onLayoutChanged()},v,{maxWait:b}),this._updateVisibles=this.async.debounce(function(){if(!c.isDisposed&&(c.visibleModels(c._visibleCells.map(function(e){return e.viewModel})),c.activeLayout().supportsLazyBinding())){for(var e=c.visibleModels.peek(),t=0;t<e.length;t++)e[t].activateBindings();c.bindingsActivated=!0}},k);var p=this.viewport;this.subscribe(p.viewport,function(){var e=c.activeLayout();e&&c.activeLayout().updateViewport(p.viewport())});var g=this.createComputed(function(){t.requiredRange&&t.requiredRange(c.requiredRange())
}).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}});this.subscribe(this.itemSet,function(){c._removeAll(),c.requireEnsureFocus=!0,c._itemToFocus=null,c.requiredRange({start:0,end:0}),g(),c.viewport.scrollElement.scrollTop=0,m.ListViewStartRender.logData()})}return __extends(t,e),t.prototype.initialize=function(e){var t=this,i=this.activeLayout.peek();i&&(this.events.off(i),i.dispose()),this.events.on(e,"change",function(){t._change(),t.visibleModels(null),t._updateVisibles()}),this.activeLayout(e),e.updateViewport(this.viewport.viewport.peek())},t.prototype.onShiftTab=function(){this._skipFocus=!0,this._surfaceElement.focus()},t.prototype.onMousedown=function(){return this._skipFocus=!0,!0},t.prototype.isReadyToBeSelected=function(e){var t=!1;return e&&this._renderedCellsByKey[e().key]&&(t=!0),t},t.prototype.setCellWidth=function(e,t){e.width=t.width},t.prototype._findScrollElement=function(e,t){var i=document.body;return t&&"body"!==t&&(i=p.findAncestor(e,t)),i},t.prototype._findElements=function(e){var t=this;this._surfaceElement=e.getElementsByClassName("List-surface")[0],this.events.on(this._surfaceElement,"focus",function(e){!t._skipFocus&&e.target===t._surfaceElement&&t.selectionModel.focusedItem()&&t._tryScrollToFocusKey(!0),t._skipFocus=!1},!0)},t.prototype._onLayoutChanged=function(){var e=this.activeLayout();if(e){for(var t=this._surfaceElement.style,i=e.getSurfaceSize().height;i!==this._lastHeight;)return t.height=i+"px",this._lastHeight=i,i=e.getSurfaceSize().height,void this._change();if(this._tryScrollToFocusKey())return void this._change();var o=e.supportsGrouping(),n=e.getVisibleRange(),r=e.getVisibleItemRange(),s=e.getMaterializedRange(),a=e.getHeaderCell();a&&(this.headerParams=a.viewData,this.headerStyle("margin-"+c.safeLeft+": "+a.left+"px; width: "+a.width+"px; height: "+a.height+"px;"),this.headerType(a.viewType)),this._visibleCells=this._renderRange(n),g.ListViewRendered.logData(),this._itemToFocus&&(this.selectionModel.setItemFocus(this._itemToFocus),this._itemToFocus=null);var l=this.viewport.viewport().width,d=this.items().length!==this._lastItemsLength;if(o){var p=e.getVisibleItemCount();d=d||p!==this._lastVisibleItemsLength,this._lastVisibleItemsLength=p}if((l!==this._lastWidth||d)&&(this._lastItemsLength=this.items().length,this._lastWidth=l,n.start<0||n.end<0?this._removeAll():this._removeCells(n)),this._asyncEnqueueOffScreenRenders(s,n),r.end>0&&this.requiredRange(r),Boolean(this._layoutIteration)){var u=this._layoutIteration.peek();this._layoutIteration(u+1)}}},t.prototype._renderRange=function(e){var t,i,o,n=this.activeLayout(),r={},s={},a=[];this.bindingsActivated=!1;for(var l=e.start;l>=0&&l<=e.end;l++){var d=this._renderedCellsByIndex[l];o=n.getCellAt(l),o&&o.viewType&&(o.cellIndex=l,i=this._renderedCellsByKey[o.key],i?s[o.key]=o:(i=this._createCell(o,l),t||(t=document.createDocumentFragment()),t.appendChild(i.element)),a.push(i),r[o.key]=!1),!d||o&&d.key===o.key||void 0!==r[d.key]||(r[d.key]=!0)}for(var c in r)r[c]&&this._removeCell(c);for(var p in s)o=s[p],this._updateCell(o,o.cellIndex);return t&&this._surfaceElement.appendChild(t),a},t.prototype._updateCell=function(e,t){var i=this._renderedCellsByKey[e.key],o=i.element.style;i.cellIndex!==t&&i===this._renderedCellsByIndex[i.cellIndex]&&delete this._renderedCellsByIndex[i.cellIndex],i.cellIndex=t,i.top=e.top,i.left=e.left,this.setCellWidth(i,e),i.height=e.height,i.viewData&&i.viewData.cellSize({width:i.width,height:i.height}),o[c.safeLeft]=i.left+"px",o.top=i.top+"px",o.width=i.width+"px",o.height=i.height+"px",this._renderedCellsByIndex[t]=i},t.prototype._createCell=function(e,t){var i=this._renderedCellsByKey[e.key]=o.utils.extend({},e);return i.viewData&&(i.viewData.cellSize=o.observable({width:i.width,height:i.height})),i.element=document.createElement("div"),i.element.className="List-cell",this._updateCell(i,t),i.viewType&&(o.applyBindingsToNode(i.element,{component:{name:i.viewType,params:i.viewData}}),i.element.firstChild&&(i.viewModel=o.dataFor(i.element.firstChild))),i},t.prototype._processRanges=function(){var e=this;this._processRangeEnqueued||(this._processRangeEnqueued=!0,this.async.setTimeout(function(){e._processRangeEnqueued=!1;var t=e._rangesToUpdate.shift();t&&(t.remove?e._removeCells(t):e._renderRange(t)),e._rangesToUpdate.length&&e._processRanges()},y))},t.prototype._enqueueOffScreenRenders=function(e,t){if(t.start>-1&&t.end>-1){this._rangesToUpdate=[];var i;for(i=t.end+1;i<=e.end;i+=_)this._rangesToUpdate.push({start:i,end:i+_-1});for(this._rangesToUpdate.push({start:e.start,end:e.end,remove:!0}),i=t.start-1-_;i>=e.start;i-=_)this._rangesToUpdate.push({start:i,end:i+_-1});this._processRanges()}},t.prototype._removeAll=function(){for(var e in this._renderedCellsByKey){var t=this._renderedCellsByKey[e];o.cleanNode(t.element)}this._surfaceElement.innerHTML="",this._renderedCellsByIndex={},this._renderedCellsByKey={}},t.prototype._removeCells=function(e){for(var t=o.utils.extend({},this._renderedCellsByKey),i=this.activeLayout(),n=e.start;e.start>=0&&n<=e.end;n++){var r=i.getCellAt(n);r&&delete t[r.key]}for(var s in t)this._removeCell(s)},t.prototype._removeCell=function(e){var t=this._renderedCellsByKey[e];o.removeNode(t.element),delete this._renderedCellsByKey[e],this._renderedCellsByIndex[t.cellIndex]===t&&delete this._renderedCellsByIndex[t.cellIndex]},t.prototype._computeItems=function(){return this.itemSet().content().items},t.prototype._tryScrollToFocusKey=function(e){var t=!1;if(this.requireEnsureFocus||e){var i=this.selectionModel.focusedItem(),o=i?i.peek():null,n=o?o.key:null;if(n){var r=this.activeLayout().getCellByKey(n);if(r){var s=this.viewport.scrollElement,a=s.getBoundingClientRect(),l=this._surfaceElement.getBoundingClientRect(),d=l.top-a.top,c=a.top+Math.abs(d),p=c+a.height,u=r.top+r.height,h=r.top>=c&&p>=u;if(!h){var m=Math.round(a.height/2-r.height/2),g=Math.max(0,r.top-m),f=this.items.peek();s.scrollTop=g,t=!0,this._itemToFocus=f[r.index],this.requireEnsureFocus=!1}}}}return t},t}(i);return T});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/layouts/BaseLayout",["require","exports","odsp-shared/base/BaseModel","odsp-utilities/events/EventGroup","knockout","../../../utilities/browser/ResponsiveUI"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this),this.viewport={width:0,height:0,visibleTop:0,visibleBottom:0},this._itemCanary=n.observable().extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}}),this._itemSet=t.itemSet,this._scrollBarWidth=r.getScrollbarWidth(),this.subscribe(this._itemSet,this.onItemSetChanged),this._subscribeForContentChange(),this._isGrouped=t.isGrouped,this._isGrouped&&this._refreshGroupSubscriptions(),this.subscribe(this._itemCanary,this._onItemCanaryChanged)}return __extends(t,e),t.prototype.onContentChanged=function(){var e=this;this._disposeItemSubscriptions(),this._itemSubscriptions=[];for(var t=this._itemSet.peek().content.peek().items,i=t.length,o=0;i>o;o++){var n=t[o];n&&n.subscribe&&this._itemSubscriptions.push(n.subscribe(function(){return e._itemCanary({})}))}this._isGrouped&&this._refreshGroupSubscriptions(),this.evaluateLayout(!0)&&this.change()},t.prototype.onItemSetChanged=function(){this._contentSubscription.dispose(),this._subscribeForContentChange(),this.onContentChanged()},t.prototype.getHeaderCell=function(){return null},t.prototype.getItemAspectRatio=function(){return 1},t.prototype.updateViewport=function(e){this.viewport=e,this.evaluateLayout(e.width!==this._lastWidth)&&this.change(),this._lastWidth=e.width},t.prototype.evaluateLayout=function(){return!0},t.prototype.change=function(){o.raise(this,"change")},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeItemSubscriptions(),this._disposeGroupSubscriptions(),this._contentSubscription.dispose()},t.prototype.supportsLazyBinding=function(){return!1},t.prototype.supportsGrouping=function(){return!1},t.prototype.getVisibleRange=function(){return{start:0,end:0}},t.prototype.getVisibleItemRange=function(){return this.getVisibleRange()},t.prototype.getVisibleItemCount=function(){return 0},t.prototype.onGroupStateChange=function(){this.evaluateLayout(!1)&&this.change()},t.prototype._subscribeForContentChange=function(){this._contentSubscription=this._itemSet.peek().content.subscribe(this.onContentChanged,this)},t.prototype._onItemCanaryChanged=function(){this.evaluateLayout(!0)&&this.change()},t.prototype._disposeItemSubscriptions=function(){if(this._itemSubscriptions)for(var e=0;e<this._itemSubscriptions.length;e++)this._itemSubscriptions[e].dispose();this._itemSubscriptions=null},t.prototype._disposeGroupSubscriptions=function(){if(this._groupSubscriptions&&this._groupSubscriptions.length>0)for(var e=0,t=this._groupSubscriptions;e<t.length;e++){var i=t[e];i.dispose()}this._groupSubscriptions=null},t.prototype._refreshGroupSubscriptions=function(){var e=this;this._disposeGroupSubscriptions(),this._groupSubscriptions=[];var t=this._itemSet.peek().content.peek().groupings;if(t&&t.length)for(var i=0;i<t.length;i++){var o=t[i],n=o.itemGroups;n&&n.length&&n.forEach(function(t){t.state&&e._groupSubscriptions.push(e.subscribe(t.state,e.onGroupStateChange))})}},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),define("odsp-next/controls/detailsRow/DetailsRowRenderer",["require","exports","knockout","odsp-shared/utilities/string/StringHelper","odsp-utilities/encoding/HtmlEncoding"],function(e,t,i,o,n){var r=function(){function e(e){this._detailsRowViewModel=e.rowViewModel,this._rootElement=e.rootElement.getElementsByClassName("DetailsRow")[0],this._bindingsActive=!1}return e.prototype.activateBindings=function(){this._bindingsActive||(i.applyBindingsToDescendants(this._detailsRowViewModel,this._rootElement),this._bindingsActive=!0)},e.prototype.refreshRow=function(){this.renderRow(),this.activateBindings()},e.prototype.renderRow=function(){this._rootElement.innerHTML=this._getRowHtml(),this._bindingsActive=!1},e.prototype._getRowHtml=function(){for(var e='<div class="DetailsRow-check" data-bind="click: onItemCheckClick"><div class="ItemCheck"><div class="ItemCheck-background"></div><div class="ItemCheck-check"></div></div></div>',t='<span role="gridcell" class="{0}" style="{1}" {2}data-bind="attr: { tabindex: $data.getCellTabindex({3}) }, hasFocus: $data.getCellFocusObservable({3}),keyboard: { mappings: { Enter: $data.onEnter.bind($data, {3}), Left: $data.onLeft.bind($data), Right: $data.onRight.bind($data) }}">{4}</span>',r='{0}<span class="DetailsRow-columns">{1}<span>',s=!this._detailsRowViewModel.isMobile||this._detailsRowViewModel.isCheckVisible?e:"",a="",l=this._detailsRowViewModel.columns,d=0;d<l.length;d++){var c=l[d],p=i.observable(d),u=this._detailsRowViewModel.getCellAriaLabel(p);a+=o.format(t,this._detailsRowViewModel.getClass(c),this._detailsRowViewModel.getStyle(c,p),Boolean(u)?'aria-label="'+n.encodeText(u)+'"':"",d,this._detailsRowViewModel.getHtmlValue(c))}return o.format(r,s,a)},e}();return r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/detailsRow/DetailsRowViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../fieldRender/FieldRenderManager","../dragAndDrop/DropHelper","../dragAndDrop/DragType","../../resources/ControlResourceKeys","../../utilities/locale/Locale","../../resources/DataSourceResourceKeys","../../actions/OpenRelation","../../resources/UtilityResourceKeys","../../bindings/keyboard/KeyboardBinding","../../bindings/customRender/CustomRenderBinding","../../bindings/dragAndDrop/DragAndDropBinding","../fieldRender/FieldRender.resx","./DetailsRowRenderer","../../bindings/focus/DelayedHasFocusBinding"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v){var b=50,x=167,y=function(e){function t(t,o){var n=this;e.call(this,t),this.draggable=!0,this.isBasePage=!1,this.columns=[],this.isSelected=i.observable(!1),this.isFocused=i.observable(!1),this.isDroppingTarget=i.observable(!1),this.targetDropped=i.observable(!1),this.selectionModel=this.resources.consume(a.itemsSelection),this.ignoreClickTime=i.observable(0),this.isReceivingDrop=i.observable(!1),this._mobile=this.resources.consume(p.mobile),this._platform=this.resources.consume(p.platformDetection),this._fieldRenderers={},this.item=this.resources.expose(a.currentItem,t.item),this._urlDataSource=this.resources.consume(d.url),this.columns=t.itemSet.peek().schema.peek().filter(function(e){return e.isVisible&&!n._platform.isMobile||n._platform.isMobile&&e.isVisibleMobile}),this._cellLocations=t.cellLocations,this._onInvoke=t.onInvoke,this._dropHelper=new(this.managed(r));var s=this.resources.consume(a.actionMap);this._action=new(this.managed(s.DefaultClickAction))({item:this.item,openRelation:c.specified,userInvokedItem:!0,sourceEngagement:"ItemRow.Click"}),this.isDroppable=this.createComputed(function(){return n.item().isDropEnabled&&!n.isSelected()}),this.isMobile=this._platform.isMobile,this.isCheckVisible=this.createComputed(function(){return n._mobile.showItemCheck()||n.selectionModel.selection().length>0}),this._currentFocusColumnIndex=i.observable(-1),this.focusedObservables=[];for(var l=0;l<this.columns.length;l++)this.focusedObservables.push(i.observable(!1));this.subscribe(this._currentFocusColumnIndex,function(e){e>=0&&n.columns.length>0&&n.focusedObservables[e](!1)},!0),this.subscribe(this._currentFocusColumnIndex,function(e){e>=0&&n.columns.length>0&&n.focusedObservables[e](!0)}),this.subscribe(this.item,this._updateSelectionSubscription),this._updateSelectionSubscription(this.item.peek()),this.tabindex=this.createPureComputed(function(){return n.isFocused()?0:-1}),this._rowRenderer=new f({rowViewModel:this,rootElement:o.element}),this._rowRenderer.renderRow(),this.subscribe(this.item,function(){n._rowRenderer.refreshRow()}),this.subscribe(this._cellLocations,function(){n._rowRenderer.refreshRow()}),this.createComputed(function(){var e=n.isReceivingDrop();e&&n.isReceivingDrop(!1)}).extend({rateLimit:{timeout:x,method:"notifyWhenChangesStop"}}),this.isSelectable=this.createComputed(this._computeIsSelectable),this.isInvokable=this.createComputed(this._computeIsInvokable);var g={keyboard:u,customRender:h,delayedHasFocus:v};this.isDroppable.peek()&&(g.dragAndDrop=m.default),this.addBindingHandlers(g)}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._updateSelectionSubscription(null)},t.prototype.activateBindings=function(){this._rowRenderer.activateBindings()},t.prototype.getCellFocusObservable=function(e){return this.focusedObservables[e]},t.prototype.getCellTabindex=function(e){var t=-1;return this.focusedObservables[e]()&&(t=0),t},t.prototype.getCellAriaLabel=function(e){var t=null,i=this.columns[e()],o=this.item();if(i.isIcon)t=o.properties.iconFieldAriaLabel,o.tooltipText&&(t=t?t+". "+o.tooltipText:o.tooltipText);else if("Editor"===i.key)t=o.properties.modifiedByFieldAriaLabel;else if("SharedWith"===i.key){var n=Number(o.properties.PrincipalCount);t=1>n?g.strings.SharedWithNoneIcon:g.strings.SharedWithSomeIcon}else"_calloutInvoker"===i.key?t=o.properties.calloutInvokerIconAriaLabel:!i.isHtml&&i.name&&this.getTextValue(i)&&(t=i.name+", "+this.getTextValue(i));return t},t.prototype.getDragData=function(){var e=this.item(),t=null;return e.isDraggable&&this.selectionModel.isItemSelected(this.item)&&(t={type:s.OneDriveItem,item:this.item(),selectionModel:this.selectionModel}),t},t.prototype.onMayReceiveDrop=function(e){var t=this.item&&this.item.peek&&this.item.peek();return!t||e.type!==s.OneDriveItem&&e.type!==s.FileUpload?null:{targetName:t.name}},t.prototype.onReceiveDrop=function(e){var t=this._dropHelper.processDrop(e,this.item.peek());return t&&this.targetDropped(!0),t},t.prototype.onItemCheckClick=function(e,t){var i=this.resources.consume(a.itemsSelection);return t.shiftKey?i.selectToItem(this.item):(i.toggleItemSelected(this.item),i.setItemFocus(this.item)),t.cancelBubble=!0,t.preventDefault(),!1},t.prototype.onRemoveDropLocation=function(){this.isDroppingTarget(!1)},t.prototype.getClass=function(e){return"DetailsRow-cell "+e.key},t.prototype.getStyle=function(e,t){var i,o=this._cellLocations()[t()];return i=o&&o.width?"width: "+o.width+"px; "+l.safeLeft+": "+o.left+"px;":"display: none"},t.prototype.getTextValue=function(e){var t=this.item(),i="";return t&&e&&!Boolean(e.isIcon)&&(i=t[e.key],void 0===i&&(i=t.properties[e.key])),i},t.prototype.getHtmlValue=function(e){return n.RenderFieldByType(this,this.item.peek(),e)},t.prototype.registerFieldRenderer=function(e,t){this._fieldRenderers[e]=t},t.prototype.getFieldRenderer=function(e){return this._fieldRenderers[e]},t.prototype.getItem=function(){return this.item},t.prototype.getRowAriaLabel=function(){var e=this.item();return e.properties.nameFieldAriaLabel+", "+e.properties.modifiedFieldAriaLabel},t.prototype.getRowAriaSelected=function(){return this.isSelected().toString()},t.prototype.onClick=function(e,t,i){var o=this.ignoreClickTime(),n=(new Date).getTime();if(o&&b>=n-o)return t.stopPropagation(),t.preventDefault(),!1;if(null===e||"displayName"===e.key||"name"===e.key){if(this._action.isAvailable.peek())return this.onInvoke(t),t.stopPropagation(),t.preventDefault(),!1}else if(i){var r=this.getFieldRenderer(e.key);return r&&"function"==typeof r.onClick&&r.onClick(t,this.item,this.resources),t.stopPropagation(),t.preventDefault(),!1}},t.prototype.onMouseDown=function(e,t){t.shiftKey||t.ctrlKey||t.metaKey||(this.selectionModel.isItemSelected(this.item)||this.selectionModel.clear(),this.selectionModel.setItemSelected(this.item,!0),this.selectionModel.setItemFocus(this.item))},t.prototype.onInvoke=function(e){this._onInvoke.call(this,e)!==!1&&this._action.isAvailable.peek()&&this._action.execute(e)},t.prototype.onEnter=function(e,t,i){return t.onClick(t.columns[e],i,!0)},t.prototype.onLeft=function(e){var t=Math.max(e._currentFocusColumnIndex()-1,0);return e._currentFocusColumnIndex(t),!1},t.prototype.onRight=function(e){var t=Math.min(e._currentFocusColumnIndex()+1,e.columns.length-1);return e._currentFocusColumnIndex(t),!1},t.prototype.detailsRowOnRight=function(e){return e._currentFocusColumnIndex(-1),e._currentFocusColumnIndex(0),!1},t.prototype._computeIsSelectable=function(){var e=this.item();return e&&this.selectionModel.canSelectItem(this.item)},t.prototype._computeIsInvokable=function(){return this._action.isAvailable()},t.prototype._updateSelectionSubscription=function(e){this._selectionSubscription&&(this._selectionSubscription.dispose(),this._selectionSubscription=null),this.selectionModel&&e&&e.key&&(this._selectionSubscription=this.selectionModel.registerSelectable(e.key,this))},t}(o);return y}),define("odsp-next/controls/detailsRow/DetailsRow.html",[],function(){return"<div class=DetailsRow role=row data-bind=\"click: onClick, delayedHasFocus: isFocused, css: { 'dropping': isDroppingTarget, 'is-selected': isSelected, 'is-focused': isFocused, 'is-checkVisible': isMobile && isCheckVisible, 'is-receivingDrop': isReceivingDrop, 'can-select': isSelectable, 'od-DetailsRow--isInvokable': isInvokable }, attr: { tabindex: tabindex, 'aria-label': getRowAriaLabel(), 'aria-selected': getRowAriaSelected() }, keyboard: { mappings: { Right: detailsRowOnRight }, context: $data }, dragAndDrop: { mayReceiveDrop: onMayReceiveDrop, isDragging: isDroppingTarget, receiveDrop: onReceiveDrop }, customRender: true\"></div>"}),define("odsp-next/controls/detailsRow/DetailsRow.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".DetailsRow-cell,.DetailsRow-check{display:inline-block;vertical-align:top}.DetailsRow{overflow:hidden;height:100%;line-height:34px;position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.DetailsRow.is-selected{background:#d7eaf9}@media screen and (-ms-high-contrast:active){.DetailsRow.is-selected{background:#0000c0}}@media screen and (-ms-high-contrast:black-on-white){.DetailsRow.is-selected{background:#00c0ff}}.DetailsRow:focus{outline:transparent solid 1px}.od--isNonMobile .DetailsRow.dropping,.od--isNonMobile .DetailsRow:hover{background:#e6f2fb;outline:transparent solid 1px}.od--isNonMobile .DetailsRow:hover.is-selected{background:#beddf4}.od--isNonMobile .DetailsRow:hover.is-selected .DetailsRow-check{opacity:1}.od-focus--enabled .DetailsRow.is-focused{box-shadow:0 0 0 1px #767676 inset;outline:transparent solid 1px}.DetailsRow-check{padding:7px 8px;opacity:0}.od-Browser--ie .DetailsRow-check{padding:8px}.DetailsRow.can-select:hover .DetailsRow-check,.DetailsRow.is-checkVisible .DetailsRow-check,.DetailsRow.is-selected .DetailsRow-check{opacity:1}.DetailsRow.dropping .DetailsRow-cell.type .FileTypeIcon-icon{-webkit-transform:scale(1.5,1.5);-ms-transform:scale(1.5,1.5);transform:scale(1.5,1.5)}.DetailsRow.is-receivingDrop .DetailsRow-cell.type .FileTypeIcon-icon{-webkit-transform:scale(1.6,1.6);-ms-transform:scale(1.6,1.6);transform:scale(1.6,1.6);transition-duration:.1s;transition-timing-function:cubic-bezier(.075,.82,.165,1)}.DetailsRow-cell.type .FileTypeIcon-icon{transition:-webkit-transform 267ms cubic-bezier(.075,.82,.165,1);transition:transform 267ms cubic-bezier(.075,.82,.165,1);transition:transform 267ms cubic-bezier(.075,.82,.165,1),-webkit-transform 267ms cubic-bezier(.075,.82,.165,1)}.DetailsRow-cell{cursor:default;padding:0 8px;position:absolute;height:100%;outline:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:12px;transition:width 367ms cubic-bezier(.1,.9,.2,1),left 367ms cubic-bezier(.1,.9,.2,1),right 367ms cubic-bezier(.1,.9,.2,1)}.DetailsRow-cell.type{line-height:30px;overflow:visible}.DetailsRow-cell.type .FileTypeIcon{line-height:16px}.DetailsRow-cell>a,.DetailsRow-cell>a:visited{cursor:pointer;text-decoration:none;color:#000;font-size:14px}.DetailsRow-cell>a:hover,.DetailsRow-cell>a:visited:hover{text-decoration:underline;color:#000}.DetailsRow-cell:focus{outline:transparent solid 1px}.od-focus--enabled .DetailsRow-cell:focus{box-shadow:0 0 0 1px #767676 inset;outline:transparent solid 1px}.DetailsRow-cell.is-checkVisible{padding:0}.DetailsRow-cell .ms-Icon{color:#07288b}")}),define("odsp-next/controls/detailsRow/DetailsRow",["require","exports","knockout","./DetailsRowViewModel","./DetailsRow.html","./DetailsRow.css"],function(e,t,i,o){var n={tagName:"ms-details-row",template:e("./DetailsRow.html"),viewModel:{createViewModel:function(e,t){return new(e.resources.injected(o))(e,t)}},synchronous:!0};return i.components.isRegistered(n.tagName)||i.components.register(n.tagName,n),n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/layouts/DetailsLayout",["require","exports","knockout","./BaseLayout","../../../resources/UtilityResourceKeys","../../../resources/ControlResourceKeys","../../detailsRow/DetailsRow"],function(e,t,i,o,n,r,s){var a=3,l=5,d=4,c=function(e){function t(t){var o=this;e.call(this,t),this._mobile=this.resources.consume(n.mobile),this._platform=this.resources.consume(n.platformDetection),this._selectionModel=this.resources.consume(r.itemsSelection),this.cellLocations=i.observable([]),this._checkShown=this.createComputed(function(){return o.isCheckSupported()&&(!o._platform.isMobile||o._mobile.showItemCheck()||o._selectionModel.selection().length>0)}),this.rowCheckWidth=this.createComputed(function(){return o._checkShown()?40:0}),this._checkChanged=this.createComputed(function(){o._checksOld!==o._checkShown()&&o.evaluateLayout(!0),o._checksOld=o._checkShown()}),this._platform.isMobile&&(this.getSettings().outerPadding=8,this.getSettings().headerHeight=0)}return __extends(t,e),t.prototype.isCheckSupported=function(){return!0},t.prototype.getSettings=function(){return{headerHeight:32,rowHeight:36,outerPadding:32,innerPadding:24}},t.prototype.getHeaderCell=function(){var e=this.getSettings();return{key:"details-header",index:0,left:e.outerPadding,top:0,width:this.viewport.width-2*e.outerPadding,height:e.headerHeight,viewType:"ms-details-header",viewData:{itemSet:this._itemSet,resources:this.resources,cellLocations:this.cellLocations}}},t.prototype.getSurfaceSize=function(){return{width:this.viewport.width,height:this.getSettings().rowHeight*this._itemSet.peek().content.peek().items.length}},t.prototype.getVisibleRange=function(){var e=this.viewport,t=this.getSettings();return{start:Math.max(0,Math.floor(e.visibleTop/t.rowHeight)),end:Math.min(this._itemSet.peek().content.peek().items.length-1,Math.floor(e.visibleBottom/t.rowHeight))}},t.prototype.getMaterializedRange=function(){var e=this.getVisibleRange(),t=this.viewport,i=this.getSettings(),o=Math.ceil(t.height/i.rowHeight),n=Math.max(a*o,d),r=Math.max(l*o,d);return{start:Math.max(0,e.start-n),end:Math.min(this._itemSet.peek().content.peek().items.length-1,e.end+r)}},t.prototype.evaluateLayout=function(e){var t=this,i=this._itemSet.peek().schema.peek();return(e||this.viewport.width!==this._lastViewportWidth||this._lastColumnCount!==i.length)&&(this._lastColumnCount=i.length,this._lastViewportWidth=this.viewport.width,this.cellLocations(this.calculateCellLocations(i.filter(function(e){return e.isVisible&&!t._platform.isMobile||t._platform.isMobile&&e.isVisibleMobile})))),!0},t.prototype.calculateCellLocations=function(e){var t,i,o,n=[],r=0,s=this.viewport,a=this.getSettings(),l=s.width-2*a.outerPadding-this.rowCheckWidth.peek();for(i=0;i<e.length;i++){t=e[i];var d=i>0?a.innerPadding:0,c=t.minWidth||t.width;t.isCollapsable&&r+d+c>l?(c=0,d=0):o=i,r+=c+d,n.push({left:0,width:c})}for(;l>r&&o>=0;){if(t=e[o],void 0!==t.minWidth){var p=l-r,u=Math.min(p,t.width-t.minWidth);n[o].width+=u,r+=u}o--}var h=this.rowCheckWidth.peek();for(i=0;i<e.length;i++)n[i].left=h,h+=n[i].width+a.innerPadding;return n},t.prototype.getCellCount=function(){return this._itemSet.peek().content.peek().items.length},t.prototype.getCellAt=function(e){var t=this._itemSet.peek().content.peek().items[e],i=t?s.tagName:null,o=this.getSettings();return{key:t?t.peek().key:"item-"+e,item:t,index:e,viewType:i,viewData:{item:t,itemSet:this._itemSet,resources:this.resources,cellLocations:this.cellLocations,onInvoke:this.onRowInvoke},left:o.outerPadding,top:o.rowHeight*e,width:this.viewport.width-2*o.outerPadding,height:o.rowHeight}},t.prototype.onRowInvoke=function(){return!0},t.prototype.getCellByKey=function(e){for(var t,o=this._itemSet.peek().content.peek().items,n=0;n<o.length;n++){var r=i.utils.unwrapObservable(o[n]);if(r&&r.key===e){t=this.getCellAt(n);break}}return t},t.prototype.getItemIndexAbove=function(e){var t=this._itemSet.peek().content.peek().items;return Math.min(t.length-1,Math.max(0,e-1))},t.prototype.getItemIndexBelow=function(e){var t=this._itemSet.peek().content.peek().items;return Math.min(t.length-1,Math.max(0,e+1))},t.prototype.getItemIndexLeft=function(e){return e},t.prototype.getItemIndexRight=function(e){return e},t.prototype.getItemIndicesInRegion=function(e){var t=[],i=this.getSurfaceSize(),o=e.x+e.width>this.getSettings().outerPadding&&e.x<i.width-this.getSettings().outerPadding&&e.y+e.height>0&&e.y<i.height;if(o)for(var n=this.getSettings(),r=Math.max(0,Math.floor(e.y/n.rowHeight)),s=Math.min(this._itemSet().content().items.length-1,Math.floor((e.y+e.height)/n.rowHeight)),a=r;s>=a;a++)t.push(a);return t},t.prototype.getToggleClass=function(){return"DetailsRow-check"},t.prototype.supportsLazyBinding=function(){return!0},t}(o.default);return c});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/viewModels/DetailsListViewModel",["require","exports","./ListViewModel","../layouts/DetailsLayout"],function(e,t,i,o){var n=function(e){function t(t,i){e.call(this,t,i);var n=new(this.managed(o))(t);this.initialize(n)}return __extends(t,e),t}(i);return n}),define("odsp-next/controls/list/List.html",[],function(){return'<div class=List role=grid data-bind="attr:{ \'aria-label\': tooltip }, pulse: visibleModels"><div class=List-header data-bind="if: headerType(), attr: { style: headerStyle }"><!--ko component: { name: headerType, params: headerParams }--><!--/ko--></div><div class=List-surface tabindex=0 data-bind="viewport: viewport, selection: { isDefaultSelection: isDefault, isSelectionOnKeyInputEnabled: isSelectionOnKeyInputEnabled, isActive: isActive, items: items, layout: activeLayout, selectionModel: selectionModel, isReadyToBeSelected: $component.isReadyToBeSelected.bind($component) }, customRender: true, contextMenu: contextMenuHelper, keyboard: { mappings: { ShiftTab: onShiftTab }, context: $data, forceBubble: true }, event: { mousedown: onMousedown }"></div></div>'}),define("odsp-next/controls/list/List.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".List{position:relative;display:block}.List .List-surface{position:relative;min-height:1px}.List .List-surface:focus{outline:0}.List .List-cell{position:absolute}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/detailsHeader/DetailsHeaderViewModel",["require","exports","knockout","../../resources/UtilityResourceKeys","../../resources/ControlResourceKeys","../../resources/DataSourceResourceKeys","../../resources/PagesResourceKeys","odsp-shared/base/ViewModel","../../utilities/list/ListFilterHelper","../../utilities/locale/Locale","../../bindings/contextMenu/ContextMenuBinding","../../bindings/contextMenu/ContextMenuHelper","odsp-utilities/logging/events/Engagement.event","odsp-shared/utilities/logging/LoggingHelper","odsp-shared/utilities/string/StringHelper","./DetailsHeader.resx","../../bindings/keyboard/KeyboardBinding","odsp-shared/utilities/logging/events/Action.event","odsp-utilities/logging/events/Qos.event","../../dataSources/url/PageType","../../dataSources/url/QueryType","../../utilities/navigation/NavigationHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_){var k=function(e){function t(t){var a=this;e.call(this,t),this.navigation=this.resources.consume(o.navigation),this.sortManager=this.resources.consume(s.sortManager),this._mobile=this.resources.consume(o.mobile),this._platform=this.resources.consume(o.platformDetection),this._selectionModel=this.resources.consume(n.itemsSelection),this._itemSet=t.itemSet,this._cellLocations=t.cellLocations,this._urlDataSource=this.resources.consume(r.url),this.columns=this.createComputed(function(){return a._itemSet().schema().filter(function(e){return e.isVisible&&!a._platform.isMobile||a._platform.isMobile&&e.isVisibleMobile})}),this.isCheckVisible=this.createComputed(function(){return!a._platform.isMobile||a._mobile.showItemCheck()||a._selectionModel.selection().length>0}),this.isAllSelected=this._selectionModel.isAllSelected,this.isSelectionActive=this._selectionModel.isActive,this.isMobile=this._platform.isMobile,this.addBindingHandlers({keyboard:f}),this._currentFocusColumnIndex=i.observable(-1),this.isItemCheckFocused=i.observable(!1),this.isFilterMenuFocused=i.observable(!1),this.subscribe(this._currentFocusColumnIndex,function(e){e>=0&&a.columns().length>0&&a.columns()[e].isFocused(!1)},!0),this.subscribe(this._currentFocusColumnIndex,function(e){e>=0&&a.columns().length>0&&a.columns()[e].isFocused(!0)})}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this.columns.dispose()
},t.prototype.getStyle=function(e,t){var i,o=this._cellLocations()[t()];return i=o&&o.width?"width: "+o.width+"px; "+d.safeLeft+": "+o.left+"px;":"display: none"},t.prototype.getClass=function(e){return"DetailsHeader-cell "+e.key+(e.sortable?" isSortable":"")},t.prototype.getTextClass=function(e){return"cellText"+(e.isSorted?" isSorted":"")+(e.isAscending?" isAscending":"")+(!e.isFocused||!e.isFocused()||Boolean(e.filterable)&&this.isFilterMenuFocused()?"":" is-focused")},t.prototype.getMenuClass=function(e){return"cellMenuLink"+(e.isFiltered()?" isFiltered":"")+(e.isFocused&&e.isFocused()&&this.isFilterMenuFocused()?" is-focused":"")},t.prototype.onClick=function(e,t){if(Boolean(t.sortable)){if(t.internalName){var i=[h.capitalizeFirstLetter(t.internalName),"Header","Click"],o=i.join(".");u.Engagement.logData({name:o})}var n=t.internalName||t.key,r=t.isSorted?!t.isAscending:!0,s=new v.Action({name:"ColumnHeaderSort",pageType:x[e._urlDataSource.getPageType()],queryType:y[e._urlDataSource.getQueryType()]}),a={sortMode:t.isSorted?"Column":"Order",sortColumn:n,sortAscending:r?"Ascending":"Descending"};s.end({resultType:b.ResultTypeEnum.Success,extraData:a}),e.sortManager.updateSort(n,r)}},t.prototype.onMenuClick=function(e,t,i){if(Boolean(t.filterable)){var o=[h.capitalizeFirstLetter(t.name),"HeaderGlyph",h.ClickName],n=o.join(".");u.Engagement.logData({name:n,extraData:{action:h.capitalizeFirstLetter(i.type)}});var s=t.internalName||t.key,a=e.resources.consume(r.items),d=_.serializeQuery(e.navigation.viewParams),m=a.getFilterData(s,d);m.then(function(o){var n=l.getFilterMenuItems(e.resources,t,o,d,s),r=new p({items:n,rootElementClass:"List",boundingElementClass:"Files-content"});c.createContextMenu(i,r,e)})}},t.prototype.toggleAllSelected=function(){this._selectionModel.setIsActive(!0),this._selectionModel.toggleSelectAll()},t.prototype.onLeft=function(e,t){if(Boolean(t.filterable)&&e.isFilterMenuFocused())e.isFilterMenuFocused(!1);else{var i=e.getLeftFocusColumnIndex();e._currentFocusColumnIndex(i),-1===i&&e.isItemCheckFocused(!0),e.isFilterMenuFocused(!0)}return!1},t.prototype.onRight=function(e,t){return!Boolean(t.filterable)||e.isFilterMenuFocused()?(e.isFilterMenuFocused(!1),e._currentFocusColumnIndex(e.getRightFocusColumnIndex())):e.isFilterMenuFocused(!0),!1},t.prototype.onDown=function(e,t,i){return Boolean(t.filterable)&&e.isFilterMenuFocused()?(e.onMenuClick(e,t,i),!1):void 0},t.prototype.onEnter=function(e,t,i){return Boolean(t.filterable)&&e.isFilterMenuFocused()?e.onMenuClick(e,t,i):e.onClick(e,t),!1},t.prototype.headerContainerOnRight=function(e){return e.isItemCheckFocused(!0),e._currentFocusColumnIndex(-1),!1},t.prototype.getColumnAriaSort=function(e){var i="none";return e.isSorted&&(i=e.isAscending?t._ascendingAriaSort:t._descendingAriaSort),i},t.prototype.getColumnFilterAriaLabel=function(e){var t=null;return e.isFiltered()&&(t=m.format(g.strings.columnFilterAriaLabel,e.name,e.filterValues())),t},t.prototype.getRightFocusColumnIndex=function(){for(var e=this._currentFocusColumnIndex(),t=this.columns(),i=e+1;i<t.length;i++)if(t[i].name){e=i;break}return e},t.prototype.getLeftFocusColumnIndex=function(){for(var e=this._currentFocusColumnIndex(),t=this.columns(),i=!1,o=e-1;o>=0;o--)if(t[o].name){e=o,i=!0;break}return i||(e=-1),e},t._ascendingAriaSort="ascending",t._descendingAriaSort="descending",t}(a);return k}),define("odsp-next/controls/detailsHeader/DetailsHeader.html",[],function(){return"<div class=DetailsHeaderContainer data-bind=\"if: !isMobile\"><div class=DetailsHeader role=row tabindex=0 data-bind=\"keyboard: { mappings: { Right: headerContainerOnRight }, context: $data }\"><!--ko if: isCheckVisible--><ms-item-check class=\"DetailsHeader-check can-select\" data-bind=\"click: toggleAllSelected, css: { 'is-selected': isAllSelected, 'is-selection-active': isSelectionActive, 'is-focused': $data.isItemCheckFocused }, hasFocus: $data.isItemCheckFocused, keyboard: { mappings: { Enter: toggleAllSelected, Right: onRight }, context: $data }, attr: {tabindex: $data.isItemCheckFocused() ? 0 : -1 }\"></ms-item-check><!--/ko--><span class=DetailsHeader-columns data-bind=\"foreach: columns\"><span role=columnheader data-bind=\"if: $data.name, attr: { 'class': $parent.getClass($data), 'style': $parent.getStyle($data, $index), 'aria-sort':$parent.getColumnAriaSort($data), tabindex: $data.isFocused() ? 0 : -1 }, hasFocus: $data.isFocused, keyboard: { mappings: { Enter: $parent.onEnter.bind($data, $parent), Space: $parent.onEnter.bind($data, $parent), Left: $parent.onLeft.bind($data, $parent), Right: $parent.onRight.bind($data, $parent), Down: $parent.onDown.bind($data, $parent) },context: $data}\"><!--ko if: $data.filterable--><span data-bind=\"click: $parent.onMenuClick.bind($data, $parent), attr: { 'class': $parent.getMenuClass($data), 'aria-label': $parent.getColumnFilterAriaLabel($data), role: $data.isFiltered()? 'button': null }\"></span><!--/ko--><span data-bind=\"text: $data.name, click: $parent.onClick.bind($data, $parent), attr: { 'class': $parent.getTextClass($data) }\"></span></span></span></div></div>"}),define("odsp-next/controls/detailsHeader/DetailsHeader.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".DetailsHeader-check,.DetailsHeader-check:hover .ItemCheck-background{display:inline-block}.od-focus--enabled .DetailsHeader-check.is-focused,.od-focus--enabled .DetailsHeader:focus{box-shadow:0 0 0 1px #767676 inset;outline:transparent solid 1px}.DetailsHeader-check:focus,.DetailsHeader:focus,.od-focus--enabled .DetailsHeader:focus{outline:transparent solid 1px}.DetailsHeader{overflow:hidden;height:30px;line-height:30px;border-bottom:1px solid #eaeaea;position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.DetailsHeader-check{position:absolute;z-index:1;height:22px;padding:4px 8px;vertical-align:top}.DetailsHeader-check:hover .ItemCheck-check:after{color:#c8c8c8}.DetailsHeader-check .ItemCheck-background{display:none}.DetailsHeader-cell,.DetailsHeader-check .ItemCheck-check,.DetailsHeader-check.can-select.is-selected .ItemCheck-background{display:inline-block}.DetailsHeader-check .ItemCheck-check:after{color:#666}.DetailsHeader-check.can-select.is-selected:hover .ItemCheck-check:after{color:#fff}.DetailsHeader-columns{position:absolute;left:0;right:0;height:30px;overflow:hidden;white-space:nowrap}.DetailsHeader-cell{vertical-align:top;position:absolute;overflow:hidden;color:#666;outline:0;transition:width 367ms cubic-bezier(.1,.9,.2,1),left 367ms cubic-bezier(.1,.9,.2,1),right 367ms cubic-bezier(.1,.9,.2,1)}.DetailsHeader-cell .cellMenuLink.is-focused,.DetailsHeader-cell .cellText.is-focused,.od-focus--enabled .DetailsHeader-cell .cellText.is-focused{box-shadow:0 0 0 1px #767676 inset;outline:transparent solid 1px}.DetailsHeader-cell.isSortable{cursor:pointer;color:#333}.DetailsHeader-cell.isSortable:hover{background:#eaeaea}@media screen and (-ms-high-contrast:active){.DetailsHeader-cell.isSortable{border-left:1px solid #000;border-right:1px solid #000;border-top:1px solid #000}.DetailsHeader-cell.isSortable:hover{border-left:1px solid #fff;border-right:1px solid #fff;border-top:1px solid #fff}}@media screen and (-ms-high-contrast:black-on-white){.DetailsHeader-cell.isSortable{border-left:1px solid #fff;border-right:1px solid #fff;border-top:1px solid #fff}.DetailsHeader-cell.isSortable:hover{border-left:1px solid #000;border-right:1px solid #000;border-top:1px solid #000}}.DetailsHeader-cell.isSortable:active{background:#c8c8c8}.DetailsHeader-cell .cellText{display:block;font-size:11px;padding:0 8px;text-overflow:ellipsis;overflow:hidden}.DetailsHeader-cell .cellMenuLink.isFiltered:after,.DetailsHeader-cell .cellText.isSorted:after,.DetailsHeader-cell.DetailsHeader-cell:focus .cellMenuLink:not(.isFiltered):after,.DetailsHeader-cell:hover .cellMenuLink:not(.isFiltered):after{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-family:Office365Icons;font-style:normal;font-weight:400;line-height:1;speak:none}.DetailsHeader-cell .cellText.isSorted:after{color:#a6a6a6;position:relative;top:-1px;font-size:9px;content:'\\e27b'}html[dir=ltr] .DetailsHeader-cell .cellText.isSorted:after{padding-left:4px}html[dir=rtl] .DetailsHeader-cell .cellText.isSorted:after{padding-right:4px}.DetailsHeader-cell .cellText.isSorted.isAscending:after{content:'\\e27a'}.DetailsHeader-cell .cellMenuLink{padding:0 5px}html[dir=ltr] .DetailsHeader-cell .cellMenuLink{float:right}html[dir=rtl] .DetailsHeader-cell .cellMenuLink{float:left}.DetailsHeader-cell .cellMenuLink.isFiltered:after{content:'\\e041'}.DetailsHeader-cell.DetailsHeader-cell:focus .cellMenuLink:not(.isFiltered):after,.DetailsHeader-cell:hover .cellMenuLink:not(.isFiltered):after{content:'\\e088'}")}),define("odsp-next/controls/itemCheck/ItemCheck.html",[],function(){return"<div class=ItemCheck><div class=ItemCheck-background></div><div class=ItemCheck-check></div></div>"}),define("odsp-next/controls/itemCheck/ItemCheck.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ItemCheck{font-family:Office365Icons;line-height:1;text-align:center;display:none;width:18px;height:18px;vertical-align:top;position:relative;cursor:default;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ItemCheck:hover .ItemCheck-check{display:inline-block}.ItemCheck-background,.ItemCheck-check{position:absolute;top:0;right:0;bottom:0;left:0}.ItemCheck-background:after,.ItemCheck-background:before{font-size:22px;line-height:21px;display:inline-block;height:18px;width:18px;position:absolute;top:0;bottom:0}html[dir=rtl] .ItemCheck-background:after,html[dir=rtl] .ItemCheck-background:before{left:0}html[dir=ltr] .ItemCheck-background:after,html[dir=ltr] .ItemCheck-background:before{right:0;left:-2px}html[dir=rtl] .ItemCheck-background:after,html[dir=rtl] .ItemCheck-background:before{right:-2px}.ItemCheck-background:before{content:'\\e001';color:#fff}@media screen and (-ms-high-contrast:white-on-black){.ItemCheck-background:before{color:#000}}@media screen and (-ms-high-contrast:black-on-white){.ItemCheck-background:before{color:#fff}}.ItemCheck-background:after{content:'\\e000';color:#c8c8c8}.ItemCheck-check{line-height:16px;overflow:hidden;display:none}.ItemCheck-check:after,.can-select .ItemCheck,.can-select.is-selected .ItemCheck-check{display:inline-block}html[dir=ltr] .ItemCheck-check{-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1)}html[dir=rtl] .ItemCheck-check{-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1);transform:scaleX(-1)}.ItemCheck-check:after{content:'\\e041';font-size:9px;color:#c8c8c8}.od-Browser--ie .ItemCheck-check{line-height:15px}.can-select.is-selected .ItemCheck-background:before{color:#3a96dd;display:inline-block}@media screen and (-ms-high-contrast:active){.can-select.is-selected .ItemCheck-background:before{color:#fff}}@media screen and (-ms-high-contrast:black-on-white){.can-select.is-selected .ItemCheck-background:before{color:#000}}.can-select.is-selected .ItemCheck-background:after{color:#fff}@media screen and (-ms-high-contrast:active){.can-select.is-selected .ItemCheck-background:after{color:#000}}@media screen and (-ms-high-contrast:black-on-white){.can-select.is-selected .ItemCheck-background:after{color:#fff}}.can-select.is-selected .ItemCheck-check:after{color:#fff}@media screen and (-ms-high-contrast:active){.can-select.is-selected .ItemCheck-check:after{color:#000}}@media screen and (-ms-high-contrast:black-on-white){.can-select.is-selected .ItemCheck-check:after{color:#fff}}")}),define("odsp-next/controls/itemCheck/ItemCheck",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./ItemCheck.html","./ItemCheck.css"],function(e,t,i){var o=i.registerComponent({tagName:"ms-item-check",template:e("./ItemCheck.html"),synchronous:!0});return o}),define("odsp-next/controls/detailsHeader/DetailsHeader",["require","exports","./DetailsHeaderViewModel","odsp-shared/utilities/knockout/ComponentFactory","./DetailsHeader.html","./DetailsHeader.css","../itemCheck/ItemCheck"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-details-header",template:e("./DetailsHeader.html"),viewModel:i,synchronous:!0});return n}),define("odsp-next/controls/list/DetailsList",["require","exports","knockout","./viewModels/DetailsListViewModel","./List.html","./List.css","../detailsRow/DetailsRow","../detailsHeader/DetailsHeader"],function(e,t,i,o){var n={tagName:"ms-details-list",template:e("./List.html"),viewModel:{createViewModel:function(e,t){return new(e.resources.injected(o))(e,t)}},synchronous:!0};return i.components.isRegistered(n.tagName)||i.components.register(n.tagName,n),n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/layouts/BaseGridLayout",["require","exports","./BaseLayout","../../../utilities/locale/Locale","../../../resources/UtilityResourceKeys","../../../controls/itemTile/ItemTile"],function(e,t,i,o,n,r){var s=3,a=3,l=30,d="folder",c="photo",p="document",u=function(e){function t(t){e.call(this,t),this.visibleRange=null,this.currentGroup=null,this.nextGroup=null,this._headerIndices=[],this.rows=[],this.responsiveHelper=this.resources.consume(n.responsiveUI)}return __extends(t,e),t.prototype.getOuterMargin=function(){return this._isSmallWidthLayout?{top:0,bottom:0,left:4,right:4}:{top:0,bottom:0,left:32,right:32}},t.prototype.getMinCellWidth=function(){return 40},t.prototype.getInnerMargin=function(){return this._isSmallWidthLayout?3:8},t.prototype.getMinRowHeight=function(){var e=this._getGroupName(this.currentGroup);switch(e){case d:return this._isSmallWidthLayout?110:120;case p:return this._isSmallWidthLayout?130:160;case c:return this._isSmallWidthLayout?90:170;default:return this._isSmallWidthLayout?120:170}},t.prototype.getItemAspectRatio=function(e){var t,i=this._getGroupName(this.currentGroup);switch(e&&(t=e()),i){case d:return t&&t.isAlbum?1:this._isSmallWidthLayout?4/3:1.6;default:if(t&&t.photo&&t.photo.width){var o=Math.max(t.photo.width,this.getMinCellWidth()),n=Math.max(t.photo.height,this.getMinRowHeight());return Math.max(.5,Math.min(3,o/n))}return 1}},t.prototype.getIsFixed=function(){var e=this._getGroupName(this.currentGroup);switch(e){case c:return!1;default:return!0}},t.prototype.getCellByKey=function(e){for(var t,i=0,o=this.cells;i<o.length;i++){var n=o[i];if(n.key===e){t=n;break}}return t},t.prototype.getItemViewType=function(e){return e?r.tagName:null},t.prototype.getItemViewData=function(e){return{item:e,resources:this.resources}},t.prototype.getVisibleRange=function(){var e=this.viewport,t=-1,i=-1;if(this.rows.length&&e.width>0&&e.height>0){var o=this.rows[this.rows.length-1],n=this.rows[0];if(e.visibleBottom>n.top&&e.visibleTop<o.top+o.height){for(t=0;n&&n.top+n.height<e.visibleTop;)n=this.rows[++t];for(i=t;n&&i<this.rows.length-1&&n.top<e.visibleBottom;)n=this.rows[++i];i=Math.min(i,this.rows.length-1)}}return this.visibleRange={start:t>=0?this.rows[t].cells[0].cellIndex:-1,end:i>=0?this.rows[i].cells[this.rows[i].cells.length-1].cellIndex:-1},this.visibleRange},t.prototype.getMaterializedRange=function(){var e={start:this.visibleRange.start,end:this.visibleRange.end};if(e.start>=0){var t=this.cells[e.end].rowIndex-this.cells[e.start].rowIndex+1,i=this.cells[this.visibleRange.start].rowIndex,o=this.cells[this.visibleRange.end].rowIndex,n=Math.max(t*s,l),r=Math.max(t*a,l);i=Math.max(0,i-n),o=Math.min(this.rows.length-1,o+r),e.start=this.rows[i].cells[0].cellIndex;var d=this.rows[o];e.end=d.cells[d.cells.length-1].cellIndex}return e},t.prototype.getSurfaceSize=function(){var e=this.lastRow,t=this.getOuterMargin();return{width:this.viewport.width,height:e?e.top+e.height+t.bottom:0}},t.prototype.getCellCount=function(){return this.cells.length},t.prototype.getCellAt=function(e){return this.cells[e]},t.prototype.getItemIndexAbove=function(e){var t=this.getCellAt(this.getCellIndexFromItemIndex(e)),i=t?t.index:-1;return t&&(i=this._findNearestCellInRow(t,-1).index),i},t.prototype.getItemIndexBelow=function(e){var t=this.getCellAt(this.getCellIndexFromItemIndex(e)),i=t?t.index:0;return t&&(i=this._findNearestCellInRow(t,1).index),i},t.prototype.getItemIndexLeft=function(e){var t=this.getCellAt(this.getCellIndexFromItemIndex(e));return t&&(t=this._findNextCell(t,o.isRightToLeft?1:-1)),t?t.index:-1},t.prototype.getItemIndexRight=function(e){var t=this.getCellAt(this.getCellIndexFromItemIndex(e));return t&&(t=this._findNextCell(t,o.isRightToLeft?-1:1)),t?t.index:-1},t.prototype.getItemIndicesInRegion=function(e){for(var t=[],i=0;i<this.rows.length;i++){var o=this.rows[i];if(o.top>e.y+e.height)break;if(o.top<=e.y+e.height&&o.top+o.height>=e.y)for(var n=0;n<o.cells.length;n++){var r=o.cells[n];r.item&&r.left<=e.x+e.width&&r.left+r.width>=e.x&&t.push(r.index)}}return t},t.prototype.getToggleClass=function(){return"ItemTile-rowCheck"},t.prototype.evaluateLayout=function(e){var t=this._itemSet.peek(),i=t&&t.content.peek().items;if(!i||!this.viewport)return!1;if(e){this._isSmallWidthLayout=this.responsiveHelper.formFactorSize()<=this.responsiveHelper.windowSize.Medium,this.cells=[],this._itemIndexToCell={},this.rows=[],this._headerIndices=[],this.lastRow=null,this._lastRowInGroup=null,this.currentGroup=null,this.nextGroup=null,this.currentRow=null;for(var o=0;o<i.length;o++){var n=i[o];this.addToCurrentRow(this.getHeader(i[o-1],n,o),!0),this.addToCurrentRow(this.getCell(n,o))}this.finalizeRow(!0)}return!0},t.prototype.addToCurrentRow=function(e,t){if(e){var i=this._getCurrentRow(),o=void 0===e.shouldLineBreak?t:e.shouldLineBreak;o?(this.finalizeRow(!0,i.isHeader),i=this._getCurrentRow(),i.isHeader=!0,i.cells.push(e),this.finalizeRow(!1,!0)):(this._canAddCell(e)||(this.finalizeRow(!0,!1),i=this._getCurrentRow()),i.aspectRatio+=e.aspectRatio,i.cells.push(e),e.isHeader||e.shouldLineBreak||i.itemCellCount++)}},t.prototype.getCell=function(e,t){var i=e&&e.peek&&e.peek(),o=i?i.key:"item-"+t,n={key:o,item:e,index:t,cellIndex:this.cells.length,viewType:this.getItemViewType(i),viewData:this.getItemViewData(e),aspectRatio:this.getItemAspectRatio(e)};return n},t.prototype.getCellIndexFromItemIndex=function(e){var t=this._itemIndexToCell[e];return t?t.cellIndex:-1},t.prototype.getAvailableWidth=function(){var e=this.getOuterMargin(),t=this.getInnerMargin(),i=this.currentRow?(this.currentRow.cells.length-1)*t:0;return this.viewport.width-(e.left+e.right)-i},t.prototype.finalizeRow=function(e,t){var i=this.currentRow;if(this.currentRow&&this.currentRow.cells.length){var o=this.getOuterMargin(),n=this.getInnerMargin(),r=this.lastRow,s=Math.ceil(this._getRowHeight(i,t)),a=0,l=null;i.top=Math.round(r?r.top+r.height+n:o.top),i.height=s;for(var d=0;d<i.cells.length;d++){var c=i.cells[d],p=c.aspectRatio||0;t&&this._headerIndices.push(this.cells.length),c.cellIndex=this.cells.length,void 0!==c.index&&(this._itemIndexToCell[c.index]=c),this.cells.push(c),c.left=Math.ceil(o.left+a*s+n*d),c.top=i.top,c.width=c.aspectRatio?Math.min(Math.ceil(p*s),this.viewport.width-o.right-c.left):this.viewport.width-o.right-c.left,c.height=s,c.rowIndex=this.rows.length,l&&(l.width=c.left-n),a+=p}this.rows.push(i),t?this._currentHeaderCell=i.cells[0]:this._currentHeaderCell&&(this._currentHeaderCell.viewData.cellsInGroup+=i.cells.length),this.lastRow=i,this._lastRowInGroup=t?null:i,this.currentGroup=this.nextGroup,this.currentRow=null}},t.prototype._processCell=function(e){var t=this.getOuterMargin();e.width||(e.width=this.viewport.width-t.left-t.right)},t.prototype._canAddCell=function(e){var t=!1,i=this._getCurrentRow(),o=this.getInnerMargin(),n=this.getMinRowHeight(),r=this.getOuterMargin(),s=this.viewport.width-(r.left+r.right)-i.cells.length*o,a=s/n;return this._processCell(e),e&&i.aspectRatio+e.aspectRatio<=a?t=!0:i.isFull=!0,t},t.prototype._getCurrentRow=function(){return this.currentRow||(this.currentRow={cells:[],top:0,height:0,aspectRatio:0,itemCellCount:0}),this.currentRow},t.prototype._getRowHeight=function(e,t){var i=this.getMinRowHeight(),o=0,n=this.getAvailableWidth(),r=this.getOuterMargin(),s=this.getInnerMargin(),a=e.cells[0],l=this.getIsFixed();if(a.width)if(!e.isFull&&l){var d,c,p=a.aspectRatio,u=1;do d=this.viewport.width-(r.left+r.right)-u++*s,p+=a.aspectRatio,c=d/i;while(c>=p);p-=a.aspectRatio,d+=s,o=d/p}else e.isFull?o=n/e.aspectRatio:this._lastRowInGroup&&(o=n/this._lastRowInGroup.aspectRatio);else o=a.height;return Math.max(t?o:i,o)},t.prototype._findNextCell=function(e,t){var i=e.cellIndex+t,o=this.cells[i];if(o&&o.viewData&&o.viewData.group){var n=i+t;n>0&&n<this.cells.length&&(o=this.cells[n])}for(;i>=0&&i<this.cells.length&&void 0===o.index;)i+=t,o=this.cells[i];return o},t.prototype._findNearestCellInRow=function(e,t){var i=-1,o=null,n=e.rowIndex+t,r=this.rows[n];if(r&&r.isHeader){var s=n+t;s>0&&s<this.rows.length&&(r=this.rows[s])}for(;e&&!o&&r;){for(var a=0;a<r.cells.length;a++){var l=r.cells[a],d=Math.abs(this._getPosition(e)-this._getPosition(l));void 0!==l.index&&(-1===i||i>d)&&(i=d,o=l)}o||(n+=t,r=this.rows[n])}return o||e},t.prototype._getPosition=function(e){return e.left+e.width/2},t.prototype._getGroupName=function(e){var t="";return e&&e.groupingId?t=e.groupingId:!e||void 0===e.closedFuture&&void 0===e.closedPast||(t=c),t},t}(i.default);return u});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharerHeader/SharerHeaderViewModel",["require","exports","odsp-shared/base/ViewModel","./SharerHeader.resx","odsp-shared/utilities/string/StringHelper","../../resources/DataSourceResourceKeys"],function(e,t,i,o,n,r){var s=o.strings,a=function(e){function t(t){e.call(this,t);var i=t.group,o=i.data;if(this.name=i.name||"",this.showAllText=s.showAll,o){var a=o.itemsSharedCount;this.subText=1===a?s.singleShared:n.format(s.multiShared,a),this.profileImageUrl=o.sharerProfileImageUrl;var l=this.resources.consume(r.url);this.sharerUrl=l.getSharedByUrl(o.sharerLongCid,o.sharerCid),this.isShowAllVisible=t.cellsInGroup<a}}return __extends(t,e),t}(i);return a}),define("odsp-next/controls/sharerHeader/SharerHeader.html",[],function(){return"<a class=SharerHeader data-bind=\"attr: { 'href': sharerUrl }\"><img class=SharerHeader-userTile data-bind=\"attr: { 'src': profileImageUrl }\" width=40 height=40><div class=SharerHeader-title data-bind=text:name></div><div class=SharerHeader-subText data-bind=text:subText></div><!--ko if:isShowAllVisible--><div class=SharerHeader-showAll data-bind=text:showAllText></div><!--/ko--></a>"}),define("odsp-next/controls/sharerHeader/SharerHeader.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".SharerHeader{display:block;padding:8px 0;margin:24px 0;text-decoration:none;vertical-align:middle;font-size:12px}.SharerHeader-userTile{border-radius:50%;background-color:#a6a6a6}html[dir=ltr] .SharerHeader-userTile{float:left;margin-right:8px}html[dir=rtl] .SharerHeader-userTile{float:right;margin-left:8px}.SharerHeader-title{font-size:17px;color:#333}.SharerHeader-subText{color:#666;display:inline-block}.SharerHeader-showAll{display:inline-block;padding:0 16px}")}),define("odsp-next/controls/sharerHeader/SharerHeader",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./SharerHeaderViewModel","./SharerHeader.html","./SharerHeader.css"],function(e,t,i,o){var n=i.registerComponent({tagName:"ms-sharer-header",template:e("./SharerHeader.html"),viewModel:o});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/layouts/GridLayout",["require","exports","./BaseGridLayout","../../sharerHeader/SharerHeader"],function(e,t,i,o){var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getGroup=function(e){var t,i=this._itemSet().content.peek().groupings||[];if(i&&i.length&&i[0].itemGroups)for(var o=i[0].itemGroups,n=0;n<o.length;n++){var r=o[n];if(r){var s=r.startIndex+r.count-1;if(r.startIndex<=e&&s>=e){t=r;break}}}return t},t.prototype.getHeader=function(e,t,i){var o=null,n=t&&t.peek&&t.peek();if(n){var r=this.getGroup(i,n);if(r&&this.currentGroup!==r){this.nextGroup=r;var s=this.getHeaderDetails(r,i);0!==i||s.viewType||(s.headerHeight=0),o={key:(s.key?s.key:n.key)+"_header",index:-1,cellIndex:this.cells.length,left:0,top:0,width:0,height:s.headerHeight,viewType:s.viewType,viewData:s.viewData}}}return o},t.prototype.getHeaderDetails=function(e){var t="",i={},n=20;return e&&"sharer"===e.groupingId&&(t=o.tagName,i={group:e,cellsInGroup:0,resources:this.resources},n=84),{viewType:t,viewData:i,headerHeight:n}},t}(i);return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/layouts/SharedGridLayout",["require","exports","./GridLayout"],function(e,t,i){var o=function(e){function t(){e.apply(this,arguments),this._finalizedRowsInGroup=0}return __extends(t,e),t.prototype.getItemApectRatio=function(){return 1},t.prototype.evaluateLayout=function(t){return this._finalizedRowsInGroup=0,e.prototype.evaluateLayout.call(this,t)},t.prototype.finalizeRow=function(t,i){var o=this.currentRow;o&&(i?this._finalizedRowsInGroup=0:this._finalizedRowsInGroup++),this._finalizedRowsInGroup<2?e.prototype.finalizeRow.call(this,t,i):this.currentRow=null},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/list/viewModels/GridListViewModel",["require","exports","./ListViewModel","../layouts/GridLayout","../layouts/SharedGridLayout","../../../dataSources/url/QueryType","odsp-shared/utilities/object/EqualityComparers"],function(e,t,i,o,n,r,s){var a=function(e){function t(t,i){e.call(this,t,i),this._params=t,this._layoutType=this.createComputed(this._computeLayoutType),this._layoutType.equalityComparer=s.objectStrictEquality,this.createComputed(this._computeInitialize)}return __extends(t,e),t.prototype._computeLayoutType=function(){var e=this.itemSet().item(),t=o;return e.queryType===r.SharedWithMe&&e.isRootFolder&&(t=n),t},t.prototype._computeInitialize=function(){this.initialize(new(this.managed(this._layoutType()))(this._params))},t}(i);return a}),define("odsp-next/controls/list/GridList",["require","exports","knockout","./viewModels/GridListViewModel","./layouts/LayoutType","./List.html","./List.css","../itemTile/ItemTile","../sharerHeader/SharerHeader"],function(e,t,i,o,n){var r={tagName:n.Grid,template:e("./List.html"),viewModel:{createViewModel:function(e,t){return new(e.resources.injected(o))(e,t)}},synchronous:!0};return i.components.isRegistered(r.tagName)||i.components.register(r.tagName,r),r}),define("odsp-next/controls/oneUp/resources/OneUpResourceKeys",["require","exports","odsp-shared/utilities/resources/ResourceKey"],function(e,t,i){t.agentProvider=i("oneUp.agentProvider")}),define("odsp-next/controls/operation/strings/OperationStringMapping",["require","exports"],function(e,t){!function(e){e[e.groupOrItem=0]="groupOrItem",e[e.groupOnly=1]="groupOnly",e[e.itemOnly=2]="itemOnly",e[e.both=3]="both"}(t.OperationActionMode||(t.OperationActionMode={}));t.OperationActionMode}),define("odsp-next/dataSources/upload/UploadErrorType",["require","exports"],function(){var e;return function(e){e[e.none=0]="none",e[e.general=1]="general",e[e.downlevelGeneral=2]="downlevelGeneral",e[e.conflict=3]="conflict",e[e.downlevelConflict=4]="downlevelConflict",e[e.invalidName=5]="invalidName",e[e.fileSize=6]="fileSize",e[e.emptyFileOrFolder=7]="emptyFileOrFolder",e[e.overQuota=8]="overQuota",e[e.accessDenied=9]="accessDenied",e[e.lockMismatch=10]="lockMismatch",e[e.downlevelLockMismatch=11]="downlevelLockMismatch",e[e.overQuotaSharedFolder=12]="overQuotaSharedFolder",e[e.folderUploadNotSupported=13]="folderUploadNotSupported"}(e||(e={})),e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/itemLink/ItemLinkViewModel",["require","exports","odsp-shared/base/ViewModel","../../resources/ControlResourceKeys","../../actions/OpenRelation","knockout"],function(e,t,i,o,n,r){var s=function(e){function t(t){var i=this;e.call(this,t),this._item=r.isObservable(t.item)?t.item:r.observable(t.item),this.name=this.createComputed(function(){return i._item()&&i._item().name}),this._actionMap=this.resources.consume(o.actionMap),this.open=new(this.managed(this._actionMap.OpenAction))({openRelation:n.specified,item:this._item,skipItemValidation:!0})}return __extends(t,e),t.prototype.execute=function(e,t){return e.isAvailable()?(e.execute(t).done(),!1):void 0},t}(i);return s}),define("odsp-next/controls/itemLink/ItemLink.html",[],function(){return'<!--ko with: open--><!--ko if: isAvailable--><a class=od-ItemLink href=# data-bind="click: $component.execute.bind($component), text: $component.name"></a><!--/ko--><!--ko ifnot: isAvailable--><span class=od-ItemLink data-bind="text: $component.name"></span><!--/ko--><!--/ko-->'}),define("odsp-next/controls/itemLink/ItemLink",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./ItemLinkViewModel","./ItemLink.html"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-item-link",template:e("./ItemLink.html"),viewModel:o,synchronous:!0});return n}),define("odsp-next/models/sharing/SharingOperationResult",["require","exports"],function(){var e;return function(e){e[e.Success=0]="Success",e[e.AccessRequestQueued=1]="AccessRequestQueued",e[e.NoResolvedUsers=-1]="NoResolvedUsers",e[e.AccessDenied=-2]="AccessDenied",e[e.CrossSiteRequestNotSupported=-3]="CrossSiteRequestNotSupported",e[e.UnknownError=-4]="UnknownError"}(e||(e={})),e}),define("odsp-next/controls/operation/strings/OperationStringMappings",["require","exports","./OperationStringMapping","../../../utilities/string/FileSizeFormatter","../monitor/OperationMonitor.resx","odsp-shared/utilities/string/StringHelper","../../../dataSources/upload/UploadErrorType","../../../utilities/icons/Icon","../../itemLink/ItemLink","../../../models/sharing/SharingOperationResult"],function(e,t,i,o,n,r,s,a,l,d){var c=n.strings,p=function(e){return r.format(c.progressFormat,e.progress.current(),e.progress.maximum())},u=function(e){return r.format(c.progressFormat,o.formatSize(e.progress.current(),!0),o.formatSize(e.progress.maximum(),!0))},h=function(){return c.createdDescription},m=function(){return c.completedDescription},g=function(e){return e.error()&&e.error().message||c.failedDescription},f=function(){return c.canceledDescription},v=function(){return""},b={general:function(){return c.generalUploadErrorText},downlevelGeneral:function(){return c.generalUploadErrorText},fileSize:function(e,t){return r.format(c.fileSizeUploadErrorFormat,o.formatSize(t.maxSizeInBytes),c.productName)},emptyFileOrFolder:function(){return c.emptyFileOrFolderUploadErrorFormat},overQuota:function(){return c.overQuotaUploadErrorText},overQuotaSharedFolder:function(){return c.overQuotaSharedFolderUploadErrorText},lockMismatch:function(){return c.lockMismatchUploadErrorText},downlevelLockMismatch:function(){return c.lockMismatchUploadErrorText},accessDenied:function(){return c.accessDeniedUploadErrorText
},invalidName:function(){return c.invalidNameUploadErrorText},conflict:function(e,t){return t.allowRename?c.conflictUploadErrorText:c.conflictUploadWithoutRenameErrorText},downlevelConflict:function(){return c.downlevelConflictUploadErrorText},folderUploadNotSupported:function(){return c.folderUploadNotSupported}},x=function(e){var t=e.error(),i=t&&t.payloads.upload&&t.payloads.upload.error,o=i&&t.payloads.upload&&b[s[i.errorType]];return o&&o(e,i)||g(e)},y=function(e){return"<span data-bind=\"component: { name: '"+l.tagName+"', params: { item: "+e+' } }"></span>'},_=function(e){var t=e.payloads(),i=t.shareItem?t.shareItem.result:null;if(null!=i)switch(i){case d.Success:return c.completedDescription;case d.AccessRequestQueued:return c.shareAccessRequestQueued;case d.AccessDenied:case d.NoResolvedUsers:return c.shareAccessDenied;default:return g(e)}return""},k=function(e){var t=e.states();return t.completed+t.created+t.started},T={types:{multiple:{title:function(e){return r.format(r.pluralSelect(k(e),c.variousSingleTitleFormat,c.variousMultipleTitleFormat),k(e))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.variousSingleTitleFormat,c.variousMultipleTitleFormat),k(e))},states:{created:{description:h},started:{description:p},completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedVariousSingleTitleFormat,c.completedVariousMultipleTitleFormat),e.states().completed)},shortTitle:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedVariousSingleTitleFormat,c.completedVariousMultipleTitleFormat),e.states().completed)},description:m},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedVariousSingleTitleFormat,c.failedVariousMultipleTitleFormat),e.states().failed)},shortTitle:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedVariousSingleTitleFormat,c.failedVariousMultipleTitleFormat),e.states().failed)},description:g},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedVariousSingleTitleFormat,c.failedVariousMultipleTitleFormat),e.states().canceled)},shortTitle:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedVariousSingleTitleFormat,c.failedVariousMultipleTitleFormat),e.states().canceled)},description:f},expired:{description:v}}},renameItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.startedRenameSingleShortTitleFormat,c.startedRenameMultipleShortTitleFormat),k(e))},shortTitle:function(e){return r.format(r.pluralSelect(e.count(),c.startedRenameSingleShortTitleFormat,c.startedRenameMultipleShortTitleFormat),e.count())},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedRenameSingleTitleFormat,c.completedRenameMultipleTitleFormat),e.states().completed)}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedRenameSingleTitleFormat,c.failedRenameMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedRenameSingleTitleFormat,c.failedRenameMultipleTitleFormat),e.states().canceled)}}}},requestReview:{title:function(e){return r.format(r.pluralSelect(k(e),c.startedRequestReviewSingleShortTitleFormat,c.startedRequestReviewMultipleShortTitleFormat),k(e))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedRequestReviewSingleShortTitleFormat,c.startedRequestReviewMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedRequestReviewSingleTitleFormat,c.completedRequestReviewMultipleTitleFormat),e.states().completed)}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedRequestReviewSingleTitleFormat,c.failedRequestReviewMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedRequestReviewSingleTitleFormat,c.failedRequestReviewMultipleTitleFormat),e.states().canceled)}}}},reportAbuse:{title:function(e){return r.format(c.startedReportAbuseSingleShortTitleFormat,e.payloads().reportAbuse.item.name)},shortTitle:function(){return c.startedReportAbuseSingleShortTitleFormat},states:{completed:{title:function(){return r.format(c.completedReportAbuseSingleTitleFormat,y("context.payloads().reportAbuse.item"))}},failed:{title:function(){return r.format(c.failedReportAbuseSingleTitleFormat,y("context.payloads().reportAbuse.item"))}},canceled:{title:function(){return r.format(c.failedReportAbuseSingleTitleFormat,y("context.payloads().reportAbuse.item"))}}}},deleteItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.deleteSingleTitleFormat,c.deleteMultipleTitleFormat),k(e),y("context.payloads().deleteItems.parent"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedDeleteSingleShortTitleFormat,c.startedDeleteMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedDeleteSingleTitleFormat,c.completedDeleteMultipleTitleFormat),e.states().completed,y("context.payloads().deleteItems.parent"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedDeleteSingleTitleFormat,c.failedDeleteMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedDeleteSingleTitleFormat,c.failedDeleteMultipleTitleFormat),e.states().canceled)}}},actions:{undo:{mode:i.OperationActionMode.groupOnly},deleteLocked:{mode:i.OperationActionMode.groupOnly}}},restoreItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.restoreSingleTitleFormat,c.restoreMultipleTitleFormat),k(e))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedRestoreSingleShortTitleFormat,c.startedRestoreMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedRestoreSingleShortTitleFormat,c.completedRestoreMultipleShortTitleFormat),e.states().completed)}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedRestoreSingleTitleFormat,c.failedRestoreMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedRestoreSingleTitleFormat,c.failedRestoreMultipleTitleFormat),e.states().canceled)}}}},uploadItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.uploadSingleTitleFormat,c.uploadMultipleTitleFormat),k(e),y("context.payloads().uploadItems.parent"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedUploadSingleShortTitleFormat,c.startedUploadMultipleShortTitleFormat),k(e))},states:{started:{description:u},completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedUploadSingleTitleFormat,c.completedUploadMultipleTitleFormat),e.states().completed,y("context.payloads().uploadItems.parent"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedUploadSingleTitleFormat,c.failedUploadMultipleTitleFormat),e.states().failed)},description:x},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedUploadSingleTitleFormat,c.failedUploadMultipleTitleFormat),e.states().canceled)}}},actions:{cancel:{mode:i.OperationActionMode.both}}},moveItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.moveSingleTitleFormat,c.moveMultipleTitleFormat),k(e),y("context.payloads().moveItems.destination"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedMoveSingleShortTitleFormat,c.startedMoveMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedMoveSingleTitleFormat,c.completedMoveMultipleTitleFormat),e.states().completed,y("context.payloads().moveItems.destination"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedMoveSingleTitleFormat,c.failedMoveMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedMoveSingleTitleFormat,c.failedMoveMultipleTitleFormat),e.states().canceled)}}}},copyItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.copySingleTitleFormat,c.copyMultipleTitleFormat),k(e),y("context.payloads().copyItems.destination"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedCopySingleShortTitleFormat,c.startedCopyMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedCopySingleTitleFormat,c.completedCopyMultipleTitleFormat),e.states().completed,y("context.payloads().copyItems.destination"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedCopySingleTitleFormat,c.failedCopyMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedCopySingleTitleFormat,c.failedCopyMultipleTitleFormat),e.states().canceled)}}}},mergeFaceGroups:{title:function(e){return r.format(c.merging,e.payloads.peek().mergeFaceGroups.items.length)},shortTitle:function(e){return r.format(c.merging,e.payloads.peek().mergeFaceGroups.items.length)},states:{completed:{title:function(e){return r.format(c.completedMerging,e.payloads.peek().mergeFaceGroups.items.length)}},failed:{title:function(){return c.failedMerge}}}},rotateItems:{title:function(e){return r.format(r.pluralSelect(k(e),c.rotateSingleTitleFormat,c.rotateMultipleTitleFormat),k(e))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedRotateSingleShortTitleFormat,c.startedRotateMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedRotateSingleShortTitleFormat,c.completedRotateMultipleShortTitleFormat),e.states().completed)}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedRotateSingleTitleFormat,c.failedRotateMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedRotateSingleTitleFormat,c.failedRotateMultipleTitleFormat),e.states().canceled)}}}},addItemsToAlbum:{title:function(e){return r.format(r.pluralSelect(k(e),c.addToAlbumSingleTitleFormat,c.addToAlbumMultipleTitleFormat),k(e),y("context.payloads().addItemsToAlbum.album"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedAddToAlbumSingleShortTitleFormat,c.startedAddToAlbumMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedAddToAlbumSingleTitleFormat,c.completedAddToAlbumMultipleTitleFormat),e.states().completed,y("context.payloads().addItemsToAlbum.album"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedAddToAlbumSingleTitleFormat,c.failedAddToAlbumMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedAddToAlbumSingleTitleFormat,c.failedAddToAlbumMultipleTitleFormat),e.states().canceled)}}}},addCoverPhotos:{title:function(e){return r.format(r.pluralSelect(k(e),c.addAsCoverPhotosSingleTitleFormat,c.addAsCoverPhotosMultipleTitleFormat),k(e),y("context.payloads().coverPhotos.parent"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedAddAsCoverPhotosSingleShortTitleFormat,c.startedAddAsCoverPhotosMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedAddAsCoverPhotosSingleTitleFormat,c.completedAddAsCoverPhotosMultipleTitleFormat),e.states().completed,y("context.payloads().coverPhotos.parent"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedAddAsCoverPhotosSingleTitleFormat,c.failedAddAsCoverPhotosMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedAddAsCoverPhotosSingleTitleFormat,c.failedAddAsCoverPhotosMultipleTitleFormat),e.states().canceled)}}}},removeCoverPhotos:{title:function(e){return r.format(r.pluralSelect(k(e),c.removeAsCoverPhotosSingleTitleFormat,c.removeAsCoverPhotosMultipleTitleFormat),k(e),y("context.payloads().coverPhotos.parent"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedRemoveAsCoverPhotosSingleShortTitleFormat,c.startedRemoveAsCoverPhotosMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedRemoveAsCoverPhotosSingleTitleFormat,c.completedRemoveAsCoverPhotosMultipleTitleFormat),e.states().completed,y("context.payloads().coverPhotos.parent"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedRemoveAsCoverPhotosSingleTitleFormat,c.failedRemoveAsCoverPhotosMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedRemoveAsCoverPhotosSingleTitleFormat,c.failedRemoveAsCoverPhotosMultipleTitleFormat),e.states().canceled)}}}},createAlbumFromFolder:{title:function(){return r.format(c.startedCreateAlbumFromFolderSingleTitleFormat,y("context.payloads().createAlbumFromFolder.album"))},states:{completed:{title:function(){return r.format(c.completedCreateAlbumFromFolderSingleTitleFormat,y("context.payloads().createAlbumFromFolder.album"))}},failed:{title:function(){return r.format(c.failedCreateAlbumFromFolderSingleTitleFormat,y("context.payloads().createAlbumFromFolder.folder"))}}}},createAlbum:{title:function(e){return r.format(r.pluralSelect(k(e),c.addToAlbumSingleTitleFormat,c.addToAlbumMultipleTitleFormat),k(e),y("context.payloads().createAlbum.album"))},shortTitle:function(e){return r.format(r.pluralSelect(k(e),c.startedAddToAlbumSingleShortTitleFormat,c.startedAddToAlbumMultipleShortTitleFormat),k(e))},states:{completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedAddToAlbumSingleTitleFormat,c.completedAddToAlbumMultipleTitleFormat),e.states().completed,y("context.payloads().createAlbum.album"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedAddToAlbumSingleTitleFormat,c.failedAddToAlbumMultipleTitleFormat),e.states().failed)}},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedAddToAlbumSingleTitleFormat,c.failedAddToAlbumMultipleTitleFormat),e.states().canceled)}}}},checkInItem:{title:function(){return r.format(c.checkInItemTitleFormat,y("context.payloads().checkInItem.parent"))},states:{}},checkOutItem:{title:function(){return r.format(c.checkOutItemTitleFormat,y("context.payloads().checkOutItem.parent"))},states:{}},undoCheckOutItem:{title:function(){return r.format(c.undoCheckOutItemTitleFormat,y("context.payloads().undoCheckOutItem.parent"))},states:{}},shareItem:{title:function(e){return r.format(c.shareTitleFormat,e.payloads().shareItem.item.name)},states:{completed:{description:_},failed:{description:_}}},createFolder:{title:function(){return r.format(c.createFolderTitleFormat,y("context.payloads().createFolder.parent"))},states:{}},updateBundle:{title:function(){return r.format(c.updateBundle,y("context.payloads().updateBundle.item"))},states:{}},setAlbumCoverPhoto:{title:function(){return r.format(c.setCoverPhotoTitleFormat,y("context.payloads().setAlbumCoverPhoto.album"))},states:{completed:{title:function(){return r.format(c.completedSetCoverPhotoTitleFormat,y("context.payloads().setAlbumCoverPhoto.album"))}},failed:{title:function(){return r.format(c.failedSetCoverPhotoTitleFormat,y("context.payloads().setAlbumCoverPhoto.album"))}}}},uploadVideos:{title:function(e){return r.format(r.pluralSelect(k(e),c.uploadSingleTitleFormat,c.uploadMultipleTitleFormat),k(e),y("context.payloads().uploadItems.parent"))},states:{started:{description:u},completed:{title:function(e){return r.format(r.pluralSelect(e.states().completed,c.completedUploadSingleTitleFormat,c.completedUploadMultipleTitleFormat),e.states().completed,y("context.payloads().uploadItems.parent"))}},failed:{title:function(e){return r.format(r.pluralSelect(e.states().failed,c.failedUploadSingleTitleFormat,c.failedUploadMultipleTitleFormat),e.states().failed)},description:x},canceled:{title:function(e){return r.format(r.pluralSelect(e.states().canceled,c.failedAddToAlbumSingleTitleFormat,c.failedAddToAlbumMultipleTitleFormat),e.states().canceled)}}}}},actions:{cancel:{name:function(){return c.cancelActionText},icon:a.x},close:{name:function(){return c.closeActionText},icon:a.x},overwrite:{name:function(e){return r.pluralSelect(e.count(),c.overwriteSingleActionText,c.overwriteMultipleActionText)}},restart:{name:function(){return c.restartActionText}},undo:{name:function(e){return r.pluralSelect(e.count(),c.undoSingleActionText,c.undoMultipleActionText)}},rename:{name:function(e){return r.pluralSelect(e.count(),c.renameSingleActionText,c.renameMultipleActionText)}},moveAnyway:{name:function(){return c.moveAnywayButtonText}},deleteLocked:{name:function(e){return r.pluralSelect(e.count(),c.deleteSingleActionText,c.deleteMultipleActionText)}},moveLockedFile:{name:function(){return c.moveAnywayButtonText}}}};return T});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/operation/monitor/OperationActionViewModel",["require","exports","odsp-shared/base/ViewModel","../strings/OperationStringMappings","odsp-utilities/async/Promise","knockout"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._action=t.action,this._onExecuteAction=t.onExecuteAction,this._context={count:this._action.count,states:r.observable({}),payloads:r.observable({}),progress:null,error:r.observable()},this._key=this._action.key,this.icon=o.actions[this._key].icon,this.title=this.createPureComputed(this._computeTitle),this.iconCss=this.createPureComputed(this._computeIconCss)}return __extends(t,e),t.prototype.execute=function(){var e=this;n.default.wrap().then(function(){return e._action.execute()}).done(),this._onExecuteAction&&this._onExecuteAction()},t.prototype._computeTitle=function(){var e=o.actions[this._key].name;return e(this._context)},t.prototype._computeIconCss=function(){return this.icon&&"ms-Icon "+this.icon.getClass()||""},t}(i);return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/operation/monitor/OperationViewModel",["require","exports","odsp-shared/base/ViewModel","../../../models/operation/OperationState","../../../models/operation/OperationType","./OperationActionViewModel","../strings/OperationStringMappings","../../../bindings/css/ClassesBinding","knockout","odsp-shared/utilities/knockout/Projections"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){e.call(this,t),this.addBindingHandlers({classes:a}),this._operation=t.operation,this._onExecuteAction=t.onExecuteAction,this._disallowedActions=t.disallowedActions||{},this.context={count:this._operation.count,states:this.createComputed(this._computeStates),progress:this._operation.progress,payloads:this._operation.payloads,error:this._operation.error},this.progress=this._operation.progress,this.iconName=this._operation.iconName,this._initializeActions(),this.title=this.createComputed(this._computeTitle),this.description=this.createComputed(this._computeDescription),this.css=this.createPureComputed(this._computeCss),this.showProgress=this.createPureComputed(this._computeShowProgress)}return __extends(t,e),t.prototype._computeStates=function(){var e={created:0,started:0,completed:0,failed:0,canceled:0,expired:0};return e[o[this._operation.state()]]=1,e},t.prototype._computeTitle=function(){return this._operation.name},t.prototype._computeDescription=function(){var e=o[this._operation.state()],t=n[this._operation.type()],i=n[n.multiple],r=s.types[t],a=r.states[e],l=s.types[i],d=l.states[e],c=a&&a.description||d&&d.description;return c(this.context)},t.prototype._initializeActions=function(){var e=this,t=l.observableArray();this.createComputed(function(){t(Object.keys(e._operation.actions()).map(function(t){return e._operation.actions.peek()[t]}))});var i=this.addDisposable(t.filter(function(t){var i=(!e._disallowedActions[t.key]||!e._disallowedActions[t.key]())&&t.isAvailable();return i})),o=this.addDisposable(i.map({mappingWithDisposeCallback:function(t){var i=new(e.managed(r))({action:t,onExecuteAction:e._onExecuteAction});return{mappedValue:i,dispose:function(){i.dispose()}}}}));this.buttonActions=this.addDisposable(o.filter(function(e){return!e.icon})),this.iconActions=this.addDisposable(o.filter(function(e){return!!e.icon}))},t.prototype._computeCss=function(){return"OperationMonitor-item--"+o[this._operation.state()]},t.prototype._computeShowProgress=function(){return this._operation.state()!==o.created&&this._operation.progress.current()>this._operation.progress.minimum()},t}(i);return d});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/operation/monitor/OperationGroupViewModel",["require","exports","odsp-shared/base/ViewModel","./OperationViewModel","./OperationActionViewModel","../../../models/operation/OperationState","../../../models/operation/OperationType","../strings/OperationStringMappings","../strings/OperationStringMapping","../../../bindings/html/BindableHtmlBinding","../../../bindings/css/ClassesBinding","knockout","odsp-shared/utilities/knockout/Projections"],function(e,t,i,o,n,r,s,a,l,d,c,p){var u=10,h=3,m=function(e){function t(t){e.call(this,t),this.addBindingHandlers({bindableHtml:d,classes:c}),this._group=t.group,this._showIndividualOperations=t.showIndividualOperations,this._showOneOperation=t.showOneOperation,this._onExecuteAction=t.onExecuteAction,this._disallowedActions={},this.progress=this._group.progress,this.context={count:this._group.count,states:this._group.states,progress:this._group.progress,payloads:this._group.payloads,error:this._group.error},this._initializeOperations(),this._initializeActions(),this._initializeOperationViewModels(),this.title=this.createComputed(this._computeTitle),this.description=this.createComputed(this._computeDescription),this.showProgress=this.createPureComputed(this._computeShowProgress),this.showDescription=this.createPureComputed(this._computeShowDescription),this.css=this.createComputed(this._computeCss)}return __extends(t,e),t.prototype._computeTitle=function(){var e=r[this._group.state()],t=s[this._group.type()],i=s[s.multiple],o=a.types[t],n=o.states[e],l=a.types[i],d=l.states[e],c=n&&n.title||o.title||d&&d.title||l.title;return c(this.context)},t.prototype._computeDescription=function(){var e=r[this._group.state()],t=s[this._group.type()],i=s[s.multiple],o=a.types[t],n=o.states[e],l=a.types[i],d=l.states[e],c=n&&n.description||d&&d.description;return c(this.context)},t.prototype._computeShowProgress=function(){return this._showIndividualOperations&&(this._group.state()===r.started||this._group.progress.current()>this._group.progress.minimum())},t.prototype._computeShowDescription=function(){return this._showIndividualOperations&&(this._group.state()!==r.failed||!!this.buttonActions().length)},t.prototype._computeCss=function(){return"OperationMonitor-item--"+r[this._group.state()]},t.prototype._initializeActions=function(){var e=this,t=p.observableArray();this.createComputed(function(){t(Object.keys(e._group.actions()).map(function(t){return e._group.actions.peek()[t]}))});var i=this.addDisposable(t.filter(function(t){var i=s[e._group.type()],o=a.types[i].actions,n=o&&o[t.key],r=a.actions[t.key],d=n&&n.mode||r.mode||l.OperationActionMode.groupOrItem,c=d!==l.OperationActionMode.groupOnly&&t.count()>h||d===l.OperationActionMode.groupOnly,u=!e._showIndividualOperations||!!r.icon||c,m=!c||d===l.OperationActionMode.both;return e._disallowedActions[t.key]?e._disallowedActions[t.key](!m):e._disallowedActions[t.key]=p.observable(!m),u&&t.isAvailable()})),o=this.addDisposable(i.map({mappingWithDisposeCallback:function(t){var i=new(e.managed(n))({action:t,onExecuteAction:e._onExecuteAction});return{mappedValue:i,dispose:function(){i.dispose()}}}}));this.buttonActions=this.addDisposable(o.filter(function(e){return!e.icon})),this.iconActions=this.addDisposable(o.filter(function(e){return!!e.icon}))},t.prototype._initializeOperations=function(){var e=this,t=this.createPureComputed(function(){return 1===e._group.operations().length}),i=this.createPureComputed(function(){return e._group.operations().length>u}),o=this.createPureComputed(function(){return e._group.states().started<u}),n=this.createPureComputed(function(){return e._group.states().created+e._group.states().started<u});this._operations=this.addDisposable(this._group.operations.filter(function(s){return e._showIndividualOperations||t()?!e._showOneOperation&&t()&&s.state()!==r.failed?!1:i()&&s.state()!==r.failed?n()&&s.state()===r.created?!0:o()&&s.state()===r.started?!0:!1:!0:!1}))},t.prototype._initializeOperationViewModels=function(){var e=this;this.operations=this.addDisposable(this._operations.map({mappingWithDisposeCallback:function(t){var i=new(e.managed(o))({operation:t,onExecuteAction:e._onExecuteAction,disallowedActions:e._disallowedActions});return{mappedValue:i,dispose:function(){i.dispose()}}}}))},t}(i);return m});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/preRender/PreRenderBinding",["require","exports","../BaseBinding","knockout"],function(e,t,i,o){var n=function(e){function t(t){e.call(this,t);for(var i=o.virtualElements.childNodes(this.element),n=[],r=0;r<i.length;r++){var s=i[r];n.push(s)}o.virtualElements.emptyNode(this.element);var a=document.createElement(this.element.tagName);o.applyBindingsToNode(a,{template:{nodes:n}},this.bindingContext),this.element.appendChild(a),this.controlsDescendantBindings=!0}return __extends(t,e),t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/operation/monitor/OperationMonitorViewModel",["require","exports","odsp-shared/base/ViewModel","../../../resources/ProviderResourceKeys","./OperationGroupViewModel","../../../bindings/preRender/PreRenderBinding","odsp-shared/utilities/knockout/Projections"],function(e,t,i,o,n,r){var s=function(e){function t(t){var i=this;e.call(this,t),this.addBindingHandlers({preRender:r.default});var s=t&&"boolean"==typeof t.expandGroups?t.expandGroups:!0,a=this.resources.consume(o.operation),l=t&&t.groups||a.groups;this.groups=this.addDisposable(l.map({mappingWithDisposeCallback:function(e){var o=new(i.resources.injected(n))({group:e,showIndividualOperations:s,onExecuteAction:t.onExecuteAction});return{mappedValue:o,dispose:function(){o.dispose()}}}}))}return __extends(t,e),t}(i);return s}),define("odsp-next/controls/operation/monitor/OperationMonitor.html",[],function(){return'<div class=OperationMonitor data-bind=preRender><div class=OperationMonitor-groups data-bind="foreach: groups"><div class=OperationMonitor-group><div class=OperationMonitor-item tabindex=-1 data-bind="classes: { base: css() }"><!--ko if: iconActions().length--><div class=OperationMonitor-itemIconActions data-bind="foreach: iconActions"><button class=OperationMonitor-itemIconAction data-bind="click: execute"><i data-bind="css: iconCss, attr: { title: title }"></i></button></div><!--/ko--><div class=OperationMonitor-itemName data-bind="bindableHtml: title"></div><!--ko if: showProgress--><div class=OperationMonitor-itemProgress data-bind="component: { name: \'ms-progress-bar\', params: { progress: progress, description: description } }"></div><!--/ko--><!--ko if: showDescription--><div class=OperationMonitor-itemDescription data-bind="text: description"></div><!--/ko--><!--ko if: buttonActions().length--><div class=OperationMonitor-itemButtonActions data-bind="foreach: buttonActions"><button class="ms-Button OperationMonitor-itemButtonAction" data-bind="click: execute"><span class=ms-Button-label data-bind="text: title"></span></button></div><!--/ko--></div><!--ko if: operations().length--><hr aria-hidden=true><div class=OperationMonitor-items data-bind="foreach: operations"><div class=OperationMonitor-item tabindex=-1 data-bind="classes: { base: css(), mappings: { \'OperationMonitor-item--icon\': !!iconName } }"><!--ko if: iconActions().length--><div class=OperationMonitor-itemIconActions data-bind="foreach: iconActions"><button class=OperationMonitor-itemIconAction data-bind="click: execute"><i data-bind="css: iconCss, attr: { title: title }"></i></button></div><!--/ko--><div class=OperationMonitor-itemType data-bind="component: { name: \'ms-file-type-icon\', params: { desiredSize: 48, iconName: iconName } }"></div><div class=OperationMonitor-itemName data-bind="text: title"></div><!--ko if: showProgress--><div class=OperationMonitor-itemProgress data-bind="component: { name: \'ms-progress-bar\', params: { progress: progress, description: description } }"></div><!--/ko--><div class=OperationMonitor-itemDescription data-bind="text: description"></div><!--ko if: buttonActions().length--><div class=OperationMonitor-itemButtonActions data-bind="foreach: buttonActions"><button class="ms-Button OperationMonitor-itemButtonAction" data-bind="click: execute"><span class=ms-Button-label data-bind="text: title"></span></button></div><!--/ko--></div></div><!--/ko--></div></div></div>'}),define("odsp-next/controls/operation/monitor/OperationMonitor.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".OperationMonitor-itemDescription,.OperationMonitor-itemName{font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-weight:400}.OperationMonitor hr{border:none;border-bottom:1px solid #eaeaea;margin:8px 0 16px}html[dir=rtl] .OperationMonitor hr{margin:8px 0 16px}.OperationMonitor-group:not(:last-child){padding-bottom:32px}.OperationMonitor-items .OperationMonitor-item:not(:last-child){margin-bottom:16px}.OperationMonitor-item{padding:0 40px 0 0}html[dir=rtl] .OperationMonitor-item{padding:0 0 0 40px}.OperationMonitor-item--icon .OperationMonitor-itemType{display:block}html[dir=ltr] .OperationMonitor-item--icon{padding-left:56px}html[dir=rtl] .OperationMonitor-item--icon{padding-right:56px}.OperationMonitor-itemName{color:#333;font-size:14px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding-top:4px;line-height:20px}.OperationMonitor-itemProgress{padding:8px 0}.OperationMonitor-itemDescription{color:#767676;font-size:11px;line-height:18px}.OperationMonitor-item--failed .OperationMonitor-itemDescription{color:#a80000;font-size:11px;word-wrap:break-word}.OperationMonitor-itemType{display:none;width:48px;height:48px;text-align:center;box-sizing:border-box;overflow:hidden;line-height:48px;margin-top:8px}html[dir=ltr] .OperationMonitor-itemType{float:left;margin-left:-56px}html[dir=rtl] .OperationMonitor-itemType{float:right;margin-right:-56px}.OperationMonitor-item:after{display:table;width:100%;content:'';clear:both}.OperationMonitor-itemIconActions{width:32px}html[dir=ltr] .OperationMonitor-itemIconActions{float:right;margin-right:-40px}html[dir=rtl] .OperationMonitor-itemIconActions{float:left;margin-left:-40px}.OperationMonitor-itemIconAction{width:32px;height:32px;padding-top:16px;text-align:center;box-sizing:border-box;overflow:hidden;background:0 0;border:0;cursor:pointer}.OperationMonitor-itemIconAction .ms-Icon{-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%);display:block}.OperationMonitor-itemButtonActions{width:218px}html[dir=ltr] .OperationMonitor-itemButtonActions{clear:right;margin-right:-40px}html[dir=rtl] .OperationMonitor-itemButtonActions{clear:left;margin-left:-40px}.OperationMonitor-itemButtonAction.ms-Button{margin-top:6px}.OperationMonitor-itemButtonAction.ms-Button .ms-Button,html[dir=rtl] .OperationMonitor-itemButtonAction.ms-Button .ms-Button{padding:4px 16px 6px}.OperationMonitor-itemButtonAction.ms-Button .ms-Button-label{font-size:12px}html[dir=ltr] .OperationMonitor-itemButtonAction.ms-Button+.ms-Button{margin-left:0}html[dir=rtl] .OperationMonitor-itemButtonAction.ms-Button+.ms-Button{margin-right:0}html[dir=ltr] .OperationMonitor-itemButtonAction.ms-Button:not(:last-child){margin-right:6px}html[dir=rtl] .OperationMonitor-itemButtonAction.ms-Button:not(:last-child){margin-left:6px}.AnchorOverlay .OperationMonitor{max-width:400px}")
});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/progress/bar/ProgressBarViewModel",["require","exports","odsp-shared/base/ViewModel","knockout"],function(e,t,i,o){var n=function(e){function t(t){var i=this;e.call(this,t),this.minimum=t.progress.minimum,this.maximum=t.progress.maximum,this.current=t.progress.current,this.description=t.description||o.observable(""),this.size=this.createComputed(function(){return i.maximum()-i.minimum()}),this.value=this.createComputed(function(){return i.current()-i.minimum()})}return __extends(t,e),t}(i);return n}),define("odsp-next/controls/progress/bar/ProgressBar.html",[],function(){return"<div class=ProgressBar role=progressbar data-bind=\"attr: { 'aria-valuemin': minimum, 'aria-valuemax': maximum, 'aria-valuenow': current, 'aria-valuetext': description }\"><div class=ProgressBar-track><!--ko if: size--><div class=ProgressBar-value data-bind=\"style: { width: value() / size() * 100 + '%' }\"></div><!--/ko--><!--ko ifnot: size--><div class=\"ProgressBar-value is-indeterminate\"></div><!--/ko--></div></div>"}),define("odsp-next/controls/progress/bar/ProgressBar.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ProgressBar-track{height:2px;position:relative;background-color:#eaeaea}.ProgressBar-value{position:absolute;top:0;bottom:0;background-color:#094AB2;transition:width 267ms cubic-bezier(.1,.9,.2,1)}html[dir=ltr] .ProgressBar-value{left:0}html[dir=rtl] .ProgressBar-value{right:0}")}),define("odsp-next/controls/progress/bar/ProgressBar",["require","exports","./ProgressBarViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ProgressBar.html","./ProgressBar.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-progress-bar",template:e("./ProgressBar.html"),viewModel:i});return n}),define("odsp-next/controls/operation/monitor/OperationMonitor",["require","exports","./OperationMonitorViewModel","odsp-shared/utilities/knockout/ComponentFactory","./OperationMonitor.html","./OperationMonitor.css","../../fileTypeIcon/FileTypeIcon","../../progress/bar/ProgressBar"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-operation-monitor",template:e("./OperationMonitor.html"),viewModel:i,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/ShowOperationsAction",["require","exports","../base/BaseAction","../resources/ProviderResourceKeys","odsp-utilities/async/Promise","../controls/operation/monitor/OperationMonitor","odsp-utilities/logging/events/Qos.event","../controls/operation/monitor/OperationMonitor.resx","knockout"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){e.call(this,t),this.name="ShowOperations",this._operationProvider=this.resources.consume(o.operation),this._panelProvider=this.resources.consume(o.panel),this._panel=l.observable()}return __extends(t,e),t.prototype.onIsAvailable=function(){return!!this._panel()||!!this._operationProvider.groups().length},t.prototype.onIsToggled=function(){return!!this._panel()},t.prototype.onExecute=function(){var e=this,t=this._panelProvider.requestPanel({title:a.strings.title,component:{name:r.tagName,params:{resources:this.resources}}});return this._panel(t),t.wait().then(function(){return e._panel(null),e._cleanup(),{resultType:s.ResultTypeEnum.Success}},function(t){return e._panel(null),e._cleanup(),n.default.wrapError(t)})},t.prototype._cleanup=function(){var e=this;this.async.setTimeout(function(){return e._operationProvider.cleanup()},0)},t}(i);return d});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/operation/commands/OperationCommandBuilder",["require","exports","odsp-shared/base/BaseModel","../../commands/CommandViewModel","../monitor/OperationMonitor","../../../resources/ProviderResourceKeys","../../../actions/ShowOperationsAction","../../../models/operation/OperationState","../../../models/operation/OperationType","../../../utilities/icons/Icon","../strings/OperationStringMappings","../../../models/operation/OperationVisibility","odsp-shared/utilities/knockout/Renderers","knockout","odsp-shared/utilities/knockout/Projections"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h){var m=function(e){function t(t,i){e.call(this,t),this._operationProvider=this.resources.consume(r.operation),this._completedOperations=h.observableArray(),this._currentOperations=h.observableArray(),this._suppressNotifications=t&&t.suppressNotifications||!1,this._context={count:this.createPureComputed(this._computeContextCount),states:this.createPureComputed(this._computeContextStates),error:this._operationProvider.overall.error,payloads:this._operationProvider.overall.payloads,progress:this._operationProvider.overall.progress},this._initializeCurrentOperation(),this._initializeCommand(t);var o=i&&i.openCommandExtenders||{rateLimit:{timeout:0,method:"notifyWhenChangesStop"}};this.createComputed(this._computeOpenCommand).extend(o);var n=i&&i.cleanupOperationsExtenders||{rateLimit:{timeout:0,method:"notifyWhenChangesStop"}};this.createComputed(this._computeCleanupOperations).extend(n)}return __extends(t,e),t.prototype._computeOpenCommand=function(){var e=this._completedOperations();e.length&&this.command.isOpen(!0)},t.prototype._computeCleanupOperations=function(){this.command.isOpen()||this.command.action.isToggled()||h.computedContext.isInitial()||(this._completedOperations.removeAll(),this._operationProvider.cleanup(!0))},t.prototype._computeContextCount=function(){return this._currentOperations().length?this._currentOperations.peek()[0].count():this._operationProvider.overall.count()},t.prototype._computeContextStates=function(){return this._currentOperations().length?this._currentOperations.peek()[0].states():this._operationProvider.overall.states()},t.prototype._initializeCurrentOperation=function(){var e=this;this._operationProvider.groups.map({mappingWithDisposeCallback:function(t){var i=t.state.subscribe(function(i){if(i===a.completed){var o=!e._suppressNotifications&&t.visibility<p.HidePeek?[t]:[];e._currentOperations.removeAll(o),(n=e._completedOperations).splice.apply(n,[0,e._completedOperations.peek().length].concat(o))}var n}),o=t.state.subscribe(function(i){(i===a.created||i===a.started||i===a.failed)&&e._currentOperations.unshift(t)});return{mappedValue:{},dispose:function(){i.dispose(),o.dispose()}}}})},t.prototype._initializeCommand=function(e){var t=this,i=e.isLabelVisible,r=void 0===i?h.observable(!1):i,a=e.isDisabled,l=void 0===a?!1:a;this.command=new(this.managed(o))({action:new(this.managed(s)),isLabelVisible:r,isDisabled:h.observable(l),isSideCommand:!0,iconObservable:this.createPureComputed(this._computeIcon),iconBadge:this.createPureComputed(this._computeIconBadge),textObservable:this.createPureComputed(this._computeText),payload:!this._suppressNotifications&&{name:n.tagName,params:{groups:this._completedOperations,expandGroups:!1,onExecuteAction:function(){t.command.isOpen(!1)}}},hasAnimation:h.observable(!0)})},t.prototype._computeText=function(){if(this._currentOperations().length){var e=this._currentOperations.peek()[0];if(e.visibility>=p.HidePeek)return"";var t=a[e.state()],i=l[e.type()],o=l[l.multiple],n=c.types[i],r=c.types[o],s=n.states[t],d=r.states[t],h=s&&(s.shortTitle||s.title)||d&&(d.shortTitle||d.title)||n.shortTitle||r.shortTitle;return u.renderText({context:this._context,resources:this.resources},h(this._context))}return""},t.prototype._computeIcon=function(){var e=this._operationProvider.overall.state();return e===a.created||e===a.started?d.progressActive:d.progress},t.prototype._computeIconBadge=function(){var e=this._operationProvider.overall.states();return e.failed?d.alertCicle:null},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=m});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/commandSets/OneUpCommandSet",["require","exports","odsp-shared/base/BaseModel","../../commands/CommandViewModel","../../../utilities/features/Features","../../../utilities/icons/Icon","../../../actions/OpenRelation","../../commands/Commands.resx","../../../resources/UtilityResourceKeys","../../../resources/ControlResourceKeys","../../../utilities/browser/WindowSize","../../operation/commands/OperationCommandBuilder","knockout","../../../controls/tabbedSharing/SharingTab","../../../utilities/optimizely/OptimizelyHelper","../../../controls/infoPane/InfoPane.resx","../../../controls/folderBuilder/FolderBuilder.resx"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v=a.strings,b=function(e){function t(t){e.call(this,t),this._legend=t.legend,this._actionMap=this.resources.consume(d.actionMap);var i=this.resources.consume(l.responsiveUI);this._initOptimizelyExperiments();var a=this.createComputed(function(){var e=i.formFactorSize();switch(e){case c.Small:case c.Medium:return!1;default:return!0}});this.overflowHostCommand=new o({text:v.OverflowCommandLabel,isLabelVisible:u.observable(!1),requiresChildren:!0,hidesMenuChevron:!0,collapseSingleChildCommands:!1,icon:r.ellipsis,hasIconOnly:!0,children:u.observableArray([])}),this.commands=u.observableArray([new o({textObservable:this._shareText,isHidden:this._shareHidden,isLabelVisible:a,iconObservable:this._shareIcon,action:!n.default.isFeatureEnabled(n.default.NextLegacyBundle)||n.default.isFeatureEnabled(n.default.SharingDialogRedux)?new(this.managed(this._actionMap.ShareByLinkAction)):new(this.managed(this._actionMap.ShareAction))({activeTab:h.invite})}),new o({text:v.copyLink,isHidden:this._getALinkHidden,isLabelVisible:a,icon:r.link,action:new(this.managed(this._actionMap.ShareAction))({activeTab:h.links})}),new o({text:v.addToSharedList,isLabelVisible:a,icon:r.plus,action:new(this.managed(this._actionMap.AddToSharedListAction))}),new o({text:v.removeFromSharedList,isLabelVisible:a,icon:r.x,action:new(this.managed(this._actionMap.RemoveFromSharedListAction))}),new(this.managed(o))({text:v.AddToAlbum,icon:r.pictureAdd,isLabelVisible:a,action:new(this.managed(this._actionMap.AddToAlbumAction))({})}),new(this.managed(o))({text:v.playSlideshow,icon:r.play,isLabelVisible:a,action:new(this.managed(this._actionMap.PlaySlideShowAction))({})}),new(this.managed(o))({text:v.rotate,icon:r.rotate,isLabelVisible:a,action:new(this.managed(this._actionMap.RotateAction))({})}),new(this.managed(o))({text:v.Download,icon:r.download,isLabelVisible:a,action:new(this.managed(this._actionMap.DownloadAction))({})}),new(this.managed(o))({text:v.DeleteItem,icon:r.trash,isLabelVisible:a,action:new(this.managed(this._actionMap.DeleteAction))({})}),new(this.managed(o))({text:v.viewOriginal,icon:r.picture,isLabelVisible:a,action:new(this.managed(this._actionMap.ViewOriginalAction))({})}),new o({text:v.viewInFolder,icon:r.folder,action:new(this.managed(this._actionMap.ViewInFolderAction)),isLabelVisible:a}),new(this.managed(o))({text:v.OrderPrints,icon:r.print,isLabelVisible:a,action:new(this.managed(this._actionMap.OrderPrintsAction))({})}),new(this.managed(o))({text:v.Embed,icon:r.embed,isLabelVisible:a,action:new(this.managed(this._actionMap.EmbedAction))({})}),new o({text:v.editTags,isLabelVisible:a,icon:r.tag,keys:["T"],action:new(this.managed(this._actionMap.EditTagsAction))}),this.overflowHostCommand,new(this.managed(p.default))({isLabelVisible:a}).command,new(this.managed(o))({textObservable:this._legend,isLabelVisible:u.observable(!0),isSideCommand:!0,isDisabled:u.observable(!0)}),new(this.managed(o))({icon:r.x,hasIconOnly:!0,isLabelVisible:u.observable(!1),action:new(this.managed(this._actionMap.OpenAction))({openRelation:s.current,ignoreHistory:!0,skipItemValidation:!0}),keys:["Esc"],isSideCommand:!0})])}return __extends(t,e),t.prototype._initOptimizelyExperiments=function(){var e=this;this._shareIcon=u.observable(r.share),this._shareText=u.observable(v.Share),this._shareHidden=u.observable(!1),this._getALinkHidden=u.observable(!0),m.GetVariationIdsMapForExperiment(m.SHARE_EXPERIMENT_ID).done(function(t){if(t&&t.length){var i=parseInt(t[0],10);i===m.SHARE_VARIATION_LINK_ID?(e._shareHidden(!0),e._getALinkHidden(!1)):i===m.SHARE_VARIATION_SHARE_LINK_ID?e._getALinkHidden(!1):i===m.SHARE_VARIATION_EMAIL_ID?(e._shareIcon(r.mail),e._shareText(g.strings.extractedTextEmailTypeName),e._getALinkHidden(!1)):i===m.SHARE_VARIATION_INVITE_ID&&(e._shareIcon(r.peopleAdd),e._shareText(f.strings.AddEditors),e._getALinkHidden(!1))}})},t}(i);return b});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/commandSets/SlideshowCommandSet",["require","exports","odsp-shared/base/BaseModel","../../commands/CommandViewModel","../../../utilities/icons/Icon","../../../actions/OpenRelation","../../commands/Commands.resx","../../../resources/UtilityResourceKeys","../../../resources/ControlResourceKeys","../../../utilities/browser/WindowSize","../../operation/commands/OperationCommandBuilder","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p){var u=s.strings,h=function(e){function t(t){e.call(this,t),this._legend=t.legend,this._actionMap=this.resources.consume(l.actionMap);var i=this.resources.consume(a.responsiveUI),s=this.createComputed(function(){var e=i.formFactorSize();switch(e){case d.Small:case d.Medium:case d.Large:return!1;default:return!0}});this.commands=p.observableArray([new(this.managed(o))({text:u.pauseSlideshow,isLabelVisible:s,icon:n.pause,action:new(this.managed(this._actionMap.StopSlideShowAction))({})}),new(this.managed(c.default))({isLabelVisible:s}).command,new(this.managed(o))({textObservable:this._legend,isLabelVisible:p.observable(!0),isSideCommand:!0,isDisabled:p.observable(!0)}),new(this.managed(o))({icon:n.x,isLabelVisible:p.observable(!1),action:new(this.managed(this._actionMap.OpenAction))({openRelation:r.current,ignoreHistory:!0,skipItemValidation:!0}),keys:["Esc"],isSideCommand:!0})])}return __extends(t,e),t}(i);return h}),define("odsp-next/utilities/browser/FeatureDetection",["require","exports"],function(){var e=function(){function e(){this._initializePointerEvents()}return e.prototype._initializePointerEvents=function(){this.arePointerEventsSupported=window.navigator&&(window.navigator.pointerEnabled||window.navigator.msPointerEnabled),this.pointerEvents=window.navigator&&!window.navigator.pointerEnabled&&window.navigator.msPointerEnabled?{pointerdown:"MSPointerDown",pointermove:"MSPointerMove",pointerup:"MSPointerUp",pointercancel:"MSPointerCancel",lostpointercapture:"MSLostPointerCapture",gotpointercapture:"MSGotPointerCapture"}:{pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",pointercancel:"pointercancel",lostpointercapture:"lostpointercapture",gotpointercapture:"gotpointercapture"}},e.instance=new e,e}();return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/idle/IdleBinding",["require","exports","../BaseBinding","odsp-utilities/domUtils/DomUtils","odsp-utilities/math/Point","../../utilities/browser/FeatureDetection","knockout"],function(e,t,i,o,n,r,s){function a(e,t){"use strict";for(;e;){if(e===t)return!0;e=o.getParent(e)}return!1}function l(e){"use strict";var t=e.relatedTarget||e.toElement;return!t||"HTML"===t.nodeName}var d=10,c=4e3,p=500,u=r.instance.pointerEvents,h=function(e){function t(t,i){e.call(this,t,i);var o=t.valueAccessor();this._isIdle=o.isIdle||s.observable(!1),this._isEnabled=o.isEnabled||s.observable(!0),this._isInIdleZone=s.observable(!1),this._lastTouchPosition=null,this._lastMousePosition=null,this._lastPointerExitPosition=null,this._pointerCount=0,this._pointers={},this._isMouseDown=!1,this._isSuspended=!1,this._idle=this.createComputed(this._computeIdle).extend({rateLimit:{timeout:c,method:"notifyWhenChangesStop"}}),this.createComputed(this._computeAwakenWhenNotEnabled),this.createComputed(this._computeSuspendIdleEvents),this.events.on(this.element,"click",this._onClick),this.events.on(document,"mousedown",this._onMouseDown,!0),this.events.on(document,"mousemove",this._onMouseMove,!0),this.events.on(document,"mouseup",this._onMouseUp,!0),this.events.on(document,"mouseout",this._onMouseOut,!0),r.instance.arePointerEventsSupported?(this.events.on(document,u.pointerdown,this._onPointerDown,!0),this.events.on(document,u.pointermove,this._onPointerMove,!0),this.events.on(document,u.pointerup,this._onPointerUp,!0),this.events.on(document,u.pointercancel,this._onPointerCancel,!0),this.events.on(document,u.lostpointercapture,this._onLostPointerCapture,!0)):(this.events.on(document,"touchstart",this._onTouchStart,!0),this.events.on(document,"touchmove",this._onTouchMove,!0),this.events.on(document,"touchend",this._onTouchEnd,!0),this.events.on(document,"touchcancel",this._onTouchCancel,!0))}return __extends(t,e),t.prototype._computeIdle=function(){var e=this._isIdle(),t=this._isInIdleZone(),i=this._isEnabled();!e&&t&&i&&this._isIdle(!0)},t.prototype._computeAwakenWhenNotEnabled=function(){var e=this._isEnabled();e||this._isIdle(!1)},t.prototype._resetPosition=function(){this._lastMousePosition=null,this._lastTouchPosition=null},t.prototype._onClick=function(e){if(0===e.button){var t=this._lastMousePosition,i=new n(e.clientX,e.clientY);this._resetPosition(),t&&i.distance(t)>=d||(this._isInIdleZone(!0),!this._isSuspended&&this._isEnabled.peek()&&this._isIdle(!this._isIdle.peek()))}},t.prototype._onMouseDown=function(e){if(0===e.button){this._isMouseDown=!0;var t=new n(e.clientX,e.clientY);this._lastMousePosition=t}},t.prototype._onMouseMove=function(e){var t=this._lastTouchPosition,i=this._lastMousePosition,o=new n(e.clientX,e.clientY);if(!(t&&o.distance(t)<d)){var r=a(e.target,this.element);this._isInIdleZone(r),!this._isMouseDown&&!this._pointerCount&&i&&o.distance(i)>=d&&(this._resetPosition(),!this._isSuspended&&this._isEnabled.peek()&&this._isIdle(!1)),this._lastMousePosition||(this._lastMousePosition=o)}},t.prototype._onMouseUp=function(e){0===e.button&&(this._isMouseDown=!1)},t.prototype._onMouseOut=function(e){if(!this._isMouseDown){var t=this._lastPointerExitPosition,i=new n(e.clientX,e.clientY);if(this._resetPosition(),this._lastPointerExitPosition=null,!(t&&i.distance(t)<d)&&l(e)){var o=this._isInIdleZone.peek();this._isInIdleZone(!0),o&&this._idle()}}},t.prototype._onTouchStart=function(e){this._pointerCount+=e.changedTouches.length,this._trackTouch(e),this._lastMousePosition=this._lastTouchPosition},t.prototype._onTouchMove=function(e){this._trackTouch(e)},t.prototype._onTouchEnd=function(e){this._pointerCount-=e.changedTouches.length,this._trackTouch(e)},t.prototype._onTouchCancel=function(e){this._pointerCount-=e.changedTouches.length},t.prototype._trackTouch=function(e){this._lastTouchPosition=new n(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},t.prototype._onPointerDown=function(e){"mouse"!==e.pointerType&&(this._pointers[e.pointerId]||(this._pointerCount++,this._trackPointer(e),this._lastMousePosition=this._lastTouchPosition))},t.prototype._onPointerMove=function(e){"mouse"!==e.pointerType&&this._pointers[e.pointerId]&&this._trackPointer(e)},t.prototype._onPointerUp=function(e){"mouse"!==e.pointerType&&(this._trackPointer(e),this._removePointer(e))},t.prototype._onPointerCancel=function(e){"mouse"!==e.pointerType&&(this._trackPointer(e),this._removePointer(e))},t.prototype._onLostPointerCapture=function(e){"mouse"!==e.pointerType&&this._removePointer(e)},t.prototype._trackPointer=function(e){var t=new n(e.clientX,e.clientY);this._pointers[e.pointerId]=t,this._lastTouchPosition=t},t.prototype._removePointer=function(e){this._pointers[e.pointerId]&&(this._lastPointerExitPosition=this._pointers[e.pointerId],delete this._pointers[e.pointerId],this._pointerCount--)},t.prototype._computeSuspendIdleEvents=function(){this._isIdle(),this._isSuspended=!0,this.async.clearTimeout(this._suspendIdleEventsTimeoutId),this._suspendIdleEventsTimeoutId=this.async.setTimeout(this._onSuspensionCompleted,p)},t.prototype._onSuspensionCompleted=function(){this._isSuspended=!1},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=h}),define("odsp-next/providers/shimmedControl/ShimmedControlProvider",["require","exports","knockout"],function(e,t,i){var o=function(){function e(){this.controls=i.observableArray([])}return e.prototype.requestShimmedControl=function(e){this.controls.push(e)},e.prototype.clearAllShimmedControls=function(){this.controls.removeAll()},e}();return o}),define("odsp-next/utilities/ui/FullScreen",["require","exports"],function(){var e=function(){function e(){}return e.isFullScreen=function(){var e=window.document;return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement},e.enterFullScreen=function(){var t=window.document,i=t.body;e.isFullScreen()||(i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen())},e.exitFullScreen=function(){var e=window.document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()},e.isFullScreenAllowed=function(){var e=window.document;return e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled},e}();return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/commands/SelectableCommandSet",["require","exports","./BaseCommandSet","odsp-shared/utilities/knockout/Translators"],function(e,t,i,o){var n=function(e){function t(t){var i=this;e.call(this,t),this._commandSet=t.commandSet,this.overflowHostCommand=this._commandSet.peek().overflowHostCommand||this.overflowHostCommand,this.createComputed(function(){i._commandsSubscription&&i._commandsSubscription.dispose(),i._commandSet().commands&&(i._commandsSubscription=o.replicateArray(i._commandSet().commands,i.commands))})}return __extends(t,e),t}(i.default);return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/OneUpViewModel",["require","exports","odsp-shared/base/ViewModel","../../resources/ControlResourceKeys","./resources/OneUpResourceKeys","../../models/selection/ItemSetSelectionModel","./commandSets/OneUpCommandSet","./commandSets/SlideshowCommandSet","../../bindings/clientRect/ClientRectBinding","../../bindings/keyboard/KeyboardBinding","../../bindings/idle/IdleBinding","../../actions/OpenRelation","../../bindings/focus/ChildFocusBinding","../../bindings/focus/PreserveFocusBinding","../../resources/PagesResourceKeys","../../providers/dialog/DialogProvider","../../providers/panel/PanelProvider","../../providers/transclusion/TransclusionProvider","../../resources/ProviderResourceKeys","odsp-shared/utilities/string/StringHelper","./OneUp.resx","../infoPane/InfoPane.resx","../../providers/shimmedControl/ShimmedControlProvider","../../utilities/features/Features","../../utilities/ui/FullScreen","../../models/itemSet/ItemSet","../../models/itemSet/ItemSetContent","../commands/SelectableCommandSet","odsp-shared/utilities/object/EqualityComparers","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_,k,T,S,w,P,I,C,E){var F=3e3,M=y.strings,O=function(e){function t(t){var i=this;e.call(this,t),this.isCarouselSlideLoaded=E.observable(!1),this.captionHasFocus=E.observable(!1),this.resources.expose(b.overlay,new(this.managed(v.default))({type:void 0})),this.agentProvider=this.resources.expose(n.agentProvider,new(this.managed(v.default))({type:void 0}));var s=new(this.managed(f));this.resources.expose(b.panel,s),this.resources.expose(b.dialog,new(this.managed(g))),this.resources.expose(b.shimmedControl,new(this.managed(k))),this.isNextLegacyBundleEnabled=!!T.default.isFeatureEnabled(T.default.NextLegacyBundle),this.isSlideShowModeEnabled=E.observable(!1),this.resources.expose(o.slideshowState,this),this.addCaptionLabel=E.observable(""),this.addBindingHandlers({clientRect:l.default,keyboard:d,hasChildFocus:u,preserveFocus:h,idle:c.default}),this.isEnabled=E.observable(!0),this.isRotating=E.observable(!1),this.isIdle=E.observable(!1),this._actionMap=this.resources.consume(o.actionMap),this.isInteractive=this.addDisposable(E.computed({read:function(){return!i.isEnabled()},write:function(e){return i.isEnabled(!e)},owner:this})),this.resources.expose(o.isInteractive,this.isInteractive),this._initializeItem(t),this._initializeItemSet(t),this._selectionModel=this.resources.expose(o.itemsSelection,new(this.managed(t.itemSetSelectionModel||r))),this.allocationRange=t.requiredRange,this.size=E.observable({width:0,height:0}),this.oneUp={isInteractive:this.isInteractive,isRotating:this.isRotating,size:this.size,slide:E.observable()},this.createComputed(this._computeSetCaptionLabel),this.isInfoPaneExpanded=this.resources.expose(m.files.isInfoPaneExpanded,E.observable(!1)),this.createComputed(this._computeHideInfoPaneWhenInteractive),this.caption=this.createComputed(this._computeCaption),this.legend=this.createComputed(this._computeLegend),this._initializeCommandSet(t),this._initializeActions(),this._initializeOpenParentWhenEmpty(),this._showPropertiesAction=new(this.managed(this._actionMap.ShowPropertiesAction))({useToggleBehavior:!0}),this.hasFocus=E.observable(!1),this.hasChildFocus=E.observable(!1),this.createComputed(this._computeRecoverFocus).extend({rateLimit:0}),this.createComputed(this._computeClearCaptionFocus),this.isIdleEnabled=this.createComputed(this._computeIsIdleEnabled),this.isAwake=this.createComputed(this._computeIsAwake),this.createComputed(this._computeSelectItem),this.createComputed(this._computeSetIdleOnInteractive)}return __extends(t,e),t.prototype.executeAction=function(e,t){return this.isEnabled()&&e.isAvailable()?(e.execute(t),!1):!0},t.prototype.enterSlideshowMode=function(){return S.enterFullScreen(),this.isSlideShowModeEnabled()?(this._timeOutId=this.async.setTimeout(this._startSlideshow,F),!0):!1},t.prototype.exitSlideshowMode=function(){return S.exitFullScreen(),this.isSlideShowModeEnabled(!1),this._timeOutId?(this.async.clearTimeout(this._timeOutId),!0):!1},t.prototype.onExitInfoPane=function(e){E.utils.toggleDomNodeCssClass(e,"OneUp-infoPane--closed",!0),this.async.setTimeout(function(){E.removeNode(e)},500)},t.prototype.focusOnContent=function(e){return this.isInfoPaneExpanded()&&this._showPropertiesAction.execute(e),!0},t.prototype.toggleInfoPaneExpanded=function(e){return this._showPropertiesAction.execute(e),!1},t.prototype.editCaption=function(e){return this.captionHasFocus(!0),this._showPropertiesAction.execute(e),!1},t.prototype.dispose=function(){S.exitFullScreen(),e.prototype.dispose.call(this)},t.prototype._startSlideshow=function(){return this.isSlideShowModeEnabled()?(this._timeOutId=this.async.setTimeout(this._startSlideshow,F),this.isCarouselSlideLoaded()&&!this.executeAction(this.openNext,null)?!0:void 0):!1},t.prototype._initializeItemSet=function(e){var t=this;this._sourceItemSet=e.itemSet,this.index=this.createPureComputed(this._computeIndex),this._isItemInSourceItemSet=this.createPureComputed(function(){return t.index()>-1});var i;this._itemSet=this.resources.expose(o.currentItemSet,this.createComputed(function(){var e,o=t._isItemInSourceItemSet();if(o)e=t._sourceItemSet();else{var n=t._sourceItemSet();e=new w,e.item=n.item,i&&i.dispose(),i=t.createComputed(function(){var i=new P;i.items=[t.item()],e.content(i)})}return e})),this._itemSet.equalityComparer=C.objectStrictEquality,this.items=E.observableArray(),this.items.equalityComparer=C.objectStrictEquality,this.createComputed(function(){t.items(t._itemSet().content().items)})},t.prototype._initializeItem=function(e){var t=this;this.item=E.observable(),this.item.equalityComparer=C.objectStrictEquality;var i=new(this.managed(this._actionMap.OpenAction))({item:this.createPureComputed(function(){return t.item()&&t.item()()}),openRelation:p.specified,preferCurrentView:!0,ignoreHistory:!0,skipItemValidation:!0});this.createComputed(function(){t.item(e.item())}),this.createComputed(function(){t.item()!==e.item.peek()&&i.isAvailable.peek()&&i.execute(null).done()}),this.updateCaptionAction=new(this.managed(this._actionMap.UpdateCaptionAction))({item:this.createPureComputed(function(){var e=t.item();return e&&e()})})},t.prototype._computeIndex=function(){return this._sourceItemSet().content().items.indexOf(this.item())},t.prototype._initializeActions=function(){this.openPrevious=new(this.managed(this._actionMap.OpenAction))({openRelation:p.specified,item:this.createComputed(this._computePreviousItem),ignoreHistory:!0,preferCurrentView:!0,skipItemValidation:!0}),this.openNext=new(this.managed(this._actionMap.OpenAction))({openRelation:p.specified,item:this.createComputed(this._computeNextItem),ignoreHistory:!0,preferCurrentView:!0,skipItemValidation:!0})},t.prototype._computePreviousItem=function(){var e=this.index();if(0>e)return null;for(var t,i=e;i>-1&&(t=E.utils.unwrapObservable(this.items()[i-1]),this.isSlideShowModeEnabled.peek())&&(!t||t.video);)i--;return t},t.prototype._computeNextItem=function(){var e=this.index();if(0>e)return null;for(var t,i=e,o=this.items().length;o>i&&(t=E.utils.unwrapObservable(this.items()[i+1]),this.isSlideShowModeEnabled.peek())&&(!t||t.video);)i++;return!t&&this.isSlideShowModeEnabled.peek()&&this.exitSlideshowMode(),t},t.prototype._initializeOpenParentWhenEmpty=function(){var e=this,t=new(this.managed(this._actionMap.OpenAction))({openRelation:p.current,ignoreHistory:!0,skipItemValidation:!0}),i=this.items().length;this.addDisposable(this.items.subscribe(function(){i=e.items().length},null,"beforeChange")),this.createComputed(function(){e.items().length||!i||e._itemSet.peek().isPlaceholder||e._itemSet.peek().item.peek().isPlaceholder||t.isAvailable()&&t.execute(null)})},t.prototype._computeClearCaptionFocus=function(){this.isInfoPaneExpanded()||this.captionHasFocus(!1)},t.prototype._initializeCommandSet=function(e){var t=this,i=e.commandSet||new(this.managed(s))({legend:this.legend}),o=e.slideshowCommandSet||new(this.managed(a))({legend:this.legend});this.commandSet=new(this.managed(I))({commandSet:this.createPureComputed(function(){return t.isSlideShowModeEnabled()?o:i})})},t.prototype._computeRecoverFocus=function(){this.hasChildFocus()||this.hasFocus(!0)},t.prototype._computeSetCaptionLabel=function(){var e=this.item(),t=e&&e.peek(),i=t&&t.photo,o=i?_.strings.captionAddCaption:_.strings.captionAddDescription;this.addCaptionLabel(o)},t.prototype._computeHideInfoPaneWhenInteractive=function(){this.isEnabled()||this.isInfoPaneExpanded(!1)},t.prototype._computeLegend=function(){var e,t=this.index();if(t>-1){var i=this._itemSet();return x.format(M.legendFormat,t+1,i.content().items.length)}return e=""},t.prototype._computeCaption=function(){var e=E.utils.unwrapObservable(this.item());return e&&e.caption},t.prototype._computeIsAwake=function(){var e=this.isInfoPaneExpanded(),t=this.isIdle();
return e||!t},t.prototype._computeIsIdleEnabled=function(){var e=this.isInfoPaneExpanded(),t=this.oneUp.slide();return(!t||t.isIdleEnabled())&&!e},t.prototype._computeSelectItem=function(){var e=this.item();this._selectionModel.selection()[0]!==e&&(this._selectionModel.clear(),this._selectionModel.setItemSelected(e,!0))},t.prototype._computeSetIdleOnInteractive=function(){var e=this.isInteractive();this.isIdleEnabled.peek()&&this.isIdle(e)},t}(i);return O}),define("odsp-next/controls/oneUp/OneUp.html",[],function(){return'<div class="OneUp od-theme--darkTransparent" tabindex=-1 data-bind="preserveFocus, hasFocus: hasFocus, hasChildFocus: hasChildFocus, css: { \'OneUp--hasInfoPane\': isInfoPaneExpanded, \'OneUp--awake\': isAwake, \'OneUp--enabled\': isEnabled, \'OneUp--hasItems\': items().length }, clientRect: { size: size }"><div class=OneUp-commandBar data-bind="component: { name: \'ms-command-bar\', params: { commandSet: commandSet, isMobile: false } }"></div><div class=OneUp-carousel data-bind="component: { name: \'ms-carousel\', params: { item: item, items: items, allocationRange: allocationRange, isLoaded: isCarouselSlideLoaded, isEnabled: isEnabled, isRotating: isRotating } }, idle: { isIdle: isIdle, isEnabled: isIdleEnabled }, click: $component.focusOnContent.bind($component), automation: \'carousel\'"><!--ko component: {\n name: \'od-one-up-slide\',\n params: {\n slide: $host,\n oneUp: $component.oneUp\n }\n }--><!--/ko--></div><!--ko with: openPrevious--><div class="OneUp-flipper OneUp-flipper--previous" data-bind="css: { \'OneUp-flipper--available\': isAvailable }"><button class=OneUp-button data-bind="click: $component.executeAction.bind($component), keyboard: { target: document, mappings: { Left: $component.executeAction.bind($component) }, useRtlMappings: true, preventDefault: true }, automation: \'previousButton\'"><i class="ms-Icon ms-Icon--chevronLeft"></i></button></div><!--/ko--><!--ko with: openNext--><div class="OneUp-flipper OneUp-flipper--next" data-bind="css: { \'OneUp-flipper--available\': isAvailable }"><button class=OneUp-button data-bind="click: $component.executeAction.bind($component), keyboard: { target: document, mappings: { Right: $component.executeAction.bind($component) }, useRtlMappings: true, preventDefault: true }, automation: \'nextButton\'"><i class="ms-Icon ms-Icon--chevronRight"></i></button></div><!--/ko--><div class=OneUp-detailsBar><!--ko if: $component.agentProvider.contexts().length--><div class=OneUp-agent data-bind="component: { name: \'od-transclusion-host\', params: { provider: $component.agentProvider } }"></div><!--/ko--><div class=OneUp-caption data-bind="click: editCaption, visible: caption() !== undefined, css: { \'OneUp-caption--existing\': caption, \'OneUp-caption--editable\': updateCaptionAction.isAvailable }"><!--ko ifnot: caption--><div class=OneUp-editCaption data-bind="visible: updateCaptionAction.isAvailable()"><button class=OneUp-button><i class="ms-Icon ms-Icon--pencil"></i></button></div><div class=OneUp-caption-clipper data-bind="visible: updateCaptionAction.isAvailable()"><span data-bind="text: addCaptionLabel"></span></div><!--/ko--><!--ko if: caption--><div class=OneUp-caption-clipper><span data-bind="text: caption"></span></div><div class=OneUp-editCaption data-bind="visible: updateCaptionAction.isAvailable()"><button class=OneUp-button><i class="ms-Icon ms-Icon--pencil"></i></button></div><!--/ko--></div><div class=OneUp-options><button class="OneUp-info OneUp-button" data-bind="click: toggleInfoPaneExpanded, automation: \'infoButton\'"><i class="ms-Icon ms-Icon--circle" data-bind="css: isInfoPaneExpanded() ? \'ms-Icon--infoOpen\' : \'ms-Icon--info\'"></i></button></div></div><div class=OneUp-paneHost data-bind="template: { foreach: [{ item: item }], if: isInfoPaneExpanded, beforeRemove: $component.onExitInfoPane.bind($component) }"><div class=OneUp-infoPane data-bind="component: { name: \'ms-info-pane\', params: { showPreview: false, captionHasFocus: $component.captionHasFocus } }"></div></div><!--ko if: isNextLegacyBundleEnabled--><div class=OneUp-shimmedControlsHost data-bind="component: { name: \'od-shimmed-control\' }"></div><!--/ko--><!--ko component: { name: \'od-dialog-host\' }--><!--/ko--><!--ko component: { name: \'ms-panel-host\' }--><!--/ko--><!--ko component: { name: \'od-overlay-host\' }--><!--/ko--></div>'}),define("odsp-next/controls/oneUp/OneUp.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".OneUp{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;background-color:#000;outline:0}.OneUp-button{border:0;background:0 0;cursor:pointer;color:#eaeaea;width:30px;height:30px;box-sizing:content-box}.OneUp-button:hover{background-color:transparent;color:#fff}.OneUp-commandBar,.OneUp-detailsBar,.OneUp-infoPane{background-color:rgba(0,0,0,.7)}.OneUp-button .ms-Icon{display:block;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);font-size:17px}.OneUp-agent,.OneUp-carousel,.OneUp-commandBar,.OneUp-detailsBar{position:absolute;left:0;right:0}.OneUp-commandBar,.OneUp-detailsBar,.OneUp-flipper{visibility:hidden;opacity:0}.OneUp-commandBar{top:-40px;z-index:2;padding:0 8px;height:40px;transition:visibility 0s linear 267ms,opacity 267ms linear,top 267ms linear}.OneUp-commandBar .CommandBar{background:0 0;padding:0;height:40px}.OneUp-agent,.OneUp-detailsBar,.OneUp-flipper .OneUp-button{background-color:rgba(0,0,0,.7)}html[dir=ltr] .OneUp-commandBar .CommandBar-sideArea .CommandBarItem:last-child{margin-right:0}html[dir=rtl] .OneUp-commandBar .CommandBar-sideArea .CommandBarItem:last-child{margin-left:0}.CommandBar-center{text-align:center}.OneUp-carousel{top:0;bottom:0;z-index:1}.OneUp-detailsBar{transition:visibility 0s linear 267ms,opacity 267ms linear,bottom 267ms linear;bottom:-80px;height:80px;color:#fff;z-index:2}.OneUp-agent{bottom:100%}.OneUp--enabled .OneUp-commandBar{top:0}.OneUp--enabled .OneUp-detailsBar{bottom:0}.OneUp--awake .OneUp-commandBar,.OneUp--awake .OneUp-detailsBar{visibility:inherit;opacity:1;transition-delay:0s,0s,0s}.OneUp--enabled.OneUp--awake .OneUp-flipper{transition-delay:0s,0s;visibility:inherit;opacity:1}.OneUp-caption{display:table;margin:auto;height:100%;cursor:pointer}.OneUp-caption-clipper{display:table-cell;max-width:600px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;vertical-align:middle;font-size:14px}.lg .OneUp-caption-clipper{max-width:510px}.md .OneUp-caption-clipper{max-width:345px}.sm .OneUp-caption-clipper{max-width:150px}.OneUp-editCaption{display:table-cell;position:relative}.OneUp-editCaption .OneUp-button{padding:0;margin-top:50px}.OneUp-options{position:absolute;top:0;bottom:0;text-align:right}html[dir=ltr] .OneUp-options{right:8px}html[dir=rtl] .OneUp-options{left:8px}.OneUp-info{position:absolute;top:0;display:block;padding:20px 8px;height:40px}html[dir=ltr] .OneUp-info{right:0}html[dir=rtl] .OneUp-info{left:0}.OneUp-paneHost{position:absolute;visibility:hidden;left:0;right:0;top:35%;bottom:80px;color:#fff;overflow:hidden;transition:visibility 267ms linear 267ms;z-index:2}.OneUp-flipper,.OneUp-infoPane{top:0;bottom:0;position:absolute}.OneUp-infoPane{left:0;right:0;-webkit-animation:oneup-enter-infopane 267ms;animation:oneup-enter-infopane 267ms;visibility:hidden;opacity:1;overflow-y:auto;-webkit-overflow-scrolling:touch}.OneUp-infoPane--closed{-webkit-animation:oneup-exit-infopane 267ms;animation:oneup-exit-infopane 267ms;opacity:0;visibility:hidden;transition:visibility 0s linear 267ms,opacity 267ms linear}.OneUp--hasInfoPane .OneUp-infoPane{visibility:inherit;opacity:1}.OneUp--hasInfoPane .OneUp-paneHost{visibility:inherit;transition-delay:0s}.OneUp--hasInfoPane .OneUp-agent,.OneUp--hasInfoPane .OneUp-caption{visibility:hidden}.OneUp--hasInfoPane .OneUp-detailsBar{background:rgba(0,0,0,.7)}.OneUp-flipper{transition:visibility 0s linear 267ms,opacity 267ms linear;z-index:1}.OneUp-flipper .OneUp-button{height:40px;position:absolute;padding:0 3px;opacity:0;visibility:hidden;transition:visibility 0s linear 267ms,opacity 267ms linear,-webkit-transform 267ms linear;transition:visibility 0s linear 267ms,opacity 267ms linear,transform 267ms linear;transition:visibility 0s linear 267ms,opacity 267ms linear,transform 267ms linear,-webkit-transform 267ms linear;top:50%;-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%)}.OneUp-slide,.od-OneUpVideo{top:0;bottom:0;position:absolute}.OneUp-flipper .OneUp-button:hover{background-color:rgba(102,102,102,.6)}.OneUp-flipper .OneUp-button .ms-Icon{font-size:28px}html[dir=ltr] .OneUp-flipper--previous{left:0}html[dir=rtl] .OneUp-flipper--previous{right:0}html[dir=ltr] .OneUp-flipper--previous .OneUp-button{left:0;-webkit-transform:translate(25%,-50%);-ms-transform:translate(25%,-50%);transform:translate(25%,-50%)}html[dir=rtl] .OneUp-flipper--previous .OneUp-button{right:0;-webkit-transform:translate(-25%,-50%) scaleX(-1);-ms-transform:translate(-25%,-50%) scaleX(-1);transform:translate(-25%,-50%) scaleX(-1)}html[dir=ltr] .OneUp-flipper--previous.OneUp-flipper--available .OneUp-button{-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%)}html[dir=rtl] .OneUp-flipper--previous.OneUp-flipper--available .OneUp-button{-webkit-transform:translate(0,-50%) scaleX(-1);-ms-transform:translate(0,-50%) scaleX(-1);transform:translate(0,-50%) scaleX(-1)}html[dir=ltr] .OneUp-flipper--next{right:0}html[dir=rtl] .OneUp-flipper--next{left:0}html[dir=ltr] .OneUp-flipper--next .OneUp-button{right:0;-webkit-transform:translate(-25%,-50%);-ms-transform:translate(-25%,-50%);transform:translate(-25%,-50%)}html[dir=rtl] .OneUp-flipper--next .OneUp-button{left:0;-webkit-transform:translate(25%,-50%) scaleX(-1);-ms-transform:translate(25%,-50%) scaleX(-1);transform:translate(25%,-50%) scaleX(-1)}html[dir=ltr] .OneUp-flipper--next.OneUp-flipper--available .OneUp-button{-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%)}html[dir=rtl] .OneUp-flipper--next.OneUp-flipper--available .OneUp-button{-webkit-transform:translate(0,-50%) scaleX(-1);-ms-transform:translate(0,-50%) scaleX(-1);transform:translate(0,-50%) scaleX(-1)}.OneUp-flipper--available .OneUp-button{opacity:1;visibility:inherit;transition-delay:0s,0s,0s}.OneUp-commandBar .CommandBarItem.is-disabled{visibility:hidden}.OneUp--hasItems .CommandBarItem.is-disabled{visibility:inherit}.OneUp-slide{left:0;right:0;background:#000}html[dir=ltr] .OneUp-slide:before,html[dir=rtl] .OneUp-slide:after{right:100%}.OneUp-slide:after,.OneUp-slide:before{display:block;position:absolute;width:2%;height:100%;content:'';background:#000}html[dir=ltr] .OneUp-slide:after,html[dir=rtl] .OneUp-slide:before{left:100%}.od-OneUpVideo{left:0;right:0}.OneUp-other{position:absolute;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.OneUp-photo .ThumbnailTile-thumbnail,.OneUp-photo .od-ImageStack-tile{background-color:#000}.OneUp-infoPane .InfoPane-removeTag:hover,.OneUp-infoPane .InfoPane-tag,.OneUp-infoPane .InfoPane-tagLink:hover,.od-Focus--enabled .OneUp-infoPane .InfoPane-removeTag:focus,.od-Focus--enabled .OneUp-infoPane .InfoPane-tagLink:focus{background-color:rgba(0,0,0,.25)}.OneUp-otherTile{width:240px;height:240px;margin:auto;position:relative}@-webkit-keyframes oneup-enter-infopane{from{-webkit-transform:translate(0,5%);transform:translate(0,5%);opacity:0}to{-webkit-transform:none;transform:none;opacity:1}}@keyframes oneup-enter-infopane{from{-webkit-transform:translate(0,5%);transform:translate(0,5%);opacity:0}to{-webkit-transform:none;transform:none;opacity:1}}@-webkit-keyframes oneup-exit-infopane{from{-webkit-transform:none;transform:none;opacity:1}to{-webkit-transform:translate(0,5%);transform:translate(0,5%);opacity:0}}@keyframes oneup-exit-infopane{from{-webkit-transform:none;transform:none;opacity:1}to{-webkit-transform:translate(0,5%);transform:translate(0,5%);opacity:0}}.OneUp-infoPane a.od-EditableText-readOnlyArea,.OneUp-infoPane a.od-EditableText-readOnlyArea:hover,.OneUp-infoPane a.od-EditableText-readOnlyArea:visited,.OneUp-infoPane table{color:#fff}.OneUp-infoPane a,.OneUp-infoPane a:visited{color:#88bded}.OneUp-infoPane a:hover{color:#2f69c0}.OneUp-infoPane .InfoPane{max-width:1366px;margin:0 auto}.OneUp-infoPane .CaptionSection{margin-top:20px}.OneUp-infoPane .CaptionSection .od-EditableText-textArea,.OneUp-infoPane .CaptionSection a.od-EditableText-readOnlyArea--interactive:hover{border:1px solid transparent}.OneUp-infoPane .CaptionSection .od-EditableText-textArea,.OneUp-infoPane .CaptionSection a.od-EditableText-readOnlyArea:hover{border-bottom-color:#fff}.OneUp-infoPane .InfoPane-sectionHeaderText{font-family:'Segoe UI Light WestEuropean','Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:21px;font-weight:400;color:#fff}.OneUp-infoPane .InfoPane-tag{border-color:transparent}.OneUp-infoPane a.InfoPane-removeTag{color:#eaeaea}.OneUp-infoPane .SharingSection,.OneUp-infoPane .SharingSection-shareScopeHeader,.OneUp-infoPane .ms-Persona-primaryText{color:#fff}.OneUp-infoPane .InfoPane-extractedText-label,.OneUp-infoPane .InfoPaneSection-information th,.OneUp-infoPane .ms-Persona-sharingRole-Chevron,.OneUp-infoPane .ms-Persona-sharingRole-Text{color:#a6a6a6}.OneUp-infoPane .BingMap-controls-icon .ms-Icon,.OneUp-infoPane .InfoPane-comments div.cc2_main div.cc2_main_cntn div.cc2_txt,.OneUp-infoPane .InfoPane-comments div.cc2_main div.cc2_main_cntn span.cc2_dnmmain a,.OneUp-infoPane .od-EditableText-textArea{color:#fff}.OneUp-infoPane .SharingSection-shareLink{line-height:36px}.OneUp-infoPane .BingMap-controls{background-color:rgba(255,255,255,.15);border-color:transparent}.OneUp-infoPane .InfoPane-comments div.cc2_main div.cc2_main_cntn textarea.cc2_ta{color:#fff!important;background-color:transparent}.OneUp-infoPane .InfoPane-comments div.cc2_main div.cc2_main_cntn span.cc2_tsmain{color:rgba(255,255,255,.5)}.od-userSelect--enabled .OneUp-infoPane{-webkit-touch-callout:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.OneUp .od-Panel,.OneUp .od-PanelOverlay{top:0}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/bindings/pan/PanBinding",["require","exports","knockout","odsp-utilities/math/Point","odsp-utilities/math/Transform","../BaseBinding","odsp-utilities/object/ObjectUtil","../../utilities/browser/FeatureDetection"],function(e,t,i,o,n,r,s,a){function l(e,t){"use strict";return e.translate.abs()>=h||Math.abs(t)>=h}function d(e){"use strict";return e}var c,p=a.instance.pointerEvents;!function(e){e[e.none=0]="none",e[e.pointer=1]="pointer",e[e.touch=2]="touch",e[e.mouse=3]="mouse",e[e.wheel=4]="wheel"}(c||(c={}));var u,h=10,m=18;u={0:function(e){return e},1:function(e){return e*m},2:function(){return.5*window.innerHeight}};var g=300,f=300,v=function(e){function t(t){e.call(this,t);var o=t.valueAccessor();this._transformV=o.transform||i.observable(n.IDENTITY),this._isActive=o.isActive||i.observable(!1),this._mayStartPan=o.mayStartPan||l,this._constrainScale=o.constrainScale||d,this._gestureMode=i.observable(c.none),this._touchCount=0,this._pointers={},this._pointerCount=0,this._initialTransformV=i.observable(n.IDENTITY),this._initialTransformV.equalityComparer=s.deepCompare,this._incrementTransformPx=i.observable(n.IDENTITY),this._incrementTransformPx.equalityComparer=s.deepCompare,this._initialCenterPx=i.observable(),this._initialCenterPx.equalityComparer=s.deepCompare,this._initialRadius=i.observable(),this._incrementTransformV=this.createComputed(this._computeIncrementTransformV),this._incrementTransformV.equalityComparer=s.deepCompare,this.createComputed(this._computeResetTransform),this.createComputed(this._computeTransform),this._isWheeling=this.createComputed(this._computeIsWheeling),this.createComputed(this._computeStopWheeling).extend({rateLimit:{timeout:f,method:"notifyWhenChangesStop"}}),this.createComputed(this._computeEndWheel),a.instance.arePointerEventsSupported?this.events.on(this.element,p.pointerdown,this._onPointerDown):(this.events.on(this.element,"touchstart",this._onTouchStart),this.events.on(this.element,"mousedown",this._onMouseDown)),this.events.on(this.element,"wheel",this._onWheel),this.events.on(this.element,"contextmenu",function(){return!1})}return __extends(t,e),t.prototype._computeIncrementTransformV=function(){var e=this._size||{width:0,height:0},t=this._incrementTransformPx();return new n(new o(t.translate.x/e.width,t.translate.y/e.height),t.scale)},t.prototype._computeResetTransform=function(){this._initialCenterPx()||(this._initialTransformV(this._transformV()),this._incrementTransformPx(n.IDENTITY))},t.prototype._computeTransform=function(){this._isActive()&&this._transformV(this._incrementTransformV().multiply(this._initialTransformV.peek()))},t.prototype._computeIsWheeling=function(){return this._gestureMode()===c.wheel},t.prototype._computeStopWheeling=function(){var e=this._isWheeling();this._transformV(),e&&this._gestureMode(c.none)},t.prototype._computeEndWheel=function(){var e=this._isWheeling();e||(this._clearGesture(),this._isActive(!1))},t.prototype._onWheel=function(e){e.preventDefault(),this._updateSize();var t=this._clientToElementTransform.apply(new o(e.clientX,e.clientY)),i=u[e.deltaMode](e.deltaY);this._handleWheel(t,i)},t.prototype._handleWheel=function(e,t){var i=Math.pow(2,-t/g);this._initialCenterPx.peek()||(this._gestureMode(c.wheel),this._resetGesture([e.add(new o(-this._size.width/2,-this._size.height/2)),e.add(new o(this._size.width/2,this._size.height/2))]));var r=n.zoom(e.subtract(this._initialCenterPx.peek()),e,i);this._gestureMode.peek()===c.wheel&&this._continueGesture(this._gesturePoints.map(function(e){return r.apply(e)}))},t.prototype._onMouseDown=function(e){if(0===e.button){this._updateSize();var t=this._clientToElementTransform.apply(new o(e.clientX,e.clientY));this._gestureMode(c.mouse);var i;i=e.ctrlKey?[new o(this._size.width/2,this._size.height/2).scale(2).subtract(t),t]:[t],this._resetGesture(i),this.events.off(this.element,"mousedown",this._onMouseDown),this.events.on(document,"mousedown",this._onMouseDown,!0),this.events.on(document,"mouseup",this._onMouseUp,!0),this.events.on(document,"mousemove",this._onMouseMove,!0)}},t.prototype._onMouseMove=function(e){e.preventDefault(),this._updateSize(!1);var t,i=this._clientToElementTransform.apply(new o(e.clientX,e.clientY));t=e.ctrlKey?[new o(this._size.width/2,this._size.height/2).scale(2).subtract(i),i]:[i],this._gestureMode.peek()===c.mouse&&this._continueGesture(t)},t.prototype._onMouseUp=function(e){0===e.button&&(this._isActive()&&e.preventDefault(),this._updateSize(!1),this._gestureMode.peek()===c.mouse&&(this._clearGesture(),this._gestureMode(c.none)),this._isActive(!1),this.events.off(document,"mousedown",this._onMouseDown,!0),this.events.off(document,"mouseup",this._onMouseUp,!0),this.events.off(document,"mousemove",this._onMouseMove,!0),this.events.on(this.element,"mousedown",this._onMouseDown))},t.prototype._onTouchStart=function(e){this._isActive.peek()&&e.preventDefault(),this._updateSize(0===this._touchCount);var t=this._touchCount;this._touchCount+=e.changedTouches.length,!t&&this._touchCount?(this._gestureMode(c.touch),this.events.off(this.element,"touchstart",this._onTouchStart),this.events.on(document,"touchstart",this._onTouchStart,!0),this.events.on(document,"touchmove",this._onTouchMove,!0),this.events.on(document,"touchend",this._onTouchEnd,!0),this.events.on(document,"touchcancel",this._onTouchCancel,!0)):this._gestureMode.peek()===c.touch&&this._clearGesture(),this._gestureMode.peek()===c.touch&&this._resetGesture(this._getPointsFromTouches(e.touches))},t.prototype._onTouchMove=function(e){e.preventDefault(),this._updateSize(!1),this._continueGesture(this._getPointsFromTouches(e.touches))},t.prototype._onTouchEnd=function(e){this._isActive.peek()&&e.preventDefault(),this._updateSize(!1),this._removeTouches(e)},t.prototype._onTouchCancel=function(e){this._updateSize(!1),this._removeTouches(e)},t.prototype._removeTouches=function(e){var t=this._touchCount;this._touchCount-=e.changedTouches.length,this._gestureMode.peek()===c.touch&&this._clearGesture(),t&&!this._touchCount?(this._gestureMode.peek()===c.touch&&this._gestureMode(c.none),this._isActive(!1),this.events.off(document,"touchstart",this._onTouchStart,!0),this.events.off(document,"touchmove",this._onTouchMove,!0),this.events.off(document,"touchend",this._onTouchEnd,!0),this.events.off(document,"touchcancel",this._onTouchCancel,!0),this.events.on(this.element,"touchstart",this._onTouchStart)):this._gestureMode.peek()===c.touch&&this._resetGesture(this._getPointsFromTouches(e.touches))},t.prototype._onPointerDown=function(e){if(!this._pointers[e.pointerId]){this._isActive.peek()&&e.preventDefault(),this._updateSize(0===this._pointerCount),this._pointers[e.pointerId]=this._clientToElementTransform.apply(new o(e.clientX,e.clientY));var t=this._pointerCount;this._pointerCount++,!t&&this._pointerCount?(this._gestureMode(c.pointer),this.events.off(this.element,p.pointerdown,this._onPointerDown),this.events.on(document,p.pointerdown,this._onPointerDown,!0),this.events.on(document,p.pointermove,this._onPointerMove,!0),this.events.on(document,p.pointerup,this._onPointerUp,!0),this.events.on(document,p.pointercancel,this._onPointerCancel,!0),this.events.on(document,p.lostpointercapture,this._onLostPointerCapture,!0)):this._gestureMode.peek()===c.pointer&&this._clearGesture(),this._gestureMode.peek()===c.pointer&&this._resetGesture(this._getPointsFromPointers())}},t.prototype._onPointerMove=function(e){this._pointers[e.pointerId]&&(e.preventDefault(),this._updateSize(!1),this._pointers[e.pointerId]=this._clientToElementTransform.apply(new o(e.clientX,e.clientY)),this._gestureMode.peek()===c.pointer&&this._continueGesture(this._getPointsFromPointers()))},t.prototype._onPointerUp=function(e){this._isActive()&&e.preventDefault(),this._updateSize(!1),this._removePointers(e)},t.prototype._onPointerCancel=function(e){this._updateSize(!1),this._removePointers(e)},t.prototype._onLostPointerCapture=function(e){this._updateSize(!1),this._removePointers(e)},t.prototype._removePointers=function(e){if(this._pointers[e.pointerId]){delete this._pointers[e.pointerId];var t=this._pointerCount;this._pointerCount--,this._gestureMode.peek()===c.pointer&&this._clearGesture(),t&&!this._pointerCount?(this._gestureMode.peek()===c.pointer&&this._gestureMode(c.none),this._isActive(!1),this.events.off(document,p.pointerdown,this._onPointerDown,!0),this.events.off(document,p.pointermove,this._onPointerMove,!0),this.events.off(document,p.pointerup,this._onPointerUp,!0),this.events.off(document,p.pointercancel,this._onPointerCancel,!0),this.events.off(document,p.lostpointercapture,this._onLostPointerCapture,!0),this.events.on(this.element,p.pointerdown,this._onPointerDown)):this._gestureMode.peek()===c.pointer&&this._resetGesture(this._getPointsFromPointers())}},t.prototype._clearGesture=function(){this._gesturePoints=null,this._initialCenterPx(null)},t.prototype._continueGesture=function(e){this._gesturePoints=e,this._initialCenterPx.peek()||this._resetGesture(e);var t,i=this._getCenter(e),r=this._getRadius(e,i),s=this._initialRadius.peek();t=0!==r&&0!==s?r/s:1;var a=this._initialTransformV.peek().scale*t,l=this._constrainScale(a),d=l/a,c=this._initialCenterPx.peek(),p=n.zoom(o.ORIGIN,c,t*d),u=new n(i.subtract(c));this._incrementTransformPx(u.multiply(p)),!this._isActive.peek()&&this._mayStartPan(this._incrementTransformPx.peek(),r-s,e)&&this._isActive(!0)},t.prototype._resetGesture=function(e){this._gesturePoints=e;var t=this._getCenter(e),i=this._getRadius(e,t);this._initialCenterPx(t),this._initialRadius(i)},t.prototype._getCenter=function(e){for(var t=o.ORIGIN,i=0;i<e.length;i++)t=t.add(e[i]);return t.scale(1/e.length)},t.prototype._getRadius=function(e,t){for(var i=0,o=0;o<e.length;o++)i+=e[o].distance(t);return i/e.length},t.prototype._getPointsFromTouches=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this._clientToElementTransform.apply(new o(e[i].clientX,e[i].clientY)));return t},t.prototype._getPointsFromPointers=function(){for(var e=[],t=Object.keys(this._pointers),i=0;i<t.length;i++)e.push(this._pointers[t[i]]);return e},t.prototype._updateSize=function(e){if(void 0===e&&(e=!0),!this._size||e){var t=this.element.getBoundingClientRect();this._size=t,this._clientToElementTransform=new n(new o(-t.left,-t.top))}},t}(r);return v});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/carousel/CarouselSlideViewModel",["require","exports","odsp-shared/base/ViewModel","../../bindings/host/HostBinding","../../bindings/css/ClassesBinding","knockout"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this.addBindingHandlers({host:o,classes:n}),this.item=t.item,this.offset=t.offset,this.isLoaded=t.isLoaded||r.observable(!1),this.order=t.order||r.observable(1),this.direction=this.createComputed(this._computeDirection)}return __extends(t,e),t.prototype._computeDirection=function(){var e=this.offset();return e>0?1:0>e?-1:0},t}(i);return s}),define("odsp-shared/utilities/knockout/Extenders",["require","exports","../../base/Disposable"],function(e,t,i){var o;return function(e){"use strict";function t(e,t){if(e.limit)e.limit(function(e){var i;return function(){t.cancelAnimationFrame(i),i=t.requestAnimationFrame(function(){i=t.requestAnimationFrame(function(){i=void 0,e()})})}});else{e.extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}});var o,n=e.subscribe(function(){t.cancelAnimationFrame(o),o=t.requestAnimationFrame(function(){o=t.requestAnimationFrame(function(){o=void 0,e()})})},null,"beforeChange");e=i.default.hook(e,function(){n.dispose()})}return e}function o(e,t){return e.equalityComparer=t,e}e.skipAnimationFrame=t,e.withComparer=o}(o||(o={})),o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/carousel/CarouselViewModel",["require","exports","odsp-shared/base/ViewModel","../../bindings/host/HostBinding","../../bindings/css/ClassesBinding","../../bindings/pan/PanBinding","./CarouselSlideViewModel","odsp-utilities/math/Point","odsp-utilities/math/Transform","odsp-utilities/object/ObjectUtil","odsp-shared/utilities/knockout/Extenders","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p){var u=1e3,h=15,m=2,g=.8,f=1e3,v=.5,b=1,x=.3,y=.5,_=.5,k=600,T=600,S=function(e){function t(t){var i=this;e.call(this,t),this.addBindingHandlers({host:o,classes:n,pan:r}),this.item=t.item,this._items=t.items,this._allocationRange=t.allocationRange||p.observable({start:0,end:0}),this.isEnabled=t.isEnabled||p.observable(!0),this.isRotating=t.isRotating||p.observable(!1),this.isLoaded=t.isLoaded||p.observable(!1),this._rotationThreshold=x,this._velocityThreshold=b,this._index=this.createComputed(function(){return i._items.indexOf(i.item())}),this._itemsInSlides=p.observableArray(),this._itemHistory=p.observableArray(),this.createComputed(this._computeUpdateItemHistory),this.createComputed(this._computeCleanItemHistory).extend({rateLimit:{timeout:T,method:"notifyWhenChangesStop"}}),this._elementsToRemove=p.observableArray(),this._initializeSlides(),this._initializeMotion(),this.carouselTransform=this.createComputed(this._computeCarouselTransform),this.carouselTransform.equalityComparer=d.deepCompare,this._initializeDirection(),this._handleItemDeletion(),this._initializeItemsInSlides(),this.createComputed(this._computeElementsToRemove).extend({rateLimit:{timeout:f,method:"notifyWhenChangesStop"}}),this.platformStyle=this.createComputed(this._computePlatformStyle)}return __extends(t,e),t.prototype.onSlideRemoved=function(e){p.utils.toggleDomNodeCssClass(e,"is-deleted",!0),p.utils.toggleDomNodeCssClass(e,"is-current",!1),this._elementsToRemove.push(e)},t.prototype.mayStartPan=function(e,t,i){return this.isEnabled.peek()&&Math.abs(e.translate.x)>=10&&5>t&&i.length<2},t.prototype._initializeMotion=function(){this.isFlipping=p.observable(!0),this.isPowered=p.observable(!1),this.isGliding=p.observable(!1),this.panTransform=p.observable(l.IDENTITY),this.panTransform.equalityComparer=d.deepCompare,this._initializeVelocity(),this.createComputed(this._computeStartPowered),this.createComputed(this._computeRotateToSlide),c.skipAnimationFrame(this.createComputed(this._computeStartGlide),this.async),this.createComputed(this._computeEndGlide).extend({rateLimit:{timeout:k,method:"notifyWhenChangesStop"}}),this.createComputed(this._computeEndRotation)},t.prototype._computeStartPowered=function(){this.isPowered()&&(this.isRotating(!0),this.isGliding(!1),this.isFlipping(!1))},t.prototype._computeStartGlide=function(){var e=this.isPowered(),t=this.isFlipping.peek();e||t||(this.panTransform(l.IDENTITY),this.isGliding(!0),this.isRotating(!0))},t.prototype._computeEndGlide=function(){var e=this.isPowered.peek(),t=this.isGliding();!e&&t&&(this.isGliding(!1),this.isRotating(!1))},t.prototype._computeEndRotation=function(){this.isRotating()||this.isFlipping(!0)},t.prototype._initializeDirection=function(){var e=this,t=this._index.peek();this.addDisposable(this.item.subscribe(function(){t=e._index.peek()},this,"beforeChange")),this.createComputed(function(){e.isFlipping()&&(t=e._index.peek())}),this.direction=this.createComputed(function(){var i,o=e._index();return i=e.isFlipping()&&o>-1&&t>-1?Math.max(-1,Math.min(1,o-t)):0})},t.prototype._initializeSlides=function(){var e=this,t=this.addDisposable(this._itemsInSlides.filter(function(t){return t&&(e._items.indexOf(t)>-1||t===e.item())}));this.slides=this.addDisposable(t.map({mappingWithDisposeCallback:function(t){var i=p.observable(!1),o=e.createPureComputed(function(){return e._items.indexOf(t)}),n=e.createPureComputed(function(){return o()-e._index()}),r=e.createComputed(function(){n()||e.isLoaded(i())}),a=e.createPureComputed(function(){var i=e._itemHistory.indexOf(t);return i+1}),l=new(e.resources.injected(s))({item:t,offset:n,isLoaded:i,order:a});return{mappedValue:l,dispose:function(){l.dispose(),n.dispose(),o.dispose(),r.dispose(),a.dispose()}}}}))},t.prototype._initializeItemsInSlides=function(){this.createComputed(this._computeAllocationRange),this.createComputed(this._computeItemsInSlides)},t.prototype._computeAllocationRange=function(){var e=this.item(),t=this._items,i=t().length,o=this._itemsInSlides.peek(),n=t.indexOf(e),r=o.indexOf(e),s=-1===r||n>=m&&m>r||i-1-m>=n&&r>o.length-1-m||h>=i&&i!==o.length;if(s&&n>-1){var a=this.direction.peek(),l=n+a*g*(Math.floor(h/2)-m),d=Math.max(0,Math.min(i-h,l-Math.floor(h/2))),c=Math.min(i,d+h);this._allocationRange({start:d,end:c})}else 0>n&&this._allocationRange({start:0,end:0})},t.prototype._computeItemsInSlides=function(){var e,t=this._allocationRange();e=t.end-t.start>0?this._items.slice(t.start,t.end):[this.item()],(i=this._itemsInSlides).splice.apply(i,[0,this._itemsInSlides.peek().length].concat(e));var i},t.prototype._handleItemDeletion=function(){var e=this,t=this._index();this.addDisposable(this._items.subscribe(function(){t=e._index()},null,"beforeChange")),this.createComputed(function(){var i=e.item.peek(),o=e._items.indexOf(i);if(t>-1&&-1===o&&i){var n=e._items.peek(),r=Math.max(0,Math.min(n.length-1,t));e.item(n[r])}})},t.prototype._computeUpdateItemHistory=function(){var e=this.item();this._itemHistory.unshift(e)},t.prototype._computeCleanItemHistory=function(){this._itemHistory().length>1&&this._itemHistory.splice(1,this._itemHistory().length)
},t.prototype._computeElementsToRemove=function(){this.item(),this._itemsInSlides();for(var e;e=this._elementsToRemove.shift();)p.removeNode(e)},t.prototype._initializeVelocity=function(){var e=this,t=this.panTransform.peek(),i=0;this.velocity=this.createComputed(function(){var o=e.panTransform(),n=(new Date).getTime(),r=o.translate.subtract(t.translate).scale(u/(n-i));return i=n,t=o,r}),this.velocity.equalityComparer=d.deepCompare},t.prototype._computeRotateToSlide=function(){var e=this.isPowered(),t=this.isFlipping.peek();if(!e&&!t){var i=this.panTransform.peek().translate.negate(),o=this.velocity.peek().negate(),n=this._index.peek(),r=this._calculateFractionalIndexOffset(i,o)+i.x;this.item(this._items.peek()[Math.max(0,Math.min(this._items.peek().length-1,n+Math.round(r)))]),this.panTransform(new l(new a(this._index.peek(),0).subtract(new a(n,0).add(i))))}},t.prototype._calculateFractionalIndexOffset=function(e,t){var i=0;return e.x>this._rotationThreshold&&e.x<v?i+=_:e.x<-this._rotationThreshold&&e.x>-v&&(i-=_),t.x>this._velocityThreshold&&e.x<v?i+=y:t.x<-this._velocityThreshold&&e.x>-v&&(i-=y),i=Math.max(-1,Math.min(1,i))},t.prototype._computeCarouselTransform=function(){var e=this.panTransform().translate,t=this._items.peek().length,i=this._index.peek();-1===i&&(i=0,t=1);var o=-e.x,n=o,r=i+o;if(0>r||r>t-1){var s=o>0?Math.floor:Math.ceil,d=Math.max(0-i,Math.min(t-1-i,s(o))),c=Math.PI,p=Math.atan(c*(o-d))/c;n=p+d}return new l(new a(-n,e.y))},t.prototype._computePlatformStyle=function(){var e=this.carouselTransform(),t="translateZ(0) translate("+100*e.translate.x+"%, 0)";return{"-ms-transform":t,"-webkit-transform":t,transform:t}},t}(i);return S}),define("odsp-next/controls/carousel/Carousel.html",[],function(){return"<div class=Carousel><div class=Carousel-platform data-bind=\"template: { foreach: slides, beforeRemove: $component.onSlideRemoved.bind($component), dontLimitMoves: true }, pan: { isActive: isPowered, transform: panTransform, mayStartPan: $component.mayStartPan.bind($component) }, style: platformStyle, classes: { base: '', mappings: { 'is-flipping': isFlipping, 'is-rotating': isRotating, 'is-powered': isPowered, 'is-gliding': isGliding, 'is-rotating-forward': direction() > 0, 'is-rotating-backward': direction() < 0 } }\"><div class=Carousel-slide data-bind=\"host: {}, attr: { 'data-item-offset': offset, 'data-item-order': order, 'data-item-direction': direction }, classes: { mappings: { 'is-current': item && item === $component.item(), 'is-loaded': isLoaded } }\"></div></div></div>"}),define("odsp-next/controls/carousel/Carousel.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles('.Carousel-platform,.Carousel-slide{position:absolute;left:0;top:0;width:100%;height:100%}.Carousel{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.Carousel-platform{z-index:0;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-ms-touch-action:none;touch-action:none;will-change:transform;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-perspective:1000;perspective:1000}.Carousel-slide{z-index:1;opacity:0;visibility:hidden;will-change:transform,opacity,visibility;-webkit-transform:translateZ(0);transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-perspective:1000;perspective:1000;transition:opacity 0s linear .3s,visibility 0s linear .3s,-webkit-transform 0s linear;transition:opacity 0s linear .3s,visibility 0s linear .3s,transform 0s linear;transition:opacity 0s linear .3s,visibility 0s linear .3s,transform 0s linear,-webkit-transform 0s linear}.Carousel-slide.is-current.is-loaded{opacity:1;visibility:inherit;transition-delay:0s,0s,0s}.Carousel-slide.is-current.is-deleted,.Carousel-slide.is-deleted{z-index:0;opacity:0;visibility:hidden;transition-duration:0s,0s,0s;transition-delay:0s,0s,0s}.Carousel-platform.is-flipping .Carousel-slide{transition-duration:0s,0s,0s;transition-delay:0s,0s,0s}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="1"]{z-index:10}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="1"].is-current.is-loaded{transition-duration:.3s,0s,.3s}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="2"]{z-index:9}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="2"].is-loaded{transition-duration:.3s,0s,.3s;transition-delay:.3s,.6s,0s}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="3"]{z-index:8}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="4"]{z-index:7}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="5"]{z-index:6}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="6"]{z-index:5}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="7"]{z-index:4}.Carousel-platform.is-flipping .Carousel-slide[data-item-order="8"]{z-index:3}html[dir=ltr] .Carousel-platform.is-flipping .Carousel-slide[data-item-direction="1"]{-webkit-transform:translate(2%,0);-ms-transform:translate(2%,0);transform:translate(2%,0)}html[dir=ltr] .Carousel-platform.is-flipping .Carousel-slide[data-item-direction="-1"],html[dir=rtl] .Carousel-platform.is-flipping .Carousel-slide[data-item-direction="1"]{-webkit-transform:translate(-2%,0);-ms-transform:translate(-2%,0);transform:translate(-2%,0)}html[dir=rtl] .Carousel-platform.is-flipping .Carousel-slide[data-item-direction="-1"]{-webkit-transform:translate(2%,0);-ms-transform:translate(2%,0);transform:translate(2%,0)}.Carousel-platform.is-rotating .Carousel-slide{transition-delay:0s,0s,0s;transition-duration:0s,0s,0s}.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="2"]{-webkit-transform:translateZ(0) translate(204%,0);transform:translateZ(0) translate(204%,0)}.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="1"]{-webkit-transform:translateZ(0) translate(102%,0);transform:translateZ(0) translate(102%,0)}.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="-1"]{-webkit-transform:translateZ(0) translate(-102%,0);transform:translateZ(0) translate(-102%,0)}.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="-2"]{-webkit-transform:translateZ(0) translate(-204%,0);transform:translateZ(0) translate(-204%,0)}.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="1"],.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="-1"],.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="-2"],.Carousel-platform.is-rotating .Carousel-slide[data-item-offset="2"]{visibility:inherit;opacity:1}.Carousel-platform.is-gliding{transition:-webkit-transform .3s ease-out;transition:transform .3s ease-out;transition:transform .3s ease-out,-webkit-transform .3s ease-out}.Carousel-platform.is-gliding .Carousel-slide[data-item-offset="1"],.Carousel-platform.is-gliding .Carousel-slide[data-item-offset="-1"],.Carousel-platform.is-gliding .Carousel-slide[data-item-offset="-2"],.Carousel-platform.is-gliding .Carousel-slide[data-item-offset="2"]{visibility:hidden;opacity:0;transition-delay:.3s,.3s,0s}')}),define("odsp-next/controls/carousel/Carousel",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./CarouselViewModel","./Carousel.html","./Carousel.css"],function(e,t,i,o){var n=i.registerComponent({tagName:"ms-carousel",template:e("./Carousel.html"),viewModel:o,synchronous:!0});return n}),define("odsp-next/controls/projector/IProjectorParams",["require","exports"],function(e,t){!function(e){e[e.live=0]="live",e[e.preview=1]="preview"}(t.ProjectorMode||(t.ProjectorMode={}));t.ProjectorMode});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/projector/ProjectorViewModel",["require","exports","odsp-shared/base/ViewModel","../../bindings/host/HostBinding","../../bindings/pan/PanBinding","../../bindings/css/ClassesBinding","../../bindings/clientRect/ClientRectBinding","./IProjectorParams","odsp-utilities/math/Transform","odsp-utilities/math/Rectangle","odsp-utilities/math/Size","odsp-utilities/math/Point","odsp-utilities/object/ObjectUtil","odsp-shared/utilities/knockout/Extenders","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m){function g(e,t){"use strict";void 0===t&&(t=!1);var i=Math.max(l.IDENTITY.scale,e.scale),o=new d(e.apply(v).subtract(new p(i,i).scale(T)),new c(i,i)),n=f,r=n.nudge(o),s=n.getCenter().subtract(r.getCenter());return t&&P&&(s=s.unit().scale(s.abs()-Math.atan(Math.PI*s.abs())/Math.PI*Math.log(e.scale/l.IDENTITY.scale))),new l(s).multiply(e)}var f=new d(0,0,1,1),v=f.getCenter(),b=10,x=1,y=4,_=3,k=100,T=.5,S=2,w=!0,P=!0,I=function(e){function t(t,i){e.call(this,t),this.addBindingHandlers({host:o,pan:n,classes:r,clientRect:s.default}),this.panTransform=m.observable(l.IDENTITY),this.panTransform.equalityComparer=u.deepCompare,this.contentTransform=m.observable(l.IDENTITY),this.contentTransform.equalityComparer=u.deepCompare,this.imageTransform=m.observable(l.IDENTITY),this.imageTransform.equalityComparer=u.deepCompare,this.isPanning=m.observable(!1),this.isGliding=m.observable(!1),this.isZoomed=t&&t.isZoomed||m.observable(!1),this.isEnabled=t&&t.isEnabled||m.observable(!0),this.size=m.observable(),this._lastZoomTogglePosition=null,this._mode=t.mode||a.ProjectorMode.live,this.mode=a.ProjectorMode[this._mode],this.createComputed(this._computeResetGlide),this.createComputed(this._computePreviewTransform),this.createComputed(this._computeCommitTransform);var d=this.createComputed(this._computeStartGlide);this.createComputed(this._computeEndGlide).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}});var c=this.createComputed(this._computeApplyTransformOnZoomed);this.createComputed(this._computeResetZoomOnTransformed),this.imageStyle=this.createComputed(this._computeImageStyle),i&&i.disableFrameSkip||(h.skipAnimationFrame(d,this.async),h.skipAnimationFrame(c,this.async)),this.host={transform:this._mode===a.ProjectorMode.live?this.panTransform:this.contentTransform,isGliding:this.isGliding}}return __extends(t,e),t.prototype.toggleIsZoomed=function(e,t){var i=this.size.peek(),o=i&&new p(t.clientX/i.width,t.clientY/i.height)||v;this._lastZoomTogglePosition=o,this.isZoomed(!this.isZoomed())},t.prototype.mayStartPan=function(e,t,i){return this.isEnabled.peek()&&(Math.abs(t)>=b&&i.length>=S||this.isZoomed.peek()&&e.translate.abs()>=b)},t.prototype.constrainPanScale=function(e){return Math.max(x,Math.min(y,e))},t.prototype._computeResetGlide=function(){this.isPanning()&&(this.isGliding(!1),this.isZoomed(!0))},t.prototype._computePreviewTransform=function(){var e=this.isPanning();if(e){var t=this.panTransform();t=g(t,!0),this.imageTransform(this.contentTransform().invert().multiply(t))}},t.prototype._computeCommitTransform=function(){var e=this.isPanning();if(!e&&!this.isGliding.peek()){var t=this.panTransform.peek();t=t.scale<l.IDENTITY.scale&&w?l.IDENTITY:g(t),this._applyTransform(t)}},t.prototype._computeStartGlide=function(){var e=this.isPanning();e||l.areEqual(this.imageTransform(),l.IDENTITY)||(this.isGliding(!0),this.imageTransform(l.IDENTITY))},t.prototype._computeEndGlide=function(){var e=this.isPanning(),t=this.isGliding();!e&&t&&this.isGliding(!1)},t.prototype._computeApplyTransformOnZoomed=function(){var e=this.isZoomed(),t=this.isEnabled(),i=this.isPanning.peek(),o=this.contentTransform.peek();i||(e&&t?l.areEqual(o,l.IDENTITY)&&this._applyTransform(l.zoom(p.ORIGIN,this._lastZoomTogglePosition||v,_)):l.areEqual(o,l.IDENTITY)||this._applyTransform(l.IDENTITY)),this._lastZoomTogglePosition=null},t.prototype._computeResetZoomOnTransformed=function(){var e=this.isPanning(),t=this.contentTransform();!e&&l.areEqual(t,l.IDENTITY)&&this.isZoomed(!1)},t.prototype._computeImageStyle=function(){if(this._mode===a.ProjectorMode.live){var e=this.contentTransform(),t=this.imageTransform(),i=e.multiply(t);return{left:i.translate.x*k+"%",top:i.translate.y*k+"%",width:i.scale*k+"%",height:i.scale*k+"%"}}var e=this.contentTransform(),t=this.imageTransform(),o="translateZ(0) translate("+t.translate.x*k+"%, "+t.translate.y*k+"%)";return{left:e.translate.x*k+"%",top:e.translate.y*k+"%",width:e.scale*k+"%",height:e.scale*k+"%","-ms-transform":o,"-webkit-transform":o,transform:o}},t.prototype._applyTransform=function(e){var t=this.contentTransform.peek().multiply(this.imageTransform.peek());this.contentTransform(e),this.imageTransform(this.contentTransform.peek().invert().multiply(t)),this.panTransform(this.contentTransform.peek())},t}(i);return I}),define("odsp-next/controls/projector/Projector.html",[],function(){return"<div class=\"od-Projector needsclick\" data-bind=\"classes: { base: 'od-Projector--' + mode, mappings: { 'od-Projector--gliding': isGliding, 'od-Projector--panning': isPanning } }, pan: { isActive: isPanning, transform: panTransform, mayStartPan: $component.mayStartPan.bind($component), constrainScale: $component.constrainPanScale.bind($component) }, clientRect: { size: size }, event: { dblclick: $component.toggleIsZoomed.bind($component) }\"><div class=od-Projector-image data-bind=\"style: imageStyle, host: { data: host }\"></div></div>"}),define("odsp-next/controls/projector/Projector.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-Projector,.od-Projector-image{position:absolute;left:0;top:0;width:100%;height:100%}.od-Projector{overflow:hidden}.od-Projector-image{-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-ms-touch-action:none;touch-action:none;will-change:transform;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-perspective:1000;perspective:1000}.od-Projector--gliding.od-Projector--preview .od-Projector-image{transition:-webkit-transform 267ms cubic-bezier(.1,.9,.2,1);transition:transform 267ms cubic-bezier(.1,.9,.2,1);transition:transform 267ms cubic-bezier(.1,.9,.2,1),-webkit-transform 267ms cubic-bezier(.1,.9,.2,1)}.od-Projector--gliding.od-Projector--live .od-Projector-image{transition:left 267ms cubic-bezier(.1,.9,.2,1),top 267ms cubic-bezier(.1,.9,.2,1),width 267ms cubic-bezier(.1,.9,.2,1),height 267ms cubic-bezier(.1,.9,.2,1)}")}),define("odsp-next/controls/projector/Projector",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./ProjectorViewModel","./Projector.html","./Projector.css"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-projector",template:e("./Projector.html"),viewModel:o,synchronous:!0});return n}),define("odsp-next/bindings/immersiveViewer/ImmersiveViewerBinding",["require","exports","knockout","odsp-utilities/async/RequireHelper","odsp-shared/utilities/string/StringHelper","odsp-utilities/domUtils/DomUtils","../../controls/panorama/Panorama.resx"],function(e,t,i,o,n,r,s){var a="{0}?psid=1&zippath={1}",l="formats/cubemap/cubemap.json",d=function(){function t(){}return t.init=function(t,d){function c(t){if(t){var i=n.format(a,t,l);m=o.promise(e,"siv").then(function(){var e=new Microsoft.ImmersiveViewer.PhotosynthSivDataSource;h=e,e.createFromJsonUri(i,p,function(){return n.format(a,t,"")},!0,!0)})}}function p(e){e&&(g.worldConfiguration(e),u())}function u(){g.viewer(new Microsoft.ImmersiveViewer.SharedImmersiveViewer(t,{dataSources:[h],backgroundColor:null,width:t.offsetWidth,height:t.offsetHeight}));var e=document.getElementById("sivZoomInButton");e.textContent="",e.setAttribute("aria-label",s.strings.ZoomIn),r.toggleClass(e,"ms-Icon",!0),r.toggleClass(e,"ms-Icon--plus",!0),r.toggleClass(e,"ms-Icon--circle",!0),r.toggleClass(e,"ms-font-l",!0);var i=document.getElementById("sivZoomOutButton");i.setAttribute("aria-label",s.strings.ZoomOut),r.toggleClass(i,"ms-Icon",!0),r.toggleClass(i,"ms-Icon--minus",!0),r.toggleClass(i,"ms-Icon--circle",!0),r.toggleClass(i,"ms-font-l",!0),i.textContent=""}var h,m,g=d(),f=g.downloadUrl.subscribe(c);i.utils.domNodeDisposal.addDisposeCallback(t,function(){f.dispose(),m&&m.cancel();var e=g.viewer();e&&(e.dispose(),g.viewer(null)),g.worldConfiguration(null)})},t}();return d});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/panorama/PanoramaViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../resources/DataSourceResourceKeys","../../resources/ControlResourceKeys","../../bindings/immersiveViewer/ImmersiveViewerBinding","./Panorama.resx"],function(e,t,i,o,n,r,s,a){var l=.05,d=function(t){function o(o){var l=this;t.call(this,o),this.enterInteractiveModeAria=a.strings.EnterInteractiveModeAria,this.exitInteractiveModeAria=a.strings.ExitInteractiveModeAria,this.addBindingHandlers({immersiveViewer:s}),this.item=o.item,this._isLoaded=o.isLoaded,this._itemDataSource=this.resources.consume(n.items),this._parentInteractive=this.resources.consume(r.isInteractive),this.interactiveButtonUrl=e.toUrl(this.resources.consume(n.settings).mediaBaseUrl+"/images/panorama/interactivemodebuttonrest.png"),this.viewer=i.observable(null),this.worldConfiguration=i.observable(null),this.downloadUrl=i.observable(null),this.isInteractive=i.observable(this._parentInteractive()),this._boundHandlePanning=this._handlePanning.bind(this),this._isGoingClockwise=!0,this.loadPanorama(),this.createComputed(function(){l._onInteractiveChange()})}return __extends(o,t),o.prototype.loadPanorama=function(){var e=this,t=this.viewer();t&&(t.dispose(),this.viewer(null));var o=i.utils.unwrapObservable(this.item);o&&this._itemDataSource.getDownloadUrl(o).then(function(t){e.downloadUrl(t)}),this._isLoaded(!0)},o.prototype.onClickInteractiveButton=function(){this.isInteractive(!0)},o.prototype.onClickBackButton=function(){this.isInteractive(!1)},o.prototype._onInteractiveChange=function(){var e=this.isInteractive(),t=this.viewer();e?(this._parentInteractive(!0),t&&(this._stopAutoPan(),t.setIsInteractive(!0),t.setFocus())):(t&&(this._resetView(),this._startAutoPan(),t.setIsInteractive(!1)),this._parentInteractive(!1))},o.prototype._resetView=function(){var e=this.viewer(),t=this.worldConfiguration();if(e&&t){var i=t.source;e.setView(i?i.startingPitch:0,i?i.startingHeading:0,Math.PI),this._isGoingClockwise=!0}},o.prototype._startAutoPan=function(){var e=this.viewer();e&&(this._handlePanning(),e.viewChangeEndEvent.addEventListener(this._boundHandlePanning))},o.prototype._stopAutoPan=function(){var e=this.viewer();e&&(e.setView(e.getPitch(),e.getHeading(),e.getVerticalFov()),e.viewChangeEndEvent.removeEventListener(this._boundHandlePanning))},o.prototype._handlePanning=function(){var e=this,t=this.viewer();if(this.isInteractive())this._stopAutoPan();else{var i=t.getBounds(),o=i.right||Math.PI,n=i.left||-Math.PI,r=i.top||Math.PI/2,s=i.bottom||-Math.PI/2,a=o-n,d=r-s,c=a>=d,p=t.getHeading(),u=t.getPitch(),h=p,m=u;c?a===2*Math.PI?p===o||p===n?(h=0,this._isGoingClockwise=!this._isGoingClockwise):h=this._isGoingClockwise?o:n:h=o>p?o:n:m=r>u?r:s;var g=1e3*(Math.abs(h-p)+Math.abs(m-u))/l;this.async.setTimeout(function(){e.isInteractive()||t.setView(m,h,t.getVerticalFov(),!0,g)},1e3)}},o}(o);return d}),define("odsp-next/controls/panorama/Panorama.html",[],function(){return"<div class=od-Panorama data-bind=\"css: {'od-Panorama--isInteractive': isInteractive}\"><div class=od-Panorama-sivContainer data-bind=\"{ immersiveViewer: { viewer: viewer, downloadUrl: downloadUrl, worldConfiguration: worldConfiguration} }\"></div><button class=od-Panorama-interactiveModeButton data-bind=\"click: onClickInteractiveButton, style: { backgroundImage: 'url(\\'' + interactiveButtonUrl + '\\')' }, attr: {'aria-label': enterInteractiveModeAria }\"></button> <button class=\"od-Panorama-backButton ms-Icon ms-Icon--x ms-Icon--circle ms-font-l\" data-bind=\"click: onClickBackButton, attr: {'aria-label': exitInteractiveModeAria }\"></button></div>"}),define("odsp-next/controls/panorama/Panorama.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-Panorama-sivContainer{position:absolute;top:0;left:0;right:0;bottom:0}.od-Panorama-interactiveModeButton{position:absolute;top:50%;width:100px;height:100px;margin-top:-50px;background-repeat:no-repeat;background-color:transparent;border:none;z-index:1}html[dir=ltr] .od-Panorama-interactiveModeButton{left:50%;margin-left:-50px}html[dir=rtl] .od-Panorama-interactiveModeButton{right:50%;margin-right:-50px}.od-Panorama-interactiveModeButton:active,.od-Panorama-interactiveModeButton:hover{background-color:transparent}.od-Panorama--isInteractive .od-Panorama-interactiveModeButton{display:none}.od-Panorama .od-Panorama-backButton{display:none;position:absolute;top:20px;height:40px;width:40px;padding:0;z-index:1;cursor:pointer;background-color:#fff}html[dir=ltr] .od-Panorama .od-Panorama-backButton{right:40px}html[dir=rtl] .od-Panorama .od-Panorama-backButton{left:40px}.od-Panorama--isInteractive .od-Panorama-backButton{display:block}.od-Panorama .sivZoomInButton,.od-Panorama .sivZoomOutButton{display:none;right:auto;background-color:#fff;width:40px;height:40px;cursor:pointer;padding:0;top:auto}html[dir=ltr] .od-Panorama .sivZoomInButton,html[dir=ltr] .od-Panorama .sivZoomOutButton{right:50px}html[dir=rtl] .od-Panorama .sivZoomInButton,html[dir=rtl] .od-Panorama .sivZoomOutButton{left:50px}.od-Panorama--isInteractive .sivZoomInButton,.od-Panorama--isInteractive .sivZoomOutButton{display:block}.od-Panorama .od-Panorama-backButton:hover,.od-Panorama .sivZoomInButton:hover,.od-Panorama .sivZoomOutButton:hover{background-color:#c8c8c8}.od-Panorama .od-Panorama-backButton:active,.od-Panorama .sivZoomInButton:active,.od-Panorama .sivZoomOutButton:active{background-color:#000;color:#fff}.od-Panorama .sivZoomInButton{bottom:100px}.od-Panorama .sivZoomOutButton{bottom:50px}.od-Panorama .sivHeadingLeftButton,.od-Panorama .sivHeadingRightButton,.od-Panorama .sivPitchDownButton,.od-Panorama .sivPitchUpButton{display:none}")}),define("odsp-next/controls/panorama/Panorama",["require","exports","./PanoramaViewModel","odsp-shared/utilities/knockout/ComponentFactory","./Panorama.html","./Panorama.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-panorama",template:e("./Panorama.html"),viewModel:i,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/shim/shimmedControl/ShimmedControlViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../../resources/ProviderResourceKeys"],function(e,t,i,o,n){var r=function(t){function o(r){t.call(this,r);var s=this.resources.consume(n.shimmedControl);s&&s.controls?(this.controls=s.controls,this.async.setTimeout(function(){e(["movecopycommand"],function(){$BSI&&$BSI.informLoaded&&"function"==typeof $BSI.informLoaded&&$BSI.informLoaded(),$Do.when("NotificationControls",0,function(){wLive.Controls.Notifications.getQueue().start()})})},o.LAZY_LOAD_INTERVAL)):this.controls=i.observable([])}return __extends(o,t),o.LAZY_LOAD_INTERVAL=5e3,o}(o);return r}),define("odsp-next/controls/shim/shimmedControl/ShimmedControl.html",[],function(){return'<div class=od-ShimmedControl><!--ko foreach: controls--><div data-bind="component: $data"></div><!--/ko--></div>'}),define("odsp-next/controls/shim/shimmedControl/ShimmedControl",["require","exports","./ShimmedControlViewModel","odsp-shared/utilities/knockout/ComponentFactory","./ShimmedControl.html"],function(e,t,i,o){var n=o.registerComponent({tagName:"od-shimmed-control",template:e("./ShimmedControl.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/OneUpContentViewModel",["require","exports","odsp-shared/base/ViewModel"],function(e,t,i){var o=function(e){function t(t){e.call(this,t),this.slide=t.slide,this.oneUp=t.oneUp}return __extends(t,e),t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/photo/OneUpPhotoViewModel",["require","exports","../OneUpContentViewModel","odsp-utilities/object/ObjectUtil"],function(e,t,i,o){var n=function(e){function t(t){var i=this;e.call(this,t),this.projectorParams={isEnabled:this.createPureComputed(function(){return!t.slide.offset()&&!i.oneUp.isRotating()}),isZoomed:this.oneUp.isInteractive}}return __extends(t,e),t.prototype.getThumbnailParams=function(e){var t=this,i=e.transform,n=e.isGliding,r=this.createPureComputed(function(){return i().scale}),s=this.createPureComputed(function(){return{width:t.oneUp.size().width*i().scale,height:t.oneUp.size().height*i().scale}});s.equalityComparer=o.deepCompare;var a=this.createPureComputed(function(){return!n()});return{slide:this.slide,oneUp:this.oneUp,size:s,scale:r,allowLoading:a}},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/oneUp/photo/OneUpPhoto.html",[],function(){return"<div class=OneUp-photo data-bind=\"component: { name: 'od-projector', params: projectorParams }\"><!--ko component: {\n name: 'od-one-up-thumbnail',\n params: getThumbnailParams($host)\n}--><!--/ko--></div>"});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/thumbnail/OneUpThumbnailViewModel",["require","exports","../OneUpContentViewModel","odsp-shared/models/image/Alignments","odsp-utilities/object/ObjectUtil","../../../utilities/features/Features","../../thumbnailTile/ThumbnailTile","../../image/frame/ImageFrame","odsp-shared/utilities/knockout/Extenders","knockout"],function(e,t,i,o,n,r,s,a,l,d){var c=function(e){function t(t){var i=this;e.call(this,t),this._scale=t.scale||d.observable(1),this._size=t.size||this.oneUp.size;var o=t.allowLoading||d.observable(!0);this.hasThumbnail=this.createComputed(this._computeHasThumbnail),this._image=this.createPureComputed(this._computeImage),this._image.equalityComparer=n.deepCompare,this._fadeIn=this.createPureComputed(function(){return Math.abs(i.slide.offset())<2}),this._allowLoading=this.createPureComputed(function(){var e=o(),t=i.oneUp.isRotating();return e&&!t}),this.thumbnailParams=this.createComputed(this._computeThumbnailTileParams),this.thumbnailTagName=r.default.isFeatureEnabled(r.default.UseImageFrameInOneUp)?a.default.tagName:s.tagName,this._coverage=l.withComparer(this.createPureComputed(r.default.isFeatureEnabled(r.default.UseImageFrameInOneUp)?this._computeImageFrameCoverage:this._computeThumbnailTileCoverage),n.deepCompare)}return __extends(t,e),t.prototype._computeImage=function(){var e=this.slide.item(),t=e.fullThumbnail;return t?{url:t.url,getAligned:t.getAligned,fitToSize:t.fitToSize,width:t.width,height:t.height,rotation:e.rotation}:null},t.prototype._computeThumbnailTileCoverage=function(){var e=this.slide.offset(),t=Math.abs(e)<2;return{maximum:t?1:.25,minimum:0}},t.prototype._computeImageFrameCoverage=function(){var e,t=this._image(),i=this._size();return t.width&&t.height&&(t.width>i.width||t.height>i.height)&&(e=.25),{minimum:0,maximum:1,fallback:e}},t.prototype._computeHasThumbnail=function(){var e=this.slide.item();return!!this._size().width&&!!e.fullThumbnail},t.prototype._computeThumbnailTileParams=function(){return this.hasThumbnail()?{image:this._image,desiredSize:this._size,scale:this._scale,shouldContainImage:!0,alignment:o.AlignmentType.fit,fadeIn:this._fadeIn,isLoaded:this.slide.isLoaded,coverage:this._coverage,allowLoading:this._allowLoading}:null},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c}),define("odsp-next/controls/oneUp/thumbnail/OneUpThumbnail.html",[],function(){return"<!--ko if: hasThumbnail--><!--ko component: {\n name: thumbnailTagName,\n params: thumbnailParams\n}--><!--/ko--><!--/ko-->"}),define("odsp-next/controls/oneUp/thumbnail/OneUpThumbnail",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpThumbnailViewModel","./OneUpThumbnail.html","../../thumbnailTile/ThumbnailTile","../../image/frame/ImageFrame"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-one-up-thumbnail",template:e("./OneUpThumbnail.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/oneUp/photo/OneUpPhoto",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpPhotoViewModel","./OneUpPhoto.html","../../projector/Projector","../thumbnail/OneUpThumbnail"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-one-up-photo",template:e("./OneUpPhoto.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/video/item/resources/ItemVideoResourceKeys",["require","exports","odsp-shared/utilities/resources/ResourceKey"],function(e,t,i){t.context=i("video.context"),t.playbackPanelProvider=i("video.playbackPanelProvider")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/video/OneUpVideoViewModel",["require","exports","knockout","../OneUpContentViewModel","odsp-utilities/async/RequireHelper","../../../providers/transclusion/TransclusionProvider","../../video/item/resources/ItemVideoResourceKeys","../resources/OneUpResourceKeys"],function(e,t,i,o,n,r,s,a){var l=function(t){function o(o){var l=this;t.call(this,o),this._isPlaying=i.observable(!1),this.videoPlayerTagName=i.observable(null),this.showVideo=this.createPureComputed(function(){return!!l.videoPlayerTagName()&&!o.slide.offset()}),this.itemVideoPlayerParams={item:this.slide.item,isLoaded:this.slide.isLoaded,useExternalControls:!0,isPlaying:this._isPlaying},this.agentProvider=this.resources.consume(a.agentProvider),this.playbackPanelProvider=this.resources.expose(s.playbackPanelProvider,new(this.managed(r.default))({type:void 0})),this.createComputed(this._computeSetIsIdleEnabledFromIsPlaying),n.promise(e,"../../video/item/ItemVideoPlayer").then(function(e){l.videoPlayerTagName(e.tagName)})}return __extends(o,t),o.prototype._computeSetIsIdleEnabledFromIsPlaying=function(){this.slide.isIdleEnabled(this._isPlaying())},o}(o.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=l}),define("odsp-next/controls/oneUp/video/OneUpVideo.html",[],function(){return"<div class=od-OneUpVideo><!--ko ifnot: showVideo--><!--ko component: {\n name: 'od-one-up-thumbnail',\n params: {\n slide: slide,\n oneUp: oneUp\n }\n }--><!--/ko--><!--/ko--><!--ko if: showVideo--><div class=od-OneUpVideo-player data-bind=\"component: { name: videoPlayerTagName, params: itemVideoPlayerParams }\"></div><!--ko component: {\n name: 'od-transclusion-content',\n params: {\n provider: agentProvider\n }\n }--><!--ko component: {\n name: 'od-transclusion-host',\n params: {\n provider: playbackPanelProvider\n }\n }--><!--/ko--><!--/ko--><!--/ko--></div>"}),define("odsp-next/controls/oneUp/video/OneUpVideo",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpVideoViewModel","./OneUpVideo.html","../thumbnail/OneUpThumbnail"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-one-up-video",template:e("./OneUpVideo.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n
});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/panorama/OneUpPanoramaViewModel",["require","exports","../OneUpContentViewModel"],function(e,t,i){var o=function(e){function t(t){e.call(this,t),this.showPanorama=this.createComputed(function(){return!t.slide.offset()}),this.panoramaParams={item:t.slide.item,isLoaded:t.slide.isLoaded}}return __extends(t,e),t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),define("odsp-next/controls/oneUp/panorama/OneUpPanorama.html",[],function(){return"<!--ko ifnot: showPanorama--><!--ko component: {\n name: 'od-one-up-thumbnail',\n params: {\n slide: slide,\n oneUp: oneUp\n }\n}--><!--/ko--><!--/ko--><!--ko if: showPanorama--><div class=OneUp-panorama data-bind=\"component: { name: 'od-panorama', params: panoramaParams }\"></div><!--/ko-->"}),define("odsp-next/controls/oneUp/panorama/OneUpPanorama",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpPanoramaViewModel","./OneUpPanorama.html","../../panorama/Panorama"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-one-up-panorama",template:e("./OneUpPanorama.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/other/OneUpOtherViewModel",["require","exports","../../../bindings/activate/ActivateBinding","../OneUpContentViewModel","knockout"],function(e,t,i,o,n){var r=238,s=function(e){function t(t){e.call(this,t),this.addBindingHandlers({activate:i}),this.itemTileParams={item:t.slide.item,cellSize:n.observable({width:r,height:r}),isInteractable:!1}}return __extends(t,e),t.prototype.activate=function(){this.slide.isLoaded(!0)},t}(o.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),define("odsp-next/controls/oneUp/other/OneUpOther.html",[],function(){return'<div class=OneUp-other data-bind="activate: $component.activate.bind($component)"><div class=OneUp-otherTile data-bind="component: { name: \'ms-item-tile\', params: itemTileParams }"></div></div>'}),define("odsp-next/controls/oneUp/other/OneUpOther",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpOtherViewModel","./OneUpOther.html","../../itemTile/ItemTile"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-one-up-other",template:e("./OneUpOther.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/oneUp/OneUpSlideViewModel",["require","exports","odsp-shared/base/ViewModel","../../utilities/features/Features","./photo/OneUpPhoto","./thumbnail/OneUpThumbnail","./video/OneUpVideo","./panorama/OneUpPanorama","./other/OneUpOther","knockout"],function(e,t,i,o,n,r,s,a,l,d){var c=function(e){function t(t,i){e.call(this,t),this._slide={isLoaded:t.slide.isLoaded,offset:t.slide.offset,item:t.slide.item,isIdleEnabled:d.observable(!0)},this._oneUp=t.oneUp,this._oneUpZoomEnabledFeature=i&&i.oneUpZoomEnabledFeature||o.default.OneUpZoomEnabled,this._name=this.createComputed(this._computeName),this.component=this.createComputed(this._computeComponent),this.createComputed(this._computeUpdateOneUpSlide)}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._oneUp.slide.peek()===this._slide&&this._oneUp.slide(void 0)},t.prototype._computeComponent=function(){var e=this._name();return e?{name:e,params:{slide:this._slide,oneUp:this._oneUp}}:null},t.prototype._computeName=function(){var e,t=this._slide.item();return e=!t||t.isPlaceholder||t.error?null:t.video?s.default.tagName:t.panorama?a.default.tagName:t.photo?o.default.isFeatureEnabled(this._oneUpZoomEnabledFeature)?n.default.tagName:r.default.tagName:l.default.tagName},t.prototype._computeUpdateOneUpSlide=function(){this._slide.offset()?this._oneUp.slide.peek()===this._slide&&this._oneUp.slide(void 0):this._oneUp.slide(this._slide)},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c}),define("odsp-next/controls/oneUp/OneUpSlide.html",[],function(){return'<div class=OneUp-slide data-bind="template: { data: component(), if: component() }"><!--ko component: $data--><!--/ko--></div>'}),define("odsp-next/controls/oneUp/OneUpSlide",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpSlideViewModel","./OneUpSlide.html","./other/OneUpOther","./panorama/OneUpPanorama","./photo/OneUpPhoto","./thumbnail/OneUpThumbnail","./video/OneUpVideo"],function(e,t,i,o){var n=i.registerComponent({tagName:"od-one-up-slide",template:e("./OneUpSlide.html"),viewModel:o.default,synchronous:!0});Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("odsp-next/controls/oneUp/OneUp",["require","exports","odsp-shared/utilities/knockout/ComponentFactory","./OneUpViewModel","./OneUp.html","./OneUp.css","../carousel/Carousel","../projector/Projector","../panorama/Panorama","../infoPane/InfoPane","../../controls/panelHost/PanelHost","../../controls/dialogHost/DialogHost","../../controls/overlays/host/OverlayHost","../../controls/shim/shimmedControl/ShimmedControl","./OneUpSlide","../../controls/transclusion/host/TransclusionHost"],function(e,t,i,o){var n=i.registerComponent({tagName:"ms-one-up",template:e("./OneUp.html"),viewModel:o,synchronous:!0});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/sharing/CachedSharingProvider",["require","exports","../../resources/ProviderResourceKeys","./SharingProvider"],function(e,t,i,o){var n=function(e){function t(){e.call(this),this._provider=this.resources.consume(i.sharing)}return __extends(t,e),t.prototype.getSharingData=function(e){return this._sharingData||(this._sharingData=this._provider.getSharingData(e)),this._sharingData},t}(o);return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/confirmation/ConfirmationViewModel",["require","exports","odsp-shared/base/ViewModel"],function(e,t,i){var o=function(e){function t(t){e.call(this,t),this.message=t.message}return __extends(t,e),t}(i);return o}),define("odsp-next/controls/confirmation/Confirmation.html",[],function(){return'<div class=od-Confirmation><p class=od-Confirmation-message data-bind="text: message"></p></div>'}),define("odsp-next/controls/confirmation/Confirmation.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-Confirmation-message{box-sizing:border-box;margin:0;padding:0;box-shadow:none;color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:14px;font-weight:400}")}),define("odsp-next/controls/confirmation/Confirmation",["require","exports","./ConfirmationViewModel","odsp-shared/utilities/knockout/ComponentFactory","./Confirmation.html","./Confirmation.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-confirmation",template:e("./Confirmation.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharingLinks/SharingLinksViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","odsp-utilities/async/Promise","../../resources/ControlResourceKeys","../../resources/ProviderResourceKeys","odsp-utilities/logging/events/Engagement.event","../loadingSpinner/LoadingSpinner","../progressSpinnerFlat/ProgressSpinnerFlat","./SharingLinks","./SharingLinks.resx","odsp-utilities/encoding/HtmlEncoding","../../utilities/selection/SelectionHelper","../../models/sharing/SharingLinkType","../../models/sharing/SharingRole","../../bindings/css/VisibilityBinding","../../bindings/focus/SelectOnFocusBinding","../../utilities/browser/WindowSize","../confirmation/Confirmation","../../models/dialog/DialogState","../../utilities/icons/Icon"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_){var k=function(e){function t(t){var o=this;e.call(this,t),this.sharingLinksTagName=c.tagName,this.loadingSpinnerTagName=l.tagName,this.progressSpinnerFlatTagName=d.tagName,t.item&&(this._item=t.item),this._guestLinkExists=t.guestLinkExists?t.guestLinkExists:i.observable(!1),this.addBindingHandlers({visibility:f,selectOnFocus:v.default}),this._selectionModel=this.resources.consume(r.itemsSelection),this._sharingProvider=this.resources.consume(s.sharing),this.loading=i.observable(!0),this.viewLinkHeader=u.encodeText(p.strings.ViewLinkHeader),this.viewLinkDescription=u.encodeText(p.strings.ViewLinkDescription),this.editLinkHeader=u.encodeText(p.strings.EditLinkHeader),this.editLinkDescription=u.encodeText(p.strings.EditLinkDescription),this.anonymousViewLink=i.observable(null),this.anonymousEditLink=i.observable(null),this.showAnonymousViewLink=i.observable(!1),this.showAnonymousEditLink=i.observable(!1),this.anonymousViewLinkUrl=i.observable(""),this.anonymousEditLinkUrl=i.observable(""),this.anonymousViewLinkButtonText=i.observable(""),this.anonymousEditLinkButtonText=i.observable(""),this.processingViewLink=i.observable(!1),this.processingEditLink=i.observable(!1),this.error=i.observable(""),this.viewLinkError=i.observable(""),this.editLinkError=i.observable(""),this.createComputed(this._computeUpdateAnonymousViewLink),this.createComputed(this._computeUpdateAnonymousEditLink);var n=this._sharingProvider.getSharingData(this._getCurrentItem());this.isReady=n.getLinks().then(function(e){e&&o._updateSharingLinks(e),o.loading(!1)},function(){o.error(p.strings.ServerError),o.loading(!1)}),t.linksAvailable&&n.getSettings().done(function(e){t.linksAvailable(e.anonymousLinksEnabled)},function(){})}return __extends(t,e),t.prototype.modifyViewLink=function(){this.viewLinkError("");var e={type:m.View,role:g.View,url:""};this._modifyLink(this.anonymousViewLink()||e,this.showAnonymousViewLink())},t.prototype.modifyEditLink=function(){this.editLinkError("");var e={type:m.Edit,role:g.Edit,url:""};this._modifyLink(this.anonymousEditLink()||e,this.showAnonymousEditLink())},t.prototype.copyViewLink=function(){return a.Engagement.logData({name:"AnonViewLink.SharingDialog.Copy"}),!0},t.prototype.copyEditLink=function(){return a.Engagement.logData({name:"AnonEditLink.SharingDialog.Copy"}),!0},t.prototype.executeDisableConfirm=function(){this._confirmDialog&&this._confirmDialog.actions[0].execute()},t.prototype._computeUpdateAnonymousViewLink=function(){var e=this.anonymousViewLink(),t=e?e.url:"";this.showAnonymousViewLink(!!e),this.anonymousViewLinkUrl(t),this.anonymousViewLinkButtonText(this._getLinkButtonText(t))},t.prototype._computeUpdateAnonymousEditLink=function(){var e=this.anonymousEditLink(),t=e?e.url:"";this.showAnonymousEditLink(!!e),this.anonymousEditLinkUrl(t),this.anonymousEditLinkButtonText(this._getLinkButtonText(t))},t.prototype._updateSharingLinks=function(e){for(var t=!1,i=0;i<e.length;i++)e[i].type===m.View&&e[i].role===g.View?(this.anonymousViewLink(e[i]),this.processingViewLink(!1),t=!0):e[i].type===m.Edit&&e[i].role===g.Edit&&(this.anonymousEditLink(e[i]),this.processingEditLink(!1),t=!0);this._guestLinkExists(t)},t.prototype._modifyLink=function(e,t){var i=t?"Disable":"Create";i+="Anon"+(e.role===g.View?"View":"Edit")+"Link.SharingDialog.Click",a.Engagement.logData({name:i}),t?this._disableLinkConfirm(e,!1):(e.role===g.View?this.processingViewLink(!0):this.processingEditLink(!0),this._modifyLinkServer(e,!0))},t.prototype._modifyLinkServer=function(e,t){var i,o=this,r=this._selectionModel&&this._selectionModel.selection&&this._selectionModel.selection(),a=[];if(r&&r.length>1){var l=this.resources.consume(s.dialog);i=h.default.resolveSelection({selectionModel:this._selectionModel,dialogProvider:l})}else i=n.default.wrap({});return i.then(function(i){return a=i,o.isReady=o._sharingProvider.manageSharingLinks({item:o._getCurrentItem(),items:a,type:e.type,role:e.role,id:e.id,create:t}).then(function(i){o._updateSharingLinks(i),t||(e.role===g.View?(o.anonymousViewLink(null),o.viewLinkError(""),o.processingViewLink(!1)):e.role===g.Edit&&(o.anonymousEditLink(null),o.editLinkError(""),o.processingEditLink(!1)))},function(){e.role===g.View?(o.viewLinkError(p.strings.ServerError),o.processingViewLink(!1)):e.role===g.Edit&&(o.editLinkError(p.strings.ServerError),o.processingEditLink(!1))})})},t.prototype._getLinkButtonText=function(e){return Boolean(e)?p.strings.DisableLinkButtonText:p.strings.CreateLinkButtonText},t.prototype._getCurrentItem=function(){return this._item?this._item:i.utils.unwrapObservable(this._selectionModel.selection()[0])},t.prototype._disableLinkConfirm=function(e,t){var o=this,r=this.resources.consume(s.dialog),l=i.observable(!0);this._confirmDialog=r.requestDialog({title:p.strings.DisableLinkConfirmationTitle,size:b.Medium,component:{name:x.tagName,params:{message:p.strings.DisableLinkConfirmationMessage}},actions:[{name:p.strings.DisableLinkConfirmationButton,execute:function(){return a.Engagement.logData({name:"Confirm.DisableLink.SharingDialog.Click"}),l(!1),o._modifyLinkServer(e,t).then(function(){return y.completed},function(){return y.dismissed})},isDefault:!0,isAvailable:l,icon:_.save,automationId:"UnshareConfirm"},{name:p.strings.KeepExistingLinkButton,execute:function(){return a.Engagement.logData({name:"KeepExisting.DisableLink.SharingDialog.Click"}),n.default.wrap(y.dismissed)},isDefault:!1,icon:_.x,automationId:"UnshareCancel"}],executeDefaultAction:!1})},t}(o);return k}),define("odsp-next/controls/sharingLinks/SharingLinks.html",[],function(){return'<!--ko if:loading--><div class=SharingLinks-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot:loading--><div aria-live=assertive class=SharingLinks-error data-bind="if: error"><span data-bind="text: error"></span></div><div class=Sharing-linksSection data-bind="ifnot: error"><div class=Sharing-linksHeading data-bind="text: viewLinkHeader"></div><label class=Sharing-linkInput-label data-bind="text: viewLinkDescription"></label><div class=Sharing-linksArea><!--ko if:showAnonymousViewLink--><input class=Sharing-linkInput-textbox readonly data-bind="value: anonymousViewLinkUrl, selectOnFocus: { isPermanent: true }, event: { copy: copyViewLink }, disable: processingViewLink, attr: { \'aria-label\': viewLinkDescription }"><!--/ko--><a class=Sharing-updateLinkButton href=javascript; data-bind="text: anonymousViewLinkButtonText, click: modifyViewLink"></a></div><div class=SharingLinks-progressBox data-bind="component: {name: progressSpinnerFlatTagName}, visibility: processingViewLink"></div><div aria-live=assertive class=SharingLinks-error data-bind="if: viewLinkError"><span data-bind="text: viewLinkError"></span></div></div><div data-bind="ifnot: error"><div class=Sharing-linksHeading data-bind="text: editLinkHeader"></div><label class=Sharing-linkInput-label data-bind="text: editLinkDescription"></label><div class=Sharing-linksArea><!--ko if:showAnonymousEditLink--><input class=Sharing-linkInput-textbox readonly data-bind="value: anonymousEditLinkUrl, selectOnFocus: true, event: { copy: copyEditLink }, disable: processingEditLink, attr: { \'aria-label\': editLinkDescription }"><!--/ko--><a class=Sharing-updateLinkButton href=javascript; data-bind="text: anonymousEditLinkButtonText, click: modifyEditLink"></a></div><div class=SharingLinks-progressBox data-bind="component: {name: progressSpinnerFlatTagName}, visibility: processingEditLink"></div><div aria-live=assertive class=SharingLinks-error data-bind="if: editLinkError"><span data-bind="text: editLinkError"></span></div></div><!--/ko-->'}),define("odsp-next/controls/sharingLinks/SharingLinks.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".Sharing-linkInput-label,.Sharing-updateLinkButton{font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400}.SharingLinks-loadingSpinner{text-align:center;padding:75px 0}.Sharing-linkInput-label{color:#666;display:block;padding-top:5px;padding-bottom:8px}.Sharing-linkInput-textbox{width:75%;padding:1px 5px 2px 10px;text-overflow:ellipsis}html[dir=rtl] .Sharing-linkInput-textbox{padding:1px 10px 2px 5px;margin-left:15px}html[dir=ltr] .Sharing-linkInput-textbox{margin-right:15px}.Sharing-linksHeading{padding:0 0 5px}.Sharing-linksArea{height:25px}.Sharing-updateLinkButton{color:#333;text-transform:uppercase}a.Sharing-updateLinkButton{color:#0078d7;text-decoration:none}.Sharing-linksSection{padding-bottom:20px}.SharingLinks-error{color:#a80000}")}),define("odsp-next/controls/sharingLinks/SharingLinks",["require","exports","./SharingLinksViewModel","odsp-shared/utilities/knockout/ComponentFactory","./SharingLinks.html","./SharingLinks.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-sharingLinks",template:e("./SharingLinks.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/SwitchSharingLinkAction",["require","exports","../base/BaseAction","odsp-utilities/async/Promise","../resources/ProviderResourceKeys","odsp-utilities/logging/events/Qos.event"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this.name="SwitchSharingLink",this._item=t.item,this._items=t.items,this._newLink=t.link,this._successCallback=t.successCallback,this._failureCallback=t.failureCallback,this._isExecuting=t.isExecuting,this._sharingProvider=this.resources.consume(n.sharing),this._expiration=t.expiration}return __extends(t,e),t.prototype.onExecute=function(){var e=this,t=Boolean(this._expiration)&&"CUSTOM"!==this._expiration?new Date(this._expiration).toLocaleDateString():null,i=Boolean(this._newLink.expiration)?new Date(this._newLink.expiration).toLocaleDateString():null;if(!this._newLink.isActive||Boolean(this._expiration)&&"CUSTOM"!==this._expiration&&t!==i||!Boolean(this._expiration)&&Boolean(this._newLink.expiration)){this._isExecuting&&this._isExecuting(!0);var n=function(t){var i={};e._sharingProvider.manageSharingLinks({item:e._item,items:e._items,type:e._newLink.type,role:e._newLink.role,create:!0,expiration:e._expiration}).then(function(o){e._successCallback&&e._successCallback(o[0]),i.resultType=r.ResultTypeEnum.Success,t(i)},function(o){e._failureCallback&&e._failureCallback(Boolean(o)&&Boolean(o.message)?o.message.value:""),i.resultType=r.ResultTypeEnum.Failure,t(i)})};return new o.default(n)}return this._successCallback&&this._successCallback(this._newLink,this._expiration),o.default.wrap({resultType:r.ResultTypeEnum.Success})},t.prototype.onIsAvailable=function(){return!0},t}(i);return s}),define("odsp-next/utilities/browser/ClipboardData",["require","exports"],function(){var e=function(){function e(){}return e.CopyToClipboard=function(t){e.CanUseClipboardData()&&window.clipboardData.setData("Text",t)},e.CanUseClipboardData=function(){var e=window;return e&&"undefined"!=typeof e.clipboardData&&"undefined"!=typeof e.clipboardData.setData},e}();return e}),define("odsp-next/utilities/sharing/SharingHelper",["require","exports","knockout","./SharingHelper.resx","odsp-utilities/logging/events/Engagement.event","../../models/dialog/DialogState","../../controls/confirmation/Confirmation","odsp-utilities/async/Promise","../browser/WindowSize","../../utilities/icons/Icon"],function(e,t,i,o,n,r,s,a,l,d){function c(e,t,c,p){"use strict";var u=i.observable(!0);return c.requestDialog({title:o.strings.DisableLinkConfirmationTitle,size:l.Medium,component:{name:s.tagName,params:{message:o.strings.DisableLinkConfirmationMessage}},actions:[{name:o.strings.DisableLinkConfirmationButton,execute:function(){n.Engagement.logData({name:"Confirm.DisableLink."+p+".Click"}),u(!1);var i=e().then(function(e){return a.default.wrap(e?r.completed:r.dismissed)});return t(i),i},isDefault:!0,isAvailable:u,icon:d.save,automationId:"UnshareConfirm"},{name:o.strings.KeepExistingLinkButton,execute:function(){return n.Engagement.logData({name:"KeepExisting.DisableLink."+p+".Click"}),a.default.wrap(r.dismissed)},isDefault:!1,icon:d.x,automationId:"UnshareCancel"}],executeDefaultAction:!1})}t.disableLinkConfirm=c});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharingLinksSelector/SharingLinksSelectorViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","odsp-utilities/async/Promise","../../resources/ControlResourceKeys","../../resources/ProviderResourceKeys","odsp-utilities/logging/events/Engagement.event","../loadingSpinner/LoadingSpinner","../progressSpinnerFlat/ProgressSpinnerFlat","./SharingLinksSelector","./SharingLinksSelector.resx","../../models/sharing/SharingLinkType","../../models/sharing/SharingRole","../../bindings/css/VisibilityBinding","../../utilities/features/Features","../commands/CommandViewModel","../../bindings/contextMenu/ContextMenuAlignment","../../bindings/dismiss/DismissBinding","odsp-shared/utilities/string/StringHelper","../../actions/SwitchSharingLinkAction","../../bindings/html/BindableHtmlBinding","../../utilities/locale/Locale","../../bindings/focus/SelectOnFocusBinding","../../utilities/browser/ClipboardData","../../utilities/sharing/SharingHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_,k,T,S,w){var P=function(e){function t(t){var o=this;e.call(this,t),this.sharingLinksSelectorTagName=c.tagName,this.loadingSpinnerTagName=l.tagName,this.progressSpinnerFlatTagName=d.tagName,t.item&&(this._item=t.item),this.addBindingHandlers({bindableHtml:_,dismiss:b,selectOnFocus:T.default,visibility:m}),this._selectionModel=this.resources.consume(r.itemsSelection),this._sharingProvider=this.resources.consume(s.sharing),this.loading=i.observable(!0),this.hasLoadingError=i.observable(!1),this.sharingLinksSelectorStrings=p.strings,this.isAnonymousLinkExpirationFeatureEnabled=g.default.isFeatureEnabled(g.default.AnonymousLinkExpiration),this.error=i.observable(""),this.shouldShowSharingLinkCopyButton=S.CanUseClipboardData(),this._guestLinkExists=t.guestLinkExists?t.guestLinkExists:i.observable(!1),this.sharingLinkMenuItems=i.observableArray(),this.isSharingLinkMenuOpen=i.observable(!1),this.menuAlignment=i.observable(k.isRightToLeft?v.Left:v.Right),this.menuLeft=i.observable(k.isRightToLeft?"0":"auto"),this.linkSelectorCurrentLabelText=i.observable(""),this.currentSharingLink=i.observable(null),this.canRemoveCurrentSharingLink=i.observable(!1),this.processingSharingLink=i.observable(!0),this.sharingLinkError=i.observable(""),this.linkExpirationMenuItems=i.observableArray(),this.isLinkExpirationMenuOpen=i.observable(!1),this.shouldShowLinkExpiration=i.observable(!1),this.shouldShowCustomExpiration=i.observable(!1),this.sharingLinkExpirationDate=i.observable(""),this.sharingLinkExpirationLabel=i.observable(""),this.sharingLinkExpirationNumDays=i.observable(0),this._companyDisplayName=i.observable("");var n=this.resources.consume(s.suiteNav);n&&n.loadData().then(function(e){o._companyDisplayName(e.CompanyDisplayName),null!=o.currentSharingLink()&&o._setCurrentLinkLabelText(o.currentSharingLink())});var a=this._sharingProvider.getSharingData(this._getCurrentItem()),u=null,h=null;this.isSingleLinkLabelVisible=!0,this.isReady=a.getSettings().then(function(e){return u=e,o.canManageLinks=e.canManageLinks,a.getBestSharingLink()},function(){}).then(function(e){return e&&(h=e,o._setCurrentSharingLink(e),o.processingSharingLink(!1)),o._getSharingLinks()},function(){o._handleSharingLinkError(),o.hasLoadingError(!0)}).then(function(e){null!=e&&(o.isSingleLinkLabelVisible=e.length<2,null==o.currentSharingLink()&&o._setCurrentSharingLink(h?h:e.length>0?e[0]:null),t.linksAvailable&&t.linksAvailable(!0)),o.loading(!1)},function(){o._handleSharingLinkError(),o.hasLoadingError(!0),o.loading(!1)})}return __extends(t,e),t.prototype.removeSharingLink=function(){var e=this;if(this.processingSharingLink())return!1;this.processingSharingLink(!0);var t=this.resources.consume(s.dialog);this._confirmDialog=w.disableLinkConfirm(function(){return a.Engagement.logData({name:"Disable"+e.currentSharingLink().tag+"Link.SharingLinksSelector.Click"}),e._sharingProvider.manageSharingLinks({item:e._getCurrentItem(),type:e.currentSharingLink().type,role:e.currentSharingLink().role,create:!1}).then(function(t){if(null!=t&&0===t.length){var i=e._sharingProvider.getSharingData(e._getCurrentItem());return i.getBestSharingLink().then(function(t){return e.processingSharingLink(!1),t?(e._setCurrentSharingLink(t),!0):(e._handleSharingLinkError(),!1)},function(){return e._handleSharingLinkError(),!1})}return e._handleSharingLinkError(),n.default.wrap(!1)},function(){return e._handleSharingLinkError(),!1})},function(t){e.isReady=t},t,"SharingLinkSelector")},t.prototype.copySharingLink=function(){return a.Engagement.logData({name:this.currentSharingLink().tag+"Link.SharingLinksSelector.Copy"}),!0},t.prototype.executeDisableConfirm=function(){this._confirmDialog&&this._confirmDialog.actions[0].execute()},t.prototype.onClickSharingLinkMenu=function(){var e=this;if(this.processingSharingLink())return null;var t=[];return this.isReady=this._getSharingLinks().then(function(i){null!=i&&i.forEach(function(i){if(i.type!==u.Direct){var o=e._getLinkLabelText(i),n=new f({text:i.isActive?x.format(e.sharingLinksSelectorStrings.SharingLinkCreated,o):o,isToggleable:!1,action:new(e.managed(y))({item:e._getCurrentItem(),link:i,expiration:i.expiration,isExecuting:e.processingSharingLink,successCallback:function(t){e.shouldShowCustomExpiration(!1),null!=t?(t.type!==e.currentSharingLink().type||t.role!==e.currentSharingLink().role||t.expiration!==e.currentSharingLink().expiration)&&(i.url=t.url,i.expiration=t.expiration,i.isActive=Boolean(i.url),e._setCurrentSharingLink(i),e.processingSharingLink(!1),a.Engagement.logData({name:"SwitchTo"+e.currentSharingLink().tag+"Link.SharingLinksSelector.Click"})):e._handleSharingLinkError()},failureCallback:function(t){e._handleSharingLinkError(t)}})});t.push(n)}})},function(){e._handleSharingLinkError()}),this.sharingLinkMenuItems(t),this.isSharingLinkMenuOpen(!this.isSharingLinkMenuOpen()),t},t.prototype.onDismissSharingLinksMenu=function(){this.isSharingLinkMenuOpen(!1)},t.prototype.onClickCopyLink=function(){return this.processingSharingLink()?!1:(this.copySharingLink(),void S.CopyToClipboard(this.currentSharingLink().url))},t.prototype.onClickLinkExpirationMenu=function(){var e=this;if(this.processingSharingLink())return null;var t=this.currentSharingLink(),i=[],o=this._getAvailableExpirationOptions();return Object.keys(o).forEach(function(n){var r=o[n],s=!isNaN(r)&&r>=0?e._calculateLinkExpiration(r):"CUSTOM",l=new f({text:n,isToggleable:!1,action:new(e.managed(y))({item:e._getCurrentItem(),link:t,expiration:s,isExecuting:e.processingSharingLink,successCallback:function(i,o){null!=i?Boolean(o)&&"CUSTOM"===o?(e.shouldShowCustomExpiration(!0),a.Engagement.logData({name:"Custom.LinkExpiration.SharingLinksSelector.Click"})):(i.type!==e.currentSharingLink().type||i.role!==e.currentSharingLink().role||i.expiration!==e.currentSharingLink().expiration)&&(t.url=i.url,t.expiration=i.expiration,t.isActive=Boolean(t.url),e._setCurrentSharingLink(t),a.Engagement.logData({name:(null!=i.expiration?"Set":"Remove")+".LinkExpiration.SharingLinksSelector.Click"})):e._handleSharingLinkError(),e.processingSharingLink(!1)},failureCallback:function(){e._handleSharingLinkError()}})});i.push(l)}),this.linkExpirationMenuItems(i),this.isLinkExpirationMenuOpen(!this.isLinkExpirationMenuOpen()),i},t.prototype.onDismissLinkExpirationMenu=function(){this.isLinkExpirationMenuOpen(!1)},t.prototype.onClickSaveCustomExpiration=function(){var e=this;if(this.processingSharingLink())return!1;var t=parseInt(String(this.sharingLinkExpirationNumDays()),10);if(String(this.sharingLinkExpirationNumDays())===String(t)&&t>=0&&730>=t){var i=1440,o=t>0?this._calculateLinkExpiration(t*i):null;this.sharingLinkError(""),this.processingSharingLink(!0),this._sharingProvider.manageSharingLinks({item:this._getCurrentItem(),type:this.currentSharingLink().type,role:this.currentSharingLink().role,create:!0,expiration:o}).then(function(t){if(e.processingSharingLink(!1),null!=t&&t.length>0){var i=e.currentSharingLink(),o=t[0];i.url=o.url,i.expiration=o.expiration,i.isActive=Boolean(i.url),e._setCurrentSharingLink(i)}},function(){e._handleSharingLinkError()})}else this._handleSharingLinkError(this.sharingLinksSelectorStrings.LinkExpiration_InvalidValueErrorMessage)},t.prototype.onClickCancelCustomExpiration=function(){return this.processingSharingLink()?!1:(this.shouldShowCustomExpiration(!1),void this.sharingLinkError(""))},t.prototype._getAvailableExpirationOptions=function(){var e=this,t=[1,30,60],i=[],o=1440;return i[this.sharingLinksSelectorStrings.LinkExpiration_Never]=0,t.forEach(function(t){var n=1===t?e.sharingLinksSelectorStrings.LinkExpiration_SingleDay:x.format(e.sharingLinksSelectorStrings.LinkExpiration_MultiDay,t),r=t*o;i[n]=r}),i[this.sharingLinksSelectorStrings.LinkExpiration_Custom]=-1,i},t.prototype._getSharingLinks=function(){var e=this,t=this._sharingProvider.getSharingData(this._getCurrentItem());return t.getLinks().then(function(t){var i=!1;return t&&t.forEach(function(e){e.type!==u.View&&e.type!==u.Edit||!e.isActive||(i=!0)}),e._guestLinkExists(i),t},function(){return e.error(e.sharingLinksSelectorStrings.ServerError),e.hasLoadingError(!0),null})},t.prototype._setCurrentSharingLink=function(e){if(e&&(this.currentSharingLink(e),this._setCurrentLinkLabelText(e),e.type!==u.View&&e.type!==u.Edit||!e.isActive||this._guestLinkExists(!0),this.canRemoveCurrentSharingLink(e.type!==u.Direct&&this.canManageLinks),this.shouldShowLinkExpiration(this.isAnonymousLinkExpirationFeatureEnabled&&e.supportsExpiration),e.supportsExpiration)){var t=e.expiration?new Date(e.expiration).toLocaleDateString():null;this.sharingLinkExpirationDate(t?x.format(this.sharingLinksSelectorStrings.LinkExpiration_DateDescription,t):""),this.sharingLinkExpirationLabel(t?this.sharingLinksSelectorStrings.UpdateSharingLinkExpiration:this.sharingLinksSelectorStrings.SetSharingLinkExpiration);var i=e.expiration?Math.abs(new Date(e.expiration).getTime()-(new Date).getTime()):0,o=Math.ceil(i/864e5);this.sharingLinkExpirationNumDays(o),this.shouldShowCustomExpiration(!1)}},t.prototype._setCurrentLinkLabelText=function(e){this.linkSelectorCurrentLabelText(this._getLinkLabelText(e))},t.prototype._getLinkLabelText=function(e){if(e)switch(e.type){case u.Direct:return this.sharingLinksSelectorStrings.DirectLinkLabel;case u.Organization:var t=Boolean(this._companyDisplayName())?x.format(this.sharingLinksSelectorStrings.OrganizationTenantAccountRequired,this._companyDisplayName()):this.sharingLinksSelectorStrings.OrganizationAccountRequired;return x.format(e.role===h.Edit?this.sharingLinksSelectorStrings.DropdownEditLabel:this.sharingLinksSelectorStrings.DropdownViewOnlyLabel,t);case u.View:return x.format(this.sharingLinksSelectorStrings.DropdownViewOnlyLabel,this.sharingLinksSelectorStrings.NoSignInRequiredLabel);
case u.Edit:return x.format(this.sharingLinksSelectorStrings.DropdownEditLabel,this.sharingLinksSelectorStrings.NoSignInRequiredLabel)}return""},t.prototype._calculateLinkExpiration=function(e){if(e>0){var t=new Date;return t.setMinutes(t.getMinutes()+e),t.toString()}return null},t.prototype._getCurrentItem=function(){return this._item?this._item:i.utils.unwrapObservable(this._selectionModel.selection()[0])},t.prototype._handleSharingLinkError=function(e){this.processingSharingLink(!1),this.sharingLinkError(Boolean(e)?e:this.sharingLinksSelectorStrings.ServerError)},t}(o);return P}),define("odsp-next/controls/sharingLinksSelector/SharingLinksSelector.html",[],function(){return'<!--ko if:loading--><div class=od-SharingLinksSelector-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot:loading--><div aria-live=assertive class=od-SharingLinksSelector-error data-bind="if: error"><span data-bind="text: error"></span></div><div class=od-SharingLinksSelector-sharingLinkSelector data-bind="ifnot: hasLoadingError"><div class=od-SharingLinksSelector-linkPickerArea><!--ko if:isSingleLinkLabelVisible--><span class=od-SharingLinksSelector-linkInput-label data-bind="text: linkSelectorCurrentLabelText()"></span><!--/ko--><!--ko ifnot:isSingleLinkLabelVisible--><a href=javascript:; class="od-SharingLinksSelector-dropdownLinkContainer ms-fontColor-neutralPrimary ms-lines ms-fullWidth" aria-haspopup=true data-bind="click: onClickSharingLinkMenu, dismiss: onDismissSharingLinksMenu, attr: {\'aria-expanded\': isSharingLinkMenuOpen}"><span class=od-SharingLinksSelector-dropdownText data-bind="text: linkSelectorCurrentLabelText()"></span> <i class="ms-Icon ms-Icon--chevronDown od-SharingLinksSelector-dropdownArrow" data-bind="title: sharingLinksSelectorStrings.OpenMenuTooltip"></i></a><ms-contextual-menu params="{ items: sharingLinkMenuItems, isOpen: isSharingLinkMenuOpen, alignment: menuAlignment, left: menuLeft}"></ms-contextual-menu><!--/ko--></div><div class="Sharing-table od-SharingLinksSelector-linkBoxArea"><div class=Sharing-row><div class="Sharing-cell od-SharingLinksSelector-linksArea"><input class=od-SharingLinksSelector-linkInput-textbox readonly data-bind="selectOnFocus: { isPermanent: true }, value: currentSharingLink().url, event: { copy: copySharingLink }, disable: processingSharingLink, attr: { \'aria-label\': linkSelectorCurrentLabelText(), title: currentSharingLink().url }"></div><div data-bind="visible: shouldShowSharingLinkCopyButton" class=Sharing-cell><button class="ms-Dialog-action ms-Button ms-Button--primary od-SharingLinksSelector-copyButton" data-bind="click: onClickCopyLink"><span class="ms-Button-label od-SharingLinksSelector-copyButton-label" data-bind="text: sharingLinksSelectorStrings.CopyLink"></span></button></div><div class=Sharing-cell><a class=od-SharingLinksSelector-updateLinkButton href=javascript:; data-bind="visible: canRemoveCurrentSharingLink, text: sharingLinksSelectorStrings.RemoveLink, click: removeSharingLink, automation: \'SharingLinksSelector-removeLink\'"></a></div></div><div class="Sharing-row od-SharingLinksSelector-progressBox" data-bind="component: {name: progressSpinnerFlatTagName}, visibility: processingSharingLink"></div></div><!--ko if:shouldShowLinkExpiration--><div class=od-SharingLinksSelector-linkExpirationArea><div data-bind="visible: !shouldShowCustomExpiration(), automation: \'SharingLinksSelector-expiration-selector\'"><span class=od-SharingLinksSelector-expiration-expirationText data-bind="visible: Boolean(sharingLinkExpirationDate()), text: sharingLinkExpirationDate, automation: \'SharingLinksSelector-expiration-expirationSpan\'"></span> <span class=od-SharingLinksSelector-LinkExpirationMenuArea><a href=javascript:; class="od-SharingLinksSelector-updateLinkButton od-SharingLinksSelector-expiration-dropdownLinkContainer" aria-haspopup=true data-bind="click: onClickLinkExpirationMenu, dismiss: onDismissLinkExpirationMenu, attr: {\'aria-expanded\': isLinkExpirationMenuOpen}"><span class="od-SharingLinksSelector-expiration-dropdownText ms-uppercase" data-bind="text: sharingLinkExpirationLabel"></span> <i class="ms-Icon ms-Icon--chevronDown ms-callout-icon od-SharingLinksSelector-expiration-dropdownArrow" data-bind="title: sharingLinksSelectorStrings.OpenMenuTooltip"></i></a><ms-contextual-menu params="{ items: linkExpirationMenuItems, isOpen: isLinkExpirationMenuOpen, alignment: menuAlignment, left: menuLeft}"></ms-contextual-menu></span></div><div class=ms-fullWidth data-bind="visible: shouldShowCustomExpiration"><div class=od-SharingLinksSelector-expiration-expirationText><span data-bind="text: sharingLinksSelectorStrings.LinkExpiration_CustomValueLabel_BeforeTextBox"></span> <input type=text class=od-SharingLinksSelector-expirationInput data-bind="selectOnFocus: { isPermanent: true }, value: sharingLinkExpirationNumDays, title: sharingLinksSelectorStrings.LinkExpiration_CustomValueTooltip"> <span data-bind="text: sharingLinksSelectorStrings.LinkExpiration_CustomValueLabel_AfterTextBox"></span></div><div class=od-SharingLinksSelector-expiration-buttons><a href=javascript:; class="od-SharingLinksSelector-updateLinkButton od-SharingLinksSelector-expiration-expirationSave" data-bind="click: onClickSaveCustomExpiration, text: sharingLinksSelectorStrings.SaveCustomExpiration, automation: \'SharingLinksSelector-expiration-saveLink\'"></a> <a href=javascript:; class="od-SharingLinksSelector-updateLinkButton od-SharingLinksSelector-expiration-expirationSave" data-bind="click: onClickCancelCustomExpiration, text: sharingLinksSelectorStrings.CancelCustomExpiration, automation: \'SharingLinksSelector-expiration-cancelLink\'"></a></div></div></div><!--/ko--><div aria-live=assertive class=od-SharingLinksSelector-error data-bind="if: sharingLinkError"><span data-bind="text: sharingLinkError"></span></div></div><!--/ko-->'}),define("odsp-next/controls/sharingLinksSelector/SharingLinksSelector.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles("html[dir=ltr] .od-SharingLinksSelector-linkInput-textbox,html[dir=ltr] button.od-SharingLinksSelector-copyButton{margin-right:15px}.od-SharingLinksSelector-sharingLinkSelector{height:200px}.od-SharingLinksSelector-loadingSpinner{text-align:center;padding:75px 0}.od-SharingLinksSelector-linkInput-label{color:#666;display:block;padding-top:5px}.od-SharingLinksSelector-linkInput-textbox{width:75%;padding:1px 5px 2px 10px;text-overflow:ellipsis}html[dir=rtl] .od-SharingLinksSelector-linkInput-textbox{padding:1px 10px 2px 5px;margin-left:15px}.od-SharingLinksSelector-linksArea{width:100%}.od-SharingLinksSelector-updateLinkButton{color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400;text-transform:uppercase;white-space:nowrap;display:inline-block;cursor:pointer}a.od-SharingLinksSelector-updateLinkButton{color:#0078d7;text-decoration:none}.od-SharingLinksSelector-linksSection{padding-bottom:20px}.od-SharingLinksSelector-error{color:#a80000}.od-SharingLinksSelector-linkPickerArea{margin-bottom:14px}.od-SharingLinksSelector-dropdownLinkContainer{display:inline-block;box-sizing:border-box;border:1px solid #666;width:433px;padding:4px 10px 2px}@media (max-width:639px){.od-SharingLinksSelector-dropdownLinkContainer{width:223px}}.od-SharingLinksSelector-dropdownLinkContainer:hover,.od-SharingLinksSelector-dropdownLinkContainer:visited{color:inherit;text-decoration:none}.od-SharingLinksSelector-dropdownArrow,.od-SharingLinksSelector-expiration-dropdownArrow{display:inline-block;position:relative;top:-3px}.od-SharingLinksSelector-linkTypeText{padding:10px}.od-SharingLinksSelector-expiry-div{border-collapse:separate}.od-SharingLinksSelector-singleLinkLabel{display:inline-block;width:433px;padding:4px 0;margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width:639px){.od-SharingLinksSelector-singleLinkLabel{width:223px}}.od-SharingLinksSelector-dropdownText{display:inline-block;width:393px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width:639px){.od-SharingLinksSelector-dropdownText{width:183px}}.od-SharingLinksSelector-expiration-dropdownText{display:inline-block;overflow:hidden}.od-SharingLinksSelector-linkBoxArea{margin-bottom:5px}.od-SharingLinksSelector-sharingLinkSelector .od-SharingLinksSelector-linkInput-textbox{box-sizing:border-box;width:95%}button.od-SharingLinksSelector-copyButton{padding:0 10px;height:1.7em}html[dir=rtl] button.od-SharingLinksSelector-copyButton{margin-left:15px}.od-SharingLinksSelector-copyButton-label{position:relative;top:-1px}.od-SharingLinksSelector-linkExpirationArea{margin-bottom:7px}.od-SharingLinksSelector-LinkExpirationMenuArea{display:inline-block}.od-SharingLinksSelector-expiration-dropdownLinkContainer{display:inline-block;vertical-align:middle}.od-SharingLinksSelector-expiration-expirationText{display:inline-block}html[dir=ltr] .od-SharingLinksSelector-expiration-expirationText{padding-right:10px}html[dir=rtl] .od-SharingLinksSelector-expiration-expirationText{padding-left:10px}.od-SharingLinksSelector-expirationInput{display:inline-block;width:30px;margin-top:-5px;cursor:text}.od-SharingLinksSelector-expiration-buttons{display:inline-block}.od-SharingLinksSelector-expiration-expirationSave{display:inline-block;vertical-align:text-bottom}html[dir=ltr] .od-SharingLinksSelector-expiration-expirationSave{margin-right:10px}html[dir=rtl] .od-SharingLinksSelector-expiration-expirationSave{margin-left:10px}.od-SharingLinksSelector-expiration-expirationError{margin-top:6px}")}),define("odsp-next/controls/sharingLinksSelector/SharingLinksSelector",["require","exports","./SharingLinksSelectorViewModel","odsp-shared/utilities/knockout/ComponentFactory","./SharingLinksSelector.html","./SharingLinksSelector.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-sharingLinksSelector",template:e("./SharingLinksSelector.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/tabbedSharing/TabbedSharingViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../resources/ControlResourceKeys","../../resources/ProviderResourceKeys","odsp-utilities/logging/events/Engagement.event","odsp-utilities/logging/events/Qos.event","odsp-utilities/logging/events/Qos.event","../../providers/sharing/CachedSharingProvider","./SharingTab","./TabbedSharing.resx","odsp-shared/utilities/string/StringHelper","../sharing/Sharing.resx","../loadingSpinner/LoadingSpinner","../../utilities/features/Features","../sharingLinks/SharingLinks","../sharingLinksSelector/SharingLinksSelector","../../bindings/keyboard/KeyboardBinding"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b){var x=function(e){function t(t){e.call(this),this.loadingSpinnerTagName=m.tagName,this.sharingParams=t.sharingParams,this.addBindingHandlers({keyboard:b}),this._sharingProvider=this.resources.expose(r.sharing,new(this.managed(d))),this._selectionModel=this.resources.consume(n.itemsSelection),this.itemName=i.observable(""),this.isLoading=i.observable(!0),this.inviteText=p.strings.InviteTabTitle,this.sharedWithText=p.strings.SharedWithTabTitle,this.linksText=p.strings.LinksTabTitle,this.anonymousLinksText=p.strings.GuestLinkText,this.linksAvailable=i.observable(!1),this.guestLinkExists=i.observable(!1),this.sharedWithMany=i.observable(!1),this.sharedWith=i.observableArray([]),this.dialogTab=t.activeTab?t.activeTab:i.observable(c.invite),this._item=t.item,this.getSharingSettings(),this._useLinkSwitcher=g.default.isFeatureEnabled(g.default.CompanyWideSharingLinks)&&g.default.isFeatureEnabled(g.default.ODBNextCompanyWideSharingLinks),this.sharingLinksComponentTagName=this._useLinkSwitcher?v.tagName:f.tagName}return __extends(t,e),t.prototype.switchToSharedWith=function(){this.switchTab(c.sharedWith)},t.prototype.switchTab=function(e){if(e!==this.dialogTab()){var t="";switch(e){case c.invite:t="InviteTab";break;case c.links:t="GetALinkTab";break;case c.sharedWith:t="SharedWithTab"}t+=".SharingDialog.Click",s.Engagement.logData({name:t}),this.dialogTab(e)}},t.prototype.getSharingSettings=function(){var e,t,o=this,n=new a.Qos({name:"TabbedSharingViewModel.getSharingSettings"});if(this._item?e=this._item:this._selectionModel&&this._selectionModel.selection()&&(t=this._selectionModel.selection(),t.length>0&&(e=i.utils.unwrapObservable(t[0]))),!e)return void n.end({resultType:l.ResultTypeEnum.Failure,resultCode:"ItemNotFound"});if(t&&t.length>1)this.sharingParams.dialogTitle(u.format(h.strings.MultiShareTitleText,t.length)),this.isLoading(!1);else{var r=this._sharingProvider.getSharingData(e);r.getSettings().then(function(e){o._sharingSettings=e,o.linksAvailable(e.anonymousLinksEnabled||o._useLinkSwitcher),o.sharedWithMany(e.sharedWithMany),o.itemName(e.itemName),o.sharingParams.dialogTitle(u.format(h.strings.TitleText,e.itemName)),e.sharedWith&&o.sharedWith(e.sharedWith),o.isLoading(!1),n.end({resultType:l.ResultTypeEnum.Success})},function(t){o.sharingParams.dialogTitle(u.format(h.strings.TitleText,e.name)),o.itemName(e.name),o.isLoading(!1),n.end({resultType:l.ResultTypeEnum.Failure,resultCode:"ServerError",extraData:{error:t}})})}},t}(o);return x}),define("odsp-next/controls/tabbedSharing/TabbedSharing.html",[],function(){return'<div class=od-TabbedSharing><!--ko if: isLoading--><div class=od-TabbedSharing-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot: isLoading--><div class=od-TabbedSharing-sharingHints data-bind="component: {name: \'ms-sharingHints\', params: { guestLinkExists: guestLinkExists, sharedWithMany: sharedWithMany, sharedWithCallback: switchToSharedWith.bind($data), itemName: itemName, sharedWith: sharedWith }}"></div><!--/ko--><div class=od-TabbedSharing-table style="display: none" data-bind="visible: !isLoading()"><div class=od-TabbedSharing-row><div class=od-TabbedSharing-tabs role=tablist><a href=javascript: role=tab aria-controls=tsd-invite class=od-TabbedSharing-tab-link data-bind="click: switchTab.bind($data, 1), keyboard: { Space: switchTab.bind($data, 1)}, css: {selected: dialogTab() == 1}, text: inviteText, attr: {\'aria-selected\': (dialogTab() == 1).toString()}"></a> <a href=javascript: role=tab aria-controls=tsd-links style="display: none" class=od-TabbedSharing-tab-link data-bind="click: switchTab.bind($data, 2), keyboard: { Space: switchTab.bind($data, 2)}, css: {selected: dialogTab() == 2}, text: linksText, attr: {\'aria-selected\': (dialogTab() == 2).toString()}, visible: linksAvailable()"></a> <a href=javascript: role=tab aria-controls=tsd-sharedWith class=od-TabbedSharing-tab-link data-bind="click: switchTab.bind($data, 3), keyboard: { Space: switchTab.bind($data, 3)}, css: {selected: dialogTab() == 3}, text: sharedWithText, attr: {\'aria-selected\': (dialogTab() == 3).toString()}"></a></div><div class=od-TabbedSharing-spacer>&nbsp;</div><div style="display: table-cell"><div role=tabpanel id=tsd-invite style="display: none" data-bind="visible: dialogTab() == 1"><div class=od-TabbedSharing-sharing data-bind="component: {name: \'ms-share\', params: sharingParams }"></div></div><!--ko if: linksAvailable--><div role=tabpanel id=tsd-links style="display: none" data-bind="visible: dialogTab() == 2"><div class=od-TabbedSharing-links data-bind="component: {name: sharingLinksComponentTagName, params: { linksAvailable: linksAvailable, guestLinkExists: guestLinkExists }}"></div></div><!--/ko--><div role=tabpanel id=tsd-sharedWith style="display: none" data-bind="visible: dialogTab() == 3"><div class=od-TabbedSharing-sharedWith data-bind="component: {name: \'ms-sharedWith\', params: {height: \'300px\'}}"></div></div></div></div></div></div>'}),define("odsp-next/controls/tabbedSharing/TabbedSharing.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-TabbedSharing{box-sizing:border-box;margin:0;padding:0;box-shadow:none;color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:14px;font-weight:400;overflow:hidden;min-height:200px}html[dir=ltr] .ms-Dialog-content .od-TabbedSharing{margin-left:-20px}html[dir=rtl] .ms-Dialog-content .od-TabbedSharing{margin-right:-20px}@media (max-width:479px){html[dir=ltr] .ms-Dialog-content .od-TabbedSharing{margin-left:0}html[dir=rtl] .ms-Dialog-content .od-TabbedSharing{margin-right:0}}.od-TabbedSharing-sharingHints{margin-bottom:15px}html[dir=ltr] .od-TabbedSharing-sharingHints{margin-left:20px}html[dir=rtl] .od-TabbedSharing-sharingHints{margin-right:20px}.od-TabbedSharing-table{display:table;width:100%;border-collapse:collapse}.od-TabbedSharing-row{display:table-row}.od-TabbedSharing-tabs{display:table-cell;vertical-align:top;width:130px}@media (max-width:479px){html[dir=ltr] .od-TabbedSharing-sharingHints{margin-left:0}html[dir=rtl] .od-TabbedSharing-sharingHints{margin-right:0}.od-TabbedSharing-tabs{display:none}}.od-TabbedSharing-spacer{width:32px;display:table-cell}html[dir=ltr] .od-TabbedSharing-spacer{border-left:1px solid #c8c8c8}html[dir=rtl] .od-TabbedSharing-spacer{border-right:1px solid #c8c8c8}@media (max-width:479px){.od-TabbedSharing-spacer{display:none}}.od-TabbedSharing-loadingSpinner{margin-top:90px;text-align:center}.od-TabbedSharing-tab-link,.od-TabbedSharing-tab-link:visited{text-decoration:none;padding:8px 20px;display:block;white-space:nowrap;color:#333;font-size:12px;font-weight:400;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif}.od-TabbedSharing-tab-link.selected,.od-TabbedSharing-tab-link:visited.selected{background-color:#d7eaf9;font-family:'Segoe UI Semibold WestEuropean','Segoe UI Semibold','Segoe WP Semibold','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif}.od-TabbedSharing-tab-link:hover{background-color:#e6f2fb;color:#333}.od-TabbedSharing-tab-link:hover.selected{background-color:#f4f4f4}")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharingTips/SharingTipsViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","./SharingTips","./SharingTips.resx","odsp-shared/utilities/string/StringHelper","odsp-utilities/logging/events/Engagement.event","../../models/peoplePicker/EntityType"],function(e,t,i,o,n,r,s,a,l){var d=function(e){function t(t){var o=this;e.call(this,t),this.SharingTipsTagName=n.tagName,this._resolvedUsers=t.selectedPeople,this.showAdvancedMessage=t.showAdditionalSharingWarning,this.advancedWarningText=r.strings.GallatinMessage,this.multiExternalUserText=r.strings.MultiExternalUserText,this.expandUsersText=i.observable(r.strings.Show),this.expandGroupsText=i.observable(r.strings.Show),this.showMultiUsers=i.observable(!1),this.showGroups=i.observable(!1),this.singleExternalUserText=i.observable(""),this.groupsText=i.observable(""),this._renderedExternalUsers=!1,this._renderedGroups=!1,this.externalUsers=this.createComputed(function(){for(var e=[],t=0;t<o._resolvedUsers().length;t++)o._resolvedUsers()[t].entityType===l.externalUser&&e.push(o._resolvedUsers()[t]);if(1===e.length){var i='<span class="od-SharingTips-resolvedUser">'+e[0].email+"</span>";o.singleExternalUserText(s.format(r.strings.SingleExternalUserText,i)),o.showMultiUsers(!1)}return e.length>0&&!o._renderedExternalUsers&&(o._renderedExternalUsers=!0,a.Engagement.logData({name:"ExternalUsers.SharingTips.Render"})),e}),this.groups=this.createComputed(function(){for(var e=[],t=0;t<o._resolvedUsers().length;t++)o._resolvedUsers()[t].entityType===l.group&&e.push(o._resolvedUsers()[t]);return o.groupsText(e.length>1?s.format(r.strings.MultiGroupText,e.length):s.format(r.strings.SingleGroupText,e.length)),e.length>0&&!o._renderedGroups&&(o._renderedGroups=!0,a.Engagement.logData({name:"Groups.SharingTips.Render"})),e})}return __extends(t,e),t.prototype.clickExpandUsers=function(){this.showMultiUsers()?(this.expandUsersText(r.strings.Show),this.showMultiUsers(!1)):(a.Engagement.logData({name:"ExpandUsers.SharingTips.Click"}),this.expandUsersText(r.strings.Hide),this.showMultiUsers(!0))},t.prototype.clickExpandGroups=function(){this.showGroups()?(this.expandGroupsText(r.strings.Show),this.showGroups(!1)):(a.Engagement.logData({name:"ExpandGroups.SharingTips.Click"}),this.expandGroupsText(r.strings.Hide),this.showGroups(!0))},t}(o);return d}),define("odsp-next/controls/sharingTips/SharingTips.html",[],function(){return'<div class=od-SharingTips><div class=od-SharingTips-section data-bind="if: externalUsers().length > 0"><div data-bind="if: externalUsers().length === 1"><div class=od-SharingTips-singleExternalUser data-bind="html: singleExternalUserText"></div></div><div data-bind="if: externalUsers().length > 1"><span class=od-SharingTips-multiUser data-bind="text: multiExternalUserText"></span> <a class=od-SharingTips-expandLink href=javascript:; data-bind="text: expandUsersText, click: clickExpandUsers"></a><div><!--ko if: showMultiUsers--><ul class=od-SharingTips-multiUserList data-bind="foreach: externalUsers"><li class=od-SharingTips-resolvedUser data-bind="text: email"></li></ul><!--/ko--></div></div><ms-dlplite></ms-dlplite><!--ko if: showAdvancedMessage--><div data-bind="text: advancedWarningText"></div><!--/ko--></div><div class=od-SharingTips-section data-bind="if: groups().length > 0"><span class=od-SharingTips-multiUser data-bind="text: groupsText"></span> <a class=od-SharingTips-expandLink href=javascript:; data-bind="text: expandGroupsText, click: clickExpandGroups"></a><div><!--ko if: showGroups--><ul class=od-SharingTips-multiUserList data-bind="foreach: groups"><li class=od-SharingTips-resolvedUser data-bind="text: name"></li></ul><!--/ko--></div></div></div>'}),define("odsp-next/controls/sharingTips/SharingTips.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles('.od-SharingTips-section{margin-top:6px}html[dir=ltr] .od-SharingTips-section{margin-left:6px}html[dir=rtl] .od-SharingTips-section{margin-right:6px}.od-SharingTips-resolvedUser{display:inline-block;font-weight:700}.od-SharingTips-multiUserList{display:inline;list-style:none;padding:0}.od-SharingTips-multiUserList li{display:inline}.od-SharingTips-multiUserList li:after{content:", "}.od-SharingTips-multiUserList li:last-child:after{content:""}.od-SharingTips-expandLink{display:inline-block}')});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/dlplite/DlpLiteViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","./DlpLite.resx","../../resources/DataSourceResourceKeys"],function(e,t,i,o,n,r){var s=function(e){function t(){var t=this;e.call(this),this.strings=n.strings,this.isVisible=o.observable(!1),this.externalSharingLearnUrl=o.observable("javascript:");var i=this.resources.consume(r.policyTip);i.getExternalSharingStatus().then(function(e){Boolean(e)&&(t.isVisible(e.isExternalSharingTipEnabled),t.externalSharingLearnUrl(e.externalSharingTipsLearnMoreUrl))},function(){})}return __extends(t,e),t}(i);return s}),define("odsp-next/controls/dlplite/DlpLite.html",[],function(){return'<div class=ms-DlpLite data-bind="visible: isVisible"><span class=ms-DlpLite-middle data-bind="text: strings.bannerWarning"></span> <a class=ms-DlpLite-middle target=_blank data-bind="text:strings.learnMore, attr: {href: externalSharingLearnUrl}"></a></div>'}),define("odsp-next/controls/dlplite/DlpLite.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".ms-DlpLite{overflow:hidden}")}),define("odsp-next/controls/dlplite/DlpLite",["require","exports","./DlpLiteViewModel","odsp-shared/utilities/knockout/ComponentFactory","./DlpLite.html","./DlpLite.css"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-dlplite",template:e("./DlpLite.html"),viewModel:i});return n}),define("odsp-next/controls/sharingTips/SharingTips",["require","exports","./SharingTipsViewModel","odsp-shared/utilities/knockout/ComponentFactory","./SharingTips.html","./SharingTips.css","../dlplite/DlpLite"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-sharingTips",template:e("./SharingTips.html"),viewModel:i});return n}),define("odsp-next/bindings/uniqueId/UniqueIdBinding",["require","exports","knockout"],function(e,t,i){var o=function(){function e(){}return e.init=function(t,o){var n=i.utils.unwrapObservable(o());if(n.data){var r=n.idPrefix+ ++e.counter;n.data.id=r,t.id=r}},e.counter=0,e}();return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/autoFillPopup/AutoFillViewModel",["require","exports","odsp-shared/base/ViewModel","../../resources/ControlResourceKeys","knockout","./AutoFill.resx","odsp-utilities/logging/events/Engagement.event","odsp-shared/utilities/string/StringHelper","../../bindings/dismiss/DismissBinding","../persona/PersonaSizeEnum","../../bindings/scrollIntoView/ScrollIntoViewBinding","../../bindings/uniqueId/UniqueIdBinding"],function(e,t,i,o,n,r,s,a,l,d,c,p){var u=function(e){function t(){var t=this;e.call(this),this.addBindingHandlers({dismiss:l,scrollIntoView:c,uniqueId:p}),this.params=this.resources.consume(o.autoFillParams),this.menuLabel=r.strings.SuggestedPeopleMenu,this._isOpenObservable=this.params.isOpen||n.observable(!1),this._personaSize=n.observable(d.Small),Boolean(this.params)||(this.params.clickedItem=n.observable(null),this.params.items=n.observableArray([]),this.params.inDataFetch=n.observable(!1),this.params.resultsTrimmed=n.observable(!1)),this.summaryText=this.createComputed(function(){return t.params.resultsTrimmed()?a.format(r.strings.ResultsCapped,t.params.items().length):0===t.params.items().length?r.strings.NoResults:""}),this.isOpen=this.createComputed(function(){return t._isOpenObservable()}),this.summaryVisible=this.createComputed(function(){return t.summaryText().length>0})}return __extends(t,e),t.prototype.onItemClicked=function(e){s.Engagement.logData({name:"SuggestedUser.AutoFill.PeoplePicker.Click"}),this.params.clickedItem(e)},t.prototype.closeMenu=function(){this._isOpenObservable(!1)},t}(i);return u}),define("odsp-next/controls/autoFillPopup/AutoFillPopup.html",[],function(){return"<div class=AutoFill role=menu data-bind=\"attr: {'aria-label': menuLabel }, dismiss: isOpen() && closeMenu\"><!--ko foreach: params.items--><div class=AutoFill-item role=menuitem data-bind=\"uniqueId: {data: $data, idPrefix: 'AFPU'}, click: $parent.onItemClicked.bind($parent), css: {'AutoFill-focused': $data.focused, 'AutoFill-separator': $data.hasSeparator }, scrollIntoView: { isSelected: $data.focused}\"><a class=AutoFill-link href=javascript:><div data-bind=\"component: { name: 'ms-persona', params: { person: data(), size: 'small'} }\"></div></a></div><!--/ko--><!--ko if:summaryVisible--><div class=AutoFill-trimmed data-bind=\"text: summaryText\"></div><!--/ko--></div>"}),define("odsp-next/controls/autoFillPopup/AutoFill.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".AutoFill{border:1px solid #a6a6a6;overflow-y:auto;position:absolute;background-color:#fff;max-height:300px;min-width:300px;max-width:400px;z-index:3001}.AutoFill-item{box-sizing:border-box;overflow:hidden;width:100%;line-height:0}.AutoFill-item.AutoFill-focused{background-color:#a8d1ef;outline:transparent solid 1px}.AutoFill-item:not(.AutoFill-focused):hover{background-color:#eaeaea}.AutoFill-item.AutoFill-separator{border-bottom:1px solid #a6a6a6}.AutoFill-link{text-decoration:none;display:inline-block;width:100%}.AutoFill-link,.AutoFill-trimmed{padding:5px 5px 5px 20px}html[dir=rtl] .AutoFill-link,html[dir=rtl] .AutoFill-trimmed{padding:5px 20px 5px 5px}")}),define("odsp-next/controls/autoFillPopup/AutoFill",["require","exports","./AutoFillViewModel","odsp-shared/utilities/knockout/ComponentFactory","./AutoFillPopup.html","./AutoFill.css","../persona/Persona"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-auto-fill",template:e("./AutoFillPopup.html"),viewModel:i});return n}),define("odsp-next/controls/autoFillPopup/AutoFillItem",["require","exports","knockout"],function(e,t,i){var o=function(){function e(e,t){this.selected=i.observable(!1),this.focused=i.observable(!1),this.hasSeparator=i.observable(!1),this.data=i.observable(),t&&i.utils.extend(this,t),this.data(e),this.id=""}return e}();return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/peoplePicker/PeoplePickerViewModel",["require","exports","odsp-shared/base/ViewModel","knockout","../autoFillPopup/AutoFill","../autoFillPopup/AutoFillItem","../../resources/ProviderResourceKeys","../../resources/ControlResourceKeys","odsp-utilities/logging/events/Engagement.event","./PeoplePicker.resx","./PeoplePicker","../../bindings/selection/SelectionBinding","../progressSpinnerFlat/ProgressSpinnerFlat","../persona/PersonaSizeEnum","../../bindings/keyboard/KeyboardBinding","odsp-shared/utilities/string/StringHelper","../../models/selection/SelectionModel","../../bindings/scrollIntoView/ScrollIntoViewBinding"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v){var b=function(e){function t(t){var i=this;e.call(this),this.resolvedItems=o.observableArray([]),this.inputTitle=o.observable(d.strings.InputHint),this.inputText=o.observable(""),this.error=o.observable(""),this.peoplePickerTagName=c.tagName,this.autoFillPopupTagName=n.tagName,this.progressSpinnerFlatTagName=u.tagName,this.inputChange=function(e,t){i._inputChangeOuter(t)},this._autoFillParams={clickedItem:o.observable(null),items:o.observableArray([]),inDataFetch:o.observable(!1),resultsTrimmed:o.observable(!1),isOpen:o.observable(!1)},this.selectionModel=new f,this.addBindingHandlers({selection:p,keyboard:m,scrollIntoView:v}),this.focusedItem=o.observable(null),this.scrollDown=o.observable(!1),this.selectedDescendantId=this.createComputed(function(){return Boolean(i.focusedItem())?i.focusedItem().id:""}),this._peoplePickerQueryParams=t.peoplePickerQueryParams?t.peoplePickerQueryParams:{allowEmailAddresses:!0,allowMultipleEntities:null,allUrlZones:null,enabledClaimProviders:null,forceClaims:null,groupID:null,maximumEntitySuggestions:5,principalSource:null,principalType:13,required:null,urlZone:null,urlZoneSpecified:null},t.hasUnresolvedText||(t.hasUnresolvedText=o.observable(!1)),this.resolvedSize=o.observable(h.XS),t.selectedPeople&&(t.selectedPeople().length>0&&this.resolvedItems(t.selectedPeople()),this.createComputed(function(){t.selectedPeople(i.resolvedItems())})),this._dataProvider=this.resources.consume(s.people),this.deleteTitle=this.createComputed(function(){return d.strings.RemoveHelp}),this._inputBoxWasEmpty=!0,this.itemClicked=this.createComputed(function(){Boolean(i._autoFillParams.clickedItem())&&i._onAutoFillPicked()}),this.showPlaceholder=o.observable(!0),this.inputPlaceholder=this.createComputed(function(){return""===i.inputText()&&0===i.resolvedItems().length?d.strings.InputPlaceholderText:""}),this.menuOpenText=this.createComputed(function(){return i._autoFillParams.isOpen()?d.strings.SuggestionTip:""}),this.inputSize=this.createComputed(function(){return t.hasUnresolvedText(0!==i.inputText().length),i.inputText().length+1}),this.peopleSuggestions=o.observableArray([]),this.peopleSuggestionsTrimmed=this.createComputed(function(){return i.peopleSuggestions().slice(0,i._peoplePickerQueryParams.maximumEntitySuggestions+i._dataProvider.MaxCacheSuggestions)
}),this.autoFillOpen=this.createComputed(function(){return i._autoFillParams.isOpen()}),this.isSelected=o.observable(!0),this._noMatchesError=d.strings.NoMatchesFound,this._multipleMatchesError=d.strings.MultipleMatchesFound,this._resolveOccurring=!1,this.resources.expose(a.autoFillParams,this._autoFillParams),this.isProgressBarShown=this._autoFillParams.inDataFetch}return __extends(t,e),t.prototype.resolveUsers=function(e,t){this._resolveInput(),t.preventDefault()},t.prototype.formatRemoveString=function(e){return g.format(this.deleteTitle(),e.name)},t.prototype.removeItem=function(e){l.Engagement.logData({name:"RemoveUser.PeoplePicker.Click"}),this.resolvedItems.remove(e),this.isSelected(!0),this._cleanErrors()},t.prototype.personaClick=function(e){if(e.isResolved)l.Engagement.logData({name:"ResolvedUser.PeoplePicker.Click"});else if(e.multipleMatches&&e.multipleMatches.length>0){l.Engagement.logData({name:"UnresolvedUser.Multiple.PeoplePicker.Click"}),this._resolveOccurring=!0,this._personBeingResolved=e;var t=[];this._processPeopleSuggestions(e.multipleMatches,t,!0)}else l.Engagement.logData({name:"UnresolvedUser.Invalid.PeoplePicker.Click"}),this.inputText(e.name),this.removeItem(e)},t.prototype.focus=function(){this.isSelected(!0),this.inputText().length>1&&!this._autoFillParams.isOpen()&&this._autoFillParams.isOpen(!0),this.showPlaceholder()&&this.showPlaceholder(!1)},t.prototype.inputFocus=function(){this.showPlaceholder()&&this.showPlaceholder(!1)},t.prototype.inputBlur=function(){this.showPlaceholder()||0!==this.resolvedItems().length||0!==this.inputText().length?this.inputText().length>1&&(!this.autoFillOpen.peek()||this._autoFillParams.items.peek().length<1)&&(this._abortSearch(!0),this._destroyAutoFill(),this._resolveUser(this.inputText())):this.showPlaceholder(!0)},t.prototype.inputPaste=function(){return l.Engagement.logData({name:"InputPaste.PeoplePicker"}),this.async.setTimeout(function(){var e=document.getElementById("PeoplePicker-textBox");this._resolveOccurring=!0,this._resolveUser(e.value),e.value=""},0),!0},t.prototype.onEnter=function(){var e=this.selectionModel.selection();return e&&1===e.length&&this._autoFillParams.clickedItem(e[0]),!1},t.prototype.getTitle=function(e){return e.isResolved?Boolean(e.providerName)?e.email+"\n"+e.providerName:e.email:e.multipleMatches&&e.multipleMatches.length>0?d.strings.MultipleMatchesFound:d.strings.NoMatchesFound},t.prototype._parseUserKeyPaste=function(e){var t=e.indexOf("<"),i=e.indexOf("@",t),o=e.indexOf(">",i);return-1!==t&&-1!==i&&-1!==o?e.substring(t+1,o):e},t.prototype._replacePerson=function(e){this.resolvedItems.replace(this._personBeingResolved,e),this.isSelected(!0),this._cleanErrors()},t.prototype._cleanErrors=function(){for(var e=this.resolvedItems&&this.resolvedItems().length-1;e>=0;e--)if(!this.resolvedItems()[e].isResolved)return void this.error(this.resolvedItems()[e].multipleMatches&&this.resolvedItems()[e].multipleMatches.length>0?this._multipleMatchesError:this._noMatchesError);this.error("")},t.prototype._inputChangeOuter=function(e){this._timer||this.async.clearTimeout(this._timer),this._timer=this.async.setTimeout(function(){this._inputChange(e),this._timer=null},130)},t.prototype._add=function(e){e.name||(e.name=e.email),null!=this._peoplePickerQueryParams.allowMultipleEntities&&this._peoplePickerQueryParams.allowMultipleEntities===!1&&this.resolvedItems().length>=1?(this.resolvedItems([e]),e.isResolved&&this._cleanErrors()):this.resolvedItems.push(e),this.async.setTimeout(function(){this.scrollDown(!0),this.scrollDown(!1)},0)},t.prototype._inputChange=function(e){var t=e.keyCode;if(38!==t&&40!==t){if(27===t&&this._autoFillParams.isOpen())return this._autoFillParams.isOpen(!1),e.cancelBubble=!0,void e.stopPropagation();var i=this.inputText().length;0===i?(this._resolveOccurring||(this._abortSearch(!0),this._destroyAutoFill()),8!==t&&46!==t||!this._inputBoxWasEmpty||(this.resolvedItems.pop(),this._cleanErrors(),this._destroyAutoFill()),this._inputBoxWasEmpty=!0):1===i?(this._abortSearch(!0),this._destroyAutoFill(),this._inputBoxWasEmpty=!1):59===t||186===t?(this._abortSearch(!0),this._destroyAutoFill(),this._resolveInput()):(this._inputBoxWasEmpty=!1,this._getPeopleSuggestions())}},t.prototype._resolveInput=function(){this._resolveUser(this.inputText())},t.prototype._abortSearch=function(e){this._autoFillParams.inDataFetch.peek()&&(this._peoplePickerSearchPromise&&this._peoplePickerSearchPromise.cancel(),e&&this._autoFillParams.inDataFetch(!1))},t.prototype._getPeopleSuggestions=function(){var e=this;this._abortSearch(!1),this._autoFillParams.inDataFetch(!0),this._cleanErrors();var t=[],i=this._dataProvider.search(this.inputText.peek(),this._peoplePickerQueryParams);i.cached&&this._processPeopleSuggestions(i.cached,t,!1),this._peoplePickerSearchPromise=i.promise,this.isSearchDone=this._peoplePickerSearchPromise.then(function(i){e._autoFillParams.inDataFetch.peek()&&(e._autoFillParams.inDataFetch(!1),e._processPeopleSuggestions(i,t,!0))},function(t){e._autoFillParams.inDataFetch(!1),t&&"Canceled"===t.name||(e.error(d.strings.ServerError),e._destroyAutoFill())})},t.prototype._processPeopleSuggestions=function(e,t,i){if(e&&e.length>0)for(var o=e,n=0;n<o.length;n++)t.push(new r(o[n],{hasSeparator:n===o.length-1}));(t.length>0||i)&&this._populateAutoFill(t)},t.prototype._resolveUser=function(e){var t=this,i=e.split(";");this._autoFillParams.inDataFetch(!0);for(var o=0;o<i.length;o++){var n=this._parseUserKeyPaste(i[o]);""!==n&&(this.isResolveDone=this._dataProvider.resolve(n,this._peoplePickerQueryParams).then(function(e){t._autoFillParams.inDataFetch(!1),t._inputBoxWasEmpty=!0,t._destroyAutoFill(),t.inputText(""),t._add(e),e.isResolved||t._cleanErrors()},function(){t._autoFillParams.inDataFetch(!1),t.error(d.strings.ServerError)}))}},t.prototype._onAutoFillPicked=function(){this._abortSearch(!0);var e=this._autoFillParams.clickedItem().data();this._resolveOccurring?Boolean(this._personBeingResolved)&&(this._replacePerson(e),this._resolveOccurring=!1):(this.inputText(""),this._inputBoxWasEmpty=!0,this._add(e)),this._destroyAutoFill(),this._dataProvider.addToMruCache(e),this._autoFillParams.clickedItem(null),this.peopleSuggestions([]),this._autoFillParams.items([]),this.focus()},t.prototype._destroyAutoFill=function(){this._resolveOccurring=!1,this._autoFillParams.items([]),this._autoFillParams.isOpen(!1),this.peopleSuggestions([])},t.prototype._populateAutoFill=function(e){this._autoFillParams.isOpen()||this._autoFillParams.isOpen(!0),this.peopleSuggestions(e),this._autoFillParams.items(this.peopleSuggestionsTrimmed()),this._autoFillParams.resultsTrimmed(this.peopleSuggestionsTrimmed().length>=this._peoplePickerQueryParams.maximumEntitySuggestions)},t}(i);return b}),define("odsp-shared/utilities/knockout/ViewModelFactory",["require","exports","knockout","./ResourceComponentLoader"],function(e,t,i){var o=function(){function e(){}return e.createViewModelFactory=function(e){return function(t){var o=new(t.resources.injected(e))(t),n=i.computed(function(){if(t.model){var e=i.utils.unwrapObservable(t.model);for(var n in e)e.hasOwnProperty(n)&&o[n]&&(i.isObservable(o[n])?o[n](i.utils.unwrapObservable(e[n])):o[n]=i.utils.unwrapObservable(e[n]))}},o),r=o.dispose;return o.dispose=function(){r&&r.call(o),n.dispose()},o}},e.createViewModelHelper=function(t){return{createViewModel:e.createViewModelFactory(t)}},e}();return o}),define("odsp-next/controls/peoplePicker/PeoplePicker.html",[],function(){return'<div class=PeoplePicker id=PeoplePicker data-bind="click: function() {focus()}, attr: {title: inputTitle}"><div class=PeoplePicker-container><!--ko foreach: resolvedItems--><div class=PeoplePicker-resolvedItem data-bind="css: { \'PeoplePicker-resolvedItem-unresolved\': !$data.isResolved }"><a class=PeoplePicker-resolvedItem-name href=javascript; data-bind="attr: {title: $parent.getTitle($data)}, click: $parent.personaClick.bind($parent), keyboard: { Enter: $parent.personaClick.bind($parent) }"><div class=PeoplePicker-resolvedItem-persona data-bind="component: { name: \'ms-persona\', params: { person: $data, personaSize: $parent.resolvedSize } }"></div></a><!--comment to prevent excess space--><a class=PeoplePicker-removeItem href=javascript:; data-bind="attr:{title: $parent.formatRemoveString($data) }, click: $parent.removeItem.bind($parent), keyboard: { Enter: $parent.removeItem.bind($parent) }"><i class="ms-Icon ms-Icon--x"></i></a></div><!--/ko--><input class=PeoplePicker-textBox id=PeoplePicker-textBox type=text autocomplete=off autocapitalize=off autocorrect=off autofocus aria-haspopup=true aria-owns=PeoplePicker-autoFill data-bind="value: inputText, valueUpdate: \'keyup\', attr:{ \'aria-busy\': _autoFillParams.inDataFetch(), size: inputSize, \'aria-activedescendant\': selectedDescendantId(), \'aria-expanded\': autoFillOpen().toString(), title: inputTitle}, event:{keyup: inputChange, focus: inputFocus, blur: inputBlur, paste: inputPaste}, hasFocus: isSelected, selection: { data: peopleSuggestionsTrimmed, focused: focusedItem, mode: \'single\', direction: \'vertical\', selectionModel: selectionModel, allowInputEvents: true }, keyboard: { Enter: onEnter, \'CtrlK\': resolveUsers, context: $data, allowInputEvents: true }"> <span class=PeoplePicker-ghostText aria-hidden=true data-bind="text: inputPlaceholder, visible: showPlaceholder"></span> <span class=ms-accessible aria-live=polite data-bind="text: menuOpenText"></span></div><div class=PeoplePicker-progressBoxContainer data-bind="scrollIntoView: { isSelected: scrollDown }"><div class=PeoplePicker-progressBox data-bind="component: {name: progressSpinnerFlatTagName}, visible: _autoFillParams.inDataFetch()"></div></div></div><!--ko if:autoFillOpen()--><div id=PeoplePicker-autoFill data-bind="component: {name: autoFillPopupTagName }"></div><!--/ko--><div aria-live=assertive class=PeoplePicker-error data-bind="text: error"></div>'}),define("odsp-next/controls/peoplePicker/PeoplePicker.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".PeoplePicker-container,.PeoplePicker-resolvedItem,.PeoplePicker-resolvedItem-name,.PeoplePicker-resolvedItem-persona,.PeoplePicker-resolvedItem-txt{display:inline-block}.PeoplePicker{border:1px solid #a6a6a6;background-color:#fff;width:100%;box-sizing:border-box;overflow-y:auto;overflow-x:hidden;max-height:78px;position:relative}.PeoplePicker .ms-Persona{height:24px}.PeoplePicker .ms-Persona .ms-Persona-details{width:auto;height:24px;margin-top:0}.PeoplePicker .ms-Persona .ms-Persona-image,.PeoplePicker .ms-Persona .ms-Persona-imageArea,.PeoplePicker .ms-Persona .ms-Persona-imageCircle{width:20px;height:20px}.PeoplePicker-ghostText{position:absolute;top:5px;color:#767676;white-space:nowrap}html[dir=ltr] .PeoplePicker-ghostText{left:5px}html[dir=rtl] .PeoplePicker-ghostText{right:5px}.PeoplePicker-progressBoxContainer{width:100%}.PeoplePicker-progressBoxContainer .PeoplePicker-progressBox{margin-top:-6px}.PeoplePicker-resolvedItem{margin:2px;white-space:nowrap;font-size:12px;background-color:#d7eaf9;border:1px solid #a8d1ef;height:24px}html[dir=ltr] .PeoplePicker-resolvedItem{float:left}html[dir=rtl] .PeoplePicker-resolvedItem{float:right}.PeoplePicker-resolvedItem.PeoplePicker-resolvedItem-unresolved{background-color:transparent;border-color:#e81123}.PeoplePicker-resolvedItem.PeoplePicker-resolvedItem-unresolved .PeoplePicker-removeItem:hover,.PeoplePicker-resolvedItem.PeoplePicker-resolvedItem-unresolved .PeoplePicker-resolvedItem-name:hover{background-color:#fde7e9}.PeoplePicker-resolvedItem .ms-Persona .ms-Persona-image{line-height:20px;font-size:14px}.PeoplePicker-resolvedItem-name{overflow:hidden;height:24px}.PeoplePicker-resolvedItem-name:hover{background-color:#a8d1ef}.sm .PeoplePicker-resolvedItem-persona .ms-Persona-details{max-width:85px}.PeoplePicker-resolvedItem-image{max-height:20px;max-width:20px;display:inline-block;vertical-align:top}html[dir=ltr] .PeoplePicker-resolvedItem-image{padding-right:5px}html[dir=rtl] .PeoplePicker-resolvedItem-image{padding-left:5px}.PeoplePicker-textBox{border:0 solid #ababab;background-color:transparent;margin:5px;vertical-align:top;outline:0}html[dir=ltr] .PeoplePicker-textBox{float:left}html[dir=rtl] .PeoplePicker-textBox{float:right}.PeoplePicker-textBox::-ms-clear{display:none}.PeoplePicker-textBox:focus{outline-color:transparent}.PeoplePicker-removeItem{width:20px;font-weight:700;text-decoration:none;display:inline-block;font-size:10px;vertical-align:top;line-height:24px}.PeoplePicker-removeItem:hover{background-color:#a8d1ef}.PeoplePicker-removeItem .ms-Icon--x{padding:8px 5px 5px}.PeoplePicker-error{color:#a80000}")}),define("odsp-next/controls/peoplePicker/PeoplePicker",["require","exports","knockout","./PeoplePickerViewModel","odsp-shared/utilities/knockout/ViewModelFactory","./PeoplePicker.html","./PeoplePicker.css","../persona/Persona.css"],function(e,t,i,o,n){var r={tagName:"ms-people-picker",template:e("./PeoplePicker.html"),viewModel:n.createViewModelHelper(o)};return i.components.isRegistered(r.tagName)||i.components.register(r.tagName,r),r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharing/SharingViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","../../resources/ControlResourceKeys","../../resources/ProviderResourceKeys","./Sharing","../sharingTips/SharingTips","../loadingSpinner/LoadingSpinner","../peoplePicker/PeoplePicker","./Sharing.resx","../persona/PersonaSizeEnum","odsp-utilities/logging/events/Engagement.event"],function(e,t,i,o,n,r,s,a,l,d,c,p,u){var h=function(e){function t(t){e.call(this,t),this.SharingTagName=s.tagName,this.peoplePickerTagName=d.tagName,this.sharingTipsTagName=a.tagName,this.loadingSpinnerTagName=l.tagName,this._params=t,this.showShareButton=Boolean(t.onExecuteAction),this._selectionModel=this.resources.consume(n.itemsSelection),this.permissionLabel=c.strings.PermissionLabel,this.inputPlaceholder=c.strings.EmailPlaceholder,this.sendEmailLabel=c.strings.EmailInvitation,this.requireSignInLabel=c.strings.RequireSignInLabel,this.propagateSharingLabel=c.strings.PropagateSharingLabel,this.requireSignInTooltip=c.strings.RequireSignInTooltip,this.shareButtonText=c.strings.ShareText,this.canSendEmail=i.observable(!1),this.canSendLink=i.observable(!1),this.supportsSharingPropagation=i.observable(!1),this.sharingRoleOptions=i.observableArray([]),this.hideOptions=Boolean(t.hideOptions),this.sendEmail=t.sendEmail,this.requireSignIn=t.requireSignIn,this.propagateSharing=t.propagateSharing,this.roleSelection=t.roleValue,this.emailInputText=t.emailMessage||i.observable(""),this.error=t.errorMessage||i.observable(""),this._item=t.item,this.loading=i.observable(!0),this.hasLoadingError=i.observable(!1),this.sharedWithSize=i.observable(p.XS),this.shareAvailable=this.createComputed(function(){if(t.hasUnresolvedText&&t.hasUnresolvedText())return!1;for(var e=t.selectedPeople(),i=0;i<e.length;i++){var o=e[i];if(!o.isResolved)return!1}return!!t.selectedPeople().length}),this.getSharingSettings()}return __extends(t,e),t.prototype.requireSignInChanged=function(){this.requireSignIn()&&this.sendEmail(!0)},t.prototype.shareClicked=function(){var e=this.resources.consume(r.sharing),t={item:this._getCurrentItem(),roleValue:this._params.roleValue(),message:this._params.emailMessage(),sendEmail:this._params.sendEmail(),requireSignIn:this._params.requireSignIn(),propagateSharing:this._params.propagateSharing()};u.Engagement.logData({name:"Share.SharingDialog.Click"}),e.share(this._params.selectedPeople(),t),this._params.onExecuteAction&&this._params.onExecuteAction()},t.prototype.getSharingSettings=function(){var e=this,t=this.resources.consume(r.sharing),i=t.getSharingData(this._getCurrentItem());this.isReady=i.getSettings().then(function(t){e.sharingSettings=t;var i={};if(i.maximumEntitySuggestions=30,t.pickerProperties){var o=t.pickerProperties;i.allowEmailAddresses=o.AllowEmailAddresses,i.principalSource=o.PrincipalSource,i.principalType=o.PrincipalAccountType}e.peoplePickerParams={selectedPeople:e._params.selectedPeople,peoplePickerQueryParams:i,hasUnresolvedText:e._params.hasUnresolvedText},e.sharingRoleOptions(t.sharingRoles),e.canSendEmail(t.canSendEmail),e.canSendLink(t.canSendLink),e.supportsSharingPropagation(t.supportsSharingPropagation),e._params.propagateSharing&&e._params.propagateSharing(t.supportsSharingPropagation),e.hasLoadingError(!1),e.loading(!1)},function(t){var i=e._getCurrentItem();i.parentLink?(u.Engagement.logData({name:"GetSettings.SharingDialog.Redirect"}),window.location.href=i.parentLink+"?sharingDialogForListItemId="+i.itemId):(e.error(t&&403===t.status?c.strings.AccessDenied:c.strings.ServerError),e.hasLoadingError(!0),e.loading(!1))})},t.prototype._getCurrentItem=function(){return this._item?this._item:i.utils.unwrapObservable(this._selectionModel.selection()[0])},t}(o);return h}),define("odsp-next/controls/sharing/Sharing.html",[],function(){return'<div class=Sharing><!--ko if:loading--><div class=Sharing-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot:loading--><div class=Sharing-table data-bind="ifnot: hasLoadingError"><div class=Sharing-row><div class="Sharing-cell Sharing-peoplePicker" id=Sharing-peoplePicker data-bind="component: {name: peoplePickerTagName, params: peoplePickerParams}"></div><select class="Sharing-cell Sharing-simpleRoleSelector" data-bind="foreach: sharingRoleOptions, value: roleSelection, attr: {\'aria-label\': permissionLabel }, visible: sharingRoleOptions().length > 0"><option data-bind="text: name, value: value"></option></select></div></div><div aria-live=assertive class=PeoplePicker-error data-bind="if: error"><span data-bind="text: error"></span></div><div data-bind="ifnot: hasLoadingError"><div aria-live=polite data-bind="component: { name: sharingTipsTagName, params: { selectedPeople: _params.selectedPeople, showAdditionalSharingWarning: sharingSettings.showAdditionalExternalWarning } }"></div></div><div data-bind="visible: canSendEmail()"><textarea class=Sharing-mailInput data-bind="enable: sendEmail, value: emailInputText, attr:{placeholder: inputPlaceholder}">\n    </textarea></div><div class=Sharing-link data-bind="visible: supportsSharingPropagation()"><input id=Sharing-aclPropagation type=checkbox data-bind="checked: propagateSharing"> <label for=Sharing-aclPropagation class=Sharing-aclPropagationLabel data-bind="text: propagateSharingLabel"></label></div><div data-bind="visible: canSendEmail() && sharingRoleOptions().length > 0 && !hideOptions"><div class=Sharing-link data-bind="visible: canSendLink"><input id=Sharing-requireSignIn type=checkbox data-bind="checked: requireSignIn, event: { change: requireSignInChanged }"> <label for=Sharing-requireSignIn data-bind="text: requireSignInLabel, attr: { title: requireSignInTooltip }"></label></div><div class=Sharing-link><input id=Sharing-sendEmailCheckbox type=checkbox data-bind="checked: sendEmail, enable: requireSignIn()"> <label for=Sharing-sendEmailCheckbox data-bind="text: sendEmailLabel"></label></div></div><!--ko if: showShareButton--><div class=Sharing-submit><button class="Sharing-submitButton ms-Button ms-Button--primary" data-bind="click: shareClicked, enable: shareAvailable, automation: \'shareDialogCommit\'"><span class=ms-Button-label data-bind="text: shareButtonText"></span></button></div><!--/ko--><!--/ko--></div>'}),define("odsp-next/controls/sharing/Sharing.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".Sharing{overflow:hidden}.Sharing .Sharing-requireSignInLabel{border-bottom-style:dotted;border-bottom-width:1px}.Sharing-submitButton{position:relative;width:100%;height:30px;margin-top:5px}html[dir=ltr] .Sharing-submit{float:right}html[dir=rtl] .Sharing-submit{float:left}.Sharing-loadingSpinner{text-align:center;padding:75px 0}.Sharing-table{display:table;width:100%;border-collapse:collapse}.Sharing-row{display:table-row;width:100%}.Sharing-cell{display:table-cell}.Sharing-peoplePicker{width:100%;vertical-align:top}.Sharing-link{padding-bottom:5px}.Sharing-simpleRoleSelector{padding:2px;vertical-align:top;border:1px solid #a6a6a6;color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400;height:33px}html[dir=ltr] .Sharing-simpleRoleSelector{margin-left:8px}html[dir=rtl] .Sharing-simpleRoleSelector{margin-right:8px}.Sharing-mailInput{resize:none;height:80px;width:100%;box-sizing:border-box;border:1px solid #a6a6a6;overflow-y:auto;padding:5px;margin:10px 0 5px}#Sharing-aclPropagation,#Sharing-requireSignIn,#Sharing-sendEmailCheckbox{display:inline-block;vertical-align:sub}html[dir=ltr] #Sharing-aclPropagation,html[dir=ltr] #Sharing-requireSignIn,html[dir=ltr] #Sharing-sendEmailCheckbox{margin-right:5px}html[dir=rtl] #Sharing-aclPropagation,html[dir=rtl] #Sharing-requireSignIn,html[dir=rtl] #Sharing-sendEmailCheckbox{margin-left:5px}")}),define("odsp-next/controls/sharing/Sharing",["require","exports","./SharingViewModel","odsp-shared/utilities/knockout/ComponentFactory","./Sharing.html","./Sharing.css","../peoplePicker/PeoplePicker"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-share",template:e("./Sharing.html"),viewModel:i});return n}),define("odsp-next/controls/sharingByLink/SharingByLinkStringHelper",["require","exports","./SharingByLink.resx","../../models/sharing/SharingLinkType","../../models/sharing/SharingRole","odsp-shared/utilities/string/StringHelper"],function(e,t,i,o,n,r){function s(e,t){"use strict";if(null===e)return"";var s=e.expiration?new Date(e.expiration).toLocaleDateString():null;switch(e.type){case o.Organization:var a;return a=e.role===n.Edit?Boolean(t)?r.format(i.strings.OrganizationEditText,t):i.strings.NoNameOrganizationEditText:Boolean(t)?r.format(i.strings.OrganizationViewText,t):i.strings.NoNameOrganizationViewText;case o.Direct:return i.strings.DirectLinkText;case o.Edit:return e.supportsExpiration&&Boolean(s)?r.format(i.strings.AnonymousEditExpiryText,s):i.strings.AnonymousEditText;case o.View:return e.supportsExpiration&&Boolean(s)?r.format(i.strings.AnonymousViewExpiryText,s):i.strings.AnonymousViewText;default:return""}}t.getLinkHintText=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharedWith/SharedWithViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","odsp-utilities/async/Promise","../../resources/ControlResourceKeys","../../resources/ProviderResourceKeys","odsp-utilities/logging/events/Engagement.event","../loadingSpinner/LoadingSpinner","./SharedWith","./SharedWith.resx","odsp-utilities/encoding/UriEncoding","../persona/PersonaSizeEnum","../../utilities/browser/WindowSize","../confirmation/Confirmation","../../models/dialog/DialogState","../sharingByLink/SharingByLinkStringHelper","../../bindings/focus/SelectOnFocusBinding","../../models/sharing/SharingLinkType","../../bindings/css/ClassesBinding","../../utilities/sharing/SharingHelper","../../utilities/icons/Icon"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_){var k=function(e){function t(t){var o=this;e.call(this,t),this.SharedWithTagName=d.tagName,this.loadingSpinnerTagName=l.tagName,this.removePerson=function(e){o.people.remove(e)},this._sharingProvider=this.resources.consume(s.sharing),this.addBindingHandlers({selectOnFocus:v.default,classes:x}),this._item=t.item,this._items=t.items,this.cardSize=Boolean(t.personaSize)?t.personaSize:i.observable(u.Medium),this.height=t.height?t.height:"none",this.showEmailLink=i.observable(!1),this.hasSettings=i.observable(!1),this.hasData=i.observable(!1),this.showRequests=i.observable(!1),this.loading=i.observable(!0),this.isMultiSelect=i.observable(!1),this._error=i.observable(""),this.advancedUrl=i.observable(""),this.disableLinkText=c.strings.DisableLinkText,this.emailText=c.strings.EmailEveryone,this.advancedText=c.strings.Advanced,this.requestsPending=c.strings.RequestPending,this.stopSharingText=c.strings.StopSharing,this.viewRequests=c.strings.ViewRequests,this.multiSelectErrorText=c.strings.MultiSelectError,this._selectionModel=this.resources.consume(r.itemsSelection),this.people=i.observableArray([]),this.links=i.observableArray([]),this.canManageLinks=i.observable(!1),this.showAdvanced=this.createComputed(function(){return Boolean(o.advancedUrl())}),this.canUnshare=i.observable(!1),this.requestsLink=i.observable(""),this.mailto=this.createComputed(function(){if(!o.hasSettings())return"";for(var e=o.people(),t="mailto:",i=new Array,n=0;n<e.length;n++)e[n].email&&i.push(e[n].email);return o.showEmailLink(i.length>0),t+=p.encodeURIComponent(i.join(";")),t+="?subject="+p.encodeURIComponent(o._settings.itemName),t+="&body="+p.encodeURIComponent(o._normalizeUrl(o._settings.itemUrl))}),this.hasError=this.createComputed(function(){return Boolean(o._error())}),this._selectionModel&&this._selectionModel.selection&&this._selectionModel.selection().length>1||this._items&&this._items.length>1?(this.isMultiSelect(!0),this.loading(!1)):(t.includeLinks&&this._getLinks(),this._getSharedWith())}return __extends(t,e),t.prototype.logCopy=function(e){return a.Engagement.logData({name:e.tag+"Link.SharedWith.Copy"}),!0},t.prototype.calculateHint=function(e){return f.getLinkHintText(e,this._companyDisplayName)},t.prototype.clickEmail=function(){return a.Engagement.logData({name:"EmailEveryone.SharingDialog.Click"}),!0},t.prototype.clickAdvanced=function(){return a.Engagement.logData({name:"AdvancedSettings.SharingDialog.Click"}),!0},t.prototype.clickAccessRequests=function(){return a.Engagement.logData({name:"PendingAccessRequests.SharingDialog.Click"}),!0},t.prototype.stopSharing=function(){a.Engagement.logData({name:"StopSharing.SharingDialog.Click"}),this._stopSharingConfirm()},t.prototype.removeSharingLink=function(e){var t=this,i=this.resources.consume(s.dialog);this._confirmDialog=y.disableLinkConfirm(function(){return a.Engagement.logData({name:"Disable"+e.tag+"Link.SharedWith.Click"}),t._sharingProvider.manageSharingLinks({item:t._getCurrentItem(),type:e.type,role:e.role,create:!1}).then(function(e){return t._updateSharingLinks(e),n.default.wrap(!0)},function(){return!1})},function(e){t.isReady=e},i,"SharedWith")},t.prototype._stopSharing=function(){var e=this._sharingProvider.unshare(this._getCurrentItem());return this.loading(!0),e},t.prototype._getLinks=function(){var e=this,t=this.resources.consume(s.suiteNav);t&&t.loadData().then(function(t){e._companyDisplayName=t.CompanyDisplayName,e.links.peek().length>0&&e._updateSharingLinks(e.links())});var i=this._sharingProvider.getSharingData(this._getCurrentItem());i.getLinks().then(function(t){t&&e._updateSharingLinks(t)},function(){e._error(c.strings.LinksError)})},t.prototype._updateSharingLinks=function(e){this.links(e.filter(function(e){return e.isActive&&e.type!==b.Direct}))},t.prototype._getSharedWith=function(){var e=this,t=this._sharingProvider.getSharingData(this._getCurrentItem());this.isReady=t.getPermissions(!0,!0).then(function(t){var i=t[0];Boolean(i)?(i.hasPendingAccessRequests&&(e.showRequests(!0),a.Engagement.logData({name:"PendingAccessRequests.SharingDialog.Render"})),e.requestsLink(i.pendingAccessRequestsLink),e.canUnshare(i.canUnshare),e._parseSharedWith(i?i.people:null)):e.loading(!1)},function(t){e._error(t&&403===t.status?c.strings.AccessDenied:c.strings.ServerError),e.loading(!1)}),t.getSettings().done(function(t){e._settings=t,e.canManageLinks(t.canManageLinks),e.advancedUrl(t.advancedUrl),e.hasSettings(!0)},function(){})},t.prototype._parseSharedWith=function(e){e&&this.people(e),this.loading(!1)},t.prototype._getCurrentItem=function(){return this._item?this._item:i.utils.unwrapObservable(this._selectionModel.selection()[0])},t.prototype._stopSharingConfirm=function(){var e=this,t=this.resources.consume(s.dialog),o=i.observable(!0);t.requestDialog({title:c.strings.StopSharingConfirmationTitle,size:h.Medium,component:{name:m.tagName,params:{message:c.strings.StopSharingConfirmationMessage}},actions:[{name:c.strings.StopSharingConfirmationButton,execute:function(){return a.Engagement.logData({name:"Unshare.SharedWithDialog.Click"}),o(!1),e._stopSharing().then(function(){return g.completed},function(){return g.dismissed})},isDefault:!0,isAvailable:o,icon:_.save,automationId:"UnshareConfirm"},{name:c.strings.StopSharingCancelButton,execute:function(){return a.Engagement.logData({name:"CancelStopSharing.SharedWithDialog.Click"}),n.default.wrap(g.dismissed)},isDefault:!1,icon:_.x,automationId:"UnshareCancel"}],executeDefaultAction:!1})},t.prototype._normalizeUrl=function(e){var t=document.createElement("A");return t.href=e,t.href},t}(o);return k}),define("odsp-next/controls/sharedWith/SharedWith.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-SharedWith-Container{width:100%}.od-SharedWith-loadingSpinner{text-align:center;padding:75px 0}.od-SharedWith-wrapper{margin:2px;width:100%;overflow-x:hidden;overflow-y:auto;min-height:175px}.od-SharedWith-accessRequests{background-color:#eaeaea;padding:8px 0}.od-SharedWith-accessRequestsIcon{padding:0 8px;color:#094AB2;font-size:12pt;vertical-align:middle}html[dir=ltr] .od-SharedWith-accessRequestsLink{padding-left:5px}html[dir=rtl] .od-SharedWith-accessRequestsLink{padding-right:5px}.od-SharedWith-person{margin:0 0 10px;width:100%}html[dir=ltr] .od-SharedWith-icon,html[dir=ltr] .od-SharedWith-link,html[dir=ltr] .od-SharedWith-link:hover,html[dir=ltr] .od-SharedWith-link:visited{margin-right:10px}html[dir=rtl] .od-SharedWith-icon,html[dir=rtl] .od-SharedWith-link,html[dir=rtl] .od-SharedWith-link:hover,html[dir=rtl] .od-SharedWith-link:visited{margin-left:10px}.od-SharedWith-error{color:#a80000}.od-SharedWith-linksBox{margin-top:10px}.od-SharedWith-link,.od-SharedWith-link:hover,.od-SharedWith-link:visited{text-decoration:none;padding:2px;text-transform:uppercase;color:#333;font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400}.od-SharedWith-iconCell{width:50px;vertical-align:top}.od-SharedWith-icon{display:inline-block;background-color:#094AB2;color:#fff;font-size:25px;border-radius:50%;width:50px;height:50px}.od-SharedWith-icon .ms-Icon--link{position:relative;top:8px}html[dir=ltr] .od-SharedWith-icon .ms-Icon--link{left:9px}html[dir=rtl] .od-SharedWith-icon .ms-Icon--link{right:9px}.od-SharedWith-mailRow{white-space:nowrap}.od-SharedWith-mailRow .od-SharedWith-icon{vertical-align:middle}.od-SharedWith-linkSwitcher{display:inline-block;margin-bottom:10px}a.od-SharedWith-linkSwitcher{cursor:pointer}.od-SharedWith-url .od-SharedWith-cell{width:100%}.od-SharedWith-input{padding:3px;width:100%;text-overflow:ellipsis;margin-bottom:3px;margin-top:5px}button.od-SharedWith-copyButton{padding:0 10px;height:1.9em}.od-SharedWith-copyButton-label{position:relative;top:-1px}.od-SharedWith-mailText{color:#333;font-family:'Segoe UI Semilight WestEuropean','Segoe UI Semilight','Segoe WP Semilight','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:17px;font-weight:400}.od-SharedWith-table{display:table;width:100%}.od-SharedWith-row{display:table-row}.od-SharedWith-cell{display:table-cell}.od-SharedWith-removeLinkButton{margin:0;padding:5px;border:0;background:0 0;cursor:pointer}html[dir=ltr] .od-SharedWith-removeLinkButton{margin-left:10px}html[dir=rtl] .od-SharedWith-removeLinkButton{margin-right:10px}.od-SharedWith--hidden{display:none}")}),define("odsp-next/controls/sharedWith/SharedWith.html",[],function(){return'<div class=od-SharedWith-Container><!--ko if:loading--><div class=od-SharedWith-loadingSpinner data-bind="component: {name: loadingSpinnerTagName}"></div><!--/ko--><!--ko ifnot:loading--><div data-bind="if: showRequests"><div aria-live=polite class=od-SharedWith-accessRequests role=alert><i class="ms-Icon ms-Icon--infoCircle od-SharedWith-accessRequestsIcon"></i> <span data-bind="text: requestsPending"></span> <a class=od-SharedWith-accessRequestsLink target=_blank data-bind="attr: {href: requestsLink }, text: viewRequests, click: clickAccessRequests"></a></div></div><div aria-live=assertive class=od-SharedWith-error data-bind="if: hasError"><span data-bind="text: _error"></span></div><div aria-live=polite data-bind="if: isMultiSelect"><span data-bind="text: multiSelectErrorText"></span></div><div class=od-SharedWith-wrapper aria-live=polite aria-relevant=text data-bind="style: { maxHeight: height }" tabindex=0><div data-bind="foreach: links"><div class=od-SharedWith-table><div class=od-SharedWith-row><div class="od-SharedWith-cell od-SharedWith-iconCell"><div class=od-SharedWith-icon><i class="ms-Icon ms-Icon--link"></i></div></div><div class=od-SharedWith-cell><div class="od-SharedWith-table od-SharedWith-url"><div class=od-SharedWith-row><div class=od-SharedWith-cell><input class=od-SharedWith-input readonly data-bind="value: url, selectOnFocus: { isPermanent: true }, event: { copy: $parent.logCopy }, attr: { \'aria-label\': $parent.calculateHint($data)}"></div><!--ko if: $parent.canManageLinks--><div class=od-SharedWith-cell><button class=od-SharedWith-removeLinkButton data-bind="click: $parent.removeSharingLink.bind($parent, $data), attr: { \'title\': $parent.disableLinkText, \'aria-label\': $parent.disableLinkText }"><i class="ms-Icon ms-Icon--x"></i></button></div><!--/ko--></div></div><span class=od-SharedWith-linkSwitcher data-bind="text: $parent.calculateHint($data)"></span></div></div></div></div><div data-bind="foreach: people"><div class=od-SharedWith-person data-bind="component: { name: \'ms-persona\', params: { person: $rawData, personaSize: $parent.cardSize, removePerson: $parent.removePerson, showPresence: true }}"></div></div></div><div class=od-SharedWith-linksBox data-bind="if: hasSettings()"><a class=od-SharedWith-link href=javascript:; data-bind="click: stopSharing, text: stopSharingText, visible: canUnshare"></a> <a class=od-SharedWith-link data-bind="attr: {href: mailto()}, text: emailText, visible: showEmailLink(), click: clickEmail"></a> <a class=od-SharedWith-link target=_blank data-bind="attr: {href: advancedUrl}, text: advancedText, visible: showAdvanced, click: clickAdvanced"></a></div><!--/ko--></div>'
}),define("odsp-next/controls/sharedWith/SharedWith",["require","exports","./SharedWithViewModel","odsp-shared/utilities/knockout/ComponentFactory","./SharedWith.css","./SharedWith.html","../persona/Persona"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-sharedWith",template:e("./SharedWith.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/sharingHints/SharingHintsViewModel",["require","exports","knockout","odsp-shared/base/ViewModel","./SharingHints.resx","odsp-shared/utilities/string/StringHelper","../../bindings/html/BindableHtmlBinding"],function(e,t,i,o,n,r,s){var a=function(e){function t(t){var o=this;e.call(this,t),this._openAnchorHtml='<a href="javascript:;" title="{0}" data-bind="click: switchTabs">',this._closeAnchorHtml="</a>",this._lastPersonTemplate='<ms-persona class="od-SharingHints-persona" params="{ person: lastPerson, personaSize: 1, showPresence: true, profileLinkOn: true }" ></ms-persona>',this._peopleTemplate='<span data-bind = "foreach: usersTrimmed" >    <ms-persona class="od-SharingHints-persona" params="{ person: $data, personaSize: 1, showPresence: true, profileLinkOn: true, includeComma: true }" ></ms-persona></span>',this.addBindingHandlers({bindableHtml:s}),this.guestLinkExists=t.guestLinkExists,this.sharedWithMany=t.sharedWithMany,this.anonymousLinksText=n.strings.GuestLinkText,this.onlyYouText=n.strings.OnlyYouText;var a=r.format(this._openAnchorHtml,r.format(n.strings.SharedWithLinkTitle,t.itemName()));this.sharedWithManyHtml=r.format(n.strings.SharedWithManyText,a,this._closeAnchorHtml),this._sharedWithCallBack=t.sharedWithCallback,this.users=i.observable(t.sharedWith().reverse()),this.usersTrimmed=this.createComputed(function(){var e=o.users().length;return 4>e?o.users().slice(0,e-1):o.users().slice(0,3)}),this.lastPerson=this.createComputed(function(){var e=o.users().length;return e>0?o.users()[e-1]:null}),this._moreLink=this.createComputed(function(){return a+r.format(n.strings.NumberMoreText,o.users().length-3)+o._closeAnchorHtml}),this.sharedWithHtml=this.users().length>4?r.format(n.strings.SharedWithText,this._peopleTemplate,this._moreLink()):1===this.users().length?r.format(n.strings.SharedWithOneText,r.format(this._lastPersonTemplate)):r.format(n.strings.SharedWithText,this._peopleTemplate,r.format(this._lastPersonTemplate))}return __extends(t,e),t.prototype.switchTabs=function(){this._sharedWithCallBack()},t}(o);return a}),define("odsp-next/controls/sharingHints/SharingHints.html",[],function(){return'<div class=od-SharingHints><div class=od-SharingHints-shared data-bind="visible: sharedWithMany()"><i class="ms-Icon ms-Icon--people"></i> <span class=od-SharingHints-text data-bind="bindableHtml: sharedWithManyHtml"></span></div><!--ko if: users().length > 0 && !sharedWithMany()--><div class=od-SharingHints-shared><i class="ms-Icon ms-Icon--people"></i> <span class=od-SharingHints-text data-bind="bindableHtml: sharedWithHtml"></span></div><!--/ko--><div class=od-SharingHints-private data-bind="visible: users().length === 0 && !guestLinkExists() && !sharedWithMany()"><i class="ms-Icon ms-Icon--lock"></i> <span class=od-SharingHints-text data-bind="text: onlyYouText"></span></div><div class=od-SharingHints-externalWarning data-bind="visible: guestLinkExists"><i class="ms-Icon ms-Icon--globe"></i> <span class=od-SharingHints-text data-bind="text: anonymousLinksText"></span></div></div>'}),define("odsp-next/controls/sharingHints/SharingHints.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-SharingHints .ms-Persona--tiny .ms-Persona-details,.od-SharingHints-text{font-family:'Segoe UI Regular WestEuropean','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif;font-size:12px;font-weight:400;color:#666}.od-SharingHints{width:100%}html[dir=ltr] .od-SharingHints .ms-Persona--tiny .ms-Persona-details{padding-left:0}html[dir=rtl] .od-SharingHints .ms-Persona--tiny .ms-Persona-details{padding-right:0}.od-SharingHints-text{padding:0 5px}.od-SharingHints-persona{display:inline-block}")}),define("odsp-next/controls/sharingHints/SharingHints",["require","exports","./SharingHintsViewModel","odsp-shared/utilities/knockout/ComponentFactory","./SharingHints.html","./SharingHints.css","../persona/Persona"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-sharingHints",template:e("./SharingHints.html"),viewModel:i});return n}),define("odsp-next/controls/tabbedSharing/TabbedSharing",["require","exports","./TabbedSharingViewModel","odsp-shared/utilities/knockout/ComponentFactory","./TabbedSharing.html","./TabbedSharing.css","../sharing/Sharing","../sharedWith/SharedWith","../sharingHints/SharingHints","../sharingLinks/SharingLinks","../sharingLinksSelector/SharingLinksSelector"],function(e,t,i,o){var n=o.registerComponent({tagName:"ms-tabbedShare",template:e("./TabbedSharing.html"),viewModel:i});return n});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/ShareAction",["require","exports","knockout","odsp-utilities/async/Promise","../base/BaseSelectionAction","../resources/ProviderResourceKeys","odsp-utilities/logging/events/Engagement.event","../controls/tabbedSharing/TabbedSharing","../controls/tabbedSharing/TabbedSharing.resx","../models/dialog/DialogState","odsp-utilities/logging/events/Qos.event","../controls/sharing/Sharing.resx","../controls/tabbedSharing/SharingTab","../utilities/browser/WindowSize","../models/item/ItemType","../utilities/icons/Icon"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g){var f=function(e){function t(t){e.call(this,t),this.name="Share",this.canFallbackToParent=!0,this.isSingleSelectAction=!0,this._initialTab=t&&t.activeTab?t.activeTab:u.invite,this._activeTab=i.observable(this._initialTab)}return __extends(t,e),t.prototype.onSelectionExecute=function(e){var t=this,n={selectedPeople:i.observableArray([]),roleValue:i.observable(""),emailMessage:i.observable(""),errorMessage:i.observable(""),sendEmail:i.observable(!0),requireSignIn:i.observable(!0),propagateSharing:i.observable(!1),hasUnresolvedText:i.observable(!1),dialogTitle:i.observable("")};this._shareButtonEnabled=i.observable(!0);var f=t.resources.consume(r.dialog),v=t.resources.consume(r.sharing),b=e[0];this._activeTab(this._initialTab);var x=f.requestDialog({title:n.dialogTitle,size:h.Large,component:{name:a.tagName,params:{sharingParams:n,activeTab:t._activeTab,resources:this.resources,item:b}},actions:[{name:p.strings.ShareText,execute:function(){t._shareButtonEnabled(!1);var i={item:b,items:e,roleValue:n.roleValue(),message:n.emailMessage(),sendEmail:n.sendEmail(),requireSignIn:n.requireSignIn(),propagateSharing:n.propagateSharing()};return s.Engagement.logData({name:"Share.SharingDialog.Click",extraData:{requireSignIn:i.requireSignIn,sendEmail:i.sendEmail,users:n.selectedPeople().length,type:i.roleValue}}),v.share(n.selectedPeople(),i),o.default.wrap(d.completed)},isVisible:i.pureComputed(function(){return t._activeTab()===u.invite}),isAvailable:i.pureComputed(function(){if(n.hasUnresolvedText())return!1;for(var e=n.selectedPeople(),i=0;i<e.length;i++)if(!e[i].isResolved)return!1;return!!n.selectedPeople().length&&t._shareButtonEnabled()}),isDefault:!0,icon:g.share,automationId:"shareDialogCommit"},{name:l.strings.CloseText,execute:function(){return s.Engagement.logData({name:"Close.SharingDialog.Click",extraData:{tab:t._activeTab()}}),o.default.wrap(d.completed)},isVisible:i.pureComputed(function(){return t._activeTab()!==u.invite}),isDefault:!0,icon:g.x,automationId:"shareDialogClose"}],executeDefaultAction:!1});return x.wait().then(function(){var t={},i={count:e.length};return 1===e.length&&(t.fileType=m[e[0].type],t.extension=e[0].extension||""),{resultType:c.ResultTypeEnum.Success,extraData:t,extraMetrics:i}})},t}(n);return f});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/odb/ShareAction",["require","exports","../ShareAction"],function(e,t,i){var o=function(e){function t(t){e.call(this,t),this.canFallbackToParent=Boolean(t)?Boolean(t.canFallbackToParent):!1}return __extends(t,e),t}(i);return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/UploadAction",["require","exports","../base/BaseItemAction","odsp-utilities/async/Promise","../resources/ProviderResourceKeys","../resources/UtilityResourceKeys","../dataSources/upload/UploadProcessorType","odsp-utilities/logging/events/Qos.event","../dataSources/url/QueryType","odsp-utilities/logging/events/Engagement.event"],function(e,t,i,o,n,r,s,a,l,d){var c=function(e){function t(t){e.call(this,t),this.name="Upload",this._platform=this.resources.consume(r.platformDetection),this.uploadProcessorType=t.uploadProcessorType,this._operatorProvider=this.resources.consume(n.operator)}return __extends(t,e),t.prototype.onInputChange=function(e){d.Engagement.logData({name:"Upload.TopMenu.Click"});var t=e.target;null!=t&&this._operatorProvider.upload({files:t.files,parentItem:this.item(),wasDragAndDropped:!1,type:this.uploadProcessorType}).done()},t.prototype.onExecute=function(){return o.default.wrap({resultType:a.ResultTypeEnum.ExpectedFailure})},t.prototype.onIsAvailable=function(){var e=!1;switch(this.uploadProcessorType){case s.Html5file:e=this._platform.isHtml5FileUploadSupported;break;case s.Folder:e=this._platform.isFolderUploadSupported}return e&&this.item().queryType===l.Files},t}(i);return c}),define("odsp-next/controls/policyTip/PolicyTipDialogState",["require","exports"],function(){var e;return function(e){e[e.loading=0]="loading",e[e.tip=1]="tip",e[e.resolve=2]="resolve",e[e.justify=3]="justify",e[e.status=4]="status",e[e.error=5]="error"}(e||(e={})),e}),define("odsp-next/controls/policyTip/PolicyTipTemplates",["require","exports","./PolicyTipDialogState"],function(e,t,i){var o=function(){function e(){}return e.getTemplateName=function(t){switch(t){case i.loading:return e.LOADING;case i.tip:return e.TIP;case i.resolve:return e.RESOLVE;case i.justify:return e.JUSTIFY;case i.status:case i.error:return e.MESSAGE;default:return e.LOADING}},e.LOADING="od-policy-tip-loading",e.TIP="od-policy-tip-tip",e.RESOLVE="od-policy-tip-resolve",e.JUSTIFY="od-policy-tip-justify",e.MESSAGE="od-policy-tip-message",e}();return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/controls/policyTip/PolicyTipViewModel",["require","exports","./PolicyTipDialogState","./PolicyTipTemplates","./PolicyTip.resx","odsp-shared/base/ViewModel","../../actions/OpenRelation","../../bindings/css/VisibilityBinding","../../bindings/html/BindableHtmlBinding","../../bindings/keyboard/KeyboardBinding","../../models/policyTip/PolicyTipUserAction","../../resources/ControlResourceKeys","../../resources/UtilityResourceKeys","../../utilities/accessibility/Accessibility","../../utilities/browser/WindowSize","../../utilities/datetime/DateTime","odsp-utilities/logging/events/Engagement.event","odsp-shared/utilities/string/StringHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v){var b=0,x=function(e){function t(t){var i=this;e.call(this,t),this.addBindingHandlers({bindableHtml:l,keyboard:d,visibility:a}),b++,this.strings=n.strings,this.info=t.policyInfo,this._state=t.state,this.buttonsAvailable=t.buttonsAvailable,this._action=t.action,this._item=t.item,this.justificationText=t.justificationText,this.justificationError=t.justificationError,this.messageText=t.messageText,this.justificationTextId="ms-policy-tip-justify-"+b,this._parentEvt=t.logEvt,this.resolveSections=[{heading:this.strings.ResolveOverrideHeading,descriptionHtml:v.format(this.strings.ResolveOverrideInfo,'<span class="ms-fontWeight-semibold">',"</span>"),buttonText:this.strings.ResolveOverride,buttonClick:function(){return i._overrideClick()},automationId:"PolicyTipDialogOverride",isVisible:function(){return!!i.info().overrideOption},isSpinnerVisible:this.createPureComputed(function(){return!i.buttonsAvailable()&&i._action()===c.override})},{heading:this.strings.ResolveReportHeading,descriptionHtml:v.format(this.strings.ResolveReportInfo,'<span class="ms-fontWeight-semibold">',"</span>"),buttonText:this.strings.ResolveReport,buttonClick:function(){return i._reportClick()},automationId:"PolicyTipDialogReport",isVisible:function(){return!0},isSpinnerVisible:this.createPureComputed(function(){return!i.buttonsAvailable()&&i._action()===c.reportFalsePositive})}];var r=this.resources.consume(u.responsiveUI);this.resolveDescriptionFirst=this.createPureComputed(function(){var e=r.formFactorSize();return e===m.Small||e===m.Medium}),this.templateName=this.createPureComputed(function(){return o.getTemplateName(i._state())}),this.resolutionTemplate=this.createPureComputed(function(){var e=i.info();if(e){var t="";return e.policyInfoUrl&&(t=v.format(i.strings.TipLearnMore,'<a href="javascript:" data-bind="click: $component.learnMoreClick.bind($component), keyboard: learnMoreKeyboardInfo">',"</a>"),i.learnMoreKeyboardInfo={mappings:{Enter:i.learnMoreClick.bind(i),Space:i.learnMoreClick.bind(i)},preventDefault:!0}),i.openKeyboardInfo={mappings:{Enter:i.openClick.bind(i),Space:i.openClick.bind(i)},preventDefault:!0},v.format(i.strings.TipText,'<a href="javascript:" data-bind="click: openClick, keyboard: openKeyboardInfo">',"</a>",'<span class="ms-fontWeight-semibold">',"</span>",t)}return""}),this.lastScannedText=this.createPureComputed(function(){var e=i.info();if(e)try{return i.strings.TipLastScanned+": "+g.GetRelativeDateTimeStringPast(e.lastScanned)}catch(t){}return""}),this.subscribe(this._state,function(){var e=document.getElementsByClassName("ms-Dialog")[0];e&&h.focusFirstTabStop(e)}),f.Engagement.logData({name:"PolicyTip.DialogRendered",extraData:{screenSize:m[r.formFactorSize()]}},this._parentEvt)}return __extends(t,e),t.prototype.openClick=function(e){this._logClick("OpenItem");var t=this.resources.consume(p.actionMap),i=new(this.resources.injected(t.DefaultClickAction))({item:this._item,openRelation:s.specified,userInvokedItem:!0});i.isAvailable()&&i.execute(e),i.dispose()},t.prototype.learnMoreClick=function(){return this._logClick("LearnMore"),window.open(this.info().policyInfoUrl,"_blank"),!1},t.prototype._overrideClick=function(){return this._logClick("Override"),this._action(c.override),!1},t.prototype._reportClick=function(){return this._logClick("Report"),this._action(c.reportFalsePositive),!1},t.prototype._logClick=function(e){var t=i[this._state()];t=t.charAt(0).toUpperCase()+t.slice(1);var o=v.format("PolicyTip.{0}State.{1}.Click",t,e);f.Engagement.logData({name:o},this._parentEvt)},t}(r);return x}),define("odsp-next/controls/policyTip/PolicyTip.html",[],function(){return'<div class=od-PolicyTip data-bind="template: { name: templateName }"></div>'}),define("odsp-next/controls/policyTip/PolicyTipLoading.html",[],function(){return"<div class=od-PolicyTip-loading data-bind=\"component: { name: 'ms-loadingSpinner', params: { loadingText: strings.TipLoadingText } }\"></div>"}),define("odsp-next/controls/policyTip/PolicyTipTip.html",[],function(){return'<div class=od-PolicyTip-issuesExplanation><!--ko if: info().explanationText--><span data-bind="text: info().explanationText"></span><br><br><!--/ko--><span data-bind="bindableHtml: resolutionTemplate"></span></div><i class="od-PolicyTip-issuesIcon ms-Icon ms-Icon--drm"></i><h3 class="od-PolicyTip-issuesHeader ms-font-m ms-fontWeight-semibold" data-bind="text: strings.TipIssues"></h3><ul class=od-PolicyTip-issueList data-bind="foreach: info().issueDescriptions"><li data-bind="text: $data"></li></ul><div class=od-PolicyTip-lastScannedRow data-bind="attr: { title: strings.TipLastScannedHelp, alt: strings.TipLastScannedHelp }, text: lastScannedText"></div>'}),define("odsp-next/controls/policyTip/PolicyTipResolve.html",[],function(){return'<!--ko foreach: resolveSections--><div class=od-PolicyTip-resolveSection data-bind="visible: isVisible()"><h3 class="od-PolicyTip-resolveHeading ms-font-m" data-bind="text: heading"></h3><!--ko if: $parent.resolveDescriptionFirst--><div data-bind="html: descriptionHtml"></div><!--/ko--><div class=od-PolicyTip-resolveButton><span class=od-PolicyTip-resolveSpinner data-bind="component: { name: \'ms-loadingSpinner\', params: { loadingText: \'\' } }, visibility: isSpinnerVisible"></span> <button class="ms-Dialog-action ms-Button ms-Button--primary" data-bind="click: buttonClick, keyboard: { mappings: { Enter: buttonClick, Space: buttonClick }, preventDefault: true }, enable: $parent.buttonsAvailable(), automation: automationId"><span class=ms-Button-label data-bind="text: buttonText"></span></button></div><!--ko ifnot: $parent.resolveDescriptionFirst--><div data-bind="html: descriptionHtml"></div><!--/ko--></div><!--/ko-->'}),define("odsp-next/controls/policyTip/PolicyTipJustify.html",[],function(){return'<div class="ms-TextField ms-TextField--multiline"><label class="ms-Label od-PolicyTip-justifyLabel" data-bind="attr: { \'for\': justificationTextId }, text: strings.OverrideDescription"></label> <textarea class="od-PolicyTip-justifyText ms-TextField-field" required aria-required=true maxlength=255 data-bind="value: justificationText, hasFocus: true, attr: { id: justificationTextId, placeholder: strings.OverridePlaceholder }, css: { \'od-PolicyTip-justifyText--error\': justificationError }"></textarea></div><div class=od-PolicyTip-justifyError aria-live=assertive data-bind="text: justificationError"></div>'}),define("odsp-next/controls/policyTip/PolicyTipMessage.html",[],function(){return'<div class=od-PolicyTip-section data-bind="text: messageText"></div>'}),define("odsp-next/controls/policyTip/PolicyTip.css",["odsp-utilities/domUtils/DomUtils"],function(e){e.loadStyles(".od-PolicyTip{height:255px;overflow-x:hidden;position:relative;margin-top:8px}.od-PolicyTip .ms-TextField.ms-TextField--multiline{margin:0}.od-PolicyTip .ms-TextField.ms-TextField--multiline .ms-Label{padding-top:0}.od-PolicyTip-loading{text-align:center;position:relative;top:102.5px}.od-PolicyTip-issuesExplanation{margin-bottom:24px}.od-PolicyTip-issuesHeader{padding:0;margin:0 32px}.od-PolicyTip-issuesIcon{padding:2px 8px 0;color:#a80000;font-size:17px;height:16px;width:16px;cursor:default}html[dir=ltr] .od-PolicyTip-issuesIcon{float:left}html[dir=rtl] .od-PolicyTip-issuesIcon{float:right}.od-PolicyTip-issueList{margin:8px 0 24px}html[dir=ltr] .od-PolicyTip-issueList{padding-left:29px}html[dir=rtl] .od-PolicyTip-issueList{padding-right:29px}html[dir=ltr] .od-PolicyTip-issueList li{padding-left:3px}html[dir=rtl] .od-PolicyTip-issueList li{padding-right:3px}.od-PolicyTip-lastScannedRow{cursor:default;color:#666}.od-PolicyTip-resolveSection{margin-bottom:24px}.od-PolicyTip-resolveHeading{color:#2f69c0;margin:0;padding:0 0 8px}.lg .od-PolicyTip-resolveButton,.xlg .od-PolicyTip-resolveButton,.xxlg .od-PolicyTip-resolveButton,.xxxlg .od-PolicyTip-resolveButton{margin-bottom:2em}html[dir=ltr] .lg .od-PolicyTip-resolveButton,html[dir=ltr] .xlg .od-PolicyTip-resolveButton,html[dir=ltr] .xxlg .od-PolicyTip-resolveButton,html[dir=ltr] .xxxlg .od-PolicyTip-resolveButton{float:right;margin-left:24px}html[dir=rtl] .lg .od-PolicyTip-resolveButton,html[dir=rtl] .xlg .od-PolicyTip-resolveButton,html[dir=rtl] .xxlg .od-PolicyTip-resolveButton,html[dir=rtl] .xxxlg .od-PolicyTip-resolveButton{float:left;margin-right:24px}.md .od-PolicyTip-resolveButton,.sm .od-PolicyTip-resolveButton{display:inline-block;width:100%;margin-top:8px}html[dir=ltr] .md .od-PolicyTip-resolveButton,html[dir=ltr] .sm .od-PolicyTip-resolveButton{text-align:right}html[dir=rtl] .md .od-PolicyTip-resolveButton,html[dir=rtl] .sm .od-PolicyTip-resolveButton{text-align:left}.od-PolicyTip-resolveButton button{min-width:100px}.od-PolicyTip-resolveSpinner{display:inline-block;padding-bottom:7px;vertical-align:bottom}html[dir=ltr] .od-PolicyTip-resolveSpinner{padding-right:5px}html[dir=rtl] .od-PolicyTip-resolveSpinner{padding-left:5px}.od-PolicyTip-justifyLabel.ms-Label{padding-bottom:16px}.od-PolicyTip-justifyText{overflow:auto}.ms-TextField.ms-TextField--multiline .od-PolicyTip-justifyText.ms-TextField-field{min-height:150px;font-size:12px}.od-PolicyTip-justifyText--error.ms-TextField-field{border-color:#a80000}.od-PolicyTip-justifyError{padding-top:2px;height:2em;color:#a80000}")}),define("odsp-next/controls/policyTip/PolicyTip",["require","exports","./PolicyTipViewModel","./PolicyTipTemplates","odsp-shared/utilities/knockout/ComponentFactory","./PolicyTip.html","./PolicyTipLoading.html","./PolicyTipTip.html","./PolicyTipResolve.html","./PolicyTipJustify.html","./PolicyTipMessage.html","./PolicyTip.css","../loadingSpinner/LoadingSpinner"],function(e,t,i,o,n){var r=n.registerComponent({tagName:"od-policy-tip-dialog",template:e("./PolicyTip.html"),viewModel:i});return n.registerTemplate(o.LOADING,e("./PolicyTipLoading.html")),n.registerTemplate(o.TIP,e("./PolicyTipTip.html")),n.registerTemplate(o.RESOLVE,e("./PolicyTipResolve.html")),n.registerTemplate(o.JUSTIFY,e("./PolicyTipJustify.html")),n.registerTemplate(o.MESSAGE,e("./PolicyTipMessage.html")),r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/PolicyTipAction",["require","exports","knockout","../base/BaseItemAction","../controls/policyTip/PolicyTip","../controls/policyTip/PolicyTipDialogState","../controls/policyTip/PolicyTip.resx","../models/dialog/DialogState","../models/policyTip/PolicyTipUserAction","../models/policyTip/PolicyTipUserActionResult","../models/policyTip/RuleOverrideOptions","../resources/DataSourceResourceKeys","../resources/ProviderResourceKeys","odsp-utilities/async/Promise","../utilities/browser/WindowSize","odsp-utilities/logging/events/Engagement.event","odsp-utilities/logging/events/Qos.event","odsp-shared/utilities/string/StringHelper","../utilities/icons/Icon"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b){var x;!function(e){e[e.None=0]="None",e[e.ItemIdParamMissing=1]="ItemIdParamMissing",e[e.ItemParamMissing=2]="ItemParamMissing",e[e.ItemNotFound=3]="ItemNotFound",e[e.NoPolicyTipInitial=4]="NoPolicyTipInitial",e[e.GetItemServerError=5]="GetItemServerError",e[e.GetInfoServerError=6]="GetInfoServerError",e[e.UpdateServerNoResult=7]="UpdateServerNoResult",e[e.UpdateServerError=8]="UpdateServerError",e[e.NoPolicyTipFinal=9]="NoPolicyTipFinal"}(x||(x={}));var y=function(e){function t(t){if(e.call(this,t),this.name="PolicyTip",this._dialogProvider=this.resources.consume(u.dialog),this._policyTipDataSource=this.resources.consume(p.policyTip),this._item=i.observable(null),t.item&&t.item())this._itemPromise=h.default.wrap(t.item());else if(t.getItemContext)if(t.getItemContext.singleItemId){var o=this.resources.consume(u.item);this._itemPromise=o.getSingleItem(t.getItemContext)}else this._errorType=x.ItemIdParamMissing,this._itemPromise=h.default.wrapError();else this._errorType=x.ItemParamMissing,this._itemPromise=h.default.wrapError()}return __extends(t,e),t.prototype.onExecute=function(e,t){var o=this,d=s.strings;this._state=i.observable(r.loading),this._buttonsAvailable=i.observable(!0),this._justificationText=i.observable(""),this._justificationError=i.observable(""),this._messageText=i.observable(""),this._titleOverride="",this._action=i.observable(null),this._info=i.observable(null),this._logEvt=t,this._title=this.createPureComputed(function(){var e=o._state();switch(e!==r.status&&e!==r.error&&(o._titleOverride=""),e){case r.loading:return d.TipHeadingNoFile;case r.tip:return o._getDocNameTitle();case r.resolve:return d.ResolveTitle;case r.justify:return d.OverrideTitle;case r.status:return o._titleOverride||o._getDocNameTitle();case r.error:return o._titleOverride||d.ErrorTitle}return""}),this.subscribe(this._action,function(e){e===l.override?o._handleOverrideClick():e===l.reportFalsePositive&&o._updateServer()}),this._itemPromise.done(function(e){return e?(o._item(e),void o._policyTipDataSource.getPolicyTip(e).done(function(e){e?(e.issueDescriptions&&e.issueDescriptions.length&&g.Engagement.logData({name:"PolicyTip.ItemWithIssues",extraData:{count:e.issueDescriptions.length}}),o._info(e),o._state(r.tip)):(o._errorType=x.NoPolicyTipInitial,o._showError())},function(e){o._errorType=x.GetInfoServerError,o._showError(e)})):(o._errorType=x.ItemNotFound,void o._showError())},function(e){o._errorType||(o._errorType=x.GetItemServerError),o._showError(e)});var c={item:this._item,policyInfo:this._info,state:this._state,buttonsAvailable:this._buttonsAvailable,justificationText:this._justificationText,justificationError:this._justificationError,messageText:this._messageText,action:this._action,logEvt:this._logEvt},p=function(e){return o.createPureComputed(function(){return o._state()===e})},u=i.observable(!1);this.subscribe(u,function(e){o._buttonsAvailable(!e)});var v=this._dialogProvider.requestDialog({title:this._title,size:m.Medium,component:{name:n.tagName,params:c},actions:[{name:d.TipResolve,execute:function(){return o._showState(r.resolve,"Resolve")},isVisible:p(r.tip),isAvailable:this._buttonsAvailable,isDefault:!0,icon:b.save,automationId:"PolicyTipDialogResolve"},{name:d.TipClose,execute:function(){return o._dismissWithButton("Close")},isVisible:this.createPureComputed(function(){var e=o._state();return e===r.tip||e===r.error}),isAvailable:this._buttonsAvailable,icon:b.x,automationId:"PolicyTipDialogClose"},{name:d.ResolveBack,execute:function(){return o._showState(r.tip,"Back")},isVisible:p(r.resolve),isAvailable:this._buttonsAvailable,icon:b.x,automationId:"PolicyTipDialogBack"},{name:d.OverrideSubmit,execute:function(){return o._logClick("Submit"),o._submitOverride()},isVisible:p(r.justify),isAvailable:this._buttonsAvailable,isDefault:!0,icon:b.save,automationId:"PolicyTipDialogSubmit",isExecuting:u},{name:d.OverrideCancel,execute:function(){return o._dismissWithButton("Cancel")},isVisible:p(r.justify),isAvailable:this._buttonsAvailable,icon:b.x,automationId:"PolicyTipDialogCancel"},{name:d.StatusOK,execute:function(){return o._logClick("OK"),h.default.wrap(a.completed)},isVisible:p(r.status),isAvailable:this._buttonsAvailable,isDefault:!0,icon:b.save,automationId:"PolicyTipDialogOK"}]});return v.wait().then(function(){return h.default.wrap(o._evtEndObj)},function(){return o._dismissedByButton||o._logClick("Dismiss"),o._evtEndObj||(o._evtEndObj={resultType:f.ResultTypeEnum.ExpectedFailure,resultCode:"CanceledOrClosed"}),h.default.wrap(o._evtEndObj)})},t.prototype._showState=function(e,t){return this._logClick(t),this._state(e),h.default.wrap(a.opened)},t.prototype._dismissWithButton=function(){return this._logClick("Close"),this._dismissedByButton=!0,h.default.wrap(a.dismissed)},t.prototype._logClick=function(e){var t=r[this._state()];t=t.charAt(0).toUpperCase()+t.slice(1);var i=v.format("PolicyTip.{0}State.{1}.Click",t,e);g.Engagement.logData({name:i},this._logEvt)},t.prototype._getDocNameTitle=function(){var e=this._item();return v.format(s.strings.TipHeading,e?e.displayName||e.name:"")},t.prototype._handleOverrideClick=function(){return this._info().overrideOption!==c.allowWithJustification?this._submitOverride():(this._justificationError(""),void this._state(r.justify))},t.prototype._submitOverride=function(){return this._info().overrideOption!==c.allowWithJustification||this._justificationText()?(this._justificationError(""),this._updateServer()):this._justificationError(s.strings.OverrideError),h.default.wrap(a.opened)},t.prototype._updateServer=function(){var e=this,t=s.strings;this._buttonsAvailable(!1);var i={item:this._item(),action:this._action(),justification:this._justificationText()};this._policyTipDataSource.updatePolicy(i).done(function(i){null===i?(e._errorType=x.UpdateServerNoResult,e._showError()):i===d.none?(e._errorType=x.NoPolicyTipFinal,e._showError()):(e._titleOverride=t.StatusTitle,e._messageText(i===d.falsePositiveReported?t.StatusReportSuccess:t.StatusOverrideSuccess),e._evtEndObj={resultType:f.ResultTypeEnum.Success},e._state(r.status),e._buttonsAvailable(!0))},function(t){e._errorType=x.UpdateServerError,e._showError(t)})},t.prototype._showError=function(e){var t=s.strings;try{"string"==typeof e&&(e=JSON.parse(e))}catch(i){}var o;switch(this._errorType){case x.ItemNotFound:this._titleOverride=t.FileNotFoundTitle,this._messageText(t.FileNotFoundMessage),o=f.ResultTypeEnum.Failure;break;case x.NoPolicyTipInitial:case x.NoPolicyTipFinal:this._titleOverride=this._getDocNameTitle(),this._messageText(t.StatusNoPolicyTip),o=f.ResultTypeEnum.ExpectedFailure;break;default:this._messageText(e&&e.error&&e.error.message&&e.error.message.value||e&&e.detailedText||"string"==typeof e&&e||t.ErrorText),o=f.ResultTypeEnum.Failure}this._evtEndObj={resultCode:x[this._errorType],resultType:o,error:this._messageText(),extraData:{error:e}},this._buttonsAvailable(!0),this._state(r.error)},t}(o);return y});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/splist/GroupAction",["require","exports","../../base/BaseAction","odsp-utilities/async/Promise","odsp-utilities/logging/events/Qos.event","../../resources/UtilityResourceKeys","odsp-next/dataSources/url/odb/UrlQueryKeys"],function(e,t,i,o,n,r,s){var a=function(e){function t(t){e.call(this,t),this.name="Group",this._field=t.field}return __extends(t,e),t.prototype.onExecute=function(){return this._setGroupByField(this.onIsToggled()?"":this._field),o.default.wrap({resultType:n.ResultTypeEnum.Success})},t.prototype.onIsAvailable=function(){return!0},t.prototype.onIsToggled=function(){return this._getGroupByField()===this._field},t.prototype._getGroupByField=function(){var e=this.resources.consume(r.navigation),t=e.viewParams[s.default.groupByKey];return t},t.prototype._setGroupByField=function(e){var t=this.resources.consume(r.navigation);t.updateViewParams((i={},i[s.default.groupByKey]=e,i));var i},t}(i);return a});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/actions/splist/ToggleAction",["require","exports","knockout","../../base/BaseAction","odsp-utilities/async/Promise","odsp-utilities/logging/events/Qos.event"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this.name="ToggleAction",this.flag=t.flag||i.observable(!1)}return __extends(t,e),t.prototype.onExecute=function(){return this.flag(!this.flag()),n.default.wrap({resultType:r.ResultTypeEnum.Success})},t.prototype.onIsAvailable=function(){return!0},t.prototype.onIsToggled=function(){return this.flag()},t}(o);return s}),define("odsp-next/models/task/TaskObserver",["require","exports"],function(e,t){var i=function(){function e(e){this._tasksByKey={},this._onChanges=e}return e.map=function(e,t){return{update:function(i,o){void 0===o&&(o=!1),e.update(i.map(function(e){return t(e)}),o)}}},e.prototype.getTasks=function(){var e=[];for(var t in this._tasksByKey)e.push(this._tasksByKey[t]);return e},e.prototype.getTask=function(e){return this._tasksByKey[e]
},e.prototype.update=function(e,t){void 0===t&&(t=!1);var i;i={};var o;for(var n in this._tasksByKey)i[n]=this._tasksByKey[n];var r;r=[];for(var s=0;s<e.length;s++){var a=e[s],l=i[a.key],d=a.compare(l);d&&r.push(d),delete i[a.key],this._tasksByKey[a.key]=a}if(t)for(var n in i)o=i[n],delete this._tasksByKey[n],r.push({previous:o,current:null});this.onChanges(r)},e.prototype.onChanges=function(e){this._onChanges&&this._onChanges(e)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/BaseOperator",["require","exports","odsp-shared/base/BaseModel","../../models/task/TaskObserver","odsp-utilities/async/Promise","odsp-utilities/async/Signal","../../resources/ProviderResourceKeys","../../models/operation/OperationState","../../models/operation/OperationError","../../models/operation/OperationType","../../models/operation/OperationBatch","../../models/operation/OperationVisibility","../../models/task/TaskStatus","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h){function m(e){"use strict";return function(){return e.complete()}}function g(e){"use strict";return function(t){return e.error(t)}}var f="_BaseOperator_actionName",v=function(e){function t(t){e.call(this,t),this._actionsByName={},this._operationProvider=this.resources.consume(s.operation),this._operationBatch=new c,this._operationsByKey={},this._observer=new o.default(this._onTaskChanges.bind(this)),this._throttleExecuteAllActions=this.async.debounce(this._executeAllActions),this.registerActions({cancel:this.onCancel}),this.addDisposable(this._operationProvider.groups.subscribe(this._onOperationProviderGroupsChanged,this,"arrayChange"))}return __extends(t,e),t.prototype.start=function(){var e=this,t=this.onStart(this._observer);return t.done(function(){e._disposeIfDone()},function(){e._disposeIfDone()}),t},t.prototype.onStart=function(){return n.default.wrap()},t.prototype.onCancel=function(e,t){return e=e.map(function(e){return e.cancel()}),t.update(e),n.default.wrap()},t.prototype.registerActions=function(e){for(var t in e){var i=e[t];i?(i[f]=t,this._actionsByName[t]={action:e[t],callback:e[t].bind(this),queue:[],signal:new r}):delete this._actionsByName[t]}},t.prototype.getOperationDetails=function(e){var t;t=e.status===u.default.succeeded?a.completed:e.status===u.default.failed?a.failed:e.status===u.default.canceled?a.canceled:a.started;var i={type:d.multiple,name:"",iconName:null,error:e.error&&new l({message:e.error.message,payloads:{}})||null,state:t,progress:{minimum:0,maximum:e.status!==u.default.canceled?1:0,current:e.status===u.default.succeeded?1:0},visibility:p.Default,payloads:{},actions:[]};return e.status===u.default.failed&&i.actions.push(this.onCancel),i},t.prototype.onOperationFinished=function(){},t.prototype._queueTaskForAction=function(e,t){var i=this._actionsByName[e];return i.queue.push(t),this._throttleExecuteAllActions(),i.signal.getPromise()},t.prototype._executeAllActions=function(){for(var e in this._actionsByName){var t=this._actionsByName[e],i=t.signal;if(t.signal=new r,t.queue.length){var o=t.queue.splice(0,t.queue.length);t.callback(o,this._observer).done(m(i),g(i))}}},t.prototype._onTaskChanges=function(e){for(var t=0;t<e.length;t++){var i=e[t];this._updateOperationForTask(i)}},t.prototype._updateOperationForTask=function(e){var t,i=e.current,o=this.getOperationDetails(i),n=this._operationsByKey[i.key];t={};for(var r=0,s=o.actions;r<s.length;r++){var a=s[r],l=a[f];this._actionsByName[l].action===a&&(t[l]=!0)}if(!n){var d={};for(var l in this._actionsByName)d[l]={isAvailable:h.observable(l in t),execute:this._getActionExecutor(l,i)};var c={batch:this._operationBatch,type:o.type,name:o.name,iconName:o.iconName,payloads:o.payloads,progress:o.progress,visibility:o.visibility,actions:d};n=this._operationsByKey[i.key]=this._operationProvider.register(c)}n.type(o.type),n.state(o.state),n.error(o.error),n.progress.minimum(o.progress.minimum),n.progress.maximum(o.progress.maximum),n.progress.current(o.progress.current);for(var l in this._actionsByName)n.actions.peek()[l].isAvailable(l in t)},t.prototype._getActionExecutor=function(e,t){var i=this;return function(){return i._queueTaskForAction(e,t)}},t.prototype._createGroupOperationSubscription=function(e){var t=this,i=!1,o=this.createComputed(function(){var n=e.state();i=n===a.completed||n===a.canceled||n===a.failed||n===a.expired,i&&(t.onOperationFinished(e),o&&o.dispose())});i&&o.dispose()},t.prototype._onOperationProviderGroupsChanged=function(e){for(var t=0;t<e.length;t++){var i=e[t],o=i.value;o.batch===this._operationBatch&&("added"===i.status?this._groupOperation||(this._groupOperation=o,this._createGroupOperationSubscription(o)):"deleted"!==i.status||i.moved||this.dispose())}},t.prototype._disposeIfDone=function(){this._groupOperation||this.dispose()},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=v});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/RestoreItemsOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/item/ItemType","../../models/task/Task","../../models/operation/OperationType","../../models/task/TaskStatus"],function(e,t,i,o,n,r,s,a){var l={1e3:!0,1012:!0},d={overwrite:1,rename:2},c=function(e){function t(t){e.call(this,t),this._itemProvider=this.resources.consume(o.item),this._context=t,this.registerActions({overwrite:this._onOverwrite,rename:this._onRename})}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input;return i.name=o.name,i.iconName=o.iconName,i.type=s.restoreItems,i.payloads={restoreItems:{item:o}},t.status===a.default.failed&&t.error&&t.error.code in l&&o.type!==n.Folder&&i.actions.push(this._onOverwrite,this._onRename),i},t.prototype.onStart=function(e){var t=this._context.items.map(function(e){return new r.default(e.key,e)});return e.update(t),this._itemProvider.restoreItems({parentKey:this._context.parentKey,retainAcls:this._context.retainAcls,items:t.map(function(e){return e.input})},e)},t.prototype._onRename=function(e,t){return e=e.map(function(e){return e.restart()}),t.update(e),this._itemProvider.restoreItems({parentKey:this._context.parentKey,items:e.map(function(e){return e.input}),retainAcls:this._context.retainAcls,nameConflict:d.rename},t)},t.prototype._onOverwrite=function(e,t){return e=e.map(function(e){return e.restart()}),t.update(e),this._itemProvider.restoreItems({parentKey:this._context.parentKey,items:e.map(function(e){return e.input}),retainAcls:this._context.retainAcls,nameConflict:d.overwrite},t)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/RotateItemsOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/task/Task","../../models/operation/OperationType"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._itemProvider=this.resources.consume(o.item)}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input;return i.name=o.name,i.iconName=o.iconName,i.type=r.rotateItems,i.payloads={rotateItems:{item:o,parent:o.parent}},i},t.prototype.onStart=function(e){var t=this._context.items.map(function(e){return new n.default(e.key,e)});return e.update(t),this._itemProvider.rotateItems({items:t.map(function(e){return e.input}),rotation:this._context.rotation,parentKey:this._context.parentKey},e)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/DeleteItemsOperator",["require","exports","../../models/task/Task","../../models/task/TaskStatus","../../models/task/TaskObserver","./BaseOperator","../../models/operation/OperationType","../../resources/ProviderResourceKeys","../../dataSources/item/DeletionType"],function(e,t,i,o,n,r,s,a,l){var d=9001;!function(e){e[e.recycle=0]="recycle",e[e.purge=1]="purge",e[e.restore=2]="restore"}(t.DeleteType||(t.DeleteType={}));var c=t.DeleteType,p=function(e){function t(t){e.call(this,t),this._itemProvider=this.resources.consume(a.item),this._context=t,this.registerActions({undo:this._onUndo,deleteLocked:this._onDeleteLocked})}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),n=t.input.item;return i.name=n.name,i.iconName=n.iconName,i.type=t.input.type===c.restore?s.restoreItems:s.deleteItems,i.payloads.deleteItems={item:n,parent:n.parent},i.payloads.restoreItems={item:n},this._context.allowUndo&&this._canUndoItem(n)&&t.input.type===c.recycle&&t.status===o.default.succeeded&&i.actions.push(this._onUndo),t.status===o.default.failed&&t.error&&t.error.code===d&&i.actions.push(this._onDeleteLocked),i},t.prototype.onStart=function(e){var t=this._context.deletionType===l.PermanantDelete?c.purge:c.recycle,o=this._context.overrideLock,r=this._context.items.map(function(e){return new i.default(e.key,{item:e,type:t,isOverride:o})});return e.update(r),this._itemProvider.deleteItems({items:this._context.items,deletionType:this._context.deletionType,overrideLock:o,parentKey:this._context.parentKey},n.default.map(e,function(e){return e.changeInput(function(e){return{item:e,type:t,isOverride:o}})}))},t.prototype._canUndoItem=function(e){return!e.isAlbum},t.prototype._onDeleteLocked=function(e,t){return e=e.map(function(e){return e.restart().changeInput(function(e){return{item:e.item,type:e.type,isOverride:!0}})}),t.update(e),this._itemProvider.deleteItems({items:e.map(function(e){return e.input.item}),deletionType:this._context.deletionType,overrideLock:!0,parentKey:this._context.parentKey},n.default.map(t,function(t){return t.changeInput(function(t){return{item:t,type:e[0].input.type,isOverride:e[0].input.isOverride}})}))},t.prototype._onUndo=function(e,t){return e=e.map(function(e){return e.restart().changeInput(function(e){return{item:e.item,type:c.restore,isOverride:!1}})}),t.update(e),this._itemProvider.restoreItems({items:e.map(function(e){return e.input.item}),parentKey:this._context.parentKey,retainAcls:!0},n.default.map(t,function(t){return t.changeInput(function(t){return{item:t,type:e[0].input.type,isOverride:e[0].input.isOverride}})}))},t}(r.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=p});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/UpdateBundleOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/task/Task","../../models/operation/OperationType"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._itemProvider=this.resources.consume(o.item)}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input;return i.type=r.updateBundle,i.name=o.name,i.iconName=o.iconName,i.payloads.updateBundle={item:o,parent:o.parent},i},t.prototype.onStart=function(e){var t=[new n.default(this._context.item.key,this._context.item)];return e.update(t),this._itemProvider.updateBundle(this._context,e)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/CreateFolderOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/operation/OperationType","../../models/operation/OperationVisibility"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._itemProvider=this.resources.consume(o.item)}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input,s=this._context.parent;return i.type=n.createFolder,i.name=o,i.iconName=s.iconName,i.payloads.createFolder={parent:s},i.visibility=r.HideAll,i},t.prototype.onStart=function(e){return this._itemProvider.createFolder(this._context,e)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/RenameItemOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/operation/OperationType","../../models/operation/OperationVisibility"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._itemProvider=this.resources.consume(o.item)}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input;return i.type=n.renameItems,i.name=o.name,i.iconName=o.iconName,i.payloads.renameItems={item:o,parent:o.parent},i.visibility=r.HideAll,i},t.prototype.onStart=function(e){return this._itemProvider.renameItem(this._context,e)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),define("odsp-next/dataSources/upload/UploadState",["require","exports"],function(){var e;return function(e){e[e.queued=0]="queued",e[e.started=1]="started",e[e.completed=2]="completed",e[e.aborted=3]="aborted",e[e.failed=4]="failed"}(e||(e={})),e}),define("odsp-next/utilities/path/Path",["require","exports"],function(){var e=function(){function e(){}return e.getFileExtension=function(e,t){void 0===t&&(t=!1);var i="";if(e){var o=e.lastIndexOf(".");o>=0&&(i=e.substr(t?o+1:o))}return i},e}();return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/BaseUploadOperator",["require","exports","./BaseOperator","../../models/operation/OperationType","../../models/operation/OperationState","../../dataSources/upload/UploadState","../../dataSources/upload/UploadErrorType","../../dataSources/upload/NameConflictBehavior","../../resources/ProviderResourceKeys","../../models/task/Task","../../models/task/TaskStatus","odsp-utilities/async/Promise","odsp-utilities/logging/events/Qos.event","../../dataSources/upload/UploadProcessorType","odsp-shared/utilities/logging/events/UploadOperation.event","../../utilities/path/Path","knockout"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f){var v=function(e){function t(t){e.call(this,t),this._context=t,this._context.resources||(this._context.resources=this.resources),this._uploadProvider=this.resources.consume(l.upload),this.registerActions({cancel:this.onCancel,overwrite:this._onOverwrite,rename:this._onRename,restart:this._onRestart}),this._canary=f.observable()}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),a=t.input,l=t.error;return i.type=o.uploadItems,i.name=a.fileName.peek(),i.iconName=a.iconName.peek(),i.payloads.uploadItems={parent:this._context.parentItem,name:a.fileName.peek()},a.state.peek()===r.queued&&(i.state=n.created),(t.status===c.default.started||t.status===c.default.failed)&&i.actions.push(this.onCancel),i.progress.maximum=a.totalBytes.peek(),i.progress.current=a.uploadedBytes.peek(),t.status===c.default.failed&&(l&&(i.error.payloads.upload={error:l}),!a.nameConflictBehavior.peek()&&l&&l.errorType===s.conflict&&(i.actions.push(this._onOverwrite),a.allowRename&&i.actions.push(this._onRename))),a.isDownlevel||t.status!==c.default.failed||l&&l.errorType!==s.general||i.actions.push(this._onRestart),i},t.prototype.getUploader=function(){var e=this;return this._uploadProvider.getUploadManager().then(function(t){return t.upload(e._context)})},t.prototype.updateTaskOutput=function(e,t){return t},t.prototype.onStart=function(e){var t=this;return this._event=new m.UploadOperation({name:"UploadOperation",dragAndDrop:this._context.wasDragAndDropped,uploadType:h[this._context.type]}),this.getUploader().then(function(i){t.addDisposable(i);var o=function(t){e.update([t])},n=0;return t.addDisposable(i.filesUploading.map({mappingWithDisposeCallback:function(e){var i="&u="+ ++n,r=t._createUploaderTaskSubscription(e,i,o);return{mappedValue:i,dispose:function(){r.dispose();var n=t._computeTask(e,i);n.status===c.default.started&&(n=n.cancel()),o(n)}}}})),i.start()})},t.prototype.onCancel=function(e){for(var t=0;t<e.length;t++){var i=e[t],o=i.input.state.peek();o===r.failed&&(i.input.error(null),i.input.state(r.aborted)),i.input.abort()}return p.default.wrap()},t.prototype.onOperationFinished=function(e){var t,i=e.state.peek(),o=e.states.peek(),r=e.operations.peek();t=i===n.completed?u.ResultTypeEnum.Success:i===n.canceled?u.ResultTypeEnum.ExpectedFailure:u.ResultTypeEnum.Failure;var s;s=1===r.length?g.getFileExtension(e.payloads.peek().uploadItems.name):"",this._event&&this._event.end({size:e.progress.maximum.peek(),count:r.length,failCount:o.failed,successCount:o.completed,abortCount:o.canceled,resultType:t,dragAndDrop:this._context.wasDragAndDropped,uploadType:h[this._context.type],extension:s})},t.prototype._onRestart=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.input.restart()}return p.default.wrap()},t.prototype._onOverwrite=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.input.nameConflictBehavior(a.overwrite),i.input.restart()}return p.default.wrap()},t.prototype._onRename=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.input.nameConflictBehavior(a.rename),i.input.restart()}return p.default.wrap()},t.prototype._createUploaderTaskSubscription=function(e,t,i){var o=this,n=!1,r=f.computed(function(){var s=o._computeTask(e,t);i(s),n=s.status===c.default.succeeded||s.status===c.default.canceled,n&&r&&r.dispose()},this).extend({rateLimit:{timeout:0}});return n&&r.dispose(),r},t.prototype._computeTask=function(e,t){var i=new d.default(t,e),o=e.state(),n=e.error(),s=e.totalBytes(),a=e.uploadedBytes();return o===r.aborted?i=i.cancel():o===r.failed?i=i.fail(n):o===r.completed&&(i=i.succeed(),this._canary.valueHasMutated()),i=i.changeOutput(function(){return{totalBytes:s,uploadedBytes:a}}),i=this.updateTaskOutput(e,i)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=v});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/UploadOperator",["require","exports","./BaseUploadOperator","knockout","../../resources/ProviderResourceKeys"],function(e,t,i,o,n){var r=4e3,s=function(e){function t(t){e.call(this,t),this._itemProvider=this.resources.consume(n.item),this._invalidateItem=this.createComputed(this._computeInvalidateItem).extend({rateLimit:{timeout:r}})}return __extends(t,e),t.prototype.dispose=function(){this._invalidateItem(),e.prototype.dispose.call(this)},t.prototype.onOperationFinished=function(t){this._invalidateItem(),e.prototype.onOperationFinished.call(this,t)},t.prototype._computeInvalidateItem=function(){this._canary(),o.computedContext.isInitial()||this._itemProvider.invalidateItem(this._context.parentItem.key,!0)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/SetAlbumCoverPhotoOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/operation/OperationType","../../models/operation/OperationVisibility"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._albumProvider=this.resources.consume(o.album)}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t);return i.type=n.setAlbumCoverPhoto,i.name=this._context.album.name,i.payloads.setAlbumCoverPhoto={album:this._context.album,item:this._context.items[0]},i.visibility=r.Default,i},t.prototype.onStart=function(e){return this._albumProvider.setCoverPhoto(this._context,e)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/CreateAlbumFromFolderOperator",["require","exports","knockout","./BaseOperator","../../resources/ProviderResourceKeys","../../models/operation/OperationType"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._itemProvider=this.resources.consume(n.item),this._albumProvider=this.resources.consume(n.album),this._payloads={createAlbumFromFolder:{folder:i.observable(null),album:i.observable(null)}}}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input;return i.type=r.createAlbumFromFolder,i.name=o,i.iconName=this._context.folder.iconName,i.payloads=this._payloads,t.output&&t.output.isAlbum&&this._payloads.createAlbumFromFolder.album(t.output),i},t.prototype.onStart=function(e){return this._albumProvider.createAlbumFromFolder(this._context,e)},t}(o.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/MergeFaceGroupsOperator",["require","exports","./BaseOperator","../../resources/ProviderResourceKeys","../../models/operation/OperationType"],function(e,t,i,o,n){var r=function(e){function t(t){e.call(this,t),this._context=t,this._faceGroupProvider=this.resources.consume(o.faceGroup)}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input,r=o[0];return i.name=r.name,i.iconName=r.iconName,i.type=n.mergeFaceGroups,i.payloads={mergeFaceGroups:{items:o}},i},t.prototype.onStart=function(e){return this._faceGroupProvider.mergeFaceGroups(this._context,e)},t}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/CreateAlbumOperator",["require","exports","knockout","./BaseOperator","../../resources/ProviderResourceKeys","../../models/operation/OperationType"],function(e,t,i,o,n,r){var s=function(e){function t(t){e.call(this,t),this._context=t,this._itemProvider=this.resources.consume(n.item),this._albumProvider=this.resources.consume(n.album),this._payloads={createAlbum:{name:i.observable(""),items:i.observable(null),album:i.observable(null)}}}return __extends(t,e),t.prototype.getOperationDetails=function(t){var i=e.prototype.getOperationDetails.call(this,t),o=t.input;return i.type=r.createAlbum,i.name=o,i.payloads=this._payloads,t.output&&t.output.isAlbum&&this._payloads.createAlbum.album(t.output),i},t.prototype.onStart=function(e){return this._albumProvider.createAlbum(this._context,e)},t}(o.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/BaseBatchUploader",["require","exports","odsp-shared/base/BaseModel","knockout"],function(e,t,i,o){var n=function(e){function t(t){e.call(this,t),this.filesUploading=o.observableArray(),this.batchStartTime=t.batchStartTime}return __extends(t,e),t.prototype.start=function(){throw new Error("Not Implemented")},t}(i);return n}),define("odsp-next/dataSources/upload/FileUploadType",["require","exports"],function(){var e=function(){function e(){}return e.Html5="h5",e.Silverlight="sl",e.Downlevel="dl",e}();return e}),define("odsp-next/dataSources/upload/odb/FileValidationStatus",["require","exports"],function(){var e;return function(e){e[e.invalid=-1]="invalid",e[e.pending=0]="pending",e[e.valid=1]="valid"}(e||(e={})),e}),define("odsp-next/dataSources/upload/odb/Html5FileUpload",["require","exports","../../../utilities/icons/IconSelector","../FileUploadType","./FileValidationStatus"],function(e,t,i,o,n){var r=function(){function e(e,t){this._disposed=!1;var r=this;r.file=e,r.name=e.fileName||e.name;var s=r.name.lastIndexOf(".");r.extension=s>=0?r.name.substring(s):"",r.iconName=i.getIconNameFromExtension(r.extension),r.size=e.size,r.eTag=e.eTag,r.downlevel=!1,r.canResizeOnClient=!1;var a=e.lastModifiedDate;if(r.lastModified="",a){var l=a.getUTCDate();l=10>l?"0"+l:l;var d=a.getUTCMonth()+1;d=10>d?"0"+d:d;var c=a.getUTCHours();c=10>c?"0"+c:c;var p=a.getUTCMinutes();p=10>p?"0"+p:p;var u=a.getUTCSeconds();u=10>u?"0"+u:u,r.lastModified=a.getUTCFullYear()+":"+d+":"+l+" "+c+":"+p+":"+u}r.upType=o.Html5,r.dragDrop=Boolean(t)?t:!1,r.isLocked=!1,r.validationStatus=n.pending,r.validationResult=""}return e.prototype.isFolder=function(e){var t=this;if(t.file.isFolder)e(!0);else{var i=new FileReader;i.onload=function(){t._disposed||e(i.result||t.extension?!1:!0)},i.onerror=function(){t._disposed||e(!0)};try{i.readAsArrayBuffer(t.getBlob(0,Math.min(1,t.file.size)))}catch(o){e(!0)}}},e.prototype.dispose=function(){this._disposed=!0,this.file=null},e.prototype.getBlob=function(e,t){var i=null;return this.file&&(this.file.slice?i=this.file.slice(e,t):this.file.mozSlice?i=this.file.mozSlice(e,t):this.file.webkitSlice&&(i=this.file.webkitSlice(e,t))),i},e}();return r}),define("odsp-next/utilities/queue/QueueTaskState",["require","exports"],function(){var e;return function(e){e[e.Disconnected=0]="Disconnected",e[e.Pending=1]="Pending",e[e.Active=2]="Active",e[e.Complete=3]="Complete"}(e||(e={})),e}),define("odsp-next/utilities/queue/Queue",["require","exports","./QueueTaskState","odsp-utilities/async/Async","odsp-utilities/async/Promise"],function(e,t,i,o,n){var r=function(){function e(t,i){this._pendingTaskCount=0,this._activeTaskCount=0,this._currentSetTimeoutId=0,this._async=new o(this),this._nextTaskId=0,this._tasks={},this._activeTasks={},this._isAbortingAll=!1,this._isProcessingTasks=!1,this._maxSimultaneousTasks=t||e.DEFAULT_SIMULTANEOUS_TASKS,this._queueId=i||e.DEFAULT_QUEUEID}return e.prototype.enqueuePromise=function(e){var t=this,i=String(this._nextTaskId++),o=function(o,n){t.enqueue(function(t){return e().then(function(e){t(),o(e)},function(e){t(),n(e)}),!0},null,i)},r=function(){t.abortTask(i)};return new n.default(o,r)},e.prototype.enqueue=function(e,t,o){var n=!1;if(!this._isAbortingAll){o=o||String(this._nextTaskId++);var r=this._tasks[o];(!r||r.state===i.Pending&&r.next)&&(r?this.detachTask(r):(n=!0,r=this._tasks[o]=this.createNewTask(e,t,o)),this.insertTask(r),this.ensureProcessingTasks())}return n},e.prototype.abortAll=function(){this._isAbortingAll=!0;for(var e in this._tasks)this.abortTask(e);this._isAbortingAll=!1},e.prototype.abortTask=function(e){var t=this._tasks[e];t&&(t.state===i.Active?(this.completeTask(t),Boolean(t.abort)&&t.abort()):this.detachTask(t),this.removeTaskFromQueue(t))},e.prototype.createNewTask=function(e,t,o){var n={id:o,exec:e,abort:t,timeoutId:0,next:null,prev:null,state:i.Disconnected};return n},e.prototype.detachTask=function(e){return e&&e.state===i.Pending&&(Boolean(e.prev)&&(e.prev.next=e.next),Boolean(e.next)&&(e.next.prev=e.prev),this._taskHead===e&&(this._taskHead=e.next),this._taskTail===e&&(this._taskTail=e.prev),e.state=i.Disconnected,e.prev=e.next=null,this._pendingTaskCount--),e},e.prototype.insertTask=function(e){if(Boolean(e)&&e.state===i.Disconnected){var t=this._taskTail;t?(t.next=e,e.prev=t):this._taskHead=e,this._taskTail=e,e.state=i.Pending,this._pendingTaskCount++}},e.prototype.ensureProcessingTasks=function(){function t(e){if(e){n._activeTaskCount++,n._activeTasks[e.id]=e,e.startTime=(new Date).getTime(),e.state=i.Active;var t=n,o=e.exec(function(){t.completeTask(e)});o||n.completeTask(e)}return e}function o(){for(n._currentSetTimeoutId=0,n._isProcessingTasks=!0;n._pendingTaskCount>0&&n._activeTaskCount<n._maxSimultaneousTasks;){var e=n._taskHead;e=Boolean(e)?t(n.detachTask(e)):null}n._isProcessingTasks=!1,n.ensureProcessingTasks()}var n=this;!n._isProcessingTasks&&!n._currentSetTimeoutId&&n._pendingTaskCount&&n._activeTaskCount<n._maxSimultaneousTasks&&(n._currentSetTimeoutId=n._async.setTimeout(o,e.DELAY_BETWEEN_PROCESSING))},e.prototype.completeTask=function(e){e.state===i.Active&&(this._activeTaskCount--,delete this._activeTasks[e.id],this.removeTaskFromQueue(e))},e.prototype.removeTaskFromQueue=function(e){e.state=i.Complete,delete this._tasks[e.id],this.ensureProcessingTasks()},e.DEFAULT_SIMULTANEOUS_TASKS=5,e.DELAY_BETWEEN_PROCESSING=0,e.DEFAULT_QUEUEID="root",e}();return r}),define("odsp-next/dataSources/upload/odb/UploadUrlBuilder",["require","exports","odsp-utilities/encoding/UriEncoding"],function(e,t,i){var o=function(){function e(e){this._queryStrings={},this._pathStrings=[],Boolean(e)?(this._httpRoot=e,this._pathStrings.push(e),"/"!==e[e.length-1]&&this._pathStrings.push("/")):this._pathStrings.push("/"),this._pathStrings.push("_api/web")}return e.prototype.appendPathSegment=function(e){this._pathStrings.push("/"),this._pathStrings.push(e)},e.prototype.appendMethodCall=function(e,t,i){if(Boolean(e)){if(this._pathStrings.push("/"),this._pathStrings.push(e),this._pathStrings.push("("),Boolean(t)){var o=Object.keys(t);if(1===o.length){var n=Boolean(i)?t[o[0]]:this.encodeStringParameter(t[o[0]]);this._pathStrings.push(n)}else for(var r=0;r<o.length;r++){var s=o[r],a=Boolean(i)?t[s]:this.encodeStringParameter(t[s]);r>0&&this._pathStrings.push(","),this._pathStrings.push(s),this._pathStrings.push("="),this._pathStrings.push(a)}}this._pathStrings.push(")")}},e.prototype.appendMethodCallWithParameterAliases=function(e,t){var i=null;if(Boolean(e)){if(Boolean(t)){i={};for(var o=Object.keys(t),n=0;n<o.length;n++){var r=o[n],s=t[r],a="@"+r;i[r]=a,this.addQueryString(a,s)}}this.appendMethodCall(e,i,!0)}},e.prototype.addQueryString=function(e,t){e in this._queryStrings||(this._queryStrings[e]=t)},e.prototype.toGuidParameter=function(e){return"guid'"+e+"'"},e.prototype.isGuidParameter=function(e){if(Boolean(e)){var t=/^guid'[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'$/i;return t.test(e)}return!1},e.prototype.encodeStringParameter=function(e){var t=e;return Boolean(e)&&(this.isGuidParameter(t)||(t=this.encodeSPRestURIStringToken(t)),t=i.encodeURIComponent(t)),t},e.prototype.encodeSPRestURIStringToken=function(e){if(Boolean(e)){var t=decodeURIComponent(e);
return t=t.replace(/'/g,"''"),"'"+t+"'"}return e},e.prototype.buildUrl=function(){var e=[];if(Boolean(this._queryStrings))for(var t=Object.keys(this._queryStrings),i=0;i<t.length;i++){e.push(0===i?"?":"&");var o=t[i],n="$filter"===o?this._queryStrings[o]:this.encodeStringParameter(this._queryStrings[o]);e.push(o),e.push("="),e.push(n)}var r=this._pathStrings.join("")+e.join("");return r},e}();return o}),define("odsp-next/dataSources/upload/UploadError",["require","exports","./UploadErrorType"],function(e,t,i){var o=function(){function e(e){this.message=e.message,this.errorType=e.errorType||i.none,this.maxSizeInBytes=e.maxSizeInBytes,this.allowRename=e.allowRename||!1}return e}();return o}),define("odsp-next/utilities/validation/CommonValidation",["require","exports"],function(){var e=function(){function e(){}return e.IndexOfIllegalCharInUrlLeafName=function(t){for(var i,o=t.length,n=-1,r=0;o>r;r++)i=t.charCodeAt(r),"."===t.charAt(r)&&r===o-1?n=r:160>i&&("/"===t.charAt(r)||!e.LegalUrlChars[i])&&(n=r);return n},e.LegalUrlChars=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!0,!1,!0,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e}();return e}),define("odsp-next/dataSources/upload/odb/FileValidator",["require","exports","./FileValidationStatus","../../../utilities/validation/CommonValidation","../../../utilities/features/Features","odsp-shared/utilities/string/StringHelper","./Upload.resx"],function(e,t,i,o,n,r,s){var a=function(){function e(){}return e.validate=function(t){return t.validationStatus=i.pending,-1!==o.IndexOfIllegalCharInUrlLeafName(t.name)?(t.validationStatus=i.invalid,void(t.validationResult=s.strings.illegalFileNameError)):0===t.size?(t.validationStatus=i.invalid,void(t.validationResult=s.strings.emptyFileError)):!n.default.isFeatureEnabled(n.default.ChunkUploadLargeFile)&&!n.default.isFeatureEnabled(n.default.ChunkUploadAllFile)&&t.size>e.MAX_FILESIZE?(t.validationStatus=i.invalid,void(t.validationResult=r.format(s.strings.uploadMaxFileSizeError,Math.floor(e.MAX_FILESIZE/1048576)))):(t.validationStatus=i.valid,void(t.validationResult=""))},e.MAX_FILESIZE=10737418240,e}();return a});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/odb/SingleFileUploader",["require","exports","knockout","odsp-utilities/async/Promise","../../../utilities/queue/Queue","odsp-utilities/guid/Guid","odsp-shared/utilities/logging/events/Upload.event","odsp-utilities/logging/events/Qos.event","./UploadUrlBuilder","odsp-utilities/async/Async","../../../utilities/features/Features","../../../dataSources/base/odb/DataSource","odsp-utilities/encoding/UriEncoding","../UploadState","../NameConflictBehavior","../UploadError","../UploadErrorType","./FileValidator","./FileValidationStatus","../../../resources/ProviderResourceKeys","../../../resources/DataSourceResourceKeys","../../../models/item/OneDriveItem","../../../models/item/ItemType","../../../controls/dragAndDrop/DropHelper"],function(e,t,i,o,n,r,s,a,l,d,c,p,u,h,m,g,f,v,b,x,y,_,k,T){var S=function(e){function t(o,n,r,s,a,l,c){e.call(this,l),this._id=t._guidSeed++,this._file=n,this._parentItem=r,this._folderUpload=a,this._aborted=!1,this._executing=!1,this._uploadId=null,this._pendingRestart=!1,this._chunkNumber=0,this._everStarted=!1,this._retryGuid=0,this._dequeueCallback=null,this._async=new d(this),this.totalBytes=i.observable(this._file.size),this.uploadedBytes=i.observable(0),this.fileName=i.observable(this._file.name),this.iconName=i.observable(this._file.iconName),this.state=i.observable(h.queued),this.error=i.observable(null),this.nameConflictBehavior=i.observable(m.none),this.allowRename=!1,this._itemProvider=o.consume(x.item),this._urlDataSource=o.consume(y.url),this.uploadedItem=null,this._uploadMetadata=c,this._resources=o}return __extends(t,e),t.prototype.getDataSourceName=function(){return"SingleFileUploader"},t.prototype.start=function(){var e=this;if(!this.startPromise){var i=t.TASKID_PREFIX+e._id+"_"+e._retryGuid,n=function(o,n){e._everStarted||t._currentCountOfFilesUploading<t.MAX_FILES_TO_UPLOAD?(e._everStarted||t._currentCountOfFilesUploading++,e._everStarted=!0,e._aborted||t._uploadQueue.enqueue(function(t){return e._shouldContinueRequest()?(e._dequeueCallback=t,e._executing=!0,e.error(null),e.state(h.started),e.uploadedBytes(0),e.startUpload().then(o,n),!0):!1},function(){e.abort()},i)):e._file.dispose()},r=function(){t._uploadQueue.abortTask(i)};this.startPromise=new o.default(n,r)}return this.startPromise},t.prototype.startUpload=function(){var e=this;if(e.validateFile(e._file),e._file.validationStatus===b.invalid)return e._handleError(new g({message:e._file.validationResult,errorType:f.none})),o.default.wrapError(e._file.validationResult);var i=function(i,o){e._executing=!0;var n=function(t){e.uploadedItem=t;var o=function(){e._shouldContinueRequest()&&(e.state(h.completed),e._callDequeueCallback(),e._uploadEvent&&(e._uploadEvent.end({resultType:a.ResultTypeEnum.Success}),e._uploadEvent=null),i())};e._uploadMetadata?T.updateMetadata([t],e._uploadMetadata,o,e._resources):o()},l=function(t){if(e._shouldContinueRequest()){var i=e._getUploadErrorFromErrorResponse(t);e._handleError(i),o(i.message)}};if(!e._uploadEvent){for(var d=!1,p=e._parentItem;p;){if(p.isMountPoint){d=!0;break}p=p.parent}e._uploadEvent=new s.Upload({name:"Upload."+e._file.upType,dragAndDrop:e._file.dragDrop,size:e._file.size,extension:e._file.extension.replace(".",""),folderUpload:e._folderUpload,groupFolder:d})}c.default.isFeatureEnabled(c.default.ChunkUploadLargeFile)&&e._file.size>t.LARGE_FILESIZE||c.default.isFeatureEnabled(c.default.ChunkUploadAllFile)?(Boolean(e._uploadId)||(e._uploadId=r.default.generate()),e._startFragmentsUpload().then(n,l)):e._isConflictFile(e._parentItem.id,e._file.name).then(function(t){if(t){var i=new g({message:"",errorType:f.conflict});e._handleError(i)}else{var o=new FileReader;o.onload=function(t){var i=t.target.result;e._uploadFile(e._parentItem.id,e._file.name,i).then(n,l)},o.readAsArrayBuffer(e._file.file)}})},n=function(){e.abort()};return new o.default(i,n)},t.prototype.abort=function(){this._aborted||(this._uploadEvent&&(this._uploadEvent.end({resultType:a.ResultTypeEnum.ExpectedFailure,resultCode:"Aborted"}),this._uploadEvent=null),this._cancelChunkUpload(),this._uploadId=null,this._pendingRestart=!1,this.startPromise&&this.startPromise.cancel(),this._file.dispose(),this._async.dispose(),this.error(null),this.state(h.aborted),this._callDequeueCallback(),this._everStarted&&t._currentCountOfFilesUploading--,this._aborted=!0)},t.prototype.restart=function(){this._executing?(this._pendingRestart=!0,this._cancelChunkUpload()):(this.startPromise=null,this._aborted=!1,this.start())},t.prototype.validateFile=function(e){v.validate(e)},t.prototype.setFileData=function(){},t.prototype._callDequeueCallback=function(){this._dequeueCallback&&(this._executing=!1,this._dequeueCallback(),this._dequeueCallback=null)},t.prototype._handleError=function(e){e&&(this._uploadEvent&&(this._uploadEvent.end({resultType:a.ResultTypeEnum.Failure,resultCode:f[e.errorType]}),this._uploadEvent=null),this.error(e),this.state(h.failed),this._callDequeueCallback())},t.prototype._getUploadErrorFromErrorResponse=function(e){var i,o,n,r=this._getUploaErrorCodeFromErrorResponse(e);return n=e.message&&e.message.value?e.message.value:e,i=r===t.ERRORCODE_DOCALREADYEXISTS?f.conflict:f.none,o=new g({message:n,errorType:i,allowRename:this.allowRename})},t.prototype._getUploaErrorCodeFromErrorResponse=function(e){var t,i;return e.code&&(t=e.code.split(","),i=t.length>0?Number(t[0]):null),i},t.prototype._getUploadFileUrl=function(e,t){var i=[],o=this._parentItem.properties?this._parentItem.properties.UniqueId:null;i.push(u.escapeUrlForCallback(this._context.webUrl)),i.push("/");var n="";return o?(i.push("_api/web/getfolderbyid(@fileUrl"),n=o):(i.push("_api/web/GetFolderByServerRelativeUrl(@fileUrl"),n=u.encodeRestUriStringToken(e)),i.push(")/Files/Add(url=@url"),i.push(this.nameConflictBehavior()===m.overwrite?",overwrite=true)":")"),i.push("?"),this._uploadMetadata&&this._uploadMetadata.group&&i.push("$Expand=ListItemAllFields&"),i.push("@fileUrl='"),i.push(n),i.push("'&@url='"),i.push(u.encodeRestUriStringToken(t)),i.push("'"),i.join("")},t.prototype._isConflictFile=function(e,t){if(this.nameConflictBehavior()===m.overwrite)return o.default.wrap(!1);var i=new l(this._context.webUrl),n={folder:u.encodeRestUriStringToken(e)},r="Name eq '"+u.encodeRestUriStringToken(t)+"'";i.appendMethodCall("GetFolderByServerRelativeUrl",n),i.appendPathSegment("Files"),i.addQueryString("$filter",r);var s=this.getData(function(){return i.buildUrl()},function(e){var t=JSON.parse(e);return t&&t.d&&t.d.results&&t.d.results.length>0?!0:!1},"GetFile");return s.then(function(e){return e},function(){return!1})},t.prototype._uploadFile=function(e,t,i){var o=this;return this.getData(function(){return o._getUploadFileUrl(e,t)},function(e){o.setFileData(e);var t=JSON.parse(e);t=t.d;var i=new _;return i.type=k.File,i.id=t.ServerRelativeUrl,i.key=o._urlDataSource.getKey(t),i.name=t.Name,i.properties=t.ListItemAllFields?{ID:t.ListItemAllFields.Id}:null,i},"UploadFile",function(){return i})},t.prototype._generateChunkPostUrl=function(e,t){var i=this._file,o=this._parentItem.properties?this._parentItem.properties.UniqueId:null,n=new l(this._context.webUrl),r="",s={folder:u.encodeRestUriStringToken(this._parentItem.id)},a={uniqueId:o},d={file:u.encodeRestUriStringToken(i.name)},c={file:u.encodeRestUriStringToken(this._parentItem.id+"/"+i.name)},p={},h=n.toGuidParameter(this._uploadId),g=i.size<=t;return 0===this._chunkNumber?(this._uploadMethod="StartUpload",o?n.appendMethodCallWithParameterAliases("getfolderbyid",a):n.appendMethodCallWithParameterAliases("getFolderByServerRelativeUrl",s),n.appendPathSegment("files"),this.nameConflictBehavior()===m.overwrite?n.appendMethodCallWithParameterAliases("getByUrlOrAddStub",d):n.appendMethodCallWithParameterAliases("addStub",d),p={uploadId:h}):(this._uploadMethod=g?"FinishUpload":"ContinueUpload",o?(n.appendMethodCallWithParameterAliases("getfolderbyid",a),n.appendPathSegment("files"),n.appendMethodCallWithParameterAliases("getByUrl",d)):n.appendMethodCallWithParameterAliases("getFileByServerRelativeUrl",c),p={uploadId:h,fileOffset:e}),n.appendMethodCall(this._uploadMethod,p),r=n.buildUrl()},t.prototype._sendFileRequest=function(e,t){var i=this;return i.getData(function(){return i._generateChunkPostUrl(e,t)},function(e){return i.setFileData(e),e},"SendFileRequest",function(){return i._file.getBlob(e,t)})},t.prototype._uploadFragment=function(e,i,n){var r=this,s=this._file.size,a=function(o,a){r._sendFileRequest(e,i).done(function(){r.uploadedBytes(i),r._shouldContinueRequest()&&(s>i?(r._chunkNumber++,e=i,i=Math.min(e+t.UPLOAD_CHUNK_SIZE,s),r._uploadFragment(e,i,t.MAX_RETRY_COUNT).done(o,a)):o())},function(s){r._shouldContinueRequest()&&(n-->0&&r._canRetry(s)?r._async.setTimeout(function(){r._uploadFragment(e,i,n).done(o,a)},t.RETRY_INTERVAL):a(s))})};return new o.default(a,null)},t.prototype._startFragmentsUpload=function(){var e=0,i=Math.min(e+t.UPLOAD_CHUNK_SIZE,this._file.size);return this._uploadFragment(e,i,t.MAX_RETRY_COUNT)},t.prototype._canRetry=function(e){var i=this._getUploaErrorCodeFromErrorResponse(e),o=!0;return i===t.ERRORCODE_DOCALREADYEXISTS&&(o=!1),o},t.prototype._cancelChunkUpload=function(){if(this._uploadId){this._uploadMethod="CancelUpload";var e=new l(this._context.webUrl),t=this._file,i={file:this._parentItem.id+"/"+t.name},n=e.toGuidParameter(this._uploadId),r={uploadId:n},s="";return e.appendMethodCallWithParameterAliases("getFileByServerRelativeUrl",i),e.appendMethodCall(this._uploadMethod,r),s=e.buildUrl(),this.getData(function(){return s},function(e){return e},"CancelUploadSession")}return o.default.wrap("")},t.prototype._hasPendingRestart=function(){return this._pendingRestart?(this._callDequeueCallback(),this._pendingRestart=!1,this.restart(),!0):!1},t.prototype._shouldContinueRequest=function(){return!this._aborted&&!this._hasPendingRestart()},t.MEGABYTES=1048576,t.UPLOAD_CHUNK_SIZE=8*t.MEGABYTES,t.LARGE_FILESIZE=30*t.MEGABYTES,t.MAX_CURRENT_UPLOADS=3,t.MAX_FILES_TO_UPLOAD=1e3,t.MAX_RETRY_COUNT=3,t.RETRY_INTERVAL=1e3,t.TASKID_PREFIX="uploadqueue_",t.ERRORCODE_DOCALREADYEXISTS=-2130575257,t.throttler=new d,t._uploadQueue=new n(t.MAX_CURRENT_UPLOADS,"upload"),t._currentCountOfFilesUploading=0,t._guidSeed=0,t}(p);return S}),define("odsp-next/dataSources/upload/o365/VideoFileValidator",["require","exports","../odb/FileValidationStatus"],function(e,t,i){var o=function(){function e(){}return e.validate=function(t){t.validationStatus=i.pending;var o=t.extension.toLowerCase();return 0===e.AcceptedVideoExtensions.filter(function(e){return e===o}).length?(t.validationStatus=i.invalid,void(t.validationResult="File with extension "+o+" cannot be uploaded")):(t.validationStatus=i.valid,void(t.validationResult=""))},e.AcceptedVideoExtensions=[".wmv",".3gp",".3g2",".3gp2",".asf",".mts",".m2ts",".avi",".mod",".dv",".ts",".vob",".xesc",".mp4",".mpeg",".mpg",".m2v",".ismv",".mov",".m4v"],e}();return o});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/o365/SingleVideoFileUploader",["require","exports","knockout","../odb/SingleFileUploader","./VideoFileValidator"],function(e,t,i,o,n){{var r=function(e){function t(t,o,n,r,s,a){e.call(this,t,o,n,r,s,a),this.fileUniqueId=i.observable("")}return __extends(t,e),t.prototype.validateFile=function(e){n.validate(e)},t.prototype.setFileData=function(e){var t=this.parseAddOperationResponse(e);this.fileUniqueId(t.UniqueId)},t.prototype.getData=function(t,i,o,n,r,s,a,l,d){return void 0===r&&(r="POST"),e.prototype.getData.call(this,t,i,o,n,r,s,a,l,d,!0)},t.prototype.parseAddOperationResponse=function(e){var t=JSON.parse(e);return t.d},t}(o);!function(){function e(){}return e}()}return r});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/o365/VideoFileUploadManager",["require","exports","../BaseBatchUploader","../odb/Html5FileUpload","./SingleVideoFileUploader","../../../resources/SPOResourceKeys","odsp-utilities/async/Promise"],function(e,t,i,o,n,r,s){var a=function(e){function t(t){if(e.call(this,t),t.files)for(var i=t.files,s=0,a=i[s];a;){var l=new o(a,t.wasDragAndDropped),d=new n(this.resources,l,t.parentItem,this.batchStartTime,null,t.resources.consume(r.hostSettings));this.filesUploading.push(d),s++,a=i[s]}}return __extends(t,e),t.prototype.start=function(){for(var e=this.filesUploading(),t=0;t<e.length;t++)e[t].start();return s.default.wrap()},t}(i);return a}),define("odsp-next/dataSources/upload/FileItem",["require","exports"],function(){var e=function(){function e(e){if(e){this.file=e,this.name=e.name,this.relativePath="";var t=e.webkitRelativePath;this._hasWebKitPath=!1,t&&(this.relativePath=t,this._hasWebKitPath=!0)}}return e.prototype.addParentPath=function(e){this._hasWebKitPath||(this.relativePath=this.relativePath&&e.relativePath?e.relativePath+"/"+this.relativePath:e.relativePath?e.relativePath+"/"+this.name:this.name)},e}();return e});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/SingleFolderUploader",["require","exports","odsp-shared/base/BaseModel","./UploadState","./NameConflictBehavior","./UploadError","../../resources/DataSourceResourceKeys","knockout"],function(e,t,i,o,n,r,s,a){var l=function(e){function t(t){e.call(this,t),this._itemDataSource=this.resources.consume(s.items),this._parent=t.parent,this._item=t.item,this.state=a.observable(o.queued),this.uploadedBytes=a.observable(0),this.totalBytes=a.observable(0),this.fileName=a.observable(t.name),this.iconName=a.observable("folder"),this.error=a.observable(),this.nameConflictBehavior=a.observable(n.none),this.allowRename=!1,this.isDownlevel=!1}return __extends(t,e),t.prototype.start=function(){var e=this;this._itemDataSource.createFolder({parent:this._parent,folderName:this.fileName.peek()}).then(function(t){e._item(t),e.state(o.completed)},function(t){e.error(new r({message:t})),e.state(o.failed)}),this.state(o.started)},t.prototype.abort=function(){this.state(o.aborted)},t.prototype.restart=function(){},t}(i);Object.defineProperty(t,"__esModule",{value:!0}),t.default=l});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/BaseFolderUploadManager",["require","exports","./BaseBatchUploader","odsp-utilities/async/Promise","./FileItem","./SingleFolderUploader","knockout"],function(e,t,i,o,n,r,s){var a=function(e){function t(t){e.call(this,t),this._createdFolders=s.observable({"":t.parentItem}),this._dirsToCreate=[],this._batchStartTime=Date.now(),this._wasDragAndDropped=t.wasDragAndDropped,this._fileList=t.files,this._uploaders={},this._paths={},this._uploadMetadata=t.metadata}return __extends(t,e),t.prototype.start=function(){var e=this,t=this._fileList;return t?this._loadFiles(t).then(function(t){t.forEach(function(t){e._addFilePath(t.relativePath)}),e._createDirectories(),e._uploadFiles(t)}):o.default.wrap()},t.prototype.createSingleFileUploader=function(){throw Error("Not Implemented")},t.prototype._uploadFiles=function(e){var t=this;e.forEach(function(e){var i=e.relativePath.substring(0,e.relativePath.lastIndexOf("/")),o=t.createComputed(function(){var n=t._createdFolders();if(n[i]&&!t._uploaders[e.relativePath]){var r=n[i],s=t.createSingleFileUploader(e.file,r,t._uploadMetadata);t.filesUploading.push(s),s.start(),t._uploaders[e.relativePath]=s,o&&o.dispose()}})})},t.prototype._loadFiles=function(e){for(var t=[],i=function(e){return new o.default(function(t,i){e.file(function(e){return t(new n(e))},i)})},r=0;r<e.length;r++){var s=e[r],a=void 0;if(s){if(s.isFile||s.isDirectory)a=s;else if(s.getAsEntry)a=s.getAsEntry();else if(s.webkitGetAsEntry)a=s.webkitGetAsEntry();else{if("function"==typeof s.getAsFile){t.push(new n(s.getAsFile()));continue}if(File&&s instanceof File){t.push(new n(s));continue}}a&&a.isFile?t.push(i(a)):a&&a.isDirectory&&t.push(this._loadDirectory(a))}}return o.default.all(t).then(function(e){var t=new n;t.children=e;for(var i=[t],o=[],r=function(e){return function(t){t.addParentPath(e),t.children?i.push(t):o.push(t)}};i.length;){var s=i.shift();s.children.forEach(r(s))}return o})},t.prototype._loadDirectory=function(e){var t=this,i=e.createReader();return new o.default(function(o,r){var s=[],a=function(){i.readEntries(function(i){i.length?(s=s.concat(Array.prototype.slice.call(i,0)),a()):t._loadFiles(s).done(function(t){var i=new n;i.name=e.name,i.children=t,o(i)},r)},r)};a()})},t.prototype._addFilePath=function(e){var t=this._paths,i=e.split("/");if(i.length>1)for(var o="",n=0,r=i.slice(0,-1);n<r.length;n++){var s=r[n];o&&(o+="/"),o+=s,t[o]||(this._dirsToCreate.push(o),t[o]=!0)}},t.prototype._createDirectories=function(){var e=this;this._dirsToCreate.forEach(function(t){var i=t.lastIndexOf("/"),o=t.substring(i+1),n=t.substring(0,i),a=s.observable();e.createComputed(function(){if(a()){var i=e._createdFolders.peek();i[t]=a(),e._createdFolders.valueHasMutated()}});var l=e.createComputed(function(){var i=e._createdFolders(),s=e._uploaders;if(i[n]&&!i[t]&&!s[t]){var d=new(e.managed(r.default))({parent:i[n],name:o,item:a});e.filesUploading.push(d),s[t]=d,d.start(),l&&l.dispose()}})})},t}(i);return a});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/dataSources/upload/o365/VideoFolderUploadManager",["require","exports","../BaseFolderUploadManager","../odb/Html5FileUpload","./SingleVideoFileUploader","../../../resources/SPOResourceKeys"],function(e,t,i,o,n,r){var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.createSingleFileUploader=function(e,t){var i=new(this.managed(o))(e,this._wasDragAndDropped);return new n(this.resources,i,t,this._batchStartTime,!0,this.resources.consume(r.hostSettings))},t}(i);return s}),define("odsp-next/dataSources/upload/o365/VideoUploadManager",["require","exports","odsp-utilities/async/Promise","../UploadProcessorType","./VideoFileUploadManager","./VideoFolderUploadManager"],function(e,t,i,o,n,r){var s=function(){function e(){}return e.getManager=function(e){return e.type===o.Html5file?i.default.wrap(new n(e)):e.type===o.Folder?i.default.wrap(new r(e)):i.default.wrapError(Error("Unsupported upload processor type"))},e}();return s});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};define("odsp-next/providers/operator/VideoUploadOperator",["require","exports","./BaseUploadOperator","../../dataSources/upload/o365/VideoUploadManager","../../../odsp-utilities/async/RequireHelper","../../models/operation/OperationType","knockout"],function(e,t,i,o,n,r,s){var a=function(t){function i(e){t.call(this,e),this._payloadsByKey={}}return __extends(i,t),i.prototype.getUploader=function(){var t=this;return n.promise(e,"../../dataSources/upload/o365/VideoUploadManager").then(function(){return o.getManager(t._context)})},i.prototype.getOperationDetails=function(e){var i=t.prototype.getOperationDetails.call(this,e);return null==this._payloadsByKey[e.key]&&(i.payloads.uploadVideos=this._payloadsByKey[e.key]={id:s.observable(""),title:s.observable(i.name),description:s.observable(""),changesSaved:s.observable(!1)}),null!=e.output.videoId&&this._payloadsByKey[e.key].id(e.output.videoId),i.type=r.uploadVideos,i},i.prototype.updateTaskOutput=function(e,t){var i=t.changeOutput(function(){return{totalBytes:t.output.totalBytes,uploadedBytes:t.output.uploadedBytes,videoId:e.fileUniqueId()}});return i},i}(i.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}),define("odsp-next/providers/operator/Operators",["require","exports","./RestoreItemsOperator","./RotateItemsOperator","./DeleteItemsOperator","./UpdateBundleOperator","./CreateFolderOperator","./RenameItemOperator","./UploadOperator","./SetAlbumCoverPhotoOperator","./CreateAlbumFromFolderOperator","./MergeFaceGroupsOperator","./CreateAlbumOperator","./VideoUploadOperator"],function(e,t){var i;!function(){"use strict"}(i||(i={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=i});